[{"id":"5d651a81.8ece7c","type":"tab","label":"Flow 1","disabled":false,"info":""},{"id":"105a4573.6dbd83","type":"tab","label":"Flow 2","disabled":false,"info":""},{"id":"21131f62.58309","type":"firebase admin","name":"Test"},{"id":"37634fe.5055fb","type":"firebase admin","name":""},{"id":"bb10ed42.1d56c","type":"twitter-credentials","screen_name":"Mohamme64231752"},{"id":"430592e7.ee35cc","type":"twitter-credentials","screen_name":"arjun_ananth23"},{"id":"6bc8f748.8274a8","type":"twitter-credentials","screen_name":"JustinK97551430"},{"id":"737bbe1a.be40e8","type":"http in","z":"5d651a81.8ece7c","name":"","url":"/tweetsfinal","method":"get","upload":false,"swaggerDoc":"","x":440,"y":460,"wires":[["99747f96.0eee08"]]},{"id":"553764c9.71696c","type":"http response","z":"5d651a81.8ece7c","name":"","statusCode":"","headers":{},"x":910,"y":460,"wires":[]},{"id":"91b3daff.e51dd","type":"function","z":"5d651a81.8ece7c","name":"Function for array of strings","func":"var tweets = []; \n\nvar count; \nfor (var i = 0; i < Object.keys(msg.payload[0]).length; i++){\n\n  tweets.push(msg.payload[0][i].x);\n\n  \n}\n\nmsg.payload = tweets;\nreturn msg;\n\n// for(var i = 0; i < Object.keys(ox2[0]).length; i++){\n//   ox_loc.push({\"x\": ox2[0][i].x, \"value\": ox2[0][i].value});\n// }","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1995.2208786010742,"y":1113.848726272583,"wires":[["2c7c01b0.b8423e"]]},{"id":"98d96b84.1d2a2","type":"natural-language-understanding","z":"5d651a81.8ece7c","name":"","categories":false,"limitcategories":"8","concepts":false,"maxconcepts":"8","doc-emotion":true,"doc-emotion-target":"","doc-sentiment":false,"doc-sentiment-target":"","entity":false,"entity-emotion":false,"entity-sentiment":false,"maxentities":"50","keyword":false,"keyword-emotion":true,"keyword-sentiment":true,"maxkeywords":"50","metadata":false,"relation":false,"semantic":false,"semantic-entities":true,"semantic-keywords":true,"maxsemantics":"50","limittextcharacters":"0","syntax":false,"syntax-sentences":false,"syntax-tokens-lemma":false,"syntax-tokens-pos":false,"service-endpoint":"https://api.us-south.natural-language-understanding.watson.cloud.ibm.com/instances/3252dc64-1496-4697-bd85-69b0a850cc46","x":2055.220878601074,"y":1275.2124004364014,"wires":[["8681ac96.58f688"]]},{"id":"8681ac96.58f688","type":"function","z":"5d651a81.8ece7c","name":"","func":"msg.payload = msg.features;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2256.9788217544556,"y":1274.545841217041,"wires":[["4a9eebd9.b05684"]],"l":false},{"id":"4a9eebd9.b05684","type":"function","z":"5d651a81.8ece7c","name":"create sentiment array","func":"\n\nvar sentiment = global.get('sentimentIC') || [];\n\nsentiment.push(msg.features.emotion.document.emotion.joy);\nglobal.set(\"sentimentIC\", sentiment);\nmsg.payload = sentiment; \n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2417.615264892578,"y":1269.7577514648438,"wires":[["1b8211b3.98669e","5a846176.ccffc"]]},{"id":"1b8211b3.98669e","type":"function","z":"5d651a81.8ece7c","name":"avg joy","func":"var sentiment = global.get('sentimentIC') || [];\nvar sum = 0;\nfor(var i = 0; i < sentiment.length; i++){\n    sum += sentiment[i];\n}\n\n\n\nvar average = 0;\n\nif(sentiment.length > 0){\n    average = sum/sentiment.length; \n}\n\nmsg.payload = {\"Mood\": average};\nmsg.average = average; \n\nif(msg.finished == true){\n    \n    return msg; \n}\nelse{\n\n    return; \n}\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2371.4329872131348,"y":1186.1519031524658,"wires":[["35ff3fb0.c4623","8b8b9471.278ff8"]]},{"id":"9269acee.3fb358","type":"function","z":"5d651a81.8ece7c","name":"","func":"msg.finished = true; \n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2203.2210874557495,"y":1186.9102592468262,"wires":[["1b8211b3.98669e","5a846176.ccffc"]],"l":false},{"id":"8d2648d3.6c4b18","type":"inject","z":"5d651a81.8ece7c","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":55,"y":60,"wires":[["ce4f8de2.9ce82"]],"l":false},{"id":"ce4f8de2.9ce82","type":"function","z":"5d651a81.8ece7c","name":"Declare Global Tweet Variables","func":"//search\nglobal.set('search_text', []); \nglobal.set('search_tweets', []); \nglobal.set('search_retweets', []); \n\n\n//IBM\n//Imperial College London\nglobal.set('ibm_text', []); \nglobal.set('ibm_tweets', 0);\nglobal.set('ibm_retweets', 0);\nglobal.set('still_processing_ibm', false); \n\n\n//Imperial College London\nglobal.set('icl_text', []); \nglobal.set('icl_tweets', 0);\nglobal.set('icl_retweets', 0);\nglobal.set('still_processing_icl', false); \n\n//Oxford University\nglobal.set('ox_text', []); \nglobal.set('ox_tweets', 0);\nglobal.set('ox_retweets', 0);\nglobal.set('still_processing_ox', false); \n\n//Uni of Birmingham\nglobal.set('bham_text', []); \nglobal.set('bham_tweets', 0);\nglobal.set('bham_retweets', 0);\nglobal.set('still_processing_bham', false); \n\n//Uni of Bristol\nglobal.set('brist_text', []); \nglobal.set('brist_tweets', 0);\nglobal.set('brist_retweets', 0);\nglobal.set('still_processing_brist', false);\n\n//Uni of Cambridge\nglobal.set('cam_text', []); \nglobal.set('cam_tweets', 0);\nglobal.set('cam_retweets', 0);\nglobal.set('still_processing_cam', false);\n\n//Uni of Cambridge\nglobal.set('cardiff_text', []); \nglobal.set('cardiff_tweets', 0);\nglobal.set('cardiff_retweets', 0);\nglobal.set('still_processing_cardiff', false);\n\n//Uni of Durham\nglobal.set('durh_text', []); \nglobal.set('durh_tweets', 0);\nglobal.set('durh_retweets', 0);\nglobal.set('still_processing_durh', false);\n\n//Uni of Edinburgh\nglobal.set('edin_text', []); \nglobal.set('edin_tweets', 0);\nglobal.set('edin_retweets', 0);\nglobal.set('still_processing_edin', false);\n\n//Uni of Exeter\nglobal.set('ex_text', []); \nglobal.set('ex_tweets', 0);\nglobal.set('ex_retweets', 0);\nglobal.set('still_processing_ex', false);\n\n//Uni of Glasgow\nglobal.set('glas_text', []); \nglobal.set('glas_tweets', 0);\nglobal.set('glas_retweets', 0);\nglobal.set('still_processing_glas', false);\n\n\n// //KCL\n// global.set('kcl_text', []); \n// global.set('kcl_tweets', 0);\n// global.set('kcl_retweets', 0);\n// global.set('still_processing_kcl', false);\n\n//UCL\nglobal.set('ucl_text', []); \nglobal.set('ucl_tweets', 0);\nglobal.set('ucl_retweets', 0);\nglobal.set('still_processing_ucl', false);\n\n\n//Leeds\nglobal.set('leeds_text', []); \nglobal.set('leeds_tweets', 0);\nglobal.set('leeds_retweets', 0);\nglobal.set('still_processing_leeds', false);\n\n//Liverpool\nglobal.set('liv_text', []); \nglobal.set('liv_tweets', 0);\nglobal.set('liv_retweets', 0);\nglobal.set('still_processing_liv', false);\n\n// //LSE\n// global.set('lse_text', []); \n// global.set('lse_tweets', 0);\n// global.set('lse_retweets', 0);\n// global.set('still_processing_lse', false);\n\n//Manchester\nglobal.set('man_text', []); \nglobal.set('man_tweets', 0);\nglobal.set('man_retweets', 0);\nglobal.set('still_processing_man', false);\n\n//Sheffield\nglobal.set('shef_text', []); \nglobal.set('shef_tweets', 0);\nglobal.set('shef_retweets', 0);\nglobal.set('still_processing_shef', false);\n\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":300,"y":60,"wires":[[]]},{"id":"d7c2f655.7dd218","type":"complete","z":"5d651a81.8ece7c","name":"Process New Tweets for ICL","scope":["608b135.252d9ec"],"uncaught":false,"x":1317.370132446289,"y":1173.2565784454346,"wires":[["83781923.8f4e1","f4747cd.c3ee"]]},{"id":"e6993b6b.a7e54","type":"function","z":"5d651a81.8ece7c","name":"Convert to Array of Strings","func":"var tweets = []; \n\nvar count; \nfor (var i = 0; i < Object.keys(msg.payload[0]).length; i++){\n\n  tweets.push(msg.payload[0][i].x);\n\n  \n}\n\nmsg.payload = tweets;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1357.8424072265625,"y":1325.5010414123535,"wires":[["a71a3db7.5855c8","8550c38d.8497"]]},{"id":"a71a3db7.5855c8","type":"function","z":"5d651a81.8ece7c","name":"Get 20 Most Common Words for Word Cloud (ICL)","func":"words = [];\n\nstopwords = [\"a\", \"able\", \"about\",\n        \"across\", \"after\", \"all\", \"almost\", \"also\", \"am\", \"among\", \"an\",\n        \"and\", \"any\", \"are\", \"as\", \"at\", \"b\", \"be\", \"because\", \"been\",\n        \"but\", \"by\", \"c\", \"can\", \"cannot\", \"could\", \"d\", \"dear\", \"did\",\n        \"do\", \"does\", \"e\", \"either\", \"else\", \"ever\", \"every\", \"f\", \"for\",\n        \"from\", \"g\", \"get\", \"got\", \"h\", \"had\", \"has\", \"have\", \"he\", \"her\",\n        \"hers\", \"him\", \"his\", \"how\", \"however\", \"i\", \"if\", \"in\", \"into\",\n        \"is\", \"it\", \"its\", \"j\", \"just\", \"k\", \"l\", \"least\", \"let\", \"like\",\n        \"likely\", \"m\", \"may\", \"me\", \"might\", \"most\", \"must\", \"my\",\n        \"neither\", \"n\", \"no\", \"nor\", \"not\", \"o\", \"of\", \"off\", \"often\",\n        \"on\", \"only\", \"or\", \"other\", \"our\", \"own\", \"p\", \"q\", \"r\", \"rather\",\n        \"s\", \"said\", \"say\", \"says\", \"she\", \"should\", \"since\", \"so\", \"some\",\n        \"t\", \"than\", \"that\", \"the\", \"their\", \"them\", \"then\", \"there\",\n        \"these\", \"they\", \"this\", \"tis\", \"to\", \"too\", \"twas\", \"u\", \"us\",\n        \"v\", \"w\", \"wants\", \"was\", \"we\", \"were\", \"what\", \"when\", \"where\",\n        \"which\", \"while\", \"who\", \"whom\", \"why\", \"will\", \"with\", \"would\",\n        \"x\", \"y\", \"yet\", \"you\", \"your\", \"z\", \"rt\"];\n\nfor(var i =0; i < msg.payload.length; i++){\n    var temp = msg.payload[i]\n    .replace(/[0-9]/g, \"\")\n    .replace(/(?:https?|ftp):\\/\\/[\\n\\S]+/g, \"\")\n    .replace(/[/.,?!:;&()\"'%@|]/g, \"\")\n\n    .toLowerCase()\n    .replace(/\\n/g, \" \")\n    .replace(/-/g, \"\")\n    .replace(/_/g, \"\")\n    .split(\" \");\n    \n    for(var j = 0; j < temp.length; j++){\n        var stopword = stopwords.includes(temp[j]);\n        if(stopword){\n            temp[j] = \"\";\n        }\n        if(temp[j] != \"\"){\n\n            words.push(temp[j]);\n        }\n\n    }\n}\n\nconst map = words.reduce((acc, word) => {\n\n    let count = acc.get(word) || 0;\n    acc.set(word, ++count)\n    return acc;\n  }, new Map());\n  // Sort by counter first from higher to lower. If counter is the same,\n  // then sort by alphabetical order\n  const topk = [...map].sort((a, b) => b[1] - a[1] || a[0].localeCompare(b[0]));\n  // Return array of k most frequent words\n   \n    msg.payload = topk.slice(0, 20);\n    //.map(item => item[0]);\n    \n    var loc_object = []; \n    //.map(item => item[0]);\n    for(var i = 0; i < msg.payload.length; i++){\n        loc_object[i] = {\"x\": msg.payload[i][0], \"value\": msg.payload[i][1]};\n        \n    }\n\n\n\nmsg.payload = loc_object;\n\n\n\n\n//msg.payload = words\nreturn msg;\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1800.4786376953125,"y":1326.501220703125,"wires":[["6b2b08dd.f2fbc"]]},{"id":"8550c38d.8497","type":"function","z":"5d651a81.8ece7c","name":"Locations Wordcloud (ICL)","func":"words = [];\n\nplaces = ['bath',  'birmingham', 'bradford', 'brighton and hove', 'bristol', 'cambridge',  'canterbury', 'carlisle', 'chester', 'chichester', 'coventry', 'derby', 'durham', ' ely ', 'exeter', 'gloucester', 'hereford', 'kingston upon hull', 'lancaster', 'leeds', 'leicester', 'lichfield', 'lincoln', 'liverpool', 'london', 'manchester', 'newcastle upon tyne', 'norwich', 'nottingham', 'oxford', 'peterborough', 'plymouth', 'portsmouth', 'preston', 'ripon', 'salford', 'salisbury', 'sheffield', 'southampton', 'st albans', 'stoke-on-trent', 'sunderland', 'truro', 'wakefield', 'wells', 'westminster', 'winchester', 'wolverhampton', 'worcester', 'york', 'bangor', 'cardiff', 'newport', 'st davids', 'swansea', 'aberdeen', 'dundee', 'edinburgh', 'glasgow', 'inverness', 'stirling', 'armagh', 'belfast', 'londonderry', 'lisburn', 'newry', 'aberdeenshire', 'angus',  'antrim', 'argyll', 'armagh',\n'ayrshire',\n'banffshire',\n'berkshire',\n'berwickshire',\n'bristol',\n'buckinghamshire',\n' bute ',\n'caithness',\n'cambridgeshire',\n'cheshire',\n 'london' ,\n'clackmannanshire',\n'clwyd',\n'cornwall',\n'cumbria',\n'derbyshire',\n'devon',\n'dorset',\n'county down',\n'dumfriesshire',\n'dunbartonshire',\n'durham',\n'dyfed',\n'east lothian',\n'east riding of yorkshire',\n'east sussex',\n'essex',\n'fermanagh',\n'fife',\n'gloucestershire',\n'greater london',\n'greater manchester',\n'gwent',\n'gwynedd',\n'hampshire',\n'herefordshire',\n'hertfordshire',\n'inverness-shire',\n'isle of wight',\n'kent',\n'kincardineshire',\n'kinross-shire',\n'kirkcudbrightshire',\n'lanarkshire',\n'lancashire',\n'leicestershire',\n'lincolnshire',\n'londonderry',\n'merseyside',\n'mid glamorgan',\n'midlothian',\n'moray',\n'nairnshire',\n'norfolk',\n'north yorkshire',\n'northamptonshire',\n'northumberland',\n'nottinghamshire',\n'orkney',\n'oxfordshire',\n'peeblesshire',\n'perthshire',\n'powys',\n'renfrewshire',\n'ross and cromarty',\n'roxburghshire',\n'rutland',\n'selkirkshire',\n'shetland',\n'shropshire',\n'somerset',\n'south glamorgan',\n'south yorkshire',\n'staffordshire',\n'stirlingshire',\n'suffolk',\n'surrey',\n'sutherland',\n'tyne and wear',\n'tyrone',\n'warwickshire',\n'west glamorgan',\n'west lothian',\n'west midlands',\n'west sussex',\n'west yorkshire',\n'wigtownshire',\n'wiltshire',\n'worcestershire']\n\n\n\nfor(var i =0; i < msg.payload.length; i++){\n    var temp = msg.payload[i]\n    .replace(/(?:https?|ftp):\\/\\/[\\n\\S]+/g, \"\")\n    .replace(/[/.,?!:;&()\" ' |@#]/g, \"\")\n    .toLowerCase()\n    .replace(/\\n/g, \" \");\n    //.split(\" \");\n\n    for(var j = 0; j < places.length; j++){\n        var contains = temp.includes(places[j]);\n        if(contains){\n            words.push(places[j]);\n        }\n    }\n}\n\nconst map = words.reduce((acc, word) => {\n\n    let count = acc.get(word) || 0;\n    acc.set(word, ++count)\n    return acc;\n  }, new Map());\n  // Sort by counter first from higher to lower. If counter is the same,\n  // then sort by alphabetical order\n  const top_places = [...map].sort((a, b) => b[1] - a[1] || a[0].localeCompare(b[0]));\n  // Return array of k most frequent words\n   \n    msg.payload = top_places.slice(0, 100);\n    var loc_object = []; \n    //.map(item => item[0]);\n    for(var i = 0; i < msg.payload.length; i++){\n        loc_object[i] = {\"x\": msg.payload[i][0], \"value\": msg.payload[i][1]};\n        \n    }\n\n\n\nmsg.payload = loc_object;\n\n\n\n\nreturn msg;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1719.3673400878906,"y":1373.8650360107422,"wires":[["c95b7c78.16c5b8"]]},{"id":"f4747cd.c3ee","type":"function","z":"5d651a81.8ece7c","name":"declare sentiment global","func":"global.set('sentimentIC',[]);\n// global.set('tweet_num', msg.payload.length);\n// global.set('IC',true);\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1665.2857131958008,"y":1173.5715732574463,"wires":[[]]},{"id":"ff10437d.96188","type":"function","z":"5d651a81.8ece7c","name":"Store ICL text in database","func":"var text = global.get('icl_text'); \nmsg.payload = text;\nglobal.set('icl_text', []); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":300,"y":540,"wires":[["608b135.252d9ec"]]},{"id":"999d489f.cbda4","type":"function","z":"5d651a81.8ece7c","name":"Store ICL Tweet count","func":"var tweet = global.get('icl_tweets'); \nmsg.payload = {Tweets: tweet};\nglobal.set('icl_tweets', 0); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":288,"y":584.9999809265137,"wires":[["f8cb026b.c1a138"]]},{"id":"616a60b4.83cdd8","type":"function","z":"5d651a81.8ece7c","name":"Store ICL Retweet count","func":"var tweet = global.get('icl_retweets'); \nmsg.payload = {Retweets: tweet};\nglobal.set('icl_retweets', 0); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":290,"y":638,"wires":[["8a04a2ba.2ae0b"]]},{"id":"5a846176.ccffc","type":"function","z":"5d651a81.8ece7c","name":"joy for line graph","func":"var sentiment = global.get('sentimentIC') || [];\nvar sum = 0;\nfor(var i = 0; i < sentiment.length; i++){\n    sum += sentiment[i];\n}\n\nvar today = new Date();\nvar date = today.getFullYear() + '-' +(today.getMonth()+1) + '-' + today.getDate();\nvar average = 0;\n\nif(sentiment.length > 0){\n    average = sum/sentiment.length; \n}\n\nglobal.set('average_icl', average); \nvar object = {\"date\": date, \"joy\": average};\nmsg.payload = object; \n\nif(msg.finished == true){\n    global.set('still_processing_icl', false);\n    return msg; \n}\n\nelse{\n    global.set('still_processing_icl', true);\n    return; \n}\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2453.1214866638184,"y":1373.363655090332,"wires":[["67be27b4.a36ae"]]},{"id":"2c7c01b0.b8423e","type":"delay","z":"5d651a81.8ece7c","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2170.5154418945312,"y":1114.060606956482,"wires":[["1ef9a670.b1ea72"]],"l":false},{"id":"c02f2226.6c96c8","type":"function","z":"5d651a81.8ece7c","name":"Too many tweets (graph)","func":"var still_processing = global.get('still_processing_icl');\nvar average = global.get('average_icl'); \nvar today = new Date();\nvar date = today.getFullYear() + '-' +(today.getMonth()+1) + '-' + today.getDate();\n\nif(still_processing == true){\n  var object = {\"date\": date, \"joy\": average};\n  msg.payload = object; \n  global.set('still_processing_icl', false);\n  return msg;\n        \n}\nmsg.finished = still_processing; \n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":290.9523620605469,"y":684.5713787078857,"wires":[["4d4551f2.a0bfb8"]]},{"id":"8b8b9471.278ff8","type":"function","z":"5d651a81.8ece7c","name":"ColorFunction","func":"var average = msg.average;\n// var average = 0.1;\n\nif(0 <= average && average < 0.2){\n    msg.payload = {\n        normal: {\n            fill: \"#cc2316  0.3\",\n            stroke: \"#cc2316\"\n        }\n    };\n    return msg;\n}else if(0.2 <= average && average < 0.4){\n    msg.payload = {\n        normal: {\n            fill: \"#fc7600  0.3\",\n            stroke: \"#fc7600\"\n        }\n    };\n    return msg;\n}else if(0.4 <= average && average < 0.6){\n    msg.payload = {\n        normal: {\n            fill: \"#fbff00  0.3\",\n            stroke: \"#fbff00\"\n        }\n    };\n    return msg;\n}else if(0.6 <= average && average < 0.8){\n    msg.payload = {\n        normal: {\n            fill: \"#00ff11  0.3\",\n            stroke: \"#00ff11\"\n        }\n    };\n    return msg;\n}else if(0.8 <= average && average <= 1){\n    msg.payload = {\n        normal: {\n            fill: \"#049cfc  0.3\",\n            stroke: \"#049cfc\"\n        }\n    };\n    return msg;\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2575.6363105773926,"y":1136.0000915527344,"wires":[["5acaf130.b11cd8"]]},{"id":"37355d78.8cf57a","type":"http in","z":"5d651a81.8ece7c","name":"Search","url":"/search","method":"post","upload":false,"swaggerDoc":"","x":65,"y":208,"wires":[["c36b3281.a8bf9","28f3a343.20ee24"]]},{"id":"c36b3281.a8bf9","type":"function","z":"5d651a81.8ece7c","name":"Search","func":"msg.payload = msg.payload.msgdata.search;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":336,"y":210,"wires":[["86710f5.525267","c7fd7c59.59c968"]],"l":false},{"id":"c7fd7c59.59c968","type":"http response","z":"5d651a81.8ece7c","name":"","statusCode":"","headers":{},"x":611,"y":158,"wires":[]},{"id":"28f3a343.20ee24","type":"function","z":"5d651a81.8ece7c","name":"","func":"var dur = parseInt(msg.payload.msgdata.time);\ndur *= 60;\nmsg.payload = dur; \nmsg.topic = \"control\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":337,"y":288,"wires":[["68f70d9.a54f8f4"]],"l":false},{"id":"9ef341e7.b81cb8","type":"function","z":"5d651a81.8ece7c","name":"","func":"if(msg.payload == 0){\n    msg.payload = \"\";\n    return msg; \n}\nreturn;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":821,"y":296,"wires":[["86710f5.525267"]],"l":false},{"id":"2389162a.b24732","type":"function","z":"5d651a81.8ece7c","name":"Search Text","func":"\nvar search_tweets = global.get('search_text'); \n\nvar key = 'x'; \nvar temp = {};\ntemp[key] = msg.tweet.text;\nsearch_tweets.push(temp);\nglobal.set('search_text', search_tweets);\nmsg.payload = search_tweets;\nreturn msg;\n\n\n\n// }\n// else{\n//     msg.payload = icl_tweets;    \n//     global.set('icl_text', []);\n//     return msg;\n// }\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":840,"y":200,"wires":[[]]},{"id":"5abf6b3b.f53d2c","type":"function","z":"5d651a81.8ece7c","name":"","func":"\nif(msg.payload == 0){\n    var text = global.get('search_text'); \n    msg.payload = text;\n    global.set('search_text', []); \n    return msg;\n}\nelse{\n    return; \n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":792,"y":360,"wires":[["8a93edba.0d157"]]},{"id":"ab2f791f.6ab2d","type":"complete","z":"5d651a81.8ece7c","name":"Process New Tweets for Search","scope":["8a93edba.0d157"],"uncaught":false,"x":1351,"y":759,"wires":[["70683bcc.2cd29c","9597e5f3.a05ca","b230db35.2e5068","c17f054d.5831b8","c078827a.625bf"]]},{"id":"b230db35.2e5068","type":"function","z":"5d651a81.8ece7c","name":"","func":"msg.payload = {\"Mood\": \"Retrieving Sentiment Information\"}; \n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1599.500244140625,"y":567.5714721679688,"wires":[["779765.0506409c"]],"l":false},{"id":"9597e5f3.a05ca","type":"function","z":"5d651a81.8ece7c","name":"declare sentiment global","func":"global.set('sentimentSearch',[]);\n// global.set('tweet_num', msg.payload.length);\n// global.set('IC',true);\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1719.6429443359375,"y":623.6786193847656,"wires":[[]]},{"id":"65411607.74b07","type":"function","z":"5d651a81.8ece7c","name":"Function for array of strings","func":"var tweets = []; \n\nvar count; \nfor (var i = 0; i < Object.keys(msg.payload[0]).length; i++){\n\n  tweets.push(msg.payload[0][i].x);\n\n  \n}\n\nmsg.payload = tweets;\nreturn msg;\n\n// for(var i = 0; i < Object.keys(ox2[0]).length; i++){\n//   ox_loc.push({\"x\": ox2[0][i].x, \"value\": ox2[0][i].value});\n// }","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2179.2143907546997,"y":574.6831007003784,"wires":[["13a8a2fe.c04515"]]},{"id":"ce11c226.87ecb8","type":"function","z":"5d651a81.8ece7c","name":"Convert to Array of Strings","func":"var tweets = []; \n\nvar count; \nfor (var i = 0; i < Object.keys(msg.payload[0]).length; i++){\n\n  tweets.push(msg.payload[0][i].x);\n\n  \n}\n\nmsg.payload = tweets;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1940,"y":880,"wires":[["e060c18a.97c458","4ace9a63.832974"]]},{"id":"13a8a2fe.c04515","type":"delay","z":"5d651a81.8ece7c","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2552.6905822753906,"y":569.4404082298279,"wires":[["6cc40685.69163"]],"l":false},{"id":"e060c18a.97c458","type":"function","z":"5d651a81.8ece7c","name":"Get 20 Most Common Words for Word Cloud (Search)","func":"words = [];\n\nstopwords = [\"a\", \"able\", \"about\",\n        \"across\", \"after\", \"all\", \"almost\", \"also\", \"am\", \"among\", \"an\",\n        \"and\", \"any\", \"are\", \"as\", \"at\", \"b\", \"be\", \"because\", \"been\",\n        \"but\", \"by\", \"c\", \"can\", \"cannot\", \"could\", \"d\", \"dear\", \"did\",\n        \"do\", \"does\", \"e\", \"either\", \"else\", \"ever\", \"every\", \"f\", \"for\",\n        \"from\", \"g\", \"get\", \"got\", \"h\", \"had\", \"has\", \"have\", \"he\", \"her\",\n        \"hers\", \"him\", \"his\", \"how\", \"however\", \"i\", \"if\", \"in\", \"into\",\n        \"is\", \"it\", \"its\", \"j\", \"just\", \"k\", \"l\", \"least\", \"let\", \"like\",\n        \"likely\", \"m\", \"may\", \"me\", \"might\", \"most\", \"must\", \"my\",\n        \"neither\", \"n\", \"no\", \"nor\", \"not\", \"o\", \"of\", \"off\", \"often\",\n        \"on\", \"only\", \"or\", \"other\", \"our\", \"own\", \"p\", \"q\", \"r\", \"rather\",\n        \"s\", \"said\", \"say\", \"says\", \"she\", \"should\", \"since\", \"so\", \"some\",\n        \"t\", \"than\", \"that\", \"the\", \"their\", \"them\", \"then\", \"there\",\n        \"these\", \"they\", \"this\", \"tis\", \"to\", \"too\", \"twas\", \"u\", \"us\",\n        \"v\", \"w\", \"wants\", \"was\", \"we\", \"were\", \"what\", \"when\", \"where\",\n        \"which\", \"while\", \"who\", \"whom\", \"why\", \"will\", \"with\", \"would\",\n        \"x\", \"y\", \"yet\", \"you\", \"your\", \"z\", \"rt\"];\n\nfor(var i =0; i < msg.payload.length; i++){\n    var temp = msg.payload[i]\n    .replace(/[0-9]/g, \"\")\n    .replace(/(?:https?|ftp):\\/\\/[\\n\\S]+/g, \"\")\n    .replace(/[/.,?!:;&()\"'%@|]/g, \"\")\n\n    .toLowerCase()\n    .replace(/\\n/g, \" \")\n    .replace(/-/g, \"\")\n    .replace(/_/g, \"\")\n    .split(\" \");\n    \n    for(var j = 0; j < temp.length; j++){\n        var stopword = stopwords.includes(temp[j]);\n        if(stopword){\n            temp[j] = \"\";\n        }\n        if(temp[j] != \"\"){\n\n            words.push(temp[j]);\n        }\n\n    }\n}\n\nconst map = words.reduce((acc, word) => {\n\n    let count = acc.get(word) || 0;\n    acc.set(word, ++count)\n    return acc;\n  }, new Map());\n  // Sort by counter first from higher to lower. If counter is the same,\n  // then sort by alphabetical order\n  const topk = [...map].sort((a, b) => b[1] - a[1] || a[0].localeCompare(b[0]));\n  // Return array of k most frequent words\n   \n    msg.payload = topk.slice(0, 20);\n    //.map(item => item[0]);\n    \n    var loc_object = []; \n    //.map(item => item[0]);\n    for(var i = 0; i < msg.payload.length; i++){\n        loc_object[i] = {\"x\": msg.payload[i][0], \"value\": msg.payload[i][1]};\n        \n    }\n\n\n\nmsg.payload = loc_object;\n\n\n\n\n//msg.payload = words\nreturn msg;\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2431.38134765625,"y":881.8809814453125,"wires":[["a821541.2ea14a8"]]},{"id":"4ace9a63.832974","type":"function","z":"5d651a81.8ece7c","name":"Locations Wordcloud (Search)","func":"words = [];\n\nplaces = ['bath',  'birmingham', 'bradford', 'brighton and hove', 'bristol', 'cambridge',  'canterbury', 'carlisle', 'chester', 'chichester', 'coventry', 'derby', 'durham', ' ely ', 'exeter', 'gloucester', 'hereford', 'kingston upon hull', 'lancaster', 'leeds', 'leicester', 'lichfield', 'lincoln', 'liverpool', 'london', 'manchester', 'newcastle upon tyne', 'norwich', 'nottingham', 'oxford', 'peterborough', 'plymouth', 'portsmouth', 'preston', 'ripon', 'salford', 'salisbury', 'sheffield', 'southampton', 'st albans', 'stoke-on-trent', 'sunderland', 'truro', 'wakefield', 'wells', 'westminster', 'winchester', 'wolverhampton', 'worcester', 'york', 'bangor', 'cardiff', 'newport', 'st davids', 'swansea', 'aberdeen', 'dundee', 'edinburgh', 'glasgow', 'inverness', 'stirling', 'armagh', 'belfast', 'londonderry', 'lisburn', 'newry', 'aberdeenshire', 'angus',  'antrim', 'argyll', 'armagh',\n'ayrshire',\n'banffshire',\n'berkshire',\n'berwickshire',\n'bristol',\n'buckinghamshire',\n' bute ',\n'caithness',\n'cambridgeshire',\n'cheshire',\n 'london' ,\n'clackmannanshire',\n'clwyd',\n'cornwall',\n'cumbria',\n'derbyshire',\n'devon',\n'dorset',\n'county down',\n'dumfriesshire',\n'dunbartonshire',\n'durham',\n'dyfed',\n'east lothian',\n'east riding of yorkshire',\n'east sussex',\n'essex',\n'fermanagh',\n'fife',\n'gloucestershire',\n'greater london',\n'greater manchester',\n'gwent',\n'gwynedd',\n'hampshire',\n'herefordshire',\n'hertfordshire',\n'inverness-shire',\n'isle of wight',\n'kent',\n'kincardineshire',\n'kinross-shire',\n'kirkcudbrightshire',\n'lanarkshire',\n'lancashire',\n'leicestershire',\n'lincolnshire',\n'londonderry',\n'merseyside',\n'mid glamorgan',\n'midlothian',\n'moray',\n'nairnshire',\n'norfolk',\n'north yorkshire',\n'northamptonshire',\n'northumberland',\n'nottinghamshire',\n'orkney',\n'oxfordshire',\n'peeblesshire',\n'perthshire',\n'powys',\n'renfrewshire',\n'ross and cromarty',\n'roxburghshire',\n'rutland',\n'selkirkshire',\n'shetland',\n'shropshire',\n'somerset',\n'south glamorgan',\n'south yorkshire',\n'staffordshire',\n'stirlingshire',\n'suffolk',\n'surrey',\n'sutherland',\n'tyne and wear',\n'tyrone',\n'warwickshire',\n'west glamorgan',\n'west lothian',\n'west midlands',\n'west sussex',\n'west yorkshire',\n'wigtownshire',\n'wiltshire',\n'worcestershire']\n\n\n\nfor(var i =0; i < msg.payload.length; i++){\n    var temp = msg.payload[i]\n    .replace(/(?:https?|ftp):\\/\\/[\\n\\S]+/g, \"\")\n    .replace(/[/.,?!:;&()\" ' |@#]/g, \"\")\n    .toLowerCase()\n    .replace(/\\n/g, \" \");\n    //.split(\" \");\n\n    for(var j = 0; j < places.length; j++){\n        var contains = temp.includes(places[j]);\n        if(contains){\n            words.push(places[j]);\n        }\n    }\n}\n\nconst map = words.reduce((acc, word) => {\n\n    let count = acc.get(word) || 0;\n    acc.set(word, ++count)\n    return acc;\n  }, new Map());\n  // Sort by counter first from higher to lower. If counter is the same,\n  // then sort by alphabetical order\n  const top_places = [...map].sort((a, b) => b[1] - a[1] || a[0].localeCompare(b[0]));\n  // Return array of k most frequent words\n   \n    msg.payload = top_places.slice(0, 100);\n    var loc_object = []; \n    //.map(item => item[0]);\n    for(var i = 0; i < msg.payload.length; i++){\n        loc_object[i] = {\"x\": msg.payload[i][0], \"value\": msg.payload[i][1]};\n        \n    }\n\nmsg.payload = loc_object;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2330.2701263427734,"y":932.881185054779,"wires":[["755461bb.11443"]]},{"id":"2c29e396.722ff4","type":"function","z":"5d651a81.8ece7c","name":"","func":"msg.finished = true; \n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2403.214599609375,"y":653.3809814453125,"wires":[["3c5ab555.787ad2"]],"l":false},{"id":"836cf225.06877","type":"natural-language-understanding","z":"5d651a81.8ece7c","name":"","categories":false,"limitcategories":"8","concepts":false,"maxconcepts":"8","doc-emotion":true,"doc-emotion-target":"","doc-sentiment":false,"doc-sentiment-target":"","entity":false,"entity-emotion":false,"entity-sentiment":false,"maxentities":"50","keyword":true,"keyword-emotion":true,"keyword-sentiment":true,"maxkeywords":"50","metadata":false,"relation":false,"semantic":false,"semantic-entities":true,"semantic-keywords":true,"maxsemantics":"50","limittextcharacters":"0","syntax":false,"syntax-sentences":false,"syntax-tokens-lemma":false,"syntax-tokens-pos":false,"service-endpoint":"https://api.eu-gb.natural-language-understanding.watson.cloud.ibm.com/instances/8b39f420-fa48-4c16-b9a4-4f829985ce23","x":2049.21435546875,"y":739.68310546875,"wires":[["60fe6dd5.d8d324","f6e43b94.a011a"]]},{"id":"3c5ab555.787ad2","type":"function","z":"5d651a81.8ece7c","name":"avg joy","func":"var sentiment = global.get('sentimentSearch') || [];\nvar sum = 0;\nfor(var i = 0; i < sentiment.length; i++){\n    sum += sentiment[i];\n}\n\n\n\nvar average = 0;\n\nif(sentiment.length > 0){\n    average = sum/sentiment.length; \n}\nglobal.set('average', average); \nmsg.payload = {\"Mood\": average};\nmsg.average = average; \n\nif(msg.finished == true){\n    \n    return msg; \n}\nelse{\n\n    return; \n}\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2640.8811645507812,"y":687.3498840332031,"wires":[["8d21ec43.96b3"]]},{"id":"60fe6dd5.d8d324","type":"function","z":"5d651a81.8ece7c","name":"","func":"msg.payload = msg.features;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2267.88134765625,"y":747.0164184570312,"wires":[["de85864d.d5f1e"]],"l":false},{"id":"de85864d.d5f1e","type":"function","z":"5d651a81.8ece7c","name":"create sentiment array","func":"\n\nvar sentiment = global.get('sentimentSearch') || [];\n\nsentiment.push(msg.features.emotion.document.emotion.joy);\nglobal.set(\"sentimentSearch\", sentiment);\nmsg.payload = sentiment; \n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2448.88134765625,"y":739.6830444335938,"wires":[["3c5ab555.787ad2"]]},{"id":"f6e43b94.a011a","type":"debug","z":"5d651a81.8ece7c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2242.9999618530273,"y":822.9999747276306,"wires":[],"l":false},{"id":"a4a7718e.5b45d","type":"inject","z":"5d651a81.8ece7c","name":"Time to analyse","props":[{"p":"payload"}],"repeat":"","crontab":"00 12 * * 1,3,5,0","once":false,"onceDelay":"10","topic":"","payload":"","payloadType":"date","x":55,"y":4080,"wires":[["ff10437d.96188","999d489f.cbda4","616a60b4.83cdd8","c02f2226.6c96c8","50543349.99179c","87835e5d.e9a968","80197f77.776548","2818893e.ca5526","d075db10.2da948","72bf48f4.a4908","8149367c.d6b9d8","5581a567.65a93c","5e589976.29b318","6dbf4889.6c3248","3200afa.585005","11cb3334.efc8dd","a6ba6ca9.14a268","e1da2b5c.63115","5a48f09b.be787","605fc7f.b259f38","7ebb01cd.35a588","7dc52c84.408fac","bd7e4a6a.fa49c8","7a59c985.933f28","96c1267b.0744c","57875691.8386f","792e0b34.10737c","68fb5fb8.f0dcc8","4bc41d5f.1111ac","13a60cb2.88c8db","5b08adbc.944d3c","9ed8f0a2.ccce3","115a4a42.796b56","c48cca30.521da","e0cc276d.1b54a8","e23b8580.8e7878","21f8ed80.feb6da","6cb80160.a2f31","7663a2a2.6ee004","396dd5b4.a4f1b2","719e7b0b.cef594","dca52d2f.f15ea","2029e61.814c41a","f78c24d.106bdd8","87633eb5.95e178","74b38b82.8986e4","8c9a4db2.cd512","f88c0c72.e96dc","ff85a678.000888","2640d2f2.4fa83e","e1b828e9.5b2988","93bfa82.dd105d8","828a8d4.08994f","ed306889.21625","a6a4537d.ce576","5fb9938e.cfca6c","57e6d094.021cc","4a16f079.62b3c","4f98f8f2.231878","c273c404.b0c77","dafce75c.7f4a7","42405585.a030a4","3c74b998.10e52e","9573cac9.82c4c8","e48da671.cb0d78","8fa6e756.74601","26ddb8b3.3b76","9f9dea54.98ccd","f7a41bb3.40fd2","33b3d545.300d2a","d44d8f99.a5746","85411b48.a4e638","c9d894b2.e7ef9","bdb2c5ad.b1ce98","54bef6d6.66d888","e888e6d8.a35638","12833367.1c042d","b907e6f9.8940d","17388928.9622b7"]],"l":false},{"id":"fbbb9dda.2d9af","type":"function","z":"5d651a81.8ece7c","name":"declare sentiment global","func":"global.set('sentimentOx',[]);\n// global.set('tweet_num', msg.payload.length);\n// global.set('IC',true);\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3308.456298828125,"y":1179.6937255859375,"wires":[[]]},{"id":"1fa42e96.3fe659","type":"complete","z":"5d651a81.8ece7c","name":"Process Tweets Ox","scope":["67be27b4.a36ae"],"uncaught":false,"x":2930.5407180786133,"y":1179.3787307739258,"wires":[["d5420032.2105","fbbb9dda.2d9af"]]},{"id":"164d6cba.0f6543","type":"function","z":"5d651a81.8ece7c","name":"Function for array of strings","func":"var tweets = []; \n\nvar count; \nfor (var i = 0; i < Object.keys(msg.payload[0]).length; i++){\n\n  tweets.push(msg.payload[0][i].x);\n\n  \n}\n\nmsg.payload = tweets;\nreturn msg;\n\n// for(var i = 0; i < Object.keys(ox2[0]).length; i++){\n//   ox_loc.push({\"x\": ox2[0][i].x, \"value\": ox2[0][i].value});\n// }","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3638.3914642333984,"y":1119.9708786010742,"wires":[["1e566176.668e4f"]]},{"id":"6ff4a4.bc5fab5c","type":"function","z":"5d651a81.8ece7c","name":"Convert to Array of Strings","func":"var tweets = []; \n\nvar count; \nfor (var i = 0; i < Object.keys(msg.payload[0]).length; i++){\n\n  tweets.push(msg.payload[0][i].x);\n\n  \n}\n\nmsg.payload = tweets;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3001.0129928588867,"y":1331.6231937408447,"wires":[["7aaee179.e3e288","135097e3.61177"]]},{"id":"1e566176.668e4f","type":"delay","z":"5d651a81.8ece7c","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":3813.6860275268555,"y":1120.1827592849731,"wires":[["76e3d1a2.c98bd8"]],"l":false},{"id":"7aaee179.e3e288","type":"function","z":"5d651a81.8ece7c","name":"Get 20 Most Common Words for Word Cloud (Ox)","func":"words = [];\n\nstopwords = [\"a\", \"able\", \"about\",\n        \"across\", \"after\", \"all\", \"almost\", \"also\", \"am\", \"among\", \"an\",\n        \"and\", \"any\", \"are\", \"as\", \"at\", \"b\", \"be\", \"because\", \"been\",\n        \"but\", \"by\", \"c\", \"can\", \"cannot\", \"could\", \"d\", \"dear\", \"did\",\n        \"do\", \"does\", \"e\", \"either\", \"else\", \"ever\", \"every\", \"f\", \"for\",\n        \"from\", \"g\", \"get\", \"got\", \"h\", \"had\", \"has\", \"have\", \"he\", \"her\",\n        \"hers\", \"him\", \"his\", \"how\", \"however\", \"i\", \"if\", \"in\", \"into\",\n        \"is\", \"it\", \"its\", \"j\", \"just\", \"k\", \"l\", \"least\", \"let\", \"like\",\n        \"likely\", \"m\", \"may\", \"me\", \"might\", \"most\", \"must\", \"my\",\n        \"neither\", \"n\", \"no\", \"nor\", \"not\", \"o\", \"of\", \"off\", \"often\",\n        \"on\", \"only\", \"or\", \"other\", \"our\", \"own\", \"p\", \"q\", \"r\", \"rather\",\n        \"s\", \"said\", \"say\", \"says\", \"she\", \"should\", \"since\", \"so\", \"some\",\n        \"t\", \"than\", \"that\", \"the\", \"their\", \"them\", \"then\", \"there\",\n        \"these\", \"they\", \"this\", \"tis\", \"to\", \"too\", \"twas\", \"u\", \"us\",\n        \"v\", \"w\", \"wants\", \"was\", \"we\", \"were\", \"what\", \"when\", \"where\",\n        \"which\", \"while\", \"who\", \"whom\", \"why\", \"will\", \"with\", \"would\",\n        \"x\", \"y\", \"yet\", \"you\", \"your\", \"z\", \"rt\"];\n\nfor(var i =0; i < msg.payload.length; i++){\n    var temp = msg.payload[i]\n    .replace(/[0-9]/g, \"\")\n    .replace(/(?:https?|ftp):\\/\\/[\\n\\S]+/g, \"\")\n    .replace(/[/.,?!:;&()\"'%@|]/g, \"\")\n\n    .toLowerCase()\n    .replace(/\\n/g, \" \")\n    .replace(/-/g, \"\")\n    .replace(/_/g, \"\")\n    .split(\" \");\n    \n    for(var j = 0; j < temp.length; j++){\n        var stopword = stopwords.includes(temp[j]);\n        if(stopword){\n            temp[j] = \"\";\n        }\n        if(temp[j] != \"\"){\n\n            words.push(temp[j]);\n        }\n\n    }\n}\n\nconst map = words.reduce((acc, word) => {\n\n    let count = acc.get(word) || 0;\n    acc.set(word, ++count)\n    return acc;\n  }, new Map());\n  // Sort by counter first from higher to lower. If counter is the same,\n  // then sort by alphabetical order\n  const topk = [...map].sort((a, b) => b[1] - a[1] || a[0].localeCompare(b[0]));\n  // Return array of k most frequent words\n   \n    msg.payload = topk.slice(0, 20);\n    //.map(item => item[0]);\n    \n    var loc_object = []; \n    //.map(item => item[0]);\n    for(var i = 0; i < msg.payload.length; i++){\n        loc_object[i] = {\"x\": msg.payload[i][0], \"value\": msg.payload[i][1]};\n        \n    }\n\n\n\nmsg.payload = loc_object;\n\n\n\n\n//msg.payload = words\nreturn msg;\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3443.6492233276367,"y":1332.6233730316162,"wires":[["95fe5d8c.76b5e"]]},{"id":"135097e3.61177","type":"function","z":"5d651a81.8ece7c","name":"Locations Wordcloud (Ox)","func":"words = [];\n\nplaces = ['bath',  'birmingham', 'bradford', 'brighton and hove', 'bristol', 'cambridge',  'canterbury', 'carlisle', 'chester', 'chichester', 'coventry', 'derby', 'durham', ' ely ', 'exeter', 'gloucester', 'hereford', 'kingston upon hull', 'lancaster', 'leeds', 'leicester', 'lichfield', 'lincoln', 'liverpool', 'london', 'manchester', 'newcastle upon tyne', 'norwich', 'nottingham', 'oxford', 'peterborough', 'plymouth', 'portsmouth', 'preston', 'ripon', 'salford', 'salisbury', 'sheffield', 'southampton', 'st albans', 'stoke-on-trent', 'sunderland', 'truro', 'wakefield', 'wells', 'westminster', 'winchester', 'wolverhampton', 'worcester', 'york', 'bangor', 'cardiff', 'newport', 'st davids', 'swansea', 'aberdeen', 'dundee', 'edinburgh', 'glasgow', 'inverness', 'stirling', 'armagh', 'belfast', 'londonderry', 'lisburn', 'newry', 'aberdeenshire', 'angus',  'antrim', 'argyll', 'armagh',\n'ayrshire',\n'banffshire',\n'berkshire',\n'berwickshire',\n'bristol',\n'buckinghamshire',\n' bute ',\n'caithness',\n'cambridgeshire',\n'cheshire',\n 'london' ,\n'clackmannanshire',\n'clwyd',\n'cornwall',\n'cumbria',\n'derbyshire',\n'devon',\n'dorset',\n'county down',\n'dumfriesshire',\n'dunbartonshire',\n'durham',\n'dyfed',\n'east lothian',\n'east riding of yorkshire',\n'east sussex',\n'essex',\n'fermanagh',\n'fife',\n'gloucestershire',\n'greater london',\n'greater manchester',\n'gwent',\n'gwynedd',\n'hampshire',\n'herefordshire',\n'hertfordshire',\n'inverness-shire',\n'isle of wight',\n'kent',\n'kincardineshire',\n'kinross-shire',\n'kirkcudbrightshire',\n'lanarkshire',\n'lancashire',\n'leicestershire',\n'lincolnshire',\n'londonderry',\n'merseyside',\n'mid glamorgan',\n'midlothian',\n'moray',\n'nairnshire',\n'norfolk',\n'north yorkshire',\n'northamptonshire',\n'northumberland',\n'nottinghamshire',\n'orkney',\n'oxfordshire',\n'peeblesshire',\n'perthshire',\n'powys',\n'renfrewshire',\n'ross and cromarty',\n'roxburghshire',\n'rutland',\n'selkirkshire',\n'shetland',\n'shropshire',\n'somerset',\n'south glamorgan',\n'south yorkshire',\n'staffordshire',\n'stirlingshire',\n'suffolk',\n'surrey',\n'sutherland',\n'tyne and wear',\n'tyrone',\n'warwickshire',\n'west glamorgan',\n'west lothian',\n'west midlands',\n'west sussex',\n'west yorkshire',\n'wigtownshire',\n'wiltshire',\n'worcestershire']\n\n\n\nfor(var i =0; i < msg.payload.length; i++){\n    var temp = msg.payload[i]\n    .replace(/(?:https?|ftp):\\/\\/[\\n\\S]+/g, \"\")\n    .replace(/[/.,?!:;&()\" ' |@#]/g, \"\")\n    .toLowerCase()\n    .replace(/\\n/g, \" \");\n    //.split(\" \");\n\n    for(var j = 0; j < places.length; j++){\n        var contains = temp.includes(places[j]);\n        if(contains){\n            words.push(places[j]);\n        }\n    }\n}\n\nconst map = words.reduce((acc, word) => {\n\n    let count = acc.get(word) || 0;\n    acc.set(word, ++count)\n    return acc;\n  }, new Map());\n  // Sort by counter first from higher to lower. If counter is the same,\n  // then sort by alphabetical order\n  const top_places = [...map].sort((a, b) => b[1] - a[1] || a[0].localeCompare(b[0]));\n  // Return array of k most frequent words\n   \n    msg.payload = top_places.slice(0, 100);\n    var loc_object = []; \n    //.map(item => item[0]);\n    for(var i = 0; i < msg.payload.length; i++){\n        loc_object[i] = {\"x\": msg.payload[i][0], \"value\": msg.payload[i][1]};\n        \n    }\n\n\n\nmsg.payload = loc_object;\n\n\n\n\nreturn msg;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3362.537925720215,"y":1379.9871883392334,"wires":[["f99ddcf1.da2c78"]]},{"id":"a6f48d95.8f8bd8","type":"function","z":"5d651a81.8ece7c","name":"","func":"msg.finished1 = true; \n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3846.3916730880737,"y":1193.0324115753174,"wires":[["ea7f47b3.377e48","6235d416.d8136c"]],"l":false},{"id":"864275fc.447f28","type":"natural-language-understanding","z":"5d651a81.8ece7c","name":"","categories":false,"limitcategories":"8","concepts":false,"maxconcepts":"8","doc-emotion":true,"doc-emotion-target":"","doc-sentiment":false,"doc-sentiment-target":"","entity":false,"entity-emotion":false,"entity-sentiment":false,"maxentities":"50","keyword":false,"keyword-emotion":true,"keyword-sentiment":true,"maxkeywords":"50","metadata":false,"relation":false,"semantic":false,"semantic-entities":true,"semantic-keywords":true,"maxsemantics":"50","limittextcharacters":"0","syntax":false,"syntax-sentences":false,"syntax-tokens-lemma":false,"syntax-tokens-pos":false,"service-endpoint":"https://api.us-south.natural-language-understanding.watson.cloud.ibm.com/instances/3252dc64-1496-4697-bd85-69b0a850cc46","x":3698.3914642333984,"y":1281.3345527648926,"wires":[["69c459c3.5d0a5"]]},{"id":"ea7f47b3.377e48","type":"function","z":"5d651a81.8ece7c","name":"avg joy","func":"var sentiment = global.get('sentimentOx') || [];\nvar sum = 0;\nfor(var i = 0; i < sentiment.length; i++){\n    sum += sentiment[i];\n}\n\n\n\nvar average = 0;\n\nif(sentiment.length > 0){\n    average = sum/sentiment.length; \n}\n\nmsg.payload = {\"Mood\": average};\nmsg.average = average; \n\nif(msg.finished1 == true){\n    \n    return msg; \n}\nelse{\n\n    return; \n}\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4014.603572845459,"y":1192.274055480957,"wires":[["5cb0a996.cbc1c8","715c13e0.30519c"]]},{"id":"6235d416.d8136c","type":"function","z":"5d651a81.8ece7c","name":"joy for line graph","func":"var sentiment = global.get('sentimentOx') || [];\nvar sum = 0;\nfor(var i = 0; i < sentiment.length; i++){\n    sum += sentiment[i];\n}\n\nvar today = new Date();\nvar date = today.getFullYear() + '-' +(today.getMonth()+1) + '-' + today.getDate();\nvar average = 0;\n\nif(sentiment.length > 0){\n    average = sum/sentiment.length; \n}\n\nglobal.set('average_ox', average); \nvar object = {\"date\": date, \"joy\": average};\nmsg.payload = object; \n\nif(msg.finished1 == true){\n    global.set('still_processing_ox', false);\n    return msg; \n}\n\nelse{\n    global.set('still_processing_ox', true);\n    return; \n}\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4096.292072296143,"y":1379.4858074188232,"wires":[["44e5fe6c.3d2aa","6f563550.5684ac"]]},{"id":"69c459c3.5d0a5","type":"function","z":"5d651a81.8ece7c","name":"","func":"msg.payload = msg.features;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3900.14940738678,"y":1280.6679935455322,"wires":[["ea82df37.bbb888"]],"l":false},{"id":"ea82df37.bbb888","type":"function","z":"5d651a81.8ece7c","name":"create sentiment array","func":"\n\nvar sentiment = global.get('sentimentOx') || [];\n\nsentiment.push(msg.features.emotion.document.emotion.joy);\nglobal.set(\"sentimentOx\", sentiment);\nmsg.payload = sentiment; \n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4140,"y":1280,"wires":[["ea7f47b3.377e48","6235d416.d8136c"]]},{"id":"715c13e0.30519c","type":"function","z":"5d651a81.8ece7c","name":"ColorFunction","func":"var average = msg.average;\n// var average = 0.1;\n\nif(0 <= average && average < 0.2){\n    msg.payload = {\n        normal: {\n            fill: \"#cc2316  0.3\",\n            stroke: \"#cc2316\"\n        }\n    };\n    return msg;\n}else if(0.2 <= average && average < 0.4){\n    msg.payload = {\n        normal: {\n            fill: \"#fc7600  0.3\",\n            stroke: \"#fc7600\"\n        }\n    };\n    return msg;\n}else if(0.4 <= average && average < 0.6){\n    msg.payload = {\n        normal: {\n            fill: \"#fbff00  0.3\",\n            stroke: \"#fbff00\"\n        }\n    };\n    return msg;\n}else if(0.6 <= average && average < 0.8){\n    msg.payload = {\n        normal: {\n            fill: \"#00ff11  0.3\",\n            stroke: \"#00ff11\"\n        }\n    };\n    return msg;\n}else if(0.8 <= average && average <= 1){\n    msg.payload = {\n        normal: {\n            fill: \"#049cfc  0.3\",\n            stroke: \"#049cfc\"\n        }\n    };\n    return msg;\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4218.806896209717,"y":1142.1222438812256,"wires":[["e2122030.889d5"]]},{"id":"50543349.99179c","type":"function","z":"5d651a81.8ece7c","name":"Store Ox text in database","func":"var text = global.get('ox_text'); \nmsg.payload = text;\nglobal.set('ox_text', []); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":321.84124755859375,"y":748.6824626922607,"wires":[["fcaadaf8.6b08c"]]},{"id":"87835e5d.e9a968","type":"function","z":"5d651a81.8ece7c","name":"Store Ox Tweet count","func":"var tweet = global.get('ox_tweets'); \nmsg.payload = {Tweets: tweet};\nglobal.set('ox_tweets', 0); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":307.61903142929077,"y":800.3491878509521,"wires":[["a69384f5.83a29"]]},{"id":"80197f77.776548","type":"function","z":"5d651a81.8ece7c","name":"Store Ox Retweet count","func":"var tweet = global.get('ox_retweets'); \nmsg.payload = {Retweets: tweet};\nglobal.set('ox_retweets', 0); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":311.84124755859375,"y":846.6824626922607,"wires":[["ee12b22.202565"]]},{"id":"2818893e.ca5526","type":"function","z":"5d651a81.8ece7c","name":"Too many tweets (graph)","func":"var still_processing = global.get('still_processing_ox');\nvar average = global.get('average_ox'); \nvar today = new Date();\nvar date = today.getFullYear() + '-' +(today.getMonth()+1) + '-' + today.getDate();\n\nif(still_processing == true){\n  var object = {\"date\": date, \"joy\": average};\n  msg.payload = object; \n  global.set('still_processing_ox', false);\n  return msg;\n        \n}\nmsg.finished = still_processing; \n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":292.7936096191406,"y":893.2538414001465,"wires":[["53fa24b2.48e634"]]},{"id":"a2650647.275a8","type":"complete","z":"5d651a81.8ece7c","name":"Process New Tweets for Bham","scope":["44e5fe6c.3d2aa"],"uncaught":false,"x":1319,"y":1539,"wires":[["c9ad83d5.29bd9","c5c2fddf.baa0e8"]]},{"id":"c5c2fddf.baa0e8","type":"function","z":"5d651a81.8ece7c","name":"declare sentiment global","func":"global.set('sentimentBham',[]);\n// global.set('tweet_num', msg.payload.length);\n// global.set('IC',true);\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1656.9155807495117,"y":1539.3149948120117,"wires":[[]]},{"id":"c75aada2.5e3868","type":"function","z":"5d651a81.8ece7c","name":"Function for array of strings","func":"var tweets = []; \n\nvar count; \nfor (var i = 0; i < Object.keys(msg.payload[0]).length; i++){\n\n  tweets.push(msg.payload[0][i].x);\n\n  \n}\n\nmsg.payload = tweets;\nreturn msg;\n\n// for(var i = 0; i < Object.keys(ox2[0]).length; i++){\n//   ox_loc.push({\"x\": ox2[0][i].x, \"value\": ox2[0][i].value});\n// }","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1986.8507461547852,"y":1479.5921478271484,"wires":[["8902f88e.86c59"]]},{"id":"327c792f.e9a1a6","type":"function","z":"5d651a81.8ece7c","name":"Convert to Array of Strings","func":"var tweets = []; \n\nvar count; \nfor (var i = 0; i < Object.keys(msg.payload[0]).length; i++){\n\n  tweets.push(msg.payload[0][i].x);\n\n  \n}\n\nmsg.payload = tweets;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1349.4722747802734,"y":1691.244462966919,"wires":[["b4950a53.e27108","2c246c18.d3ca6c"]]},{"id":"8902f88e.86c59","type":"delay","z":"5d651a81.8ece7c","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2162.145309448242,"y":1479.8040285110474,"wires":[["98e71887.153788"]],"l":false},{"id":"b4950a53.e27108","type":"function","z":"5d651a81.8ece7c","name":"Get 20 Most Common Words for Word Cloud (Bham)","func":"words = [];\n\nstopwords = [\"a\", \"able\", \"about\",\n        \"across\", \"after\", \"all\", \"almost\", \"also\", \"am\", \"among\", \"an\",\n        \"and\", \"any\", \"are\", \"as\", \"at\", \"b\", \"be\", \"because\", \"been\",\n        \"but\", \"by\", \"c\", \"can\", \"cannot\", \"could\", \"d\", \"dear\", \"did\",\n        \"do\", \"does\", \"e\", \"either\", \"else\", \"ever\", \"every\", \"f\", \"for\",\n        \"from\", \"g\", \"get\", \"got\", \"h\", \"had\", \"has\", \"have\", \"he\", \"her\",\n        \"hers\", \"him\", \"his\", \"how\", \"however\", \"i\", \"if\", \"in\", \"into\",\n        \"is\", \"it\", \"its\", \"j\", \"just\", \"k\", \"l\", \"least\", \"let\", \"like\",\n        \"likely\", \"m\", \"may\", \"me\", \"might\", \"most\", \"must\", \"my\",\n        \"neither\", \"n\", \"no\", \"nor\", \"not\", \"o\", \"of\", \"off\", \"often\",\n        \"on\", \"only\", \"or\", \"other\", \"our\", \"own\", \"p\", \"q\", \"r\", \"rather\",\n        \"s\", \"said\", \"say\", \"says\", \"she\", \"should\", \"since\", \"so\", \"some\",\n        \"t\", \"than\", \"that\", \"the\", \"their\", \"them\", \"then\", \"there\",\n        \"these\", \"they\", \"this\", \"tis\", \"to\", \"too\", \"twas\", \"u\", \"us\",\n        \"v\", \"w\", \"wants\", \"was\", \"we\", \"were\", \"what\", \"when\", \"where\",\n        \"which\", \"while\", \"who\", \"whom\", \"why\", \"will\", \"with\", \"would\",\n        \"x\", \"y\", \"yet\", \"you\", \"your\", \"z\", \"rt\"];\n\nfor(var i =0; i < msg.payload.length; i++){\n    var temp = msg.payload[i]\n    .replace(/[0-9]/g, \"\")\n    .replace(/(?:https?|ftp):\\/\\/[\\n\\S]+/g, \"\")\n    .replace(/[/.,?!:;&()\"'%@|]/g, \"\")\n\n    .toLowerCase()\n    .replace(/\\n/g, \" \")\n    .replace(/-/g, \"\")\n    .replace(/_/g, \"\")\n    .split(\" \");\n    \n    for(var j = 0; j < temp.length; j++){\n        var stopword = stopwords.includes(temp[j]);\n        if(stopword){\n            temp[j] = \"\";\n        }\n        if(temp[j] != \"\"){\n\n            words.push(temp[j]);\n        }\n\n    }\n}\n\nconst map = words.reduce((acc, word) => {\n\n    let count = acc.get(word) || 0;\n    acc.set(word, ++count)\n    return acc;\n  }, new Map());\n  // Sort by counter first from higher to lower. If counter is the same,\n  // then sort by alphabetical order\n  const topk = [...map].sort((a, b) => b[1] - a[1] || a[0].localeCompare(b[0]));\n  // Return array of k most frequent words\n   \n    msg.payload = topk.slice(0, 20);\n    //.map(item => item[0]);\n    \n    var loc_object = []; \n    //.map(item => item[0]);\n    for(var i = 0; i < msg.payload.length; i++){\n        loc_object[i] = {\"x\": msg.payload[i][0], \"value\": msg.payload[i][1]};\n        \n    }\n\n\n\nmsg.payload = loc_object;\n\n\n\n\n//msg.payload = words\nreturn msg;\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1780.1085205078125,"y":1692.24462890625,"wires":[["d8aa3801.96db28"]]},{"id":"2c246c18.d3ca6c","type":"function","z":"5d651a81.8ece7c","name":"Locations Wordcloud (Bham)","func":"words = [];\n\nplaces = ['bath',  'birmingham', 'bradford', 'brighton and hove', 'bristol', 'cambridge',  'canterbury', 'carlisle', 'chester', 'chichester', 'coventry', 'derby', 'durham', ' ely ', 'exeter', 'gloucester', 'hereford', 'kingston upon hull', 'lancaster', 'leeds', 'leicester', 'lichfield', 'lincoln', 'liverpool', 'london', 'manchester', 'newcastle upon tyne', 'norwich', 'nottingham', 'oxford', 'peterborough', 'plymouth', 'portsmouth', 'preston', 'ripon', 'salford', 'salisbury', 'sheffield', 'southampton', 'st albans', 'stoke-on-trent', 'sunderland', 'truro', 'wakefield', 'wells', 'westminster', 'winchester', 'wolverhampton', 'worcester', 'york', 'bangor', 'cardiff', 'newport', 'st davids', 'swansea', 'aberdeen', 'dundee', 'edinburgh', 'glasgow', 'inverness', 'stirling', 'armagh', 'belfast', 'londonderry', 'lisburn', 'newry', 'aberdeenshire', 'angus',  'antrim', 'argyll', 'armagh',\n'ayrshire',\n'banffshire',\n'berkshire',\n'berwickshire',\n'bristol',\n'buckinghamshire',\n' bute ',\n'caithness',\n'cambridgeshire',\n'cheshire',\n 'london' ,\n'clackmannanshire',\n'clwyd',\n'cornwall',\n'cumbria',\n'derbyshire',\n'devon',\n'dorset',\n'county down',\n'dumfriesshire',\n'dunbartonshire',\n'durham',\n'dyfed',\n'east lothian',\n'east riding of yorkshire',\n'east sussex',\n'essex',\n'fermanagh',\n'fife',\n'gloucestershire',\n'greater london',\n'greater manchester',\n'gwent',\n'gwynedd',\n'hampshire',\n'herefordshire',\n'hertfordshire',\n'inverness-shire',\n'isle of wight',\n'kent',\n'kincardineshire',\n'kinross-shire',\n'kirkcudbrightshire',\n'lanarkshire',\n'lancashire',\n'leicestershire',\n'lincolnshire',\n'londonderry',\n'merseyside',\n'mid glamorgan',\n'midlothian',\n'moray',\n'nairnshire',\n'norfolk',\n'north yorkshire',\n'northamptonshire',\n'northumberland',\n'nottinghamshire',\n'orkney',\n'oxfordshire',\n'peeblesshire',\n'perthshire',\n'powys',\n'renfrewshire',\n'ross and cromarty',\n'roxburghshire',\n'rutland',\n'selkirkshire',\n'shetland',\n'shropshire',\n'somerset',\n'south glamorgan',\n'south yorkshire',\n'staffordshire',\n'stirlingshire',\n'suffolk',\n'surrey',\n'sutherland',\n'tyne and wear',\n'tyrone',\n'warwickshire',\n'west glamorgan',\n'west lothian',\n'west midlands',\n'west sussex',\n'west yorkshire',\n'wigtownshire',\n'wiltshire',\n'worcestershire']\n\n\n\nfor(var i =0; i < msg.payload.length; i++){\n    var temp = msg.payload[i]\n    .replace(/(?:https?|ftp):\\/\\/[\\n\\S]+/g, \"\")\n    .replace(/[/.,?!:;&()\" ' |@#]/g, \"\")\n    .toLowerCase()\n    .replace(/\\n/g, \" \");\n    //.split(\" \");\n\n    for(var j = 0; j < places.length; j++){\n        var contains = temp.includes(places[j]);\n        if(contains){\n            words.push(places[j]);\n        }\n    }\n}\n\nconst map = words.reduce((acc, word) => {\n\n    let count = acc.get(word) || 0;\n    acc.set(word, ++count)\n    return acc;\n  }, new Map());\n  // Sort by counter first from higher to lower. If counter is the same,\n  // then sort by alphabetical order\n  const top_places = [...map].sort((a, b) => b[1] - a[1] || a[0].localeCompare(b[0]));\n  // Return array of k most frequent words\n   \n    msg.payload = top_places.slice(0, 100);\n    var loc_object = []; \n    //.map(item => item[0]);\n    for(var i = 0; i < msg.payload.length; i++){\n        loc_object[i] = {\"x\": msg.payload[i][0], \"value\": msg.payload[i][1]};\n        \n    }\n\n\n\nmsg.payload = loc_object;\n\n\n\n\nreturn msg;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1682.9971923828125,"y":1739.6083984375,"wires":[["9d637833.473288"]]},{"id":"5e5a43c5.b981ec","type":"function","z":"5d651a81.8ece7c","name":"","func":"msg.finished2 = true; \n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2194.8509550094604,"y":1552.6536808013916,"wires":[["c3595d03.5d3fe8","7b23c4d9.113294"]],"l":false},{"id":"2c97a3db.59e49c","type":"natural-language-understanding","z":"5d651a81.8ece7c","name":"","categories":false,"limitcategories":"8","concepts":false,"maxconcepts":"8","doc-emotion":true,"doc-emotion-target":"","doc-sentiment":false,"doc-sentiment-target":"","entity":false,"entity-emotion":false,"entity-sentiment":false,"maxentities":"50","keyword":false,"keyword-emotion":true,"keyword-sentiment":true,"maxkeywords":"50","metadata":false,"relation":false,"semantic":false,"semantic-entities":true,"semantic-keywords":true,"maxsemantics":"50","limittextcharacters":"0","syntax":false,"syntax-sentences":false,"syntax-tokens-lemma":false,"syntax-tokens-pos":false,"service-endpoint":"https://api.us-south.natural-language-understanding.watson.cloud.ibm.com/instances/3252dc64-1496-4697-bd85-69b0a850cc46","x":2046.8507461547852,"y":1640.9558219909668,"wires":[["38a5be05.a1745a"]]},{"id":"c3595d03.5d3fe8","type":"function","z":"5d651a81.8ece7c","name":"avg joy","func":"var sentiment = global.get('sentimentBham') || [];\nvar sum = 0;\nfor(var i = 0; i < sentiment.length; i++){\n    sum += sentiment[i];\n}\n\n\n\nvar average = 0;\n\nif(sentiment.length > 0){\n    average = sum/sentiment.length; \n}\n\nmsg.payload = {\"Mood\": average};\nmsg.average = average; \n\nif(msg.finished2 == true){\n    \n    return msg; \n}\nelse{\n\n    return; \n}\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2363.0628547668457,"y":1551.8953247070312,"wires":[["eb00cbc9.27424","f048a5b0.9ef5f"]]},{"id":"7b23c4d9.113294","type":"function","z":"5d651a81.8ece7c","name":"joy for line graph","func":"var sentiment = global.get('sentimentBham') || [];\nvar sum = 0;\nfor(var i = 0; i < sentiment.length; i++){\n    sum += sentiment[i];\n}\n\nvar today = new Date();\nvar date = today.getFullYear() + '-' +(today.getMonth()+1) + '-' + today.getDate();\nvar average = 0;\n\nif(sentiment.length > 0){\n    average = sum/sentiment.length; \n}\n\nglobal.set('average_bham', average); \nvar object = {\"date\": date, \"joy\": average};\nmsg.payload = object; \n\nif(msg.finished2 == true){\n    global.set('still_processing_bham', false);\n    return msg; \n}\n\nelse{\n    global.set('still_processing_bham', true);\n    return; \n}\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2444.7513542175293,"y":1739.1070766448975,"wires":[["bce9556f.3ccb1"]]},{"id":"38a5be05.a1745a","type":"function","z":"5d651a81.8ece7c","name":"","func":"msg.payload = msg.features;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2248.6086893081665,"y":1640.2892627716064,"wires":[["3ae87f2.2d79e8"]],"l":false},{"id":"3ae87f2.2d79e8","type":"function","z":"5d651a81.8ece7c","name":"create sentiment array","func":"\n\nvar sentiment = global.get('sentimentBham') || [];\n\nsentiment.push(msg.features.emotion.document.emotion.joy);\nglobal.set(\"sentimentBham\", sentiment);\nmsg.payload = sentiment; \n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2409.245132446289,"y":1635.5011730194092,"wires":[["c3595d03.5d3fe8","7b23c4d9.113294"]]},{"id":"f048a5b0.9ef5f","type":"function","z":"5d651a81.8ece7c","name":"ColorFunction","func":"var average = msg.average;\n// var average = 0.1;\n\nif(0 <= average && average < 0.2){\n    msg.payload = {\n        normal: {\n            fill: \"#cc2316  0.3\",\n            stroke: \"#cc2316\"\n        }\n    };\n    return msg;\n}else if(0.2 <= average && average < 0.4){\n    msg.payload = {\n        normal: {\n            fill: \"#fc7600  0.3\",\n            stroke: \"#fc7600\"\n        }\n    };\n    return msg;\n}else if(0.4 <= average && average < 0.6){\n    msg.payload = {\n        normal: {\n            fill: \"#fbff00  0.3\",\n            stroke: \"#fbff00\"\n        }\n    };\n    return msg;\n}else if(0.6 <= average && average < 0.8){\n    msg.payload = {\n        normal: {\n            fill: \"#00ff11  0.3\",\n            stroke: \"#00ff11\"\n        }\n    };\n    return msg;\n}else if(0.8 <= average && average <= 1){\n    msg.payload = {\n        normal: {\n            fill: \"#049cfc  0.3\",\n            stroke: \"#049cfc\"\n        }\n    };\n    return msg;\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2567.2661781311035,"y":1501.7435131072998,"wires":[["f43b59c1.b02df8"]]},{"id":"d075db10.2da948","type":"function","z":"5d651a81.8ece7c","name":"Store Bham text in database","func":"var text = global.get('bham_text'); \nmsg.payload = text;\nglobal.set('bham_text', []); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":309.28570556640625,"y":960.5713787078857,"wires":[["575c2ea4.b27568"]]},{"id":"72bf48f4.a4908","type":"function","z":"5d651a81.8ece7c","name":"Store Bham Tweet count","func":"var tweet = global.get('bham_tweets'); \nmsg.payload = {Tweets: tweet};\nglobal.set('bham_tweets', 0); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":295.06348943710327,"y":1012.2381038665771,"wires":[["f496dff.ede542"]]},{"id":"8149367c.d6b9d8","type":"function","z":"5d651a81.8ece7c","name":"Store Bham Retweet count","func":"var tweet = global.get('bham_retweets'); \nmsg.payload = {Retweets: tweet};\nglobal.set('bham_retweets', 0); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":299.28570556640625,"y":1058.5713787078857,"wires":[["83520da1.bd16c"]]},{"id":"5581a567.65a93c","type":"function","z":"5d651a81.8ece7c","name":"Too many tweets (graph)","func":"var still_processing = global.get('still_processing_bham');\nvar average = global.get('average_bham'); \nvar today = new Date();\nvar date = today.getFullYear() + '-' +(today.getMonth()+1) + '-' + today.getDate();\n\nif(still_processing == true){\n  var object = {\"date\": date, \"joy\": average};\n  msg.payload = object; \n  global.set('still_processing_bham', false);\n  return msg;\n}\nmsg.finished = still_processing; \n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":270.2380676269531,"y":1105.1427574157715,"wires":[["8da01a12.938e3"]]},{"id":"ebef9ff4.d8395","type":"complete","z":"5d651a81.8ece7c","name":"Process New Tweets for Bristol","scope":["bce9556f.3ccb1"],"uncaught":false,"x":3031,"y":1533,"wires":[["3bd563ce.1dafec","5ac763a5.c76124"]]},{"id":"5ac763a5.c76124","type":"function","z":"5d651a81.8ece7c","name":"declare sentiment global","func":"global.set('sentimentBrist',[]);\n// global.set('tweet_num', msg.payload.length);\n// global.set('IC',true);\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3368.9155807495117,"y":1533.3149948120117,"wires":[[]]},{"id":"dfdea2fb.529a9","type":"function","z":"5d651a81.8ece7c","name":"Function for array of strings","func":"var tweets = []; \n\nvar count; \nfor (var i = 0; i < Object.keys(msg.payload[0]).length; i++){\n\n  tweets.push(msg.payload[0][i].x);\n\n  \n}\n\nmsg.payload = tweets;\nreturn msg;\n\n// for(var i = 0; i < Object.keys(ox2[0]).length; i++){\n//   ox_loc.push({\"x\": ox2[0][i].x, \"value\": ox2[0][i].value});\n// }","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3698.850746154785,"y":1473.5921478271484,"wires":[["bcbf4502.0728e"]]},{"id":"f41305bd.b43c6","type":"function","z":"5d651a81.8ece7c","name":"Convert to Array of Strings","func":"var tweets = []; \n\nvar count; \nfor (var i = 0; i < Object.keys(msg.payload[0]).length; i++){\n\n  tweets.push(msg.payload[0][i].x);\n\n  \n}\n\nmsg.payload = tweets;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3061.4722747802734,"y":1685.244462966919,"wires":[["7b4899d6.ea6fe","7c55907c.9de0a8"]]},{"id":"bcbf4502.0728e","type":"delay","z":"5d651a81.8ece7c","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":3874.145309448242,"y":1473.8040285110474,"wires":[["cb014862.efe1a8"]],"l":false},{"id":"7b4899d6.ea6fe","type":"function","z":"5d651a81.8ece7c","name":"Get 20 Most Common Words for Word Cloud (Bristol)","func":"words = [];\n\nstopwords = [\"a\", \"able\", \"about\",\n        \"across\", \"after\", \"all\", \"almost\", \"also\", \"am\", \"among\", \"an\",\n        \"and\", \"any\", \"are\", \"as\", \"at\", \"b\", \"be\", \"because\", \"been\",\n        \"but\", \"by\", \"c\", \"can\", \"cannot\", \"could\", \"d\", \"dear\", \"did\",\n        \"do\", \"does\", \"e\", \"either\", \"else\", \"ever\", \"every\", \"f\", \"for\",\n        \"from\", \"g\", \"get\", \"got\", \"h\", \"had\", \"has\", \"have\", \"he\", \"her\",\n        \"hers\", \"him\", \"his\", \"how\", \"however\", \"i\", \"if\", \"in\", \"into\",\n        \"is\", \"it\", \"its\", \"j\", \"just\", \"k\", \"l\", \"least\", \"let\", \"like\",\n        \"likely\", \"m\", \"may\", \"me\", \"might\", \"most\", \"must\", \"my\",\n        \"neither\", \"n\", \"no\", \"nor\", \"not\", \"o\", \"of\", \"off\", \"often\",\n        \"on\", \"only\", \"or\", \"other\", \"our\", \"own\", \"p\", \"q\", \"r\", \"rather\",\n        \"s\", \"said\", \"say\", \"says\", \"she\", \"should\", \"since\", \"so\", \"some\",\n        \"t\", \"than\", \"that\", \"the\", \"their\", \"them\", \"then\", \"there\",\n        \"these\", \"they\", \"this\", \"tis\", \"to\", \"too\", \"twas\", \"u\", \"us\",\n        \"v\", \"w\", \"wants\", \"was\", \"we\", \"were\", \"what\", \"when\", \"where\",\n        \"which\", \"while\", \"who\", \"whom\", \"why\", \"will\", \"with\", \"would\",\n        \"x\", \"y\", \"yet\", \"you\", \"your\", \"z\", \"rt\"];\n\nfor(var i =0; i < msg.payload.length; i++){\n    var temp = msg.payload[i]\n    .replace(/[0-9]/g, \"\")\n    .replace(/(?:https?|ftp):\\/\\/[\\n\\S]+/g, \"\")\n    .replace(/[/.,?!:;&()\"'%@|]/g, \"\")\n\n    .toLowerCase()\n    .replace(/\\n/g, \" \")\n    .replace(/-/g, \"\")\n    .replace(/_/g, \"\")\n    .split(\" \");\n    \n    for(var j = 0; j < temp.length; j++){\n        var stopword = stopwords.includes(temp[j]);\n        if(stopword){\n            temp[j] = \"\";\n        }\n        if(temp[j] != \"\"){\n\n            words.push(temp[j]);\n        }\n\n    }\n}\n\nconst map = words.reduce((acc, word) => {\n\n    let count = acc.get(word) || 0;\n    acc.set(word, ++count)\n    return acc;\n  }, new Map());\n  // Sort by counter first from higher to lower. If counter is the same,\n  // then sort by alphabetical order\n  const topk = [...map].sort((a, b) => b[1] - a[1] || a[0].localeCompare(b[0]));\n  // Return array of k most frequent words\n   \n    msg.payload = topk.slice(0, 20);\n    //.map(item => item[0]);\n    \n    var loc_object = []; \n    //.map(item => item[0]);\n    for(var i = 0; i < msg.payload.length; i++){\n        loc_object[i] = {\"x\": msg.payload[i][0], \"value\": msg.payload[i][1]};\n        \n    }\n\n\n\nmsg.payload = loc_object;\n\n\n\n\n//msg.payload = words\nreturn msg;\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3492.1085205078125,"y":1686.24462890625,"wires":[["f7ab7f0.8fe96"]]},{"id":"7c55907c.9de0a8","type":"function","z":"5d651a81.8ece7c","name":"Locations Wordcloud (Bristol)","func":"words = [];\n\nplaces = ['bath',  'birmingham', 'bradford', 'brighton and hove', 'bristol', 'cambridge',  'canterbury', 'carlisle', 'chester', 'chichester', 'coventry', 'derby', 'durham', ' ely ', 'exeter', 'gloucester', 'hereford', 'kingston upon hull', 'lancaster', 'leeds', 'leicester', 'lichfield', 'lincoln', 'liverpool', 'london', 'manchester', 'newcastle upon tyne', 'norwich', 'nottingham', 'oxford', 'peterborough', 'plymouth', 'portsmouth', 'preston', 'ripon', 'salford', 'salisbury', 'sheffield', 'southampton', 'st albans', 'stoke-on-trent', 'sunderland', 'truro', 'wakefield', 'wells', 'westminster', 'winchester', 'wolverhampton', 'worcester', 'york', 'bangor', 'cardiff', 'newport', 'st davids', 'swansea', 'aberdeen', 'dundee', 'edinburgh', 'glasgow', 'inverness', 'stirling', 'armagh', 'belfast', 'londonderry', 'lisburn', 'newry', 'aberdeenshire', 'angus',  'antrim', 'argyll', 'armagh',\n'ayrshire',\n'banffshire',\n'berkshire',\n'berwickshire',\n'bristol',\n'buckinghamshire',\n' bute ',\n'caithness',\n'cambridgeshire',\n'cheshire',\n 'london' ,\n'clackmannanshire',\n'clwyd',\n'cornwall',\n'cumbria',\n'derbyshire',\n'devon',\n'dorset',\n'county down',\n'dumfriesshire',\n'dunbartonshire',\n'durham',\n'dyfed',\n'east lothian',\n'east riding of yorkshire',\n'east sussex',\n'essex',\n'fermanagh',\n'fife',\n'gloucestershire',\n'greater london',\n'greater manchester',\n'gwent',\n'gwynedd',\n'hampshire',\n'herefordshire',\n'hertfordshire',\n'inverness-shire',\n'isle of wight',\n'kent',\n'kincardineshire',\n'kinross-shire',\n'kirkcudbrightshire',\n'lanarkshire',\n'lancashire',\n'leicestershire',\n'lincolnshire',\n'londonderry',\n'merseyside',\n'mid glamorgan',\n'midlothian',\n'moray',\n'nairnshire',\n'norfolk',\n'north yorkshire',\n'northamptonshire',\n'northumberland',\n'nottinghamshire',\n'orkney',\n'oxfordshire',\n'peeblesshire',\n'perthshire',\n'powys',\n'renfrewshire',\n'ross and cromarty',\n'roxburghshire',\n'rutland',\n'selkirkshire',\n'shetland',\n'shropshire',\n'somerset',\n'south glamorgan',\n'south yorkshire',\n'staffordshire',\n'stirlingshire',\n'suffolk',\n'surrey',\n'sutherland',\n'tyne and wear',\n'tyrone',\n'warwickshire',\n'west glamorgan',\n'west lothian',\n'west midlands',\n'west sussex',\n'west yorkshire',\n'wigtownshire',\n'wiltshire',\n'worcestershire']\n\n\n\nfor(var i =0; i < msg.payload.length; i++){\n    var temp = msg.payload[i]\n    .replace(/(?:https?|ftp):\\/\\/[\\n\\S]+/g, \"\")\n    .replace(/[/.,?!:;&()\" ' |@#]/g, \"\")\n    .toLowerCase()\n    .replace(/\\n/g, \" \");\n    //.split(\" \");\n\n    for(var j = 0; j < places.length; j++){\n        var contains = temp.includes(places[j]);\n        if(contains){\n            words.push(places[j]);\n        }\n    }\n}\n\nconst map = words.reduce((acc, word) => {\n\n    let count = acc.get(word) || 0;\n    acc.set(word, ++count)\n    return acc;\n  }, new Map());\n  // Sort by counter first from higher to lower. If counter is the same,\n  // then sort by alphabetical order\n  const top_places = [...map].sort((a, b) => b[1] - a[1] || a[0].localeCompare(b[0]));\n  // Return array of k most frequent words\n   \n    msg.payload = top_places.slice(0, 100);\n    var loc_object = []; \n    //.map(item => item[0]);\n    for(var i = 0; i < msg.payload.length; i++){\n        loc_object[i] = {\"x\": msg.payload[i][0], \"value\": msg.payload[i][1]};\n        \n    }\n\n\n\nmsg.payload = loc_object;\n\n\n\n\nreturn msg;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3394.9971923828125,"y":1733.6083984375,"wires":[["70bbe67a.7a646"]]},{"id":"19adf7c2.608aa8","type":"function","z":"5d651a81.8ece7c","name":"","func":"msg.finished3 = true; \n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3906.8509550094604,"y":1546.6536808013916,"wires":[["9f47dde1.30894","e4f9a158.8cd738"]],"l":false},{"id":"c69cd0f.7c781b","type":"natural-language-understanding","z":"5d651a81.8ece7c","name":"","categories":false,"limitcategories":"8","concepts":false,"maxconcepts":"8","doc-emotion":true,"doc-emotion-target":"","doc-sentiment":false,"doc-sentiment-target":"","entity":false,"entity-emotion":false,"entity-sentiment":false,"maxentities":"50","keyword":false,"keyword-emotion":true,"keyword-sentiment":true,"maxkeywords":"50","metadata":false,"relation":false,"semantic":false,"semantic-entities":true,"semantic-keywords":true,"maxsemantics":"50","limittextcharacters":"0","syntax":false,"syntax-sentences":false,"syntax-tokens-lemma":false,"syntax-tokens-pos":false,"service-endpoint":"https://api.us-south.natural-language-understanding.watson.cloud.ibm.com/instances/3252dc64-1496-4697-bd85-69b0a850cc46","x":3758.850746154785,"y":1634.9558219909668,"wires":[["55ff88db.932fc8"]]},{"id":"9f47dde1.30894","type":"function","z":"5d651a81.8ece7c","name":"avg joy","func":"var sentiment = global.get('sentimentBrist') || [];\nvar sum = 0;\nfor(var i = 0; i < sentiment.length; i++){\n    sum += sentiment[i];\n}\n\n\n\nvar average = 0;\n\nif(sentiment.length > 0){\n    average = sum/sentiment.length; \n}\n\nmsg.payload = {\"Mood\": average};\nmsg.average = average; \n\nif(msg.finished3 == true){\n    \n    return msg; \n}\nelse{\n\n    return; \n}\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4075.0628547668457,"y":1545.8953247070312,"wires":[["cc75a97c.ba424","d98ca040.331198"]]},{"id":"e4f9a158.8cd738","type":"function","z":"5d651a81.8ece7c","name":"joy for line graph","func":"var sentiment = global.get('sentimentBrist') || [];\nvar sum = 0;\nfor(var i = 0; i < sentiment.length; i++){\n    sum += sentiment[i];\n}\n\nvar today = new Date();\nvar date = today.getFullYear() + '-' +(today.getMonth()+1) + '-' + today.getDate();\nvar average = 0;\n\nif(sentiment.length > 0){\n    average = sum/sentiment.length; \n}\n\nglobal.set('average_brist', average); \nvar object = {\"date\": date, \"joy\": average};\nmsg.payload = object; \n\nif(msg.finished3 == true){\n    global.set('still_processing_brist', false);\n    return msg; \n}\n\nelse{\n    global.set('still_processing_brist', true);\n    return; \n}\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4156.751354217529,"y":1733.1070766448975,"wires":[["406d1f52.e087b"]]},{"id":"55ff88db.932fc8","type":"function","z":"5d651a81.8ece7c","name":"","func":"msg.payload = msg.features;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3960.6086893081665,"y":1634.2892627716064,"wires":[["55126a73.35d314"]],"l":false},{"id":"55126a73.35d314","type":"function","z":"5d651a81.8ece7c","name":"create sentiment array","func":"\n\nvar sentiment = global.get('sentimentBrist') || [];\n\nsentiment.push(msg.features.emotion.document.emotion.joy);\nglobal.set(\"sentimentBrist\", sentiment);\nmsg.payload = sentiment; \n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4121.245132446289,"y":1629.5011730194092,"wires":[["9f47dde1.30894","e4f9a158.8cd738"]]},{"id":"d98ca040.331198","type":"function","z":"5d651a81.8ece7c","name":"ColorFunction","func":"var average = msg.average;\n// var average = 0.1;\n\nif(0 <= average && average < 0.2){\n    msg.payload = {\n        normal: {\n            fill: \"#cc2316  0.3\",\n            stroke: \"#cc2316\"\n        }\n    };\n    return msg;\n}else if(0.2 <= average && average < 0.4){\n    msg.payload = {\n        normal: {\n            fill: \"#fc7600  0.3\",\n            stroke: \"#fc7600\"\n        }\n    };\n    return msg;\n}else if(0.4 <= average && average < 0.6){\n    msg.payload = {\n        normal: {\n            fill: \"#fbff00  0.3\",\n            stroke: \"#fbff00\"\n        }\n    };\n    return msg;\n}else if(0.6 <= average && average < 0.8){\n    msg.payload = {\n        normal: {\n            fill: \"#00ff11  0.3\",\n            stroke: \"#00ff11\"\n        }\n    };\n    return msg;\n}else if(0.8 <= average && average <= 1){\n    msg.payload = {\n        normal: {\n            fill: \"#049cfc  0.3\",\n            stroke: \"#049cfc\"\n        }\n    };\n    return msg;\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4279.2661781311035,"y":1495.7435131072998,"wires":[["696637e.4a97bc8"]]},{"id":"5e589976.29b318","type":"function","z":"5d651a81.8ece7c","name":"Store Brist text in database","func":"var text = global.get('brist_text'); \nmsg.payload = text;\nglobal.set('brist_text', []); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":287.28570556640625,"y":1172.5713787078857,"wires":[["8bd7d19f.946368"]]},{"id":"6dbf4889.6c3248","type":"function","z":"5d651a81.8ece7c","name":"Store Brist Tweet count","func":"var tweet = global.get('brist_tweets'); \nmsg.payload = {Tweets: tweet};\nglobal.set('brist_tweets', 0); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":283.06348943710327,"y":1224.2381038665771,"wires":[["69ab6e65.73e8c8"]]},{"id":"3200afa.585005","type":"function","z":"5d651a81.8ece7c","name":"Store Bristol Retweet count","func":"var tweet = global.get('brist_retweets'); \nmsg.payload = {Retweets: tweet};\nglobal.set('brist_retweets', 0); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":287.28570556640625,"y":1270.5713787078857,"wires":[["ace35440.a7f29"]]},{"id":"11cb3334.efc8dd","type":"function","z":"5d651a81.8ece7c","name":"Too many tweets (graph)","func":"var still_processing = global.get('still_processing_brist');\nvar average = global.get('average_brist'); \nvar today = new Date();\nvar date = today.getFullYear() + '-' +(today.getMonth()+1) + '-' + today.getDate();\n\nif(still_processing == true){\n  var object = {\"date\": date, \"joy\": average};\n  msg.payload = object; \n  global.set('still_processing_brist', false);\n  return msg;\n        \n}\nmsg.finished = still_processing; \n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":278.2380676269531,"y":1317.1427898406982,"wires":[["7475feb2.886cd8"]]},{"id":"e898fbdb.3bc4f8","type":"function","z":"5d651a81.8ece7c","name":"Convert to Array of Strings","func":"var tweets = []; \n\nvar count; \nfor (var i = 0; i < Object.keys(msg.payload[0]).length; i++){\n\n  tweets.push(msg.payload[0][i].x);\n\n  \n}\n\nmsg.payload = tweets;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1348.333251953125,"y":2145,"wires":[["627512fb.c74e5c","568d7c62.bd334c"]]},{"id":"627512fb.c74e5c","type":"function","z":"5d651a81.8ece7c","name":"Get 20 Most Common Words for Word Cloud (Cam)","func":"words = [];\n\nstopwords = [\"a\", \"able\", \"about\",\n        \"across\", \"after\", \"all\", \"almost\", \"also\", \"am\", \"among\", \"an\",\n        \"and\", \"any\", \"are\", \"as\", \"at\", \"b\", \"be\", \"because\", \"been\",\n        \"but\", \"by\", \"c\", \"can\", \"cannot\", \"could\", \"d\", \"dear\", \"did\",\n        \"do\", \"does\", \"e\", \"either\", \"else\", \"ever\", \"every\", \"f\", \"for\",\n        \"from\", \"g\", \"get\", \"got\", \"h\", \"had\", \"has\", \"have\", \"he\", \"her\",\n        \"hers\", \"him\", \"his\", \"how\", \"however\", \"i\", \"if\", \"in\", \"into\",\n        \"is\", \"it\", \"its\", \"j\", \"just\", \"k\", \"l\", \"least\", \"let\", \"like\",\n        \"likely\", \"m\", \"may\", \"me\", \"might\", \"most\", \"must\", \"my\",\n        \"neither\", \"n\", \"no\", \"nor\", \"not\", \"o\", \"of\", \"off\", \"often\",\n        \"on\", \"only\", \"or\", \"other\", \"our\", \"own\", \"p\", \"q\", \"r\", \"rather\",\n        \"s\", \"said\", \"say\", \"says\", \"she\", \"should\", \"since\", \"so\", \"some\",\n        \"t\", \"than\", \"that\", \"the\", \"their\", \"them\", \"then\", \"there\",\n        \"these\", \"they\", \"this\", \"tis\", \"to\", \"too\", \"twas\", \"u\", \"us\",\n        \"v\", \"w\", \"wants\", \"was\", \"we\", \"were\", \"what\", \"when\", \"where\",\n        \"which\", \"while\", \"who\", \"whom\", \"why\", \"will\", \"with\", \"would\",\n        \"x\", \"y\", \"yet\", \"you\", \"your\", \"z\", \"rt\"];\n\nfor(var i =0; i < msg.payload.length; i++){\n    var temp = msg.payload[i]\n    .replace(/[0-9]/g, \"\")\n    .replace(/(?:https?|ftp):\\/\\/[\\n\\S]+/g, \"\")\n    .replace(/[/.,?!:;&()\"'%@|]/g, \"\")\n\n    .toLowerCase()\n    .replace(/\\n/g, \" \")\n    .replace(/-/g, \"\")\n    .replace(/_/g, \"\")\n    .split(\" \");\n    \n    for(var j = 0; j < temp.length; j++){\n        var stopword = stopwords.includes(temp[j]);\n        if(stopword){\n            temp[j] = \"\";\n        }\n        if(temp[j] != \"\"){\n\n            words.push(temp[j]);\n        }\n\n    }\n}\n\nconst map = words.reduce((acc, word) => {\n\n    let count = acc.get(word) || 0;\n    acc.set(word, ++count)\n    return acc;\n  }, new Map());\n  // Sort by counter first from higher to lower. If counter is the same,\n  // then sort by alphabetical order\n  const topk = [...map].sort((a, b) => b[1] - a[1] || a[0].localeCompare(b[0]));\n  // Return array of k most frequent words\n   \n    msg.payload = topk.slice(0, 20);\n    //.map(item => item[0]);\n    \n    var loc_object = []; \n    //.map(item => item[0]);\n    for(var i = 0; i < msg.payload.length; i++){\n        loc_object[i] = {\"x\": msg.payload[i][0], \"value\": msg.payload[i][1]};\n        \n    }\n\n\n\nmsg.payload = loc_object;\n\n\n\n\n//msg.payload = words\nreturn msg;\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1768.969497680664,"y":2146.000165939331,"wires":[["62ee1de8.676f04"]]},{"id":"568d7c62.bd334c","type":"function","z":"5d651a81.8ece7c","name":"Locations Wordcloud (Cambridge)","func":"words = [];\n\nplaces = ['bath',  'birmingham', 'bradford', 'brighton and hove', 'bristol', 'cambridge',  'canterbury', 'carlisle', 'chester', 'chichester', 'coventry', 'derby', 'durham', ' ely ', 'exeter', 'gloucester', 'hereford', 'kingston upon hull', 'lancaster', 'leeds', 'leicester', 'lichfield', 'lincoln', 'liverpool', 'london', 'manchester', 'newcastle upon tyne', 'norwich', 'nottingham', 'oxford', 'peterborough', 'plymouth', 'portsmouth', 'preston', 'ripon', 'salford', 'salisbury', 'sheffield', 'southampton', 'st albans', 'stoke-on-trent', 'sunderland', 'truro', 'wakefield', 'wells', 'westminster', 'winchester', 'wolverhampton', 'worcester', 'york', 'bangor', 'cardiff', 'newport', 'st davids', 'swansea', 'aberdeen', 'dundee', 'edinburgh', 'glasgow', 'inverness', 'stirling', 'armagh', 'belfast', 'londonderry', 'lisburn', 'newry', 'aberdeenshire', 'angus',  'antrim', 'argyll', 'armagh',\n'ayrshire',\n'banffshire',\n'berkshire',\n'berwickshire',\n'bristol',\n'buckinghamshire',\n' bute ',\n'caithness',\n'cambridgeshire',\n'cheshire',\n 'london' ,\n'clackmannanshire',\n'clwyd',\n'cornwall',\n'cumbria',\n'derbyshire',\n'devon',\n'dorset',\n'county down',\n'dumfriesshire',\n'dunbartonshire',\n'durham',\n'dyfed',\n'east lothian',\n'east riding of yorkshire',\n'east sussex',\n'essex',\n'fermanagh',\n'fife',\n'gloucestershire',\n'greater london',\n'greater manchester',\n'gwent',\n'gwynedd',\n'hampshire',\n'herefordshire',\n'hertfordshire',\n'inverness-shire',\n'isle of wight',\n'kent',\n'kincardineshire',\n'kinross-shire',\n'kirkcudbrightshire',\n'lanarkshire',\n'lancashire',\n'leicestershire',\n'lincolnshire',\n'londonderry',\n'merseyside',\n'mid glamorgan',\n'midlothian',\n'moray',\n'nairnshire',\n'norfolk',\n'north yorkshire',\n'northamptonshire',\n'northumberland',\n'nottinghamshire',\n'orkney',\n'oxfordshire',\n'peeblesshire',\n'perthshire',\n'powys',\n'renfrewshire',\n'ross and cromarty',\n'roxburghshire',\n'rutland',\n'selkirkshire',\n'shetland',\n'shropshire',\n'somerset',\n'south glamorgan',\n'south yorkshire',\n'staffordshire',\n'stirlingshire',\n'suffolk',\n'surrey',\n'sutherland',\n'tyne and wear',\n'tyrone',\n'warwickshire',\n'west glamorgan',\n'west lothian',\n'west midlands',\n'west sussex',\n'west yorkshire',\n'wigtownshire',\n'wiltshire',\n'worcestershire']\n\n\n\nfor(var i =0; i < msg.payload.length; i++){\n    var temp = msg.payload[i]\n    .replace(/(?:https?|ftp):\\/\\/[\\n\\S]+/g, \"\")\n    .replace(/[/.,?!:;&()\" ' |@#]/g, \"\")\n    .toLowerCase()\n    .replace(/\\n/g, \" \");\n    //.split(\" \");\n\n    for(var j = 0; j < places.length; j++){\n        var contains = temp.includes(places[j]);\n        if(contains){\n            words.push(places[j]);\n        }\n    }\n}\n\nconst map = words.reduce((acc, word) => {\n\n    let count = acc.get(word) || 0;\n    acc.set(word, ++count)\n    return acc;\n  }, new Map());\n  // Sort by counter first from higher to lower. If counter is the same,\n  // then sort by alphabetical order\n  const top_places = [...map].sort((a, b) => b[1] - a[1] || a[0].localeCompare(b[0]));\n  // Return array of k most frequent words\n   \n    msg.payload = top_places.slice(0, 100);\n    var loc_object = []; \n    //.map(item => item[0]);\n    for(var i = 0; i < msg.payload.length; i++){\n        loc_object[i] = {\"x\": msg.payload[i][0], \"value\": msg.payload[i][1]};\n        \n    }\n\n\n\nmsg.payload = loc_object;\n\n\n\n\nreturn msg;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1701.858169555664,"y":2193.363935470581,"wires":[["735f7191.b2c828"]]},{"id":"c07d596d.3086d","type":"complete","z":"5d651a81.8ece7c","name":"Process New Tweets for Cambridge","scope":["d5c7adf7.343828"],"uncaught":false,"x":1290,"y":2000,"wires":[["19789a26.4041d6","7947b0.d0bda05"]]},{"id":"b3e1e496.fd0ea","type":"function","z":"5d651a81.8ece7c","name":"Function for array of strings","func":"var tweets = []; \n\nvar count; \nfor (var i = 0; i < Object.keys(msg.payload[0]).length; i++){\n\n  tweets.push(msg.payload[0][i].x);\n\n  \n}\n\nmsg.payload = tweets;\nreturn msg;\n\n// for(var i = 0; i < Object.keys(ox2[0]).length; i++){\n//   ox_loc.push({\"x\": ox2[0][i].x, \"value\": ox2[0][i].value});\n// }","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1985.7117233276367,"y":1933.3476848602295,"wires":[["ed426a32.6dc0f8"]]},{"id":"7947b0.d0bda05","type":"function","z":"5d651a81.8ece7c","name":"declare sentiment global","func":"global.set('sentimentCam',[]);\n// global.set('tweet_num', msg.payload.length);\n// global.set('IC',true);\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1655.7765579223633,"y":1993.0705318450928,"wires":[[]]},{"id":"ed426a32.6dc0f8","type":"delay","z":"5d651a81.8ece7c","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2161.0062866210938,"y":1933.5595655441284,"wires":[["46157517.0b3bec"]],"l":false},{"id":"48f633aa.473d34","type":"function","z":"5d651a81.8ece7c","name":"","func":"msg.finished4 = true; \n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2193.711932182312,"y":2006.4092178344727,"wires":[["cfe279a7.824828","ec3f597c.2dbdb8"]],"l":false},{"id":"51e18b60.1dd77c","type":"natural-language-understanding","z":"5d651a81.8ece7c","name":"","categories":false,"limitcategories":"8","concepts":false,"maxconcepts":"8","doc-emotion":true,"doc-emotion-target":"","doc-sentiment":false,"doc-sentiment-target":"","entity":false,"entity-emotion":false,"entity-sentiment":false,"maxentities":"50","keyword":false,"keyword-emotion":true,"keyword-sentiment":true,"maxkeywords":"50","metadata":false,"relation":false,"semantic":false,"semantic-entities":true,"semantic-keywords":true,"maxsemantics":"50","limittextcharacters":"0","syntax":false,"syntax-sentences":false,"syntax-tokens-lemma":false,"syntax-tokens-pos":false,"service-endpoint":"https://api.us-south.natural-language-understanding.watson.cloud.ibm.com/instances/3252dc64-1496-4697-bd85-69b0a850cc46","x":2045.7117233276367,"y":2094.711359024048,"wires":[["70bad946.39761"]]},{"id":"cfe279a7.824828","type":"function","z":"5d651a81.8ece7c","name":"avg joy","func":"var sentiment = global.get('sentimentCam') || [];\nvar sum = 0;\nfor(var i = 0; i < sentiment.length; i++){\n    sum += sentiment[i];\n}\n\n\n\nvar average = 0;\n\nif(sentiment.length > 0){\n    average = sum/sentiment.length; \n}\n\nmsg.payload = {\"Mood\": average};\nmsg.average = average; \n\nif(msg.finished4 == true){\n    \n    return msg; \n}\nelse{\n\n    return; \n}\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2361.9238319396973,"y":2005.6508617401123,"wires":[["2db4d0eb.5b3098","ca4e2628.b1ac98"]]},{"id":"ec3f597c.2dbdb8","type":"function","z":"5d651a81.8ece7c","name":"joy for line graph","func":"var sentiment = global.get('sentimentCam') || [];\nvar sum = 0;\nfor(var i = 0; i < sentiment.length; i++){\n    sum += sentiment[i];\n}\n\nvar today = new Date();\nvar date = today.getFullYear() + '-' +(today.getMonth()+1) + '-' + today.getDate();\nvar average = 0;\n\nif(sentiment.length > 0){\n    average = sum/sentiment.length; \n}\n\nglobal.set('average_cam', average); \nvar object = {\"date\": date, \"joy\": average};\nmsg.payload = object; \n\nif(msg.finished4 == true){\n    global.set('still_processing_cam', false);\n    return msg; \n}\n\nelse{\n    global.set('still_processing_cam', true);\n    return; \n}\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2443.612331390381,"y":2192.8626136779785,"wires":[["47ad45d2.dd0b94"]]},{"id":"70bad946.39761","type":"function","z":"5d651a81.8ece7c","name":"","func":"msg.payload = msg.features;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2247.469666481018,"y":2094.0447998046875,"wires":[["fbdbd4af.2e9808"]],"l":false},{"id":"fbdbd4af.2e9808","type":"function","z":"5d651a81.8ece7c","name":"create sentiment array","func":"\n\nvar sentiment = global.get('sentimentCam') || [];\n\nsentiment.push(msg.features.emotion.document.emotion.joy);\nglobal.set(\"sentimentCam\", sentiment);\nmsg.payload = sentiment; \n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2408.1061096191406,"y":2089.2567100524902,"wires":[["cfe279a7.824828","ec3f597c.2dbdb8"]]},{"id":"ca4e2628.b1ac98","type":"function","z":"5d651a81.8ece7c","name":"ColorFunction","func":"var average = msg.average;\n// var average = 0.1;\n\nif(0 <= average && average < 0.2){\n    msg.payload = {\n        normal: {\n            fill: \"#cc2316  0.3\",\n            stroke: \"#cc2316\"\n        }\n    };\n    return msg;\n}else if(0.2 <= average && average < 0.4){\n    msg.payload = {\n        normal: {\n            fill: \"#fc7600  0.3\",\n            stroke: \"#fc7600\"\n        }\n    };\n    return msg;\n}else if(0.4 <= average && average < 0.6){\n    msg.payload = {\n        normal: {\n            fill: \"#fbff00  0.3\",\n            stroke: \"#fbff00\"\n        }\n    };\n    return msg;\n}else if(0.6 <= average && average < 0.8){\n    msg.payload = {\n        normal: {\n            fill: \"#00ff11  0.3\",\n            stroke: \"#00ff11\"\n        }\n    };\n    return msg;\n}else if(0.8 <= average && average <= 1){\n    msg.payload = {\n        normal: {\n            fill: \"#049cfc  0.3\",\n            stroke: \"#049cfc\"\n        }\n    };\n    return msg;\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2566.127155303955,"y":1955.4990501403809,"wires":[["979d1ab4.11ab6"]]},{"id":"a6ba6ca9.14a268","type":"function","z":"5d651a81.8ece7c","name":"Store Cam text in database","func":"var text = global.get('cam_text'); \nmsg.payload = text;\nglobal.set('cam_text', []); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":296.88404846191406,"y":1398.9391400814056,"wires":[["d5c7adf7.343828"]]},{"id":"e1da2b5c.63115","type":"function","z":"5d651a81.8ece7c","name":"Store Cam Tweet count","func":"var tweet = global.get('cam_tweets'); \nmsg.payload = {Tweets: tweet};\nglobal.set('cam_tweets', 0); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":292.6618323326111,"y":1450.605865240097,"wires":[["e3512686.6cc8a8"]]},{"id":"5a48f09b.be787","type":"function","z":"5d651a81.8ece7c","name":"Store Cam Retweet count","func":"var tweet = global.get('cam_retweets'); \nmsg.payload = {Retweets: tweet};\nglobal.set('cam_retweets', 0); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":296.88404846191406,"y":1496.9391400814056,"wires":[["19930e92.474b11"]]},{"id":"605fc7f.b259f38","type":"function","z":"5d651a81.8ece7c","name":"Too many tweets (graph)","func":"var still_processing = global.get('still_processing_cam');\nvar average = global.get('average_cam'); \nvar today = new Date();\nvar date = today.getFullYear() + '-' +(today.getMonth()+1) + '-' + today.getDate();\n\nif(still_processing == true){\n  var object = {\"date\": date, \"joy\": average};\n  msg.payload = object; \n  global.set('still_processing_cam', false);\n  return msg;\n        \n}\nmsg.finished = still_processing; \n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":287.83641052246094,"y":1543.5105512142181,"wires":[["79bb281f.7c08f"]]},{"id":"7ebb01cd.35a588","type":"function","z":"5d651a81.8ece7c","name":"Store Cardiff text in database","func":"var text = global.get('cardiff_text'); \nmsg.payload = text;\nglobal.set('cardiff_text', []); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":305.65748596191406,"y":1621.3361127376556,"wires":[["1552c91a.85f16f"]]},{"id":"7dc52c84.408fac","type":"function","z":"5d651a81.8ece7c","name":"Store Cardiff Tweet count","func":"var tweet = global.get('cardiff_tweets'); \nmsg.payload = {Tweets: tweet};\nglobal.set('cardiff_tweets', 0); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":301.4352698326111,"y":1673.002837896347,"wires":[["3c438dc3.86a582"]]},{"id":"bd7e4a6a.fa49c8","type":"function","z":"5d651a81.8ece7c","name":"Store Cardiff Retweet count","func":"var tweet = global.get('cardiff_retweets'); \nmsg.payload = {Retweets: tweet};\nglobal.set('cardiff_retweets', 0); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":305.65748596191406,"y":1719.3361127376556,"wires":[["fdd46ab4.e732c8"]]},{"id":"7a59c985.933f28","type":"function","z":"5d651a81.8ece7c","name":"Too many tweets (graph)","func":"var still_processing = global.get('still_processing_cardiff');\nvar average = global.get('average_cardiff'); \nvar today = new Date();\nvar date = today.getFullYear() + '-' +(today.getMonth()+1) + '-' + today.getDate();\n\nif(still_processing == true){\n  var object = {\"date\": date, \"joy\": average};\n  msg.payload = object; \n  global.set('still_processing_cardiff', false); \n  return msg;\n        \n}\n\n// msg.finished = still_processing; \n  \n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":286.60984802246094,"y":1765.9075238704681,"wires":[["819c6699.56b03"]]},{"id":"c46b45b3.621fb","type":"function","z":"5d651a81.8ece7c","name":"Convert to Array of Strings","func":"var tweets = []; \n\nvar count; \nfor (var i = 0; i < Object.keys(msg.payload[0]).length; i++){\n\n  tweets.push(msg.payload[0][i].x);\n\n  \n}\n\nmsg.payload = tweets;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3071.013671875,"y":2114.478271484375,"wires":[["1b70423c.033596","fa814fdf.ee091"]]},{"id":"1b70423c.033596","type":"function","z":"5d651a81.8ece7c","name":"Get 20 Most Common Words for Word Cloud (Car)","func":"words = [];\n\nstopwords = [\"a\", \"able\", \"about\",\n        \"across\", \"after\", \"all\", \"almost\", \"also\", \"am\", \"among\", \"an\",\n        \"and\", \"any\", \"are\", \"as\", \"at\", \"b\", \"be\", \"because\", \"been\",\n        \"but\", \"by\", \"c\", \"can\", \"cannot\", \"could\", \"d\", \"dear\", \"did\",\n        \"do\", \"does\", \"e\", \"either\", \"else\", \"ever\", \"every\", \"f\", \"for\",\n        \"from\", \"g\", \"get\", \"got\", \"h\", \"had\", \"has\", \"have\", \"he\", \"her\",\n        \"hers\", \"him\", \"his\", \"how\", \"however\", \"i\", \"if\", \"in\", \"into\",\n        \"is\", \"it\", \"its\", \"j\", \"just\", \"k\", \"l\", \"least\", \"let\", \"like\",\n        \"likely\", \"m\", \"may\", \"me\", \"might\", \"most\", \"must\", \"my\",\n        \"neither\", \"n\", \"no\", \"nor\", \"not\", \"o\", \"of\", \"off\", \"often\",\n        \"on\", \"only\", \"or\", \"other\", \"our\", \"own\", \"p\", \"q\", \"r\", \"rather\",\n        \"s\", \"said\", \"say\", \"says\", \"she\", \"should\", \"since\", \"so\", \"some\",\n        \"t\", \"than\", \"that\", \"the\", \"their\", \"them\", \"then\", \"there\",\n        \"these\", \"they\", \"this\", \"tis\", \"to\", \"too\", \"twas\", \"u\", \"us\",\n        \"v\", \"w\", \"wants\", \"was\", \"we\", \"were\", \"what\", \"when\", \"where\",\n        \"which\", \"while\", \"who\", \"whom\", \"why\", \"will\", \"with\", \"would\",\n        \"x\", \"y\", \"yet\", \"you\", \"your\", \"z\", \"rt\"];\n\nfor(var i =0; i < msg.payload.length; i++){\n    var temp = msg.payload[i]\n    .replace(/[0-9]/g, \"\")\n    .replace(/(?:https?|ftp):\\/\\/[\\n\\S]+/g, \"\")\n    .replace(/[/.,?!:;&()\"'%@|]/g, \"\")\n\n    .toLowerCase()\n    .replace(/\\n/g, \" \")\n    .replace(/-/g, \"\")\n    .replace(/_/g, \"\")\n    .split(\" \");\n    \n    for(var j = 0; j < temp.length; j++){\n        var stopword = stopwords.includes(temp[j]);\n        if(stopword){\n            temp[j] = \"\";\n        }\n        if(temp[j] != \"\"){\n\n            words.push(temp[j]);\n        }\n\n    }\n}\n\nconst map = words.reduce((acc, word) => {\n\n    let count = acc.get(word) || 0;\n    acc.set(word, ++count)\n    return acc;\n  }, new Map());\n  // Sort by counter first from higher to lower. If counter is the same,\n  // then sort by alphabetical order\n  const topk = [...map].sort((a, b) => b[1] - a[1] || a[0].localeCompare(b[0]));\n  // Return array of k most frequent words\n   \n    msg.payload = topk.slice(0, 20);\n    //.map(item => item[0]);\n    \n    var loc_object = []; \n    //.map(item => item[0]);\n    for(var i = 0; i < msg.payload.length; i++){\n        loc_object[i] = {\"x\": msg.payload[i][0], \"value\": msg.payload[i][1]};\n        \n    }\n\n\n\nmsg.payload = loc_object;\n\n\n\n\n//msg.payload = words\nreturn msg;\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3491.649917602539,"y":2115.478437423706,"wires":[["d2d7b693.69bf8"]]},{"id":"fa814fdf.ee091","type":"function","z":"5d651a81.8ece7c","name":"Locations Wordcloud (Car)","func":"words = [];\n\nplaces = ['bath',  'birmingham', 'bradford', 'brighton and hove', 'bristol', 'cambridge',  'canterbury', 'carlisle', 'chester', 'chichester', 'coventry', 'derby', 'durham', ' ely ', 'exeter', 'gloucester', 'hereford', 'kingston upon hull', 'lancaster', 'leeds', 'leicester', 'lichfield', 'lincoln', 'liverpool', 'london', 'manchester', 'newcastle upon tyne', 'norwich', 'nottingham', 'oxford', 'peterborough', 'plymouth', 'portsmouth', 'preston', 'ripon', 'salford', 'salisbury', 'sheffield', 'southampton', 'st albans', 'stoke-on-trent', 'sunderland', 'truro', 'wakefield', 'wells', 'westminster', 'winchester', 'wolverhampton', 'worcester', 'york', 'bangor', 'cardiff', 'newport', 'st davids', 'swansea', 'aberdeen', 'dundee', 'edinburgh', 'glasgow', 'inverness', 'stirling', 'armagh', 'belfast', 'londonderry', 'lisburn', 'newry', 'aberdeenshire', 'angus',  'antrim', 'argyll', 'armagh',\n'ayrshire',\n'banffshire',\n'berkshire',\n'berwickshire',\n'bristol',\n'buckinghamshire',\n' bute ',\n'caithness',\n'cambridgeshire',\n'cheshire',\n 'london' ,\n'clackmannanshire',\n'clwyd',\n'cornwall',\n'cumbria',\n'derbyshire',\n'devon',\n'dorset',\n'county down',\n'dumfriesshire',\n'dunbartonshire',\n'durham',\n'dyfed',\n'east lothian',\n'east riding of yorkshire',\n'east sussex',\n'essex',\n'fermanagh',\n'fife',\n'gloucestershire',\n'greater london',\n'greater manchester',\n'gwent',\n'gwynedd',\n'hampshire',\n'herefordshire',\n'hertfordshire',\n'inverness-shire',\n'isle of wight',\n'kent',\n'kincardineshire',\n'kinross-shire',\n'kirkcudbrightshire',\n'lanarkshire',\n'lancashire',\n'leicestershire',\n'lincolnshire',\n'londonderry',\n'merseyside',\n'mid glamorgan',\n'midlothian',\n'moray',\n'nairnshire',\n'norfolk',\n'north yorkshire',\n'northamptonshire',\n'northumberland',\n'nottinghamshire',\n'orkney',\n'oxfordshire',\n'peeblesshire',\n'perthshire',\n'powys',\n'renfrewshire',\n'ross and cromarty',\n'roxburghshire',\n'rutland',\n'selkirkshire',\n'shetland',\n'shropshire',\n'somerset',\n'south glamorgan',\n'south yorkshire',\n'staffordshire',\n'stirlingshire',\n'suffolk',\n'surrey',\n'sutherland',\n'tyne and wear',\n'tyrone',\n'warwickshire',\n'west glamorgan',\n'west lothian',\n'west midlands',\n'west sussex',\n'west yorkshire',\n'wigtownshire',\n'wiltshire',\n'worcestershire']\n\n\n\nfor(var i =0; i < msg.payload.length; i++){\n    var temp = msg.payload[i]\n    .replace(/(?:https?|ftp):\\/\\/[\\n\\S]+/g, \"\")\n    .replace(/[/.,?!:;&()\" ' |@#]/g, \"\")\n    .toLowerCase()\n    .replace(/\\n/g, \" \");\n    //.split(\" \");\n\n    for(var j = 0; j < places.length; j++){\n        var contains = temp.includes(places[j]);\n        if(contains){\n            words.push(places[j]);\n        }\n    }\n}\n\nconst map = words.reduce((acc, word) => {\n\n    let count = acc.get(word) || 0;\n    acc.set(word, ++count)\n    return acc;\n  }, new Map());\n  // Sort by counter first from higher to lower. If counter is the same,\n  // then sort by alphabetical order\n  const top_places = [...map].sort((a, b) => b[1] - a[1] || a[0].localeCompare(b[0]));\n  // Return array of k most frequent words\n   \n    msg.payload = top_places.slice(0, 100);\n    var loc_object = []; \n    //.map(item => item[0]);\n    for(var i = 0; i < msg.payload.length; i++){\n        loc_object[i] = {\"x\": msg.payload[i][0], \"value\": msg.payload[i][1]};\n        \n    }\n\n\n\nmsg.payload = loc_object;\n\n\n\n\nreturn msg;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3394.538589477539,"y":2162.842206954956,"wires":[["5659993c.4da2e8"]]},{"id":"3fb3a946.1d61a6","type":"complete","z":"5d651a81.8ece7c","name":"Process New Tweets for Cardiff","scope":["47ad45d2.dd0b94"],"uncaught":false,"x":3050.5413970947266,"y":1962.233808517456,"wires":[["96dfb9e.2ea2c48","51c8c41c.ad09ec"]]},{"id":"12b226a4.2379c9","type":"function","z":"5d651a81.8ece7c","name":"Function for array of strings","func":"var tweets = []; \n\nvar count; \nfor (var i = 0; i < Object.keys(msg.payload[0]).length; i++){\n\n  tweets.push(msg.payload[0][i].x);\n\n  \n}\n\nmsg.payload = tweets;\nreturn msg;\n\n// for(var i = 0; i < Object.keys(ox2[0]).length; i++){\n//   ox_loc.push({\"x\": ox2[0][i].x, \"value\": ox2[0][i].value});\n// }","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3708.3921432495117,"y":1902.8259563446045,"wires":[["5712e602.0d0af"]]},{"id":"51c8c41c.ad09ec","type":"function","z":"5d651a81.8ece7c","name":"declare sentiment global","func":"global.set('sentimentCar',[]);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3378.4569778442383,"y":1962.5488033294678,"wires":[[]]},{"id":"5712e602.0d0af","type":"delay","z":"5d651a81.8ece7c","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":3883.6867065429688,"y":1903.0378370285034,"wires":[["ba512469.65ba78"]],"l":false},{"id":"edfe9da4.56b06","type":"function","z":"5d651a81.8ece7c","name":"","func":"msg.finished5 = true; \n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3916.392352104187,"y":1975.8874893188477,"wires":[["f1c2c3af.63e418","3b9743aa.5959d4"]],"l":false},{"id":"d1ddf84a.78aa8","type":"natural-language-understanding","z":"5d651a81.8ece7c","name":"","categories":false,"limitcategories":"8","concepts":false,"maxconcepts":"8","doc-emotion":true,"doc-emotion-target":"","doc-sentiment":false,"doc-sentiment-target":"","entity":false,"entity-emotion":false,"entity-sentiment":false,"maxentities":"50","keyword":false,"keyword-emotion":true,"keyword-sentiment":true,"maxkeywords":"50","metadata":false,"relation":false,"semantic":false,"semantic-entities":true,"semantic-keywords":true,"maxsemantics":"50","limittextcharacters":"0","syntax":false,"syntax-sentences":false,"syntax-tokens-lemma":false,"syntax-tokens-pos":false,"service-endpoint":"https://api.us-south.natural-language-understanding.watson.cloud.ibm.com/instances/3252dc64-1496-4697-bd85-69b0a850cc46","x":3768.3921432495117,"y":2064.189630508423,"wires":[["930dbf28.fc9ca"]]},{"id":"f1c2c3af.63e418","type":"function","z":"5d651a81.8ece7c","name":"avg joy","func":"var sentiment = global.get('sentimentCar') || [];\nvar sum = 0;\nfor(var i = 0; i < sentiment.length; i++){\n    sum += sentiment[i];\n}\n\n\n\nvar average = 0;\n\nif(sentiment.length > 0){\n    average = sum/sentiment.length; \n}\n\nmsg.payload = {\"Mood\": average};\nmsg.average = average; \n\nif(msg.finished5 == true){\n    \n    return msg; \n}\nelse{\n\n    return; \n}\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4084.6042518615723,"y":1975.1291332244873,"wires":[["e805554b.5fcb98","42090a7a.e2f794"]]},{"id":"3b9743aa.5959d4","type":"function","z":"5d651a81.8ece7c","name":"joy for line graph","func":"var sentiment = global.get('sentimentCar') || [];\nvar sum = 0;\nfor(var i = 0; i < sentiment.length; i++){\n    sum += sentiment[i];\n}\n\nvar today = new Date();\nvar date = today.getFullYear() + '-' +(today.getMonth()+1) + '-' + today.getDate();\nvar average = 0;\n\nif(sentiment.length > 0){\n    average = sum/sentiment.length; \n}\n\nglobal.set('average_cardiff', average); \nvar object = {\"date\": date, \"joy\": average};\nmsg.payload = object; \n\nif(msg.finished5 == true){\n    global.set('still_processing_cardiff', false);\n    return msg; \n}\n\nelse{\n    global.set('still_processing_cardiff', true);\n    return; \n}\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4166.292751312256,"y":2162.3408851623535,"wires":[["2ebb293b.c9a086"]]},{"id":"930dbf28.fc9ca","type":"function","z":"5d651a81.8ece7c","name":"","func":"msg.payload = msg.features;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3970.150086402893,"y":2063.5230712890625,"wires":[["688c049e.f05f4c"]],"l":false},{"id":"688c049e.f05f4c","type":"function","z":"5d651a81.8ece7c","name":"create sentiment array","func":"\n\nvar sentiment = global.get('sentimentCar') || [];\n\nsentiment.push(msg.features.emotion.document.emotion.joy);\nglobal.set(\"sentimentCar\", sentiment);\nmsg.payload = sentiment; \n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4130.786529541016,"y":2058.7349815368652,"wires":[["f1c2c3af.63e418","3b9743aa.5959d4"]]},{"id":"42090a7a.e2f794","type":"function","z":"5d651a81.8ece7c","name":"ColorFunction","func":"var average = msg.average;\n// var average = 0.1;\n\nif(0 <= average && average < 0.2){\n    msg.payload = {\n        normal: {\n            fill: \"#cc2316  0.3\",\n            stroke: \"#cc2316\"\n        }\n    };\n    return msg;\n}else if(0.2 <= average && average < 0.4){\n    msg.payload = {\n        normal: {\n            fill: \"#fc7600  0.3\",\n            stroke: \"#fc7600\"\n        }\n    };\n    return msg;\n}else if(0.4 <= average && average < 0.6){\n    msg.payload = {\n        normal: {\n            fill: \"#fbff00  0.3\",\n            stroke: \"#fbff00\"\n        }\n    };\n    return msg;\n}else if(0.6 <= average && average < 0.8){\n    msg.payload = {\n        normal: {\n            fill: \"#00ff11  0.3\",\n            stroke: \"#00ff11\"\n        }\n    };\n    return msg;\n}else if(0.8 <= average && average <= 1){\n    msg.payload = {\n        normal: {\n            fill: \"#049cfc  0.3\",\n            stroke: \"#049cfc\"\n        }\n    };\n    return msg;\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4288.80757522583,"y":1924.9773216247559,"wires":[["2ea4f8f0.3d66f8"]]},{"id":"b54d2ea9.9375d8","type":"function","z":"5d651a81.8ece7c","name":"Convert to Array of Strings","func":"var tweets = []; \n\nvar count; \nfor (var i = 0; i < Object.keys(msg.payload[0]).length; i++){\n\n  tweets.push(msg.payload[0][i].x);\n\n  \n}\n\nmsg.payload = tweets;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1363,"y":2515,"wires":[["6db4f1a9.66bcd","c5d30e6d.1733"]]},{"id":"6db4f1a9.66bcd","type":"function","z":"5d651a81.8ece7c","name":"Get 20 Most Common Words for Word Cloud (Durh)","func":"words = [];\n\nstopwords = [\"a\", \"able\", \"about\",\n        \"across\", \"after\", \"all\", \"almost\", \"also\", \"am\", \"among\", \"an\",\n        \"and\", \"any\", \"are\", \"as\", \"at\", \"b\", \"be\", \"because\", \"been\",\n        \"but\", \"by\", \"c\", \"can\", \"cannot\", \"could\", \"d\", \"dear\", \"did\",\n        \"do\", \"does\", \"e\", \"either\", \"else\", \"ever\", \"every\", \"f\", \"for\",\n        \"from\", \"g\", \"get\", \"got\", \"h\", \"had\", \"has\", \"have\", \"he\", \"her\",\n        \"hers\", \"him\", \"his\", \"how\", \"however\", \"i\", \"if\", \"in\", \"into\",\n        \"is\", \"it\", \"its\", \"j\", \"just\", \"k\", \"l\", \"least\", \"let\", \"like\",\n        \"likely\", \"m\", \"may\", \"me\", \"might\", \"most\", \"must\", \"my\",\n        \"neither\", \"n\", \"no\", \"nor\", \"not\", \"o\", \"of\", \"off\", \"often\",\n        \"on\", \"only\", \"or\", \"other\", \"our\", \"own\", \"p\", \"q\", \"r\", \"rather\",\n        \"s\", \"said\", \"say\", \"says\", \"she\", \"should\", \"since\", \"so\", \"some\",\n        \"t\", \"than\", \"that\", \"the\", \"their\", \"them\", \"then\", \"there\",\n        \"these\", \"they\", \"this\", \"tis\", \"to\", \"too\", \"twas\", \"u\", \"us\",\n        \"v\", \"w\", \"wants\", \"was\", \"we\", \"were\", \"what\", \"when\", \"where\",\n        \"which\", \"while\", \"who\", \"whom\", \"why\", \"will\", \"with\", \"would\",\n        \"x\", \"y\", \"yet\", \"you\", \"your\", \"z\", \"rt\"];\n\nfor(var i =0; i < msg.payload.length; i++){\n    var temp = msg.payload[i]\n    .replace(/[0-9]/g, \"\")\n    .replace(/(?:https?|ftp):\\/\\/[\\n\\S]+/g, \"\")\n    .replace(/[/.,?!:;&()\"'%@|]/g, \"\")\n\n    .toLowerCase()\n    .replace(/\\n/g, \" \")\n    .replace(/-/g, \"\")\n    .replace(/_/g, \"\")\n    .split(\" \");\n    \n    for(var j = 0; j < temp.length; j++){\n        var stopword = stopwords.includes(temp[j]);\n        if(stopword){\n            temp[j] = \"\";\n        }\n        if(temp[j] != \"\"){\n\n            words.push(temp[j]);\n        }\n\n    }\n}\n\nconst map = words.reduce((acc, word) => {\n\n    let count = acc.get(word) || 0;\n    acc.set(word, ++count)\n    return acc;\n  }, new Map());\n  // Sort by counter first from higher to lower. If counter is the same,\n  // then sort by alphabetical order\n  const topk = [...map].sort((a, b) => b[1] - a[1] || a[0].localeCompare(b[0]));\n  // Return array of k most frequent words\n   \n    msg.payload = topk.slice(0, 20);\n    //.map(item => item[0]);\n    \n    var loc_object = []; \n    //.map(item => item[0]);\n    for(var i = 0; i < msg.payload.length; i++){\n        loc_object[i] = {\"x\": msg.payload[i][0], \"value\": msg.payload[i][1]};\n        \n    }\n\n\n\nmsg.payload = loc_object;\n\n\n\n\n//msg.payload = words\nreturn msg;\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1783.636245727539,"y":2516.000165939331,"wires":[["d9288a2e.dfaf1"]]},{"id":"c5d30e6d.1733","type":"function","z":"5d651a81.8ece7c","name":"Locations Wordcloud (Durh)","func":"words = [];\n\nplaces = ['bath',  'birmingham', 'bradford', 'brighton and hove', 'bristol', 'cambridge',  'canterbury', 'carlisle', 'chester', 'chichester', 'coventry', 'derby', 'durham', ' ely ', 'exeter', 'gloucester', 'hereford', 'kingston upon hull', 'lancaster', 'leeds', 'leicester', 'lichfield', 'lincoln', 'liverpool', 'london', 'manchester', 'newcastle upon tyne', 'norwich', 'nottingham', 'oxford', 'peterborough', 'plymouth', 'portsmouth', 'preston', 'ripon', 'salford', 'salisbury', 'sheffield', 'southampton', 'st albans', 'stoke-on-trent', 'sunderland', 'truro', 'wakefield', 'wells', 'westminster', 'winchester', 'wolverhampton', 'worcester', 'york', 'bangor', 'cardiff', 'newport', 'st davids', 'swansea', 'aberdeen', 'dundee', 'edinburgh', 'glasgow', 'inverness', 'stirling', 'armagh', 'belfast', 'londonderry', 'lisburn', 'newry', 'aberdeenshire', 'angus',  'antrim', 'argyll', 'armagh',\n'ayrshire',\n'banffshire',\n'berkshire',\n'berwickshire',\n'bristol',\n'buckinghamshire',\n' bute ',\n'caithness',\n'cambridgeshire',\n'cheshire',\n 'london' ,\n'clackmannanshire',\n'clwyd',\n'cornwall',\n'cumbria',\n'derbyshire',\n'devon',\n'dorset',\n'county down',\n'dumfriesshire',\n'dunbartonshire',\n'durham',\n'dyfed',\n'east lothian',\n'east riding of yorkshire',\n'east sussex',\n'essex',\n'fermanagh',\n'fife',\n'gloucestershire',\n'greater london',\n'greater manchester',\n'gwent',\n'gwynedd',\n'hampshire',\n'herefordshire',\n'hertfordshire',\n'inverness-shire',\n'isle of wight',\n'kent',\n'kincardineshire',\n'kinross-shire',\n'kirkcudbrightshire',\n'lanarkshire',\n'lancashire',\n'leicestershire',\n'lincolnshire',\n'londonderry',\n'merseyside',\n'mid glamorgan',\n'midlothian',\n'moray',\n'nairnshire',\n'norfolk',\n'north yorkshire',\n'northamptonshire',\n'northumberland',\n'nottinghamshire',\n'orkney',\n'oxfordshire',\n'peeblesshire',\n'perthshire',\n'powys',\n'renfrewshire',\n'ross and cromarty',\n'roxburghshire',\n'rutland',\n'selkirkshire',\n'shetland',\n'shropshire',\n'somerset',\n'south glamorgan',\n'south yorkshire',\n'staffordshire',\n'stirlingshire',\n'suffolk',\n'surrey',\n'sutherland',\n'tyne and wear',\n'tyrone',\n'warwickshire',\n'west glamorgan',\n'west lothian',\n'west midlands',\n'west sussex',\n'west yorkshire',\n'wigtownshire',\n'wiltshire',\n'worcestershire']\n\n\n\nfor(var i =0; i < msg.payload.length; i++){\n    var temp = msg.payload[i]\n    .replace(/(?:https?|ftp):\\/\\/[\\n\\S]+/g, \"\")\n    .replace(/[/.,?!:;&()\" ' |@#]/g, \"\")\n    .toLowerCase()\n    .replace(/\\n/g, \" \");\n    //.split(\" \");\n\n    for(var j = 0; j < places.length; j++){\n        var contains = temp.includes(places[j]);\n        if(contains){\n            words.push(places[j]);\n        }\n    }\n}\n\nconst map = words.reduce((acc, word) => {\n\n    let count = acc.get(word) || 0;\n    acc.set(word, ++count)\n    return acc;\n  }, new Map());\n  // Sort by counter first from higher to lower. If counter is the same,\n  // then sort by alphabetical order\n  const top_places = [...map].sort((a, b) => b[1] - a[1] || a[0].localeCompare(b[0]));\n  // Return array of k most frequent words\n   \n    msg.payload = top_places.slice(0, 100);\n    var loc_object = []; \n    //.map(item => item[0]);\n    for(var i = 0; i < msg.payload.length; i++){\n        loc_object[i] = {\"x\": msg.payload[i][0], \"value\": msg.payload[i][1]};\n        \n    }\n\n\n\nmsg.payload = loc_object;\n\n\n\n\nreturn msg;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1696.524917602539,"y":2563.363935470581,"wires":[["2614bfca.2c69a8"]]},{"id":"3138e61.e17ab1a","type":"complete","z":"5d651a81.8ece7c","name":"Process New Tweets for Durham","scope":["2ebb293b.c9a086"],"uncaught":false,"x":1342.5277252197266,"y":2362.755537033081,"wires":[["48006a15.2cd5f4","82abb32.9dde3d"]]},{"id":"c34ad36.30e36b","type":"function","z":"5d651a81.8ece7c","name":"Function for array of strings","func":"var tweets = []; \n\nvar count; \nfor (var i = 0; i < Object.keys(msg.payload[0]).length; i++){\n\n  tweets.push(msg.payload[0][i].x);\n\n  \n}\n\nmsg.payload = tweets;\nreturn msg;\n\n// for(var i = 0; i < Object.keys(ox2[0]).length; i++){\n//   ox_loc.push({\"x\": ox2[0][i].x, \"value\": ox2[0][i].value});\n// }","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2000.3784713745117,"y":2303.3476848602295,"wires":[["b4eeb0e2.186f4"]]},{"id":"82abb32.9dde3d","type":"function","z":"5d651a81.8ece7c","name":"declare sentiment global","func":"global.set('sentimentDurh',[]);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1670.4433059692383,"y":2363.070531845093,"wires":[[]]},{"id":"b4eeb0e2.186f4","type":"delay","z":"5d651a81.8ece7c","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2175.6730346679688,"y":2303.5595655441284,"wires":[["96f24ac5.46489"]],"l":false},{"id":"b32bfa29.98f62","type":"function","z":"5d651a81.8ece7c","name":"","func":"msg.finished6 = true; \n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2208.378680229187,"y":2376.4092178344727,"wires":[["de17cb1a.f11cc","60c47666.d0294"]],"l":false},{"id":"b03e9b8d.651948","type":"natural-language-understanding","z":"5d651a81.8ece7c","name":"","categories":false,"limitcategories":"8","concepts":false,"maxconcepts":"8","doc-emotion":true,"doc-emotion-target":"","doc-sentiment":false,"doc-sentiment-target":"","entity":false,"entity-emotion":false,"entity-sentiment":false,"maxentities":"50","keyword":false,"keyword-emotion":true,"keyword-sentiment":true,"maxkeywords":"50","metadata":false,"relation":false,"semantic":false,"semantic-entities":true,"semantic-keywords":true,"maxsemantics":"50","limittextcharacters":"0","syntax":false,"syntax-sentences":false,"syntax-tokens-lemma":false,"syntax-tokens-pos":false,"service-endpoint":"https://api.us-south.natural-language-understanding.watson.cloud.ibm.com/instances/3252dc64-1496-4697-bd85-69b0a850cc46","x":2060.3784713745117,"y":2464.711359024048,"wires":[["33ad6188.7572c6"]]},{"id":"de17cb1a.f11cc","type":"function","z":"5d651a81.8ece7c","name":"avg joy","func":"var sentiment = global.get('sentimentDurh') || [];\nvar sum = 0;\nfor(var i = 0; i < sentiment.length; i++){\n    sum += sentiment[i];\n}\n\n\n\nvar average = 0;\n\nif(sentiment.length > 0){\n    average = sum/sentiment.length; \n}\n\nmsg.payload = {\"Mood\": average};\nmsg.average = average; \n\nif(msg.finished6 == true){\n    \n    return msg; \n}\nelse{\n\n    return; \n}\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2376.5905799865723,"y":2375.6508617401123,"wires":[["ef6501.fc901b","3dfbe6f5.bbb5ea"]]},{"id":"60c47666.d0294","type":"function","z":"5d651a81.8ece7c","name":"joy for line graph","func":"var sentiment = global.get('sentimentDurh') || [];\nvar sum = 0;\nfor(var i = 0; i < sentiment.length; i++){\n    sum += sentiment[i];\n}\n\nvar today = new Date();\nvar date = today.getFullYear() + '-' +(today.getMonth()+1) + '-' + today.getDate();\nvar average = 0;\n\nif(sentiment.length > 0){\n    average = sum/sentiment.length; \n}\n\nglobal.set('average_durh', average); \nvar object = {\"date\": date, \"joy\": average};\nmsg.payload = object; \n\nif(msg.finished6 == true){\n    global.set('still_processing_durh', false);\n    return msg; \n}\n\nelse{\n    global.set('still_processing_durh', true);\n    return; \n}\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2458.279079437256,"y":2562.8626136779785,"wires":[["6ebd084d.47d508"]]},{"id":"33ad6188.7572c6","type":"function","z":"5d651a81.8ece7c","name":"","func":"msg.payload = msg.features;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2262.136414527893,"y":2464.0447998046875,"wires":[["96bb499a.b5e968"]],"l":false},{"id":"96bb499a.b5e968","type":"function","z":"5d651a81.8ece7c","name":"create sentiment array","func":"\n\nvar sentiment = global.get('sentimentDurh') || [];\n\nsentiment.push(msg.features.emotion.document.emotion.joy);\nglobal.set(\"sentimentDurh\", sentiment);\nmsg.payload = sentiment; \n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2422.7728576660156,"y":2459.2567100524902,"wires":[["de17cb1a.f11cc","60c47666.d0294"]]},{"id":"3dfbe6f5.bbb5ea","type":"function","z":"5d651a81.8ece7c","name":"ColorFunction","func":"var average = msg.average;\n// var average = 0.1;\n\nif(0 <= average && average < 0.2){\n    msg.payload = {\n        normal: {\n            fill: \"#cc2316  0.3\",\n            stroke: \"#cc2316\"\n        }\n    };\n    return msg;\n}else if(0.2 <= average && average < 0.4){\n    msg.payload = {\n        normal: {\n            fill: \"#fc7600  0.3\",\n            stroke: \"#fc7600\"\n        }\n    };\n    return msg;\n}else if(0.4 <= average && average < 0.6){\n    msg.payload = {\n        normal: {\n            fill: \"#fbff00  0.3\",\n            stroke: \"#fbff00\"\n        }\n    };\n    return msg;\n}else if(0.6 <= average && average < 0.8){\n    msg.payload = {\n        normal: {\n            fill: \"#00ff11  0.3\",\n            stroke: \"#00ff11\"\n        }\n    };\n    return msg;\n}else if(0.8 <= average && average <= 1){\n    msg.payload = {\n        normal: {\n            fill: \"#049cfc  0.3\",\n            stroke: \"#049cfc\"\n        }\n    };\n    return msg;\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2580.79390335083,"y":2325.499050140381,"wires":[["a2a115.2afd16e8"]]},{"id":"96c1267b.0744c","type":"function","z":"5d651a81.8ece7c","name":"Store Durham text in database","func":"var text = global.get('durh_text'); \nmsg.payload = text;\nglobal.set('durh_text', []); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":309.7301788330078,"y":1831.0160443782806,"wires":[["21604d23.fd9b12"]]},{"id":"57875691.8386f","type":"function","z":"5d651a81.8ece7c","name":"Store Durham Tweet count","func":"var tweet = global.get('durh_tweets'); \nmsg.payload = {Tweets: tweet};\nglobal.set('durh_tweets', 0); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":295.50796270370483,"y":1882.682769536972,"wires":[["4def9722.5efc28"]]},{"id":"792e0b34.10737c","type":"function","z":"5d651a81.8ece7c","name":"Store Durham Retweet count","func":"var tweet = global.get('durh_retweets'); \nmsg.payload = {Retweets: tweet};\nglobal.set('durh_retweets', 0); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":299.7301788330078,"y":1929.0160443782806,"wires":[["35041bc2.792ecc"]]},{"id":"68fb5fb8.f0dcc8","type":"function","z":"5d651a81.8ece7c","name":"Too many tweets (graph)","func":"var still_processing = global.get('still_processing_durh');\nvar average = global.get('average_durh'); \nvar today = new Date();\nvar date = today.getFullYear() + '-' +(today.getMonth()+1) + '-' + today.getDate();\n\nif(still_processing == true){\n  var object = {\"date\": date, \"joy\": average};\n  msg.payload = object; \n  global.set('still_processing_durh', false); \n  return msg;\n        \n}\n\n// msg.finished = still_processing; \n  \n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":280.6825408935547,"y":1975.5874555110931,"wires":[["b3589e8a.025d38"]]},{"id":"4bc41d5f.1111ac","type":"function","z":"5d651a81.8ece7c","name":"Store Edinburgh text in database","func":"var text = global.get('edin_text'); \nmsg.payload = text;\nglobal.set('edin_text', []); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":311.7301788330078,"y":2053.0160443782806,"wires":[["31a8db32.a7b224"]]},{"id":"13a60cb2.88c8db","type":"function","z":"5d651a81.8ece7c","name":"Store Edinburgh Tweet count","func":"var tweet = global.get('edin_tweets'); \nmsg.payload = {Tweets: tweet};\nglobal.set('edin_tweets', 0); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":297.50796270370483,"y":2104.682769536972,"wires":[["f0b0e9b0.5c8f"]]},{"id":"5b08adbc.944d3c","type":"function","z":"5d651a81.8ece7c","name":"Store Edinburgh Retweet count","func":"var tweet = global.get('edin_retweets'); \nmsg.payload = {Retweets: tweet};\nglobal.set('edin_retweets', 0); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":301.7301788330078,"y":2151.0160443782806,"wires":[["56165339.32df94"]]},{"id":"9ed8f0a2.ccce3","type":"function","z":"5d651a81.8ece7c","name":"Too many tweets (graph)","func":"var still_processing = global.get('still_processing_edin');\nvar average = global.get('average_edin'); \nvar today = new Date();\nvar date = today.getFullYear() + '-' +(today.getMonth()+1) + '-' + today.getDate();\n\nif(still_processing == true){\n  var object = {\"date\": date, \"joy\": average};\n  msg.payload = object; \n  global.set('still_processing_edin', false); \n  return msg;\n        \n}\n\n// msg.finished = still_processing; \n  \n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":272.6825408935547,"y":2197.587455511093,"wires":[["21b6ce46.13fc7a"]]},{"id":"f530e14f.d72b3","type":"function","z":"5d651a81.8ece7c","name":"Convert to Array of Strings","func":"var tweets = []; \n\nvar count; \nfor (var i = 0; i < Object.keys(msg.payload[0]).length; i++){\n\n  tweets.push(msg.payload[0][i].x);\n\n  \n}\n\nmsg.payload = tweets;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3087,"y":2515,"wires":[["8d9c4d90.ffedf","ed533df1.321cc"]]},{"id":"8d9c4d90.ffedf","type":"function","z":"5d651a81.8ece7c","name":"Get 20 Most Common Words for Word Cloud (Edin)","func":"words = [];\n\nstopwords = [\"a\", \"able\", \"about\",\n        \"across\", \"after\", \"all\", \"almost\", \"also\", \"am\", \"among\", \"an\",\n        \"and\", \"any\", \"are\", \"as\", \"at\", \"b\", \"be\", \"because\", \"been\",\n        \"but\", \"by\", \"c\", \"can\", \"cannot\", \"could\", \"d\", \"dear\", \"did\",\n        \"do\", \"does\", \"e\", \"either\", \"else\", \"ever\", \"every\", \"f\", \"for\",\n        \"from\", \"g\", \"get\", \"got\", \"h\", \"had\", \"has\", \"have\", \"he\", \"her\",\n        \"hers\", \"him\", \"his\", \"how\", \"however\", \"i\", \"if\", \"in\", \"into\",\n        \"is\", \"it\", \"its\", \"j\", \"just\", \"k\", \"l\", \"least\", \"let\", \"like\",\n        \"likely\", \"m\", \"may\", \"me\", \"might\", \"most\", \"must\", \"my\",\n        \"neither\", \"n\", \"no\", \"nor\", \"not\", \"o\", \"of\", \"off\", \"often\",\n        \"on\", \"only\", \"or\", \"other\", \"our\", \"own\", \"p\", \"q\", \"r\", \"rather\",\n        \"s\", \"said\", \"say\", \"says\", \"she\", \"should\", \"since\", \"so\", \"some\",\n        \"t\", \"than\", \"that\", \"the\", \"their\", \"them\", \"then\", \"there\",\n        \"these\", \"they\", \"this\", \"tis\", \"to\", \"too\", \"twas\", \"u\", \"us\",\n        \"v\", \"w\", \"wants\", \"was\", \"we\", \"were\", \"what\", \"when\", \"where\",\n        \"which\", \"while\", \"who\", \"whom\", \"why\", \"will\", \"with\", \"would\",\n        \"x\", \"y\", \"yet\", \"you\", \"your\", \"z\", \"rt\"];\n\nfor(var i =0; i < msg.payload.length; i++){\n    var temp = msg.payload[i]\n    .replace(/[0-9]/g, \"\")\n    .replace(/(?:https?|ftp):\\/\\/[\\n\\S]+/g, \"\")\n    .replace(/[/.,?!:;&()\"'%@|]/g, \"\")\n\n    .toLowerCase()\n    .replace(/\\n/g, \" \")\n    .replace(/-/g, \"\")\n    .replace(/_/g, \"\")\n    .split(\" \");\n    \n    for(var j = 0; j < temp.length; j++){\n        var stopword = stopwords.includes(temp[j]);\n        if(stopword){\n            temp[j] = \"\";\n        }\n        if(temp[j] != \"\"){\n\n            words.push(temp[j]);\n        }\n\n    }\n}\n\nconst map = words.reduce((acc, word) => {\n\n    let count = acc.get(word) || 0;\n    acc.set(word, ++count)\n    return acc;\n  }, new Map());\n  // Sort by counter first from higher to lower. If counter is the same,\n  // then sort by alphabetical order\n  const topk = [...map].sort((a, b) => b[1] - a[1] || a[0].localeCompare(b[0]));\n  // Return array of k most frequent words\n   \n    msg.payload = topk.slice(0, 20);\n    //.map(item => item[0]);\n    \n    var loc_object = []; \n    //.map(item => item[0]);\n    for(var i = 0; i < msg.payload.length; i++){\n        loc_object[i] = {\"x\": msg.payload[i][0], \"value\": msg.payload[i][1]};\n        \n    }\n\n\n\nmsg.payload = loc_object;\n\n\n\n\n//msg.payload = words\nreturn msg;\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3507.636245727539,"y":2516.000165939331,"wires":[["b4e0a41e.10d168"]]},{"id":"ed533df1.321cc","type":"function","z":"5d651a81.8ece7c","name":"Locations Wordcloud (Edin)","func":"words = [];\n\nplaces = ['bath',  'birmingham', 'bradford', 'brighton and hove', 'bristol', 'cambridge',  'canterbury', 'carlisle', 'chester', 'chichester', 'coventry', 'derby', 'durham', ' ely ', 'exeter', 'gloucester', 'hereford', 'kingston upon hull', 'lancaster', 'leeds', 'leicester', 'lichfield', 'lincoln', 'liverpool', 'london', 'manchester', 'newcastle upon tyne', 'norwich', 'nottingham', 'oxford', 'peterborough', 'plymouth', 'portsmouth', 'preston', 'ripon', 'salford', 'salisbury', 'sheffield', 'southampton', 'st albans', 'stoke-on-trent', 'sunderland', 'truro', 'wakefield', 'wells', 'westminster', 'winchester', 'wolverhampton', 'worcester', 'york', 'bangor', 'cardiff', 'newport', 'st davids', 'swansea', 'aberdeen', 'dundee', 'edinburgh', 'glasgow', 'inverness', 'stirling', 'armagh', 'belfast', 'londonderry', 'lisburn', 'newry', 'aberdeenshire', 'angus',  'antrim', 'argyll', 'armagh',\n'ayrshire',\n'banffshire',\n'berkshire',\n'berwickshire',\n'bristol',\n'buckinghamshire',\n' bute ',\n'caithness',\n'cambridgeshire',\n'cheshire',\n 'london' ,\n'clackmannanshire',\n'clwyd',\n'cornwall',\n'cumbria',\n'derbyshire',\n'devon',\n'dorset',\n'county down',\n'dumfriesshire',\n'dunbartonshire',\n'durham',\n'dyfed',\n'east lothian',\n'east riding of yorkshire',\n'east sussex',\n'essex',\n'fermanagh',\n'fife',\n'gloucestershire',\n'greater london',\n'greater manchester',\n'gwent',\n'gwynedd',\n'hampshire',\n'herefordshire',\n'hertfordshire',\n'inverness-shire',\n'isle of wight',\n'kent',\n'kincardineshire',\n'kinross-shire',\n'kirkcudbrightshire',\n'lanarkshire',\n'lancashire',\n'leicestershire',\n'lincolnshire',\n'londonderry',\n'merseyside',\n'mid glamorgan',\n'midlothian',\n'moray',\n'nairnshire',\n'norfolk',\n'north yorkshire',\n'northamptonshire',\n'northumberland',\n'nottinghamshire',\n'orkney',\n'oxfordshire',\n'peeblesshire',\n'perthshire',\n'powys',\n'renfrewshire',\n'ross and cromarty',\n'roxburghshire',\n'rutland',\n'selkirkshire',\n'shetland',\n'shropshire',\n'somerset',\n'south glamorgan',\n'south yorkshire',\n'staffordshire',\n'stirlingshire',\n'suffolk',\n'surrey',\n'sutherland',\n'tyne and wear',\n'tyrone',\n'warwickshire',\n'west glamorgan',\n'west lothian',\n'west midlands',\n'west sussex',\n'west yorkshire',\n'wigtownshire',\n'wiltshire',\n'worcestershire']\n\n\n\nfor(var i =0; i < msg.payload.length; i++){\n    var temp = msg.payload[i]\n    .replace(/(?:https?|ftp):\\/\\/[\\n\\S]+/g, \"\")\n    .replace(/[/.,?!:;&()\" ' |@#]/g, \"\")\n    .toLowerCase()\n    .replace(/\\n/g, \" \");\n    //.split(\" \");\n\n    for(var j = 0; j < places.length; j++){\n        var contains = temp.includes(places[j]);\n        if(contains){\n            words.push(places[j]);\n        }\n    }\n}\n\nconst map = words.reduce((acc, word) => {\n\n    let count = acc.get(word) || 0;\n    acc.set(word, ++count)\n    return acc;\n  }, new Map());\n  // Sort by counter first from higher to lower. If counter is the same,\n  // then sort by alphabetical order\n  const top_places = [...map].sort((a, b) => b[1] - a[1] || a[0].localeCompare(b[0]));\n  // Return array of k most frequent words\n   \n    msg.payload = top_places.slice(0, 100);\n    var loc_object = []; \n    //.map(item => item[0]);\n    for(var i = 0; i < msg.payload.length; i++){\n        loc_object[i] = {\"x\": msg.payload[i][0], \"value\": msg.payload[i][1]};\n        \n    }\n\n\n\nmsg.payload = loc_object;\n\n\n\n\nreturn msg;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3410.524917602539,"y":2563.363935470581,"wires":[["7ee23f86.3b2958"]]},{"id":"bcfa3e5b.f00438","type":"complete","z":"5d651a81.8ece7c","name":"Process New Tweets for Edinburgh","scope":["6ebd084d.47d508"],"uncaught":false,"x":3060.52783203125,"y":2362.755615234375,"wires":[["74a0e5bc.44732c","d9f552b1.438ae8"]]},{"id":"ca1e97e3.f8f4b8","type":"function","z":"5d651a81.8ece7c","name":"Function for array of strings","func":"var tweets = []; \n\nvar count; \nfor (var i = 0; i < Object.keys(msg.payload[0]).length; i++){\n\n  tweets.push(msg.payload[0][i].x);\n\n  \n}\n\nmsg.payload = tweets;\nreturn msg;\n\n// for(var i = 0; i < Object.keys(ox2[0]).length; i++){\n//   ox_loc.push({\"x\": ox2[0][i].x, \"value\": ox2[0][i].value});\n// }","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3724.3784713745117,"y":2303.3476848602295,"wires":[["72933eff.7dba98"]]},{"id":"d9f552b1.438ae8","type":"function","z":"5d651a81.8ece7c","name":"declare sentiment global","func":"global.set('sentimentEdin',[]);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3394.4433059692383,"y":2363.070531845093,"wires":[[]]},{"id":"72933eff.7dba98","type":"delay","z":"5d651a81.8ece7c","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":3899.6730346679688,"y":2303.5595655441284,"wires":[["7fd41a0.dcaa668"]],"l":false},{"id":"d47021c7.95f378","type":"function","z":"5d651a81.8ece7c","name":"","func":"msg.finished7 = true; \n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3932.378680229187,"y":2376.4092178344727,"wires":[["ea1dbb49.e6825","a0ce92c7.baf3"]],"l":false},{"id":"80c385b0.a34d","type":"natural-language-understanding","z":"5d651a81.8ece7c","name":"","categories":false,"limitcategories":"8","concepts":false,"maxconcepts":"8","doc-emotion":true,"doc-emotion-target":"","doc-sentiment":false,"doc-sentiment-target":"","entity":false,"entity-emotion":false,"entity-sentiment":false,"maxentities":"50","keyword":false,"keyword-emotion":true,"keyword-sentiment":true,"maxkeywords":"50","metadata":false,"relation":false,"semantic":false,"semantic-entities":true,"semantic-keywords":true,"maxsemantics":"50","limittextcharacters":"0","syntax":false,"syntax-sentences":false,"syntax-tokens-lemma":false,"syntax-tokens-pos":false,"service-endpoint":"https://api.us-south.natural-language-understanding.watson.cloud.ibm.com/instances/3252dc64-1496-4697-bd85-69b0a850cc46","x":3784.3784713745117,"y":2464.711359024048,"wires":[["cd83bde4.b4d8c"]]},{"id":"ea1dbb49.e6825","type":"function","z":"5d651a81.8ece7c","name":"avg joy","func":"var sentiment = global.get('sentimentEdin') || [];\nvar sum = 0;\nfor(var i = 0; i < sentiment.length; i++){\n    sum += sentiment[i];\n}\n\n\n\nvar average = 0;\n\nif(sentiment.length > 0){\n    average = sum/sentiment.length; \n}\n\nmsg.payload = {\"Mood\": average};\nmsg.average = average; \n\nif(msg.finished7 == true){\n    \n    return msg; \n}\nelse{\n\n    return; \n}\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4100.590579986572,"y":2375.6508617401123,"wires":[["50ad19ee.af578","259e006d.013d6"]]},{"id":"a0ce92c7.baf3","type":"function","z":"5d651a81.8ece7c","name":"joy for line graph","func":"var sentiment = global.get('sentimentEdin') || [];\nvar sum = 0;\nfor(var i = 0; i < sentiment.length; i++){\n    sum += sentiment[i];\n}\n\nvar today = new Date();\nvar date = today.getFullYear() + '-' +(today.getMonth()+1) + '-' + today.getDate();\nvar average = 0;\n\nif(sentiment.length > 0){\n    average = sum/sentiment.length; \n}\n\nglobal.set('average_edin', average); \nvar object = {\"date\": date, \"joy\": average};\nmsg.payload = object; \n\nif(msg.finished7 == true){\n    global.set('still_processing_edin', false);\n    return msg; \n}\n\nelse{\n    global.set('still_processing_edin', true);\n    return; \n}\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4182.279079437256,"y":2562.8626136779785,"wires":[["155a87bd.dfc638"]]},{"id":"cd83bde4.b4d8c","type":"function","z":"5d651a81.8ece7c","name":"","func":"msg.payload = msg.features;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3986.136414527893,"y":2464.0447998046875,"wires":[["f316dc90.3d7328"]],"l":false},{"id":"f316dc90.3d7328","type":"function","z":"5d651a81.8ece7c","name":"create sentiment array","func":"\n\nvar sentiment = global.get('sentimentEdin') || [];\n\nsentiment.push(msg.features.emotion.document.emotion.joy);\nglobal.set(\"sentimentEdin\", sentiment);\nmsg.payload = sentiment; \n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4146.772857666016,"y":2459.2567100524902,"wires":[["ea1dbb49.e6825","a0ce92c7.baf3"]]},{"id":"259e006d.013d6","type":"function","z":"5d651a81.8ece7c","name":"ColorFunction","func":"var average = msg.average;\n// var average = 0.1;\n\nif(0 <= average && average < 0.2){\n    msg.payload = {\n        normal: {\n            fill: \"#cc2316  0.3\",\n            stroke: \"#cc2316\"\n        }\n    };\n    return msg;\n}else if(0.2 <= average && average < 0.4){\n    msg.payload = {\n        normal: {\n            fill: \"#fc7600  0.3\",\n            stroke: \"#fc7600\"\n        }\n    };\n    return msg;\n}else if(0.4 <= average && average < 0.6){\n    msg.payload = {\n        normal: {\n            fill: \"#fbff00  0.3\",\n            stroke: \"#fbff00\"\n        }\n    };\n    return msg;\n}else if(0.6 <= average && average < 0.8){\n    msg.payload = {\n        normal: {\n            fill: \"#00ff11  0.3\",\n            stroke: \"#00ff11\"\n        }\n    };\n    return msg;\n}else if(0.8 <= average && average <= 1){\n    msg.payload = {\n        normal: {\n            fill: \"#049cfc  0.3\",\n            stroke: \"#049cfc\"\n        }\n    };\n    return msg;\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4304.79390335083,"y":2325.499050140381,"wires":[["ef52651c.c05108"]]},{"id":"115a4a42.796b56","type":"function","z":"5d651a81.8ece7c","name":"Store Exeter text in database","func":"var text = global.get('ex_text'); \nmsg.payload = text;\nglobal.set('ex_text', []); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":285.7301788330078,"y":2283.0160443782806,"wires":[["302850c8.ceeac8"]]},{"id":"c48cca30.521da","type":"function","z":"5d651a81.8ece7c","name":"Store Exeter Tweet count","func":"var tweet = global.get('ex_tweets'); \nmsg.payload = {Tweets: tweet};\nglobal.set('ex_tweets', 0); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":271.50796270370483,"y":2334.682769536972,"wires":[["8768a0a0.7d5a7"]]},{"id":"e0cc276d.1b54a8","type":"function","z":"5d651a81.8ece7c","name":"Store Exeter Retweet count","func":"var tweet = global.get('ex_retweets'); \nmsg.payload = {Retweets: tweet};\nglobal.set('ex_retweets', 0); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":275.7301788330078,"y":2381.0160443782806,"wires":[["fbea27d5.c280a8"]]},{"id":"e23b8580.8e7878","type":"function","z":"5d651a81.8ece7c","name":"Too many tweets (graph)","func":"var still_processing = global.get('still_processing_ex');\nvar average = global.get('average_ex'); \nvar today = new Date();\nvar date = today.getFullYear() + '-' +(today.getMonth()+1) + '-' + today.getDate();\n\nif(still_processing == true){\n  var object = {\"date\": date, \"joy\": average};\n  msg.payload = object; \n  global.set('still_processing_ex', false); \n  return msg;\n        \n}\n\n// msg.finished = still_processing; \n  \n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":266.6825408935547,"y":2427.587455511093,"wires":[["ea225d43.e5956"]]},{"id":"ef28d497.6a054","type":"complete","z":"5d651a81.8ece7c","name":"Process New Tweets for Exeter","scope":["302850c8.ceeac8"],"uncaught":false,"x":1327.142822265625,"y":2732.857177734375,"wires":[["720ff2e7.efda64","126ed1f8.7d3e56"]]},{"id":"126ed1f8.7d3e56","type":"function","z":"5d651a81.8ece7c","name":"declare sentiment global","func":"global.set('sentimentEx',[]);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1681.0582962036133,"y":2733.172094345093,"wires":[[]]},{"id":"1753954.9c9916b","type":"function","z":"5d651a81.8ece7c","name":"Function for array of strings","func":"var tweets = []; \n\nvar count; \nfor (var i = 0; i < Object.keys(msg.payload[0]).length; i++){\n\n  tweets.push(msg.payload[0][i].x);\n\n  \n}\n\nmsg.payload = tweets;\nreturn msg;\n\n// for(var i = 0; i < Object.keys(ox2[0]).length; i++){\n//   ox_loc.push({\"x\": ox2[0][i].x, \"value\": ox2[0][i].value});\n// }","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2010.9934616088867,"y":2673.4492473602295,"wires":[["8f2b75b5.edfcd"]]},{"id":"5e2f8d2b.ae52ac","type":"function","z":"5d651a81.8ece7c","name":"Convert to Array of Strings","func":"var tweets = []; \n\nvar count; \nfor (var i = 0; i < Object.keys(msg.payload[0]).length; i++){\n\n  tweets.push(msg.payload[0][i].x);\n\n  \n}\n\nmsg.payload = tweets;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1373.614990234375,"y":2885.1015625,"wires":[["f0a325f4.d700c","3c59698e.bdda76"]]},{"id":"8f2b75b5.edfcd","type":"delay","z":"5d651a81.8ece7c","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2186.2880249023438,"y":2673.6611280441284,"wires":[["4fc570a3.83353"]],"l":false},{"id":"f0a325f4.d700c","type":"function","z":"5d651a81.8ece7c","name":"Get 20 Most Common Words for Word Cloud (Ex)","func":"words = [];\n\nstopwords = [\"a\", \"able\", \"about\",\n        \"across\", \"after\", \"all\", \"almost\", \"also\", \"am\", \"among\", \"an\",\n        \"and\", \"any\", \"are\", \"as\", \"at\", \"b\", \"be\", \"because\", \"been\",\n        \"but\", \"by\", \"c\", \"can\", \"cannot\", \"could\", \"d\", \"dear\", \"did\",\n        \"do\", \"does\", \"e\", \"either\", \"else\", \"ever\", \"every\", \"f\", \"for\",\n        \"from\", \"g\", \"get\", \"got\", \"h\", \"had\", \"has\", \"have\", \"he\", \"her\",\n        \"hers\", \"him\", \"his\", \"how\", \"however\", \"i\", \"if\", \"in\", \"into\",\n        \"is\", \"it\", \"its\", \"j\", \"just\", \"k\", \"l\", \"least\", \"let\", \"like\",\n        \"likely\", \"m\", \"may\", \"me\", \"might\", \"most\", \"must\", \"my\",\n        \"neither\", \"n\", \"no\", \"nor\", \"not\", \"o\", \"of\", \"off\", \"often\",\n        \"on\", \"only\", \"or\", \"other\", \"our\", \"own\", \"p\", \"q\", \"r\", \"rather\",\n        \"s\", \"said\", \"say\", \"says\", \"she\", \"should\", \"since\", \"so\", \"some\",\n        \"t\", \"than\", \"that\", \"the\", \"their\", \"them\", \"then\", \"there\",\n        \"these\", \"they\", \"this\", \"tis\", \"to\", \"too\", \"twas\", \"u\", \"us\",\n        \"v\", \"w\", \"wants\", \"was\", \"we\", \"were\", \"what\", \"when\", \"where\",\n        \"which\", \"while\", \"who\", \"whom\", \"why\", \"will\", \"with\", \"would\",\n        \"x\", \"y\", \"yet\", \"you\", \"your\", \"z\", \"rt\"];\n\nfor(var i =0; i < msg.payload.length; i++){\n    var temp = msg.payload[i]\n    .replace(/[0-9]/g, \"\")\n    .replace(/(?:https?|ftp):\\/\\/[\\n\\S]+/g, \"\")\n    .replace(/[/.,?!:;&()\"'%@|]/g, \"\")\n\n    .toLowerCase()\n    .replace(/\\n/g, \" \")\n    .replace(/-/g, \"\")\n    .replace(/_/g, \"\")\n    .split(\" \");\n    \n    for(var j = 0; j < temp.length; j++){\n        var stopword = stopwords.includes(temp[j]);\n        if(stopword){\n            temp[j] = \"\";\n        }\n        if(temp[j] != \"\"){\n\n            words.push(temp[j]);\n        }\n\n    }\n}\n\nconst map = words.reduce((acc, word) => {\n\n    let count = acc.get(word) || 0;\n    acc.set(word, ++count)\n    return acc;\n  }, new Map());\n  // Sort by counter first from higher to lower. If counter is the same,\n  // then sort by alphabetical order\n  const topk = [...map].sort((a, b) => b[1] - a[1] || a[0].localeCompare(b[0]));\n  // Return array of k most frequent words\n   \n    msg.payload = topk.slice(0, 20);\n    //.map(item => item[0]);\n    \n    var loc_object = []; \n    //.map(item => item[0]);\n    for(var i = 0; i < msg.payload.length; i++){\n        loc_object[i] = {\"x\": msg.payload[i][0], \"value\": msg.payload[i][1]};\n        \n    }\n\n\n\nmsg.payload = loc_object;\n\n\n\n\n//msg.payload = words\nreturn msg;\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1784.251235961914,"y":2886.101728439331,"wires":[["51249dfa.d26dcc"]]},{"id":"3c59698e.bdda76","type":"function","z":"5d651a81.8ece7c","name":"Locations Wordcloud (Ex)","func":"words = [];\n\nplaces = ['bath',  'birmingham', 'bradford', 'brighton and hove', 'bristol', 'cambridge',  'canterbury', 'carlisle', 'chester', 'chichester', 'coventry', 'derby', 'durham', ' ely ', 'exeter', 'gloucester', 'hereford', 'kingston upon hull', 'lancaster', 'leeds', 'leicester', 'lichfield', 'lincoln', 'liverpool', 'london', 'manchester', 'newcastle upon tyne', 'norwich', 'nottingham', 'oxford', 'peterborough', 'plymouth', 'portsmouth', 'preston', 'ripon', 'salford', 'salisbury', 'sheffield', 'southampton', 'st albans', 'stoke-on-trent', 'sunderland', 'truro', 'wakefield', 'wells', 'westminster', 'winchester', 'wolverhampton', 'worcester', 'york', 'bangor', 'cardiff', 'newport', 'st davids', 'swansea', 'aberdeen', 'dundee', 'edinburgh', 'glasgow', 'inverness', 'stirling', 'armagh', 'belfast', 'londonderry', 'lisburn', 'newry', 'aberdeenshire', 'angus',  'antrim', 'argyll', 'armagh',\n'ayrshire',\n'banffshire',\n'berkshire',\n'berwickshire',\n'bristol',\n'buckinghamshire',\n' bute ',\n'caithness',\n'cambridgeshire',\n'cheshire',\n 'london' ,\n'clackmannanshire',\n'clwyd',\n'cornwall',\n'cumbria',\n'derbyshire',\n'devon',\n'dorset',\n'county down',\n'dumfriesshire',\n'dunbartonshire',\n'durham',\n'dyfed',\n'east lothian',\n'east riding of yorkshire',\n'east sussex',\n'essex',\n'fermanagh',\n'fife',\n'gloucestershire',\n'greater london',\n'greater manchester',\n'gwent',\n'gwynedd',\n'hampshire',\n'herefordshire',\n'hertfordshire',\n'inverness-shire',\n'isle of wight',\n'kent',\n'kincardineshire',\n'kinross-shire',\n'kirkcudbrightshire',\n'lanarkshire',\n'lancashire',\n'leicestershire',\n'lincolnshire',\n'londonderry',\n'merseyside',\n'mid glamorgan',\n'midlothian',\n'moray',\n'nairnshire',\n'norfolk',\n'north yorkshire',\n'northamptonshire',\n'northumberland',\n'nottinghamshire',\n'orkney',\n'oxfordshire',\n'peeblesshire',\n'perthshire',\n'powys',\n'renfrewshire',\n'ross and cromarty',\n'roxburghshire',\n'rutland',\n'selkirkshire',\n'shetland',\n'shropshire',\n'somerset',\n'south glamorgan',\n'south yorkshire',\n'staffordshire',\n'stirlingshire',\n'suffolk',\n'surrey',\n'sutherland',\n'tyne and wear',\n'tyrone',\n'warwickshire',\n'west glamorgan',\n'west lothian',\n'west midlands',\n'west sussex',\n'west yorkshire',\n'wigtownshire',\n'wiltshire',\n'worcestershire']\n\n\n\nfor(var i =0; i < msg.payload.length; i++){\n    var temp = msg.payload[i]\n    .replace(/(?:https?|ftp):\\/\\/[\\n\\S]+/g, \"\")\n    .replace(/[/.,?!:;&()\" ' |@#]/g, \"\")\n    .toLowerCase()\n    .replace(/\\n/g, \" \");\n    //.split(\" \");\n\n    for(var j = 0; j < places.length; j++){\n        var contains = temp.includes(places[j]);\n        if(contains){\n            words.push(places[j]);\n        }\n    }\n}\n\nconst map = words.reduce((acc, word) => {\n\n    let count = acc.get(word) || 0;\n    acc.set(word, ++count)\n    return acc;\n  }, new Map());\n  // Sort by counter first from higher to lower. If counter is the same,\n  // then sort by alphabetical order\n  const top_places = [...map].sort((a, b) => b[1] - a[1] || a[0].localeCompare(b[0]));\n  // Return array of k most frequent words\n   \n    msg.payload = top_places.slice(0, 100);\n    var loc_object = []; \n    //.map(item => item[0]);\n    for(var i = 0; i < msg.payload.length; i++){\n        loc_object[i] = {\"x\": msg.payload[i][0], \"value\": msg.payload[i][1]};\n        \n    }\n\n\n\nmsg.payload = loc_object;\n\n\n\n\nreturn msg;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1697.139907836914,"y":2933.465497970581,"wires":[["737f78d0.bcb5e"]]},{"id":"5c95f0b5.b32ad","type":"function","z":"5d651a81.8ece7c","name":"","func":"msg.finished8 = true; \n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2218.993670463562,"y":2746.5107803344727,"wires":[["aca0edb2.ffc09","91beec1a.a95fc"]],"l":false},{"id":"4b1624e9.5796c4","type":"natural-language-understanding","z":"5d651a81.8ece7c","name":"","categories":false,"limitcategories":"8","concepts":false,"maxconcepts":"8","doc-emotion":true,"doc-emotion-target":"","doc-sentiment":false,"doc-sentiment-target":"","entity":false,"entity-emotion":false,"entity-sentiment":false,"maxentities":"50","keyword":false,"keyword-emotion":true,"keyword-sentiment":true,"maxkeywords":"50","metadata":false,"relation":false,"semantic":false,"semantic-entities":true,"semantic-keywords":true,"maxsemantics":"50","limittextcharacters":"0","syntax":false,"syntax-sentences":false,"syntax-tokens-lemma":false,"syntax-tokens-pos":false,"service-endpoint":"https://api.us-south.natural-language-understanding.watson.cloud.ibm.com/instances/3252dc64-1496-4697-bd85-69b0a850cc46","x":2070.9934616088867,"y":2834.812921524048,"wires":[["99086560.b6b05"]]},{"id":"aca0edb2.ffc09","type":"function","z":"5d651a81.8ece7c","name":"avg joy","func":"var sentiment = global.get('sentimentEx') || [];\nvar sum = 0;\nfor(var i = 0; i < sentiment.length; i++){\n    sum += sentiment[i];\n}\n\n\n\nvar average = 0;\n\nif(sentiment.length > 0){\n    average = sum/sentiment.length; \n}\n\nmsg.payload = {\"Mood\": average};\nmsg.average = average; \n\nif(msg.finished8 == true){\n    \n    return msg; \n}\nelse{\n\n    return; \n}\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2387.2055702209473,"y":2745.7524242401123,"wires":[["993851e2.6a11a8","a1a81dc0.66cac8"]]},{"id":"91beec1a.a95fc","type":"function","z":"5d651a81.8ece7c","name":"joy for line graph","func":"var sentiment = global.get('sentimentEx') || [];\nvar sum = 0;\nfor(var i = 0; i < sentiment.length; i++){\n    sum += sentiment[i];\n}\n\nvar today = new Date();\nvar date = today.getFullYear() + '-' +(today.getMonth()+1) + '-' + today.getDate();\nvar average = 0;\n\nif(sentiment.length > 0){\n    average = sum/sentiment.length; \n}\n\nglobal.set('average_ex', average); \nvar object = {\"date\": date, \"joy\": average};\nmsg.payload = object; \n\nif(msg.finished8 == true){\n    global.set('still_processing_ex', false);\n    return msg; \n}\n\nelse{\n    global.set('still_processing_ex', true);\n    return; \n}\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2468.894069671631,"y":2932.9641761779785,"wires":[["38e278a3.1a9ed"]]},{"id":"99086560.b6b05","type":"function","z":"5d651a81.8ece7c","name":"","func":"msg.payload = msg.features;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2272.751404762268,"y":2834.1463623046875,"wires":[["7f7386ee.95301"]],"l":false},{"id":"7f7386ee.95301","type":"function","z":"5d651a81.8ece7c","name":"create sentiment array","func":"\n\nvar sentiment = global.get('sentimentEx') || [];\n\nsentiment.push(msg.features.emotion.document.emotion.joy);\nglobal.set(\"sentimentEx\", sentiment);\nmsg.payload = sentiment; \n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2433.3878479003906,"y":2829.3582725524902,"wires":[["aca0edb2.ffc09","91beec1a.a95fc"]]},{"id":"a1a81dc0.66cac8","type":"function","z":"5d651a81.8ece7c","name":"ColorFunction","func":"var average = msg.average;\n// var average = 0.1;\n\nif(0 <= average && average < 0.2){\n    msg.payload = {\n        normal: {\n            fill: \"#cc2316  0.3\",\n            stroke: \"#cc2316\"\n        }\n    };\n    return msg;\n}else if(0.2 <= average && average < 0.4){\n    msg.payload = {\n        normal: {\n            fill: \"#fc7600  0.3\",\n            stroke: \"#fc7600\"\n        }\n    };\n    return msg;\n}else if(0.4 <= average && average < 0.6){\n    msg.payload = {\n        normal: {\n            fill: \"#fbff00  0.3\",\n            stroke: \"#fbff00\"\n        }\n    };\n    return msg;\n}else if(0.6 <= average && average < 0.8){\n    msg.payload = {\n        normal: {\n            fill: \"#00ff11  0.3\",\n            stroke: \"#00ff11\"\n        }\n    };\n    return msg;\n}else if(0.8 <= average && average <= 1){\n    msg.payload = {\n        normal: {\n            fill: \"#049cfc  0.3\",\n            stroke: \"#049cfc\"\n        }\n    };\n    return msg;\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2591.408893585205,"y":2695.600612640381,"wires":[["b74d2e3a.ce3388"]]},{"id":"21f8ed80.feb6da","type":"function","z":"5d651a81.8ece7c","name":"Store Glasgow text in database","func":"var text = global.get('glas_text'); \nmsg.payload = text;\nglobal.set('glas_text', []); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":298.5079345703125,"y":2517.5713987350464,"wires":[["797619b.485f6e8"]]},{"id":"6cb80160.a2f31","type":"function","z":"5d651a81.8ece7c","name":"Store Glasgow Tweet count","func":"var tweet = global.get('glas_tweets'); \nmsg.payload = {Tweets: tweet};\nglobal.set('glas_tweets', 0); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":284.2857184410095,"y":2569.238123893738,"wires":[["24130a91.5a68d6"]]},{"id":"7663a2a2.6ee004","type":"function","z":"5d651a81.8ece7c","name":"Store Glasgow Retweet count","func":"var tweet = global.get('glas_retweets'); \nmsg.payload = {Retweets: tweet};\nglobal.set('glas_retweets', 0); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":288.5079345703125,"y":2615.5713987350464,"wires":[["c8883e27.01cc58"]]},{"id":"396dd5b4.a4f1b2","type":"function","z":"5d651a81.8ece7c","name":"Too many tweets (graph)","func":"var still_processing = global.get('still_processing_glas');\nvar average = global.get('average_glas'); \nvar today = new Date();\nvar date = today.getFullYear() + '-' +(today.getMonth()+1) + '-' + today.getDate();\n\nif(still_processing == true){\n  var object = {\"date\": date, \"joy\": average};\n  msg.payload = object; \n  global.set('still_processing_glas', false); \n  return msg;\n        \n}\n\n// msg.finished = still_processing; \n  \n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":269.4602966308594,"y":2662.142809867859,"wires":[["517453d9.eab61c"]]},{"id":"c7114eff.84efe","type":"function","z":"5d651a81.8ece7c","name":"Convert to Array of Strings","func":"var tweets = []; \n\nvar count; \nfor (var i = 0; i < Object.keys(msg.payload[0]).length; i++){\n\n  tweets.push(msg.payload[0][i].x);\n\n  \n}\n\nmsg.payload = tweets;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3105,"y":2873,"wires":[["4439d34a.825bec","6e39f058.29b788"]]},{"id":"4439d34a.825bec","type":"function","z":"5d651a81.8ece7c","name":"Get 20 Most Common Words for Word Cloud ","func":"words = [];\n\nstopwords = [\"a\", \"able\", \"about\",\n        \"across\", \"after\", \"all\", \"almost\", \"also\", \"am\", \"among\", \"an\",\n        \"and\", \"any\", \"are\", \"as\", \"at\", \"b\", \"be\", \"because\", \"been\",\n        \"but\", \"by\", \"c\", \"can\", \"cannot\", \"could\", \"d\", \"dear\", \"did\",\n        \"do\", \"does\", \"e\", \"either\", \"else\", \"ever\", \"every\", \"f\", \"for\",\n        \"from\", \"g\", \"get\", \"got\", \"h\", \"had\", \"has\", \"have\", \"he\", \"her\",\n        \"hers\", \"him\", \"his\", \"how\", \"however\", \"i\", \"if\", \"in\", \"into\",\n        \"is\", \"it\", \"its\", \"j\", \"just\", \"k\", \"l\", \"least\", \"let\", \"like\",\n        \"likely\", \"m\", \"may\", \"me\", \"might\", \"most\", \"must\", \"my\",\n        \"neither\", \"n\", \"no\", \"nor\", \"not\", \"o\", \"of\", \"off\", \"often\",\n        \"on\", \"only\", \"or\", \"other\", \"our\", \"own\", \"p\", \"q\", \"r\", \"rather\",\n        \"s\", \"said\", \"say\", \"says\", \"she\", \"should\", \"since\", \"so\", \"some\",\n        \"t\", \"than\", \"that\", \"the\", \"their\", \"them\", \"then\", \"there\",\n        \"these\", \"they\", \"this\", \"tis\", \"to\", \"too\", \"twas\", \"u\", \"us\",\n        \"v\", \"w\", \"wants\", \"was\", \"we\", \"were\", \"what\", \"when\", \"where\",\n        \"which\", \"while\", \"who\", \"whom\", \"why\", \"will\", \"with\", \"would\",\n        \"x\", \"y\", \"yet\", \"you\", \"your\", \"z\", \"rt\"];\n\nfor(var i =0; i < msg.payload.length; i++){\n    var temp = msg.payload[i]\n    .replace(/[0-9]/g, \"\")\n    .replace(/(?:https?|ftp):\\/\\/[\\n\\S]+/g, \"\")\n    .replace(/[/.,?!:;&()\"'%@|]/g, \"\")\n\n    .toLowerCase()\n    .replace(/\\n/g, \" \")\n    .replace(/-/g, \"\")\n    .replace(/_/g, \"\")\n    .split(\" \");\n    \n    for(var j = 0; j < temp.length; j++){\n        var stopword = stopwords.includes(temp[j]);\n        if(stopword){\n            temp[j] = \"\";\n        }\n        if(temp[j] != \"\"){\n\n            words.push(temp[j]);\n        }\n\n    }\n}\n\nconst map = words.reduce((acc, word) => {\n\n    let count = acc.get(word) || 0;\n    acc.set(word, ++count)\n    return acc;\n  }, new Map());\n  // Sort by counter first from higher to lower. If counter is the same,\n  // then sort by alphabetical order\n  const topk = [...map].sort((a, b) => b[1] - a[1] || a[0].localeCompare(b[0]));\n  // Return array of k most frequent words\n   \n    msg.payload = topk.slice(0, 20);\n    //.map(item => item[0]);\n    \n    var loc_object = []; \n    //.map(item => item[0]);\n    for(var i = 0; i < msg.payload.length; i++){\n        loc_object[i] = {\"x\": msg.payload[i][0], \"value\": msg.payload[i][1]};\n        \n    }\n\n\n\nmsg.payload = loc_object;\n\n\n\n\n//msg.payload = words\nreturn msg;\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3495.636245727539,"y":2874.000165939331,"wires":[["f36d585d.f7f66"]]},{"id":"6e39f058.29b788","type":"function","z":"5d651a81.8ece7c","name":"Locations Wordcloud ","func":"words = [];\n\nplaces = ['bath',  'birmingham', 'bradford', 'brighton and hove', 'bristol', 'cambridge',  'canterbury', 'carlisle', 'chester', 'chichester', 'coventry', 'derby', 'durham', ' ely ', 'exeter', 'gloucester', 'hereford', 'kingston upon hull', 'lancaster', 'leeds', 'leicester', 'lichfield', 'lincoln', 'liverpool', 'london', 'manchester', 'newcastle upon tyne', 'norwich', 'nottingham', 'oxford', 'peterborough', 'plymouth', 'portsmouth', 'preston', 'ripon', 'salford', 'salisbury', 'sheffield', 'southampton', 'st albans', 'stoke-on-trent', 'sunderland', 'truro', 'wakefield', 'wells', 'westminster', 'winchester', 'wolverhampton', 'worcester', 'york', 'bangor', 'cardiff', 'newport', 'st davids', 'swansea', 'aberdeen', 'dundee', 'edinburgh', 'glasgow', 'inverness', 'stirling', 'armagh', 'belfast', 'londonderry', 'lisburn', 'newry', 'aberdeenshire', 'angus',  'antrim', 'argyll', 'armagh',\n'ayrshire',\n'banffshire',\n'berkshire',\n'berwickshire',\n'bristol',\n'buckinghamshire',\n' bute ',\n'caithness',\n'cambridgeshire',\n'cheshire',\n 'london' ,\n'clackmannanshire',\n'clwyd',\n'cornwall',\n'cumbria',\n'derbyshire',\n'devon',\n'dorset',\n'county down',\n'dumfriesshire',\n'dunbartonshire',\n'durham',\n'dyfed',\n'east lothian',\n'east riding of yorkshire',\n'east sussex',\n'essex',\n'fermanagh',\n'fife',\n'gloucestershire',\n'greater london',\n'greater manchester',\n'gwent',\n'gwynedd',\n'hampshire',\n'herefordshire',\n'hertfordshire',\n'inverness-shire',\n'isle of wight',\n'kent',\n'kincardineshire',\n'kinross-shire',\n'kirkcudbrightshire',\n'lanarkshire',\n'lancashire',\n'leicestershire',\n'lincolnshire',\n'londonderry',\n'merseyside',\n'mid glamorgan',\n'midlothian',\n'moray',\n'nairnshire',\n'norfolk',\n'north yorkshire',\n'northamptonshire',\n'northumberland',\n'nottinghamshire',\n'orkney',\n'oxfordshire',\n'peeblesshire',\n'perthshire',\n'powys',\n'renfrewshire',\n'ross and cromarty',\n'roxburghshire',\n'rutland',\n'selkirkshire',\n'shetland',\n'shropshire',\n'somerset',\n'south glamorgan',\n'south yorkshire',\n'staffordshire',\n'stirlingshire',\n'suffolk',\n'surrey',\n'sutherland',\n'tyne and wear',\n'tyrone',\n'warwickshire',\n'west glamorgan',\n'west lothian',\n'west midlands',\n'west sussex',\n'west yorkshire',\n'wigtownshire',\n'wiltshire',\n'worcestershire']\n\n\n\nfor(var i =0; i < msg.payload.length; i++){\n    var temp = msg.payload[i]\n    .replace(/(?:https?|ftp):\\/\\/[\\n\\S]+/g, \"\")\n    .replace(/[/.,?!:;&()\" ' |@#]/g, \"\")\n    .toLowerCase()\n    .replace(/\\n/g, \" \");\n    //.split(\" \");\n\n    for(var j = 0; j < places.length; j++){\n        var contains = temp.includes(places[j]);\n        if(contains){\n            words.push(places[j]);\n        }\n    }\n}\n\nconst map = words.reduce((acc, word) => {\n\n    let count = acc.get(word) || 0;\n    acc.set(word, ++count)\n    return acc;\n  }, new Map());\n  // Sort by counter first from higher to lower. If counter is the same,\n  // then sort by alphabetical order\n  const top_places = [...map].sort((a, b) => b[1] - a[1] || a[0].localeCompare(b[0]));\n  // Return array of k most frequent words\n   \n    msg.payload = top_places.slice(0, 100);\n    var loc_object = []; \n    //.map(item => item[0]);\n    for(var i = 0; i < msg.payload.length; i++){\n        loc_object[i] = {\"x\": msg.payload[i][0], \"value\": msg.payload[i][1]};\n        \n    }\n\n\n\nmsg.payload = loc_object;\n\n\n\n\nreturn msg;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3408.524917602539,"y":2921.363935470581,"wires":[["f02ef90a.7f7b08"]]},{"id":"67a1a0cb.820238","type":"complete","z":"5d651a81.8ece7c","name":"Process New Tweets for Glasgow","scope":["38e278a3.1a9ed"],"uncaught":false,"x":3068.52783203125,"y":2720.755615234375,"wires":[["91fde415.68a848","41a28372.1b47fc"]]},{"id":"cdaeb158.688e4","type":"function","z":"5d651a81.8ece7c","name":"Function for array of strings","func":"var tweets = []; \n\nvar count; \nfor (var i = 0; i < Object.keys(msg.payload[0]).length; i++){\n\n  tweets.push(msg.payload[0][i].x);\n\n  \n}\n\nmsg.payload = tweets;\nreturn msg;\n\n// for(var i = 0; i < Object.keys(ox2[0]).length; i++){\n//   ox_loc.push({\"x\": ox2[0][i].x, \"value\": ox2[0][i].value});\n// }","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3742.3784713745117,"y":2661.3476848602295,"wires":[["6125987f.299218"]]},{"id":"41a28372.1b47fc","type":"function","z":"5d651a81.8ece7c","name":"declare sentiment global","func":"global.set('sentimentGl',[]);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3412.4433059692383,"y":2721.070531845093,"wires":[[]]},{"id":"6125987f.299218","type":"delay","z":"5d651a81.8ece7c","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":3917.6730346679688,"y":2661.5595655441284,"wires":[["bdf3373c.1cb338"]],"l":false},{"id":"428d696b.8733c8","type":"function","z":"5d651a81.8ece7c","name":"","func":"msg.finished9 = true; \n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3950.378680229187,"y":2734.4092178344727,"wires":[["7f580dc.fa330f4","c1ad3978.c6f798"]],"l":false},{"id":"7aaa6c.91510594","type":"natural-language-understanding","z":"5d651a81.8ece7c","name":"","categories":false,"limitcategories":"8","concepts":false,"maxconcepts":"8","doc-emotion":true,"doc-emotion-target":"","doc-sentiment":false,"doc-sentiment-target":"","entity":false,"entity-emotion":false,"entity-sentiment":false,"maxentities":"50","keyword":false,"keyword-emotion":true,"keyword-sentiment":true,"maxkeywords":"50","metadata":false,"relation":false,"semantic":false,"semantic-entities":true,"semantic-keywords":true,"maxsemantics":"50","limittextcharacters":"0","syntax":false,"syntax-sentences":false,"syntax-tokens-lemma":false,"syntax-tokens-pos":false,"service-endpoint":"https://api.us-south.natural-language-understanding.watson.cloud.ibm.com/instances/3252dc64-1496-4697-bd85-69b0a850cc46","x":3802.3784713745117,"y":2822.711359024048,"wires":[["c88b9663.676c2"]]},{"id":"7f580dc.fa330f4","type":"function","z":"5d651a81.8ece7c","name":"avg joy","func":"var sentiment = global.get('sentimentGl') || [];\nvar sum = 0;\nfor(var i = 0; i < sentiment.length; i++){\n    sum += sentiment[i];\n}\n\n\n\nvar average = 0;\n\nif(sentiment.length > 0){\n    average = sum/sentiment.length; \n}\n\nmsg.payload = {\"Mood\": average};\nmsg.average = average; \n\nif(msg.finished9 == true){\n    \n    return msg; \n}\nelse{\n\n    return; \n}\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4118.590579986572,"y":2733.6508617401123,"wires":[["2dba91b7.4d47f6","ea20bf7a.b9fbf"]]},{"id":"c1ad3978.c6f798","type":"function","z":"5d651a81.8ece7c","name":"joy for line graph","func":"var sentiment = global.get('sentimentGl') || [];\nvar sum = 0;\nfor(var i = 0; i < sentiment.length; i++){\n    sum += sentiment[i];\n}\n\nvar today = new Date();\nvar date = today.getFullYear() + '-' +(today.getMonth()+1) + '-' + today.getDate();\nvar average = 0;\n\nif(sentiment.length > 0){\n    average = sum/sentiment.length; \n}\n\nglobal.set('average_glas', average); \nvar object = {\"date\": date, \"joy\": average};\nmsg.payload = object; \n\nif(msg.finished9 == true){\n    global.set('still_processing_glas', false);\n    return msg; \n}\n\nelse{\n    global.set('still_processing_glas', true);\n    return; \n}\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4200.279079437256,"y":2920.8626136779785,"wires":[["d4494ddb.c83f2"]]},{"id":"c88b9663.676c2","type":"function","z":"5d651a81.8ece7c","name":"","func":"msg.payload = msg.features;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4004.136414527893,"y":2822.0447998046875,"wires":[["3bef67d5.9a9cf8"]],"l":false},{"id":"3bef67d5.9a9cf8","type":"function","z":"5d651a81.8ece7c","name":"create sentiment array","func":"\n\nvar sentiment = global.get('sentimentGl') || [];\n\nsentiment.push(msg.features.emotion.document.emotion.joy);\nglobal.set(\"sentimentGl\", sentiment);\nmsg.payload = sentiment; \n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4164.772857666016,"y":2817.2567100524902,"wires":[["7f580dc.fa330f4","c1ad3978.c6f798"]]},{"id":"ea20bf7a.b9fbf","type":"function","z":"5d651a81.8ece7c","name":"ColorFunction","func":"var average = msg.average;\n// var average = 0.1;\n\nif(0 <= average && average < 0.2){\n    msg.payload = {\n        normal: {\n            fill: \"#cc2316  0.3\",\n            stroke: \"#cc2316\"\n        }\n    };\n    return msg;\n}else if(0.2 <= average && average < 0.4){\n    msg.payload = {\n        normal: {\n            fill: \"#fc7600  0.3\",\n            stroke: \"#fc7600\"\n        }\n    };\n    return msg;\n}else if(0.4 <= average && average < 0.6){\n    msg.payload = {\n        normal: {\n            fill: \"#fbff00  0.3\",\n            stroke: \"#fbff00\"\n        }\n    };\n    return msg;\n}else if(0.6 <= average && average < 0.8){\n    msg.payload = {\n        normal: {\n            fill: \"#00ff11  0.3\",\n            stroke: \"#00ff11\"\n        }\n    };\n    return msg;\n}else if(0.8 <= average && average <= 1){\n    msg.payload = {\n        normal: {\n            fill: \"#049cfc  0.3\",\n            stroke: \"#049cfc\"\n        }\n    };\n    return msg;\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4322.79390335083,"y":2683.499050140381,"wires":[["106a1937.273ecf"]]},{"id":"719e7b0b.cef594","type":"function","z":"5d651a81.8ece7c","name":"Store UCL text in database","func":"var text = global.get('ucl_text'); \nmsg.payload = text;\nglobal.set('ucl_text', []); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":274.77056884765625,"y":2975.3492307662964,"wires":[["13249581.9ceb42"]]},{"id":"dca52d2f.f15ea","type":"function","z":"5d651a81.8ece7c","name":"Store UCL Tweet count","func":"var tweet = global.get('ucl_tweets'); \nmsg.payload = {Tweets: tweet};\nglobal.set('ucl_tweets', 0); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":272.77056884765625,"y":3020.34921169281,"wires":[["17c52cfe.79f47b"]]},{"id":"2029e61.814c41a","type":"function","z":"5d651a81.8ece7c","name":"Store UCL Retweet count","func":"var tweet = global.get('ucl_retweets'); \nmsg.payload = {Retweets: tweet};\nglobal.set('ucl_retweets', 0); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":274.77056884765625,"y":3073.3492307662964,"wires":[["15b69ac2.674005"]]},{"id":"f78c24d.106bdd8","type":"function","z":"5d651a81.8ece7c","name":"Too many tweets (graph)","func":"var still_processing = global.get('still_processing_ucl');\nvar average = global.get('average_ucl'); \nvar today = new Date();\nvar date = today.getFullYear() + '-' +(today.getMonth()+1) + '-' + today.getDate();\n\nif(still_processing == true){\n  var object = {\"date\": date, \"joy\": average};\n  msg.payload = object; \n  global.set('still_processing_ucl', false);\n  return msg;\n        \n}\nmsg.finished = still_processing; \n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":265.7229309082031,"y":3119.920609474182,"wires":[["a670e538.f185e8"]]},{"id":"87633eb5.95e178","type":"function","z":"5d651a81.8ece7c","name":"Store Leeds text in database","func":"var text = global.get('leeds_text'); \nmsg.payload = text;\nglobal.set('leeds_text', []); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":285.0952453613281,"y":3207.4920530319214,"wires":[["dedf4195.e5a66"]]},{"id":"74b38b82.8986e4","type":"function","z":"5d651a81.8ece7c","name":"Store Leeds Tweet count","func":"var tweet = global.get('leeds_tweets'); \nmsg.payload = {Tweets: tweet};\nglobal.set('leeds_tweets', 0); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":273.0952453613281,"y":3252.492033958435,"wires":[["f1def4eb.dfaf3"]]},{"id":"8c9a4db2.cd512","type":"function","z":"5d651a81.8ece7c","name":"Store Leeds Retweet count","func":"var tweet = global.get('leeds_retweets'); \nmsg.payload = {Retweets: tweet};\nglobal.set('leeds_retweets', 0); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":275.0952453613281,"y":3305.4920530319214,"wires":[["9299ab82.f2018"]]},{"id":"f88c0c72.e96dc","type":"function","z":"5d651a81.8ece7c","name":"Too many tweets (graph)","func":"var still_processing = global.get('still_processing_leeds');\nvar average = global.get('average_leeds'); \nvar today = new Date();\nvar date = today.getFullYear() + '-' +(today.getMonth()+1) + '-' + today.getDate();\n\nif(still_processing == true){\n  var object = {\"date\": date, \"joy\": average};\n  msg.payload = object; \n  global.set('still_processing_leeds', false);\n  return msg;\n        \n}\nmsg.finished = still_processing; \n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":266.047607421875,"y":3352.063431739807,"wires":[["9213261a.fafb68"]]},{"id":"5c03aa42.50956c","type":"function","z":"5d651a81.8ece7c","name":"Convert to Array of Strings","func":"var tweets = []; \n\nvar count; \nfor (var i = 0; i < Object.keys(msg.payload[0]).length; i++){\n\n  tweets.push(msg.payload[0][i].x);\n\n  \n}\n\nmsg.payload = tweets;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1400,"y":3380,"wires":[["1ff82454.d57de4","43dae608.47af18"]]},{"id":"1ff82454.d57de4","type":"function","z":"5d651a81.8ece7c","name":"Get 20 Most Common Words for Word Cloud (leeds)","func":"words = [];\n\nstopwords = [\"a\", \"able\", \"about\",\n        \"across\", \"after\", \"all\", \"almost\", \"also\", \"am\", \"among\", \"an\",\n        \"and\", \"any\", \"are\", \"as\", \"at\", \"b\", \"be\", \"because\", \"been\",\n        \"but\", \"by\", \"c\", \"can\", \"cannot\", \"could\", \"d\", \"dear\", \"did\",\n        \"do\", \"does\", \"e\", \"either\", \"else\", \"ever\", \"every\", \"f\", \"for\",\n        \"from\", \"g\", \"get\", \"got\", \"h\", \"had\", \"has\", \"have\", \"he\", \"her\",\n        \"hers\", \"him\", \"his\", \"how\", \"however\", \"i\", \"if\", \"in\", \"into\",\n        \"is\", \"it\", \"its\", \"j\", \"just\", \"k\", \"l\", \"least\", \"let\", \"like\",\n        \"likely\", \"m\", \"may\", \"me\", \"might\", \"most\", \"must\", \"my\",\n        \"neither\", \"n\", \"no\", \"nor\", \"not\", \"o\", \"of\", \"off\", \"often\",\n        \"on\", \"only\", \"or\", \"other\", \"our\", \"own\", \"p\", \"q\", \"r\", \"rather\",\n        \"s\", \"said\", \"say\", \"says\", \"she\", \"should\", \"since\", \"so\", \"some\",\n        \"t\", \"than\", \"that\", \"the\", \"their\", \"them\", \"then\", \"there\",\n        \"these\", \"they\", \"this\", \"tis\", \"to\", \"too\", \"twas\", \"u\", \"us\",\n        \"v\", \"w\", \"wants\", \"was\", \"we\", \"were\", \"what\", \"when\", \"where\",\n        \"which\", \"while\", \"who\", \"whom\", \"why\", \"will\", \"with\", \"would\",\n        \"x\", \"y\", \"yet\", \"you\", \"your\", \"z\", \"rt\"];\n\nfor(var i =0; i < msg.payload.length; i++){\n    var temp = msg.payload[i]\n    .replace(/[0-9]/g, \"\")\n    .replace(/(?:https?|ftp):\\/\\/[\\n\\S]+/g, \"\")\n    .replace(/[/.,?!:;&()\"'%@|]/g, \"\")\n\n    .toLowerCase()\n    .replace(/\\n/g, \" \")\n    .replace(/-/g, \"\")\n    .replace(/_/g, \"\")\n    .split(\" \");\n    \n    for(var j = 0; j < temp.length; j++){\n        var stopword = stopwords.includes(temp[j]);\n        if(stopword){\n            temp[j] = \"\";\n        }\n        if(temp[j] != \"\"){\n\n            words.push(temp[j]);\n        }\n\n    }\n}\n\nconst map = words.reduce((acc, word) => {\n\n    let count = acc.get(word) || 0;\n    acc.set(word, ++count)\n    return acc;\n  }, new Map());\n  // Sort by counter first from higher to lower. If counter is the same,\n  // then sort by alphabetical order\n  const topk = [...map].sort((a, b) => b[1] - a[1] || a[0].localeCompare(b[0]));\n  // Return array of k most frequent words\n   \n    msg.payload = topk.slice(0, 20);\n    //.map(item => item[0]);\n    \n    var loc_object = []; \n    //.map(item => item[0]);\n    for(var i = 0; i < msg.payload.length; i++){\n        loc_object[i] = {\"x\": msg.payload[i][0], \"value\": msg.payload[i][1]};\n        \n    }\n\n\n\nmsg.payload = loc_object;\n\n\n\n\n//msg.payload = words\nreturn msg;\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1842.63623046875,"y":3381.0001792907715,"wires":[["c0bf35d0.9f448"]]},{"id":"43dae608.47af18","type":"function","z":"5d651a81.8ece7c","name":"Locations Wordcloud (leeds)","func":"words = [];\n\nplaces = ['bath',  'birmingham', 'bradford', 'brighton and hove', 'bristol', 'cambridge',  'canterbury', 'carlisle', 'chester', 'chichester', 'coventry', 'derby', 'durham', ' ely ', 'exeter', 'gloucester', 'hereford', 'kingston upon hull', 'lancaster', 'leeds', 'leicester', 'lichfield', 'lincoln', 'liverpool', 'london', 'manchester', 'newcastle upon tyne', 'norwich', 'nottingham', 'oxford', 'peterborough', 'plymouth', 'portsmouth', 'preston', 'ripon', 'salford', 'salisbury', 'sheffield', 'southampton', 'st albans', 'stoke-on-trent', 'sunderland', 'truro', 'wakefield', 'wells', 'westminster', 'winchester', 'wolverhampton', 'worcester', 'york', 'bangor', 'cardiff', 'newport', 'st davids', 'swansea', 'aberdeen', 'dundee', 'edinburgh', 'glasgow', 'inverness', 'stirling', 'armagh', 'belfast', 'londonderry', 'lisburn', 'newry', 'aberdeenshire', 'angus',  'antrim', 'argyll', 'armagh',\n'ayrshire',\n'banffshire',\n'berkshire',\n'berwickshire',\n'bristol',\n'buckinghamshire',\n' bute ',\n'caithness',\n'cambridgeshire',\n'cheshire',\n 'london' ,\n'clackmannanshire',\n'clwyd',\n'cornwall',\n'cumbria',\n'derbyshire',\n'devon',\n'dorset',\n'county down',\n'dumfriesshire',\n'dunbartonshire',\n'durham',\n'dyfed',\n'east lothian',\n'east riding of yorkshire',\n'east sussex',\n'essex',\n'fermanagh',\n'fife',\n'gloucestershire',\n'greater london',\n'greater manchester',\n'gwent',\n'gwynedd',\n'hampshire',\n'herefordshire',\n'hertfordshire',\n'inverness-shire',\n'isle of wight',\n'kent',\n'kincardineshire',\n'kinross-shire',\n'kirkcudbrightshire',\n'lanarkshire',\n'lancashire',\n'leicestershire',\n'lincolnshire',\n'londonderry',\n'merseyside',\n'mid glamorgan',\n'midlothian',\n'moray',\n'nairnshire',\n'norfolk',\n'north yorkshire',\n'northamptonshire',\n'northumberland',\n'nottinghamshire',\n'orkney',\n'oxfordshire',\n'peeblesshire',\n'perthshire',\n'powys',\n'renfrewshire',\n'ross and cromarty',\n'roxburghshire',\n'rutland',\n'selkirkshire',\n'shetland',\n'shropshire',\n'somerset',\n'south glamorgan',\n'south yorkshire',\n'staffordshire',\n'stirlingshire',\n'suffolk',\n'surrey',\n'sutherland',\n'tyne and wear',\n'tyrone',\n'warwickshire',\n'west glamorgan',\n'west lothian',\n'west midlands',\n'west sussex',\n'west yorkshire',\n'wigtownshire',\n'wiltshire',\n'worcestershire']\n\n\n\nfor(var i =0; i < msg.payload.length; i++){\n    var temp = msg.payload[i]\n    .replace(/(?:https?|ftp):\\/\\/[\\n\\S]+/g, \"\")\n    .replace(/[/.,?!:;&()\" ' |@#]/g, \"\")\n    .toLowerCase()\n    .replace(/\\n/g, \" \");\n    //.split(\" \");\n\n    for(var j = 0; j < places.length; j++){\n        var contains = temp.includes(places[j]);\n        if(contains){\n            words.push(places[j]);\n        }\n    }\n}\n\nconst map = words.reduce((acc, word) => {\n\n    let count = acc.get(word) || 0;\n    acc.set(word, ++count)\n    return acc;\n  }, new Map());\n  // Sort by counter first from higher to lower. If counter is the same,\n  // then sort by alphabetical order\n  const top_places = [...map].sort((a, b) => b[1] - a[1] || a[0].localeCompare(b[0]));\n  // Return array of k most frequent words\n   \n    msg.payload = top_places.slice(0, 100);\n    var loc_object = []; \n    //.map(item => item[0]);\n    for(var i = 0; i < msg.payload.length; i++){\n        loc_object[i] = {\"x\": msg.payload[i][0], \"value\": msg.payload[i][1]};\n        \n    }\n\n\n\nmsg.payload = loc_object;\n\n\n\n\nreturn msg;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1771.5249328613281,"y":3428.3639945983887,"wires":[["a47bf999.47dae8"]]},{"id":"c5999978.86726","type":"complete","z":"5d651a81.8ece7c","name":"Process New Tweets for Leeds","scope":["d4494ddb.c83f2"],"uncaught":false,"x":1369.5277252197266,"y":3227.755537033081,"wires":[["dda5670f.d0681","dbd94f86.e49b3"]]},{"id":"bb5c02c3.0fc078","type":"function","z":"5d651a81.8ece7c","name":"Function for array of strings","func":"var tweets = []; \n\nvar count; \nfor (var i = 0; i < Object.keys(msg.payload[0]).length; i++){\n\n  tweets.push(msg.payload[0][i].x);\n\n  \n}\n\nmsg.payload = tweets;\nreturn msg;\n\n// for(var i = 0; i < Object.keys(ox2[0]).length; i++){\n//   ox_loc.push({\"x\": ox2[0][i].x, \"value\": ox2[0][i].value});\n// }","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2037.3784713745117,"y":3168.3476848602295,"wires":[["fa5117d4.4ac1d8"]]},{"id":"dbd94f86.e49b3","type":"function","z":"5d651a81.8ece7c","name":"declare sentiment global","func":"global.set('sentimentLeeds',[]);\n// global.set('tweet_num', msg.payload.length);\n// global.set('IC',true);\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1707.4433059692383,"y":3228.070531845093,"wires":[[]]},{"id":"fa5117d4.4ac1d8","type":"delay","z":"5d651a81.8ece7c","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2212.6730346679688,"y":3168.5595655441284,"wires":[["53ec697b.f35e68"]],"l":false},{"id":"bdc13402.7f64d","type":"function","z":"5d651a81.8ece7c","name":"","func":"msg.finished12 = true; \n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2245.378680229187,"y":3241.4092178344727,"wires":[["cddfe7cd.cc4808","ecd3699d.019378"]],"l":false},{"id":"c00037ad.1aceb8","type":"natural-language-understanding","z":"5d651a81.8ece7c","name":"","categories":false,"limitcategories":"8","concepts":false,"maxconcepts":"8","doc-emotion":true,"doc-emotion-target":"","doc-sentiment":false,"doc-sentiment-target":"","entity":false,"entity-emotion":false,"entity-sentiment":false,"maxentities":"50","keyword":false,"keyword-emotion":true,"keyword-sentiment":true,"maxkeywords":"50","metadata":false,"relation":false,"semantic":false,"semantic-entities":true,"semantic-keywords":true,"maxsemantics":"50","limittextcharacters":"0","syntax":false,"syntax-sentences":false,"syntax-tokens-lemma":false,"syntax-tokens-pos":false,"service-endpoint":"https://api.us-south.natural-language-understanding.watson.cloud.ibm.com/instances/3252dc64-1496-4697-bd85-69b0a850cc46","x":2097.3784713745117,"y":3329.711359024048,"wires":[["f364346.8482148"]]},{"id":"cddfe7cd.cc4808","type":"function","z":"5d651a81.8ece7c","name":"avg joy","func":"var sentiment = global.get('sentimentLeeds') || [];\nvar sum = 0;\nfor(var i = 0; i < sentiment.length; i++){\n    sum += sentiment[i];\n}\n\n\n\nvar average = 0;\n\nif(sentiment.length > 0){\n    average = sum/sentiment.length; \n}\n\nmsg.payload = {\"Mood\": average};\nmsg.average = average; \n\nif(msg.finished12 == true){\n    \n    return msg; \n}\nelse{\n\n    return; \n}\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2413.5905799865723,"y":3240.6508617401123,"wires":[["418f8891.72e828","dce02d9b.56d7d"]]},{"id":"ecd3699d.019378","type":"function","z":"5d651a81.8ece7c","name":"joy for line graph","func":"var sentiment = global.get('sentimentLeeds') || [];\nvar sum = 0;\nfor(var i = 0; i < sentiment.length; i++){\n    sum += sentiment[i];\n}\n\nvar today = new Date();\nvar date = today.getFullYear() + '-' +(today.getMonth()+1) + '-' + today.getDate();\nvar average = 0;\n\nif(sentiment.length > 0){\n    average = sum/sentiment.length; \n}\n\nglobal.set('average_leeds', average); \nvar object = {\"date\": date, \"joy\": average};\nmsg.payload = object; \n\nif(msg.finished12 == true){\n    global.set('still_processing_leeds', false);\n    return msg; \n}\n\nelse{\n    global.set('still_processing_leeds', true);\n    return; \n}\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2495.279079437256,"y":3427.8626136779785,"wires":[["e43acb52.80b258"]]},{"id":"f364346.8482148","type":"function","z":"5d651a81.8ece7c","name":"","func":"msg.payload = msg.features;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2299.136414527893,"y":3329.0447998046875,"wires":[["f404f11d.90655"]],"l":false},{"id":"f404f11d.90655","type":"function","z":"5d651a81.8ece7c","name":"create sentiment array","func":"\n\nvar sentiment = global.get('sentimentLeeds') || [];\n\nsentiment.push(msg.features.emotion.document.emotion.joy);\nglobal.set(\"sentimentLeeds\", sentiment);\nmsg.payload = sentiment; \n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2459.7728576660156,"y":3324.2567100524902,"wires":[["cddfe7cd.cc4808","ecd3699d.019378"]]},{"id":"dce02d9b.56d7d","type":"function","z":"5d651a81.8ece7c","name":"ColorFunction","func":"var average = msg.average;\n// var average = 0.1;\n\nif(0 <= average && average < 0.2){\n    msg.payload = {\n        normal: {\n            fill: \"#cc2316  0.3\",\n            stroke: \"#cc2316\"\n        }\n    };\n    return msg;\n}else if(0.2 <= average && average < 0.4){\n    msg.payload = {\n        normal: {\n            fill: \"#fc7600  0.3\",\n            stroke: \"#fc7600\"\n        }\n    };\n    return msg;\n}else if(0.4 <= average && average < 0.6){\n    msg.payload = {\n        normal: {\n            fill: \"#fbff00  0.3\",\n            stroke: \"#fbff00\"\n        }\n    };\n    return msg;\n}else if(0.6 <= average && average < 0.8){\n    msg.payload = {\n        normal: {\n            fill: \"#00ff11  0.3\",\n            stroke: \"#00ff11\"\n        }\n    };\n    return msg;\n}else if(0.8 <= average && average <= 1){\n    msg.payload = {\n        normal: {\n            fill: \"#049cfc  0.3\",\n            stroke: \"#049cfc\"\n        }\n    };\n    return msg;\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2617.79390335083,"y":3190.499050140381,"wires":[["e330b543.2582c8"]]},{"id":"ff85a678.000888","type":"function","z":"5d651a81.8ece7c","name":"Store Liverpool text in database","func":"var text = global.get('liv_text'); \nmsg.payload = text;\nglobal.set('liv_text', []); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":299.73016357421875,"y":3424.7936820983887,"wires":[["343ab5d6.4651a2"]]},{"id":"2640d2f2.4fa83e","type":"function","z":"5d651a81.8ece7c","name":"Store Liverpool Tweet count","func":"var tweet = global.get('liv_tweets'); \nmsg.payload = {Tweets: tweet};\nglobal.set('liv_tweets', 0); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":297.73016357421875,"y":3469.7936630249023,"wires":[["96a87eff.b252a8"]]},{"id":"e1b828e9.5b2988","type":"function","z":"5d651a81.8ece7c","name":"Store Liverpool Retweet count","func":"var tweet = global.get('liv_retweets'); \nmsg.payload = {Retweets: tweet};\nglobal.set('liv_retweets', 0); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":299.73016357421875,"y":3522.7936820983887,"wires":[["3c9d1790.a84428"]]},{"id":"93bfa82.dd105d8","type":"function","z":"5d651a81.8ece7c","name":"Too many tweets (graph)","func":"var still_processing = global.get('still_processing_liv');\nvar average = global.get('average_liv'); \nvar today = new Date();\nvar date = today.getFullYear() + '-' +(today.getMonth()+1) + '-' + today.getDate();\n\nif(still_processing == true){\n  var object = {\"date\": date, \"joy\": average};\n  msg.payload = object; \n  global.set('still_processing_liv', false);\n  return msg;\n        \n}\nmsg.finished = still_processing; \n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":270.6825256347656,"y":3569.3650608062744,"wires":[["b4330986.c9535"]]},{"id":"ec54cf3b.0e8ad8","type":"complete","z":"5d651a81.8ece7c","name":"Process New Tweets for Liverpool","scope":["e43acb52.80b258"],"uncaught":false,"x":3089.5455322265625,"y":3196.272705078125,"wires":[["276cf04.03aac9","763e3340.19b4ec"]]},{"id":"763e3340.19b4ec","type":"function","z":"5d651a81.8ece7c","name":"declare sentiment global","func":"global.set('sentimentLiv',[]);\n// global.set('tweet_num', msg.payload.length);\n// global.set('IC',true);\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3423.4610595703125,"y":3198.587646484375,"wires":[[]]},{"id":"c8e19f87.08dcf8","type":"function","z":"5d651a81.8ece7c","name":"Function for array of strings","func":"var tweets = []; \n\nvar count; \nfor (var i = 0; i < Object.keys(msg.payload[0]).length; i++){\n\n  tweets.push(msg.payload[0][i].x);\n\n  \n}\n\nmsg.payload = tweets;\nreturn msg;\n\n// for(var i = 0; i < Object.keys(ox2[0]).length; i++){\n//   ox_loc.push({\"x\": ox2[0][i].x, \"value\": ox2[0][i].value});\n// }","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3737.3962783813477,"y":3136.8648529052734,"wires":[["934566de.3a76c8"]]},{"id":"d67231fe.d58c18","type":"function","z":"5d651a81.8ece7c","name":"Convert to Array of Strings","func":"var tweets = []; \n\nvar count; \nfor (var i = 0; i < Object.keys(msg.payload[0]).length; i++){\n\n  tweets.push(msg.payload[0][i].x);\n\n  \n}\n\nmsg.payload = tweets;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3100.017807006836,"y":3348.517168045044,"wires":[["216d534f.fff75c","89ebad8f.f0d7c8"]]},{"id":"934566de.3a76c8","type":"delay","z":"5d651a81.8ece7c","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":3912.6908416748047,"y":3137.0767335891724,"wires":[["79db6a53.9b8e9c"]],"l":false},{"id":"216d534f.fff75c","type":"function","z":"5d651a81.8ece7c","name":"Get 20 Most Common Words for Word Cloud","func":"words = [];\n\nstopwords = [\"a\", \"able\", \"about\",\n        \"across\", \"after\", \"all\", \"almost\", \"also\", \"am\", \"among\", \"an\",\n        \"and\", \"any\", \"are\", \"as\", \"at\", \"b\", \"be\", \"because\", \"been\",\n        \"but\", \"by\", \"c\", \"can\", \"cannot\", \"could\", \"d\", \"dear\", \"did\",\n        \"do\", \"does\", \"e\", \"either\", \"else\", \"ever\", \"every\", \"f\", \"for\",\n        \"from\", \"g\", \"get\", \"got\", \"h\", \"had\", \"has\", \"have\", \"he\", \"her\",\n        \"hers\", \"him\", \"his\", \"how\", \"however\", \"i\", \"if\", \"in\", \"into\",\n        \"is\", \"it\", \"its\", \"j\", \"just\", \"k\", \"l\", \"least\", \"let\", \"like\",\n        \"likely\", \"m\", \"may\", \"me\", \"might\", \"most\", \"must\", \"my\",\n        \"neither\", \"n\", \"no\", \"nor\", \"not\", \"o\", \"of\", \"off\", \"often\",\n        \"on\", \"only\", \"or\", \"other\", \"our\", \"own\", \"p\", \"q\", \"r\", \"rather\",\n        \"s\", \"said\", \"say\", \"says\", \"she\", \"should\", \"since\", \"so\", \"some\",\n        \"t\", \"than\", \"that\", \"the\", \"their\", \"them\", \"then\", \"there\",\n        \"these\", \"they\", \"this\", \"tis\", \"to\", \"too\", \"twas\", \"u\", \"us\",\n        \"v\", \"w\", \"wants\", \"was\", \"we\", \"were\", \"what\", \"when\", \"where\",\n        \"which\", \"while\", \"who\", \"whom\", \"why\", \"will\", \"with\", \"would\",\n        \"x\", \"y\", \"yet\", \"you\", \"your\", \"z\", \"rt\"];\n\nfor(var i =0; i < msg.payload.length; i++){\n    var temp = msg.payload[i]\n    .replace(/[0-9]/g, \"\")\n    .replace(/(?:https?|ftp):\\/\\/[\\n\\S]+/g, \"\")\n    .replace(/[/.,?!:;&()\"'%@|]/g, \"\")\n\n    .toLowerCase()\n    .replace(/\\n/g, \" \")\n    .replace(/-/g, \"\")\n    .replace(/_/g, \"\")\n    .split(\" \");\n    \n    for(var j = 0; j < temp.length; j++){\n        var stopword = stopwords.includes(temp[j]);\n        if(stopword){\n            temp[j] = \"\";\n        }\n        if(temp[j] != \"\"){\n\n            words.push(temp[j]);\n        }\n\n    }\n}\n\nconst map = words.reduce((acc, word) => {\n\n    let count = acc.get(word) || 0;\n    acc.set(word, ++count)\n    return acc;\n  }, new Map());\n  // Sort by counter first from higher to lower. If counter is the same,\n  // then sort by alphabetical order\n  const topk = [...map].sort((a, b) => b[1] - a[1] || a[0].localeCompare(b[0]));\n  // Return array of k most frequent words\n   \n    msg.payload = topk.slice(0, 20);\n    //.map(item => item[0]);\n    \n    var loc_object = []; \n    //.map(item => item[0]);\n    for(var i = 0; i < msg.payload.length; i++){\n        loc_object[i] = {\"x\": msg.payload[i][0], \"value\": msg.payload[i][1]};\n        \n    }\n\n\n\nmsg.payload = loc_object;\n\n\n\n\n//msg.payload = words\nreturn msg;\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3512.654037475586,"y":3349.5173473358154,"wires":[["b72c6693.d28f38"]]},{"id":"89ebad8f.f0d7c8","type":"function","z":"5d651a81.8ece7c","name":"Locations Wordcloud ","func":"words = [];\n\nplaces = ['bath',  'birmingham', 'bradford', 'brighton and hove', 'bristol', 'cambridge',  'canterbury', 'carlisle', 'chester', 'chichester', 'coventry', 'derby', 'durham', ' ely ', 'exeter', 'gloucester', 'hereford', 'kingston upon hull', 'lancaster', 'leeds', 'leicester', 'lichfield', 'lincoln', 'liverpool', 'london', 'manchester', 'newcastle upon tyne', 'norwich', 'nottingham', 'oxford', 'peterborough', 'plymouth', 'portsmouth', 'preston', 'ripon', 'salford', 'salisbury', 'sheffield', 'southampton', 'st albans', 'stoke-on-trent', 'sunderland', 'truro', 'wakefield', 'wells', 'westminster', 'winchester', 'wolverhampton', 'worcester', 'york', 'bangor', 'cardiff', 'newport', 'st davids', 'swansea', 'aberdeen', 'dundee', 'edinburgh', 'glasgow', 'inverness', 'stirling', 'armagh', 'belfast', 'londonderry', 'lisburn', 'newry', 'aberdeenshire', 'angus',  'antrim', 'argyll', 'armagh',\n'ayrshire',\n'banffshire',\n'berkshire',\n'berwickshire',\n'bristol',\n'buckinghamshire',\n' bute ',\n'caithness',\n'cambridgeshire',\n'cheshire',\n 'london' ,\n'clackmannanshire',\n'clwyd',\n'cornwall',\n'cumbria',\n'derbyshire',\n'devon',\n'dorset',\n'county down',\n'dumfriesshire',\n'dunbartonshire',\n'durham',\n'dyfed',\n'east lothian',\n'east riding of yorkshire',\n'east sussex',\n'essex',\n'fermanagh',\n'fife',\n'gloucestershire',\n'greater london',\n'greater manchester',\n'gwent',\n'gwynedd',\n'hampshire',\n'herefordshire',\n'hertfordshire',\n'inverness-shire',\n'isle of wight',\n'kent',\n'kincardineshire',\n'kinross-shire',\n'kirkcudbrightshire',\n'lanarkshire',\n'lancashire',\n'leicestershire',\n'lincolnshire',\n'londonderry',\n'merseyside',\n'mid glamorgan',\n'midlothian',\n'moray',\n'nairnshire',\n'norfolk',\n'north yorkshire',\n'northamptonshire',\n'northumberland',\n'nottinghamshire',\n'orkney',\n'oxfordshire',\n'peeblesshire',\n'perthshire',\n'powys',\n'renfrewshire',\n'ross and cromarty',\n'roxburghshire',\n'rutland',\n'selkirkshire',\n'shetland',\n'shropshire',\n'somerset',\n'south glamorgan',\n'south yorkshire',\n'staffordshire',\n'stirlingshire',\n'suffolk',\n'surrey',\n'sutherland',\n'tyne and wear',\n'tyrone',\n'warwickshire',\n'west glamorgan',\n'west lothian',\n'west midlands',\n'west sussex',\n'west yorkshire',\n'wigtownshire',\n'wiltshire',\n'worcestershire']\n\n\n\nfor(var i =0; i < msg.payload.length; i++){\n    var temp = msg.payload[i]\n    .replace(/(?:https?|ftp):\\/\\/[\\n\\S]+/g, \"\")\n    .replace(/[/.,?!:;&()\" ' |@#]/g, \"\")\n    .toLowerCase()\n    .replace(/\\n/g, \" \");\n    //.split(\" \");\n\n    for(var j = 0; j < places.length; j++){\n        var contains = temp.includes(places[j]);\n        if(contains){\n            words.push(places[j]);\n        }\n    }\n}\n\nconst map = words.reduce((acc, word) => {\n\n    let count = acc.get(word) || 0;\n    acc.set(word, ++count)\n    return acc;\n  }, new Map());\n  // Sort by counter first from higher to lower. If counter is the same,\n  // then sort by alphabetical order\n  const top_places = [...map].sort((a, b) => b[1] - a[1] || a[0].localeCompare(b[0]));\n  // Return array of k most frequent words\n   \n    msg.payload = top_places.slice(0, 100);\n    var loc_object = []; \n    //.map(item => item[0]);\n    for(var i = 0; i < msg.payload.length; i++){\n        loc_object[i] = {\"x\": msg.payload[i][0], \"value\": msg.payload[i][1]};\n        \n    }\n\n\n\nmsg.payload = loc_object;\n\n\n\n\nreturn msg;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3441.542739868164,"y":3396.8811626434326,"wires":[["30a7ee7e.ba07ca"]]},{"id":"10f4e1f0.b186f6","type":"function","z":"5d651a81.8ece7c","name":"","func":"msg.finished13 = true; \n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3945.396487236023,"y":3209.9263858795166,"wires":[["e4b7932e.24c2c","f4ca4752.d7cc8"]],"l":false},{"id":"bf9d0dbb.b1cc68","type":"natural-language-understanding","z":"5d651a81.8ece7c","name":"","categories":false,"limitcategories":"8","concepts":false,"maxconcepts":"8","doc-emotion":true,"doc-emotion-target":"","doc-sentiment":false,"doc-sentiment-target":"","entity":false,"entity-emotion":false,"entity-sentiment":false,"maxentities":"50","keyword":false,"keyword-emotion":true,"keyword-sentiment":true,"maxkeywords":"50","metadata":false,"relation":false,"semantic":false,"semantic-entities":true,"semantic-keywords":true,"maxsemantics":"50","limittextcharacters":"0","syntax":false,"syntax-sentences":false,"syntax-tokens-lemma":false,"syntax-tokens-pos":false,"service-endpoint":"https://api.us-south.natural-language-understanding.watson.cloud.ibm.com/instances/3252dc64-1496-4697-bd85-69b0a850cc46","x":3797.3962783813477,"y":3298.228527069092,"wires":[["8772673e.636a98"]]},{"id":"e4b7932e.24c2c","type":"function","z":"5d651a81.8ece7c","name":"avg joy","func":"var sentiment = global.get('sentimentLiv') || [];\nvar sum = 0;\nfor(var i = 0; i < sentiment.length; i++){\n    sum += sentiment[i];\n}\n\n\n\nvar average = 0;\n\nif(sentiment.length > 0){\n    average = sum/sentiment.length; \n}\n\nmsg.payload = {\"Mood\": average};\nmsg.average = average; \n\nif(msg.finished13 == true){\n    \n    return msg; \n}\nelse{\n\n    return; \n}\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4113.608386993408,"y":3209.1680297851562,"wires":[["c06d5527.f494a","ee0b344d.d92518"]]},{"id":"f4ca4752.d7cc8","type":"function","z":"5d651a81.8ece7c","name":"joy for line graph","func":"var sentiment = global.get('sentimentLiv') || [];\nvar sum = 0;\nfor(var i = 0; i < sentiment.length; i++){\n    sum += sentiment[i];\n}\n\nvar today = new Date();\nvar date = today.getFullYear() + '-' +(today.getMonth()+1) + '-' + today.getDate();\nvar average = 0;\n\nif(sentiment.length > 0){\n    average = sum/sentiment.length; \n}\n\nglobal.set('average_liv', average); \nvar object = {\"date\": date, \"joy\": average};\nmsg.payload = object; \n\nif(msg.finished13 == true){\n    global.set('still_processing_liv', false);\n    return msg; \n}\n\nelse{\n    global.set('still_processing_liv', true);\n    return; \n}\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4195.296886444092,"y":3396.3797817230225,"wires":[["b8c0a934.28941"]]},{"id":"8772673e.636a98","type":"function","z":"5d651a81.8ece7c","name":"","func":"msg.payload = msg.features;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3999.154221534729,"y":3297.5619678497314,"wires":[["2cedd646.0a03ea"]],"l":false},{"id":"2cedd646.0a03ea","type":"function","z":"5d651a81.8ece7c","name":"create sentiment array","func":"\n\nvar sentiment = global.get('sentimentLiv') || [];\n\nsentiment.push(msg.features.emotion.document.emotion.joy);\nglobal.set(\"sentimentLiv\", sentiment);\nmsg.payload = sentiment; \n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4159.790664672852,"y":3292.773878097534,"wires":[["e4b7932e.24c2c","f4ca4752.d7cc8"]]},{"id":"ee0b344d.d92518","type":"function","z":"5d651a81.8ece7c","name":"ColorFunction","func":"var average = msg.average;\n// var average = 0.1;\n\nif(0 <= average && average < 0.2){\n    msg.payload = {\n        normal: {\n            fill: \"#cc2316  0.3\",\n            stroke: \"#cc2316\"\n        }\n    };\n    return msg;\n}else if(0.2 <= average && average < 0.4){\n    msg.payload = {\n        normal: {\n            fill: \"#fc7600  0.3\",\n            stroke: \"#fc7600\"\n        }\n    };\n    return msg;\n}else if(0.4 <= average && average < 0.6){\n    msg.payload = {\n        normal: {\n            fill: \"#fbff00  0.3\",\n            stroke: \"#fbff00\"\n        }\n    };\n    return msg;\n}else if(0.6 <= average && average < 0.8){\n    msg.payload = {\n        normal: {\n            fill: \"#00ff11  0.3\",\n            stroke: \"#00ff11\"\n        }\n    };\n    return msg;\n}else if(0.8 <= average && average <= 1){\n    msg.payload = {\n        normal: {\n            fill: \"#049cfc  0.3\",\n            stroke: \"#049cfc\"\n        }\n    };\n    return msg;\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4317.811710357666,"y":3159.016218185425,"wires":[["208f9133.d3da46"]]},{"id":"828a8d4.08994f","type":"function","z":"5d651a81.8ece7c","name":"Store Manchester text in database","func":"var text = global.get('man_text'); \nmsg.payload = text;\nglobal.set('man_text', []); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":315.5912551879883,"y":3884.9324197769165,"wires":[["a48f394d.ba9f58"]]},{"id":"ed306889.21625","type":"function","z":"5d651a81.8ece7c","name":"Store Manchester Tweet count","func":"var tweet = global.get('man_tweets'); \nmsg.payload = {Tweets: tweet};\nglobal.set('man_tweets', 0); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":313.5912551879883,"y":3929.93240070343,"wires":[["396c68b.b291198"]]},{"id":"a6a4537d.ce576","type":"function","z":"5d651a81.8ece7c","name":"Store Manchester Retweet count","func":"var tweet = global.get('man_retweets'); \nmsg.payload = {Retweets: tweet};\nglobal.set('man_retweets', 0); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":315.5912551879883,"y":3982.9324197769165,"wires":[["aeb9154f.5f5138"]]},{"id":"5fb9938e.cfca6c","type":"function","z":"5d651a81.8ece7c","name":"Too many tweets (graph)","func":"var still_processing = global.get('still_processing_man');\nvar average = global.get('average_man'); \nvar today = new Date();\nvar date = today.getFullYear() + '-' +(today.getMonth()+1) + '-' + today.getDate();\n\nif(still_processing == true){\n  var object = {\"date\": date, \"joy\": average};\n  msg.payload = object; \n  global.set('still_processing_man', false);\n  return msg;\n        \n}\nmsg.finished = still_processing; \n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":276.54361724853516,"y":4029.5037984848022,"wires":[["e89eb2cc.44eb58"]]},{"id":"ced9b44c.5900b8","type":"complete","z":"5d651a81.8ece7c","name":"Process New Tweets for Manchester","scope":["a48f394d.ba9f58"],"uncaught":false,"x":1360,"y":3640,"wires":[["c4d616c6.0e25","9ddfce71.3606e"]]},{"id":"9ddfce71.3606e","type":"function","z":"5d651a81.8ece7c","name":"declare sentiment global","func":"global.set('sentimentMan',[]);\n// global.set('tweet_num', msg.payload.length);\n// global.set('IC',true);\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1719.6297912597656,"y":3642.315008163452,"wires":[[]]},{"id":"429d9a75.24fe9c","type":"function","z":"5d651a81.8ece7c","name":"Function for array of strings","func":"var tweets = []; \n\nvar count; \nfor (var i = 0; i < Object.keys(msg.payload[0]).length; i++){\n\n  tweets.push(msg.payload[0][i].x);\n\n  \n}\n\nmsg.payload = tweets;\nreturn msg;\n\n// for(var i = 0; i < Object.keys(ox2[0]).length; i++){\n//   ox_loc.push({\"x\": ox2[0][i].x, \"value\": ox2[0][i].value});\n// }","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2033.5650100708008,"y":3580.5922145843506,"wires":[["a95073bc.55f5f"]]},{"id":"220fea8.6446916","type":"function","z":"5d651a81.8ece7c","name":"Convert to Array of Strings","func":"var tweets = []; \n\nvar count; \nfor (var i = 0; i < Object.keys(msg.payload[0]).length; i++){\n\n  tweets.push(msg.payload[0][i].x);\n\n  \n}\n\nmsg.payload = tweets;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1396.186538696289,"y":3792.244529724121,"wires":[["d685af7c.ec27","29bd1eee.a14c42"]]},{"id":"a95073bc.55f5f","type":"delay","z":"5d651a81.8ece7c","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2208.859573364258,"y":3580.8040952682495,"wires":[["98b31c1f.9aae68"]],"l":false},{"id":"d685af7c.ec27","type":"function","z":"5d651a81.8ece7c","name":"Get 20 Most Common Words for Word Cloud","func":"words = [];\n\nstopwords = [\"a\", \"able\", \"about\",\n        \"across\", \"after\", \"all\", \"almost\", \"also\", \"am\", \"among\", \"an\",\n        \"and\", \"any\", \"are\", \"as\", \"at\", \"b\", \"be\", \"because\", \"been\",\n        \"but\", \"by\", \"c\", \"can\", \"cannot\", \"could\", \"d\", \"dear\", \"did\",\n        \"do\", \"does\", \"e\", \"either\", \"else\", \"ever\", \"every\", \"f\", \"for\",\n        \"from\", \"g\", \"get\", \"got\", \"h\", \"had\", \"has\", \"have\", \"he\", \"her\",\n        \"hers\", \"him\", \"his\", \"how\", \"however\", \"i\", \"if\", \"in\", \"into\",\n        \"is\", \"it\", \"its\", \"j\", \"just\", \"k\", \"l\", \"least\", \"let\", \"like\",\n        \"likely\", \"m\", \"may\", \"me\", \"might\", \"most\", \"must\", \"my\",\n        \"neither\", \"n\", \"no\", \"nor\", \"not\", \"o\", \"of\", \"off\", \"often\",\n        \"on\", \"only\", \"or\", \"other\", \"our\", \"own\", \"p\", \"q\", \"r\", \"rather\",\n        \"s\", \"said\", \"say\", \"says\", \"she\", \"should\", \"since\", \"so\", \"some\",\n        \"t\", \"than\", \"that\", \"the\", \"their\", \"them\", \"then\", \"there\",\n        \"these\", \"they\", \"this\", \"tis\", \"to\", \"too\", \"twas\", \"u\", \"us\",\n        \"v\", \"w\", \"wants\", \"was\", \"we\", \"were\", \"what\", \"when\", \"where\",\n        \"which\", \"while\", \"who\", \"whom\", \"why\", \"will\", \"with\", \"would\",\n        \"x\", \"y\", \"yet\", \"you\", \"your\", \"z\", \"rt\"];\n\nfor(var i =0; i < msg.payload.length; i++){\n    var temp = msg.payload[i]\n    .replace(/[0-9]/g, \"\")\n    .replace(/(?:https?|ftp):\\/\\/[\\n\\S]+/g, \"\")\n    .replace(/[/.,?!:;&()\"'%@|]/g, \"\")\n\n    .toLowerCase()\n    .replace(/\\n/g, \" \")\n    .replace(/-/g, \"\")\n    .replace(/_/g, \"\")\n    .split(\" \");\n    \n    for(var j = 0; j < temp.length; j++){\n        var stopword = stopwords.includes(temp[j]);\n        if(stopword){\n            temp[j] = \"\";\n        }\n        if(temp[j] != \"\"){\n\n            words.push(temp[j]);\n        }\n\n    }\n}\n\nconst map = words.reduce((acc, word) => {\n\n    let count = acc.get(word) || 0;\n    acc.set(word, ++count)\n    return acc;\n  }, new Map());\n  // Sort by counter first from higher to lower. If counter is the same,\n  // then sort by alphabetical order\n  const topk = [...map].sort((a, b) => b[1] - a[1] || a[0].localeCompare(b[0]));\n  // Return array of k most frequent words\n   \n    msg.payload = topk.slice(0, 20);\n    //.map(item => item[0]);\n    \n    var loc_object = []; \n    //.map(item => item[0]);\n    for(var i = 0; i < msg.payload.length; i++){\n        loc_object[i] = {\"x\": msg.payload[i][0], \"value\": msg.payload[i][1]};\n        \n    }\n\n\n\nmsg.payload = loc_object;\n\n\n\n\n//msg.payload = words\nreturn msg;\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1808.822769165039,"y":3793.2447090148926,"wires":[["40bea90f.df7978"]]},{"id":"29bd1eee.a14c42","type":"function","z":"5d651a81.8ece7c","name":"Locations Wordcloud ","func":"words = [];\n\nplaces = ['bath',  'birmingham', 'bradford', 'brighton and hove', 'bristol', 'cambridge',  'canterbury', 'carlisle', 'chester', 'chichester', 'coventry', 'derby', 'durham', ' ely ', 'exeter', 'gloucester', 'hereford', 'kingston upon hull', 'lancaster', 'leeds', 'leicester', 'lichfield', 'lincoln', 'liverpool', 'london', 'manchester', 'newcastle upon tyne', 'norwich', 'nottingham', 'oxford', 'peterborough', 'plymouth', 'portsmouth', 'preston', 'ripon', 'salford', 'salisbury', 'sheffield', 'southampton', 'st albans', 'stoke-on-trent', 'sunderland', 'truro', 'wakefield', 'wells', 'westminster', 'winchester', 'wolverhampton', 'worcester', 'york', 'bangor', 'cardiff', 'newport', 'st davids', 'swansea', 'aberdeen', 'dundee', 'edinburgh', 'glasgow', 'inverness', 'stirling', 'armagh', 'belfast', 'londonderry', 'lisburn', 'newry', 'aberdeenshire', 'angus',  'antrim', 'argyll', 'armagh',\n'ayrshire',\n'banffshire',\n'berkshire',\n'berwickshire',\n'bristol',\n'buckinghamshire',\n' bute ',\n'caithness',\n'cambridgeshire',\n'cheshire',\n 'london' ,\n'clackmannanshire',\n'clwyd',\n'cornwall',\n'cumbria',\n'derbyshire',\n'devon',\n'dorset',\n'county down',\n'dumfriesshire',\n'dunbartonshire',\n'durham',\n'dyfed',\n'east lothian',\n'east riding of yorkshire',\n'east sussex',\n'essex',\n'fermanagh',\n'fife',\n'gloucestershire',\n'greater london',\n'greater manchester',\n'gwent',\n'gwynedd',\n'hampshire',\n'herefordshire',\n'hertfordshire',\n'inverness-shire',\n'isle of wight',\n'kent',\n'kincardineshire',\n'kinross-shire',\n'kirkcudbrightshire',\n'lanarkshire',\n'lancashire',\n'leicestershire',\n'lincolnshire',\n'londonderry',\n'merseyside',\n'mid glamorgan',\n'midlothian',\n'moray',\n'nairnshire',\n'norfolk',\n'north yorkshire',\n'northamptonshire',\n'northumberland',\n'nottinghamshire',\n'orkney',\n'oxfordshire',\n'peeblesshire',\n'perthshire',\n'powys',\n'renfrewshire',\n'ross and cromarty',\n'roxburghshire',\n'rutland',\n'selkirkshire',\n'shetland',\n'shropshire',\n'somerset',\n'south glamorgan',\n'south yorkshire',\n'staffordshire',\n'stirlingshire',\n'suffolk',\n'surrey',\n'sutherland',\n'tyne and wear',\n'tyrone',\n'warwickshire',\n'west glamorgan',\n'west lothian',\n'west midlands',\n'west sussex',\n'west yorkshire',\n'wigtownshire',\n'wiltshire',\n'worcestershire']\n\n\n\nfor(var i =0; i < msg.payload.length; i++){\n    var temp = msg.payload[i]\n    .replace(/(?:https?|ftp):\\/\\/[\\n\\S]+/g, \"\")\n    .replace(/[/.,?!:;&()\" ' |@#]/g, \"\")\n    .toLowerCase()\n    .replace(/\\n/g, \" \");\n    //.split(\" \");\n\n    for(var j = 0; j < places.length; j++){\n        var contains = temp.includes(places[j]);\n        if(contains){\n            words.push(places[j]);\n        }\n    }\n}\n\nconst map = words.reduce((acc, word) => {\n\n    let count = acc.get(word) || 0;\n    acc.set(word, ++count)\n    return acc;\n  }, new Map());\n  // Sort by counter first from higher to lower. If counter is the same,\n  // then sort by alphabetical order\n  const top_places = [...map].sort((a, b) => b[1] - a[1] || a[0].localeCompare(b[0]));\n  // Return array of k most frequent words\n   \n    msg.payload = top_places.slice(0, 100);\n    var loc_object = []; \n    //.map(item => item[0]);\n    for(var i = 0; i < msg.payload.length; i++){\n        loc_object[i] = {\"x\": msg.payload[i][0], \"value\": msg.payload[i][1]};\n        \n    }\n\n\n\nmsg.payload = loc_object;\n\n\n\n\nreturn msg;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1737.7114715576172,"y":3840.6085243225098,"wires":[["686f3b4.b7d0b44"]]},{"id":"15e4f604.e0b462","type":"function","z":"5d651a81.8ece7c","name":"","func":"msg.finished15 = true; \n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2241.565218925476,"y":3653.6537475585938,"wires":[["10393cc7.f2ffb3","c331adac.4bfc38"]],"l":false},{"id":"4933b3e4.1efdb4","type":"natural-language-understanding","z":"5d651a81.8ece7c","name":"","categories":false,"limitcategories":"8","concepts":false,"maxconcepts":"8","doc-emotion":true,"doc-emotion-target":"","doc-sentiment":false,"doc-sentiment-target":"","entity":false,"entity-emotion":false,"entity-sentiment":false,"maxentities":"50","keyword":false,"keyword-emotion":true,"keyword-sentiment":true,"maxkeywords":"50","metadata":false,"relation":false,"semantic":false,"semantic-entities":true,"semantic-keywords":true,"maxsemantics":"50","limittextcharacters":"0","syntax":false,"syntax-sentences":false,"syntax-tokens-lemma":false,"syntax-tokens-pos":false,"service-endpoint":"https://api.us-south.natural-language-understanding.watson.cloud.ibm.com/instances/3252dc64-1496-4697-bd85-69b0a850cc46","x":2093.565010070801,"y":3741.955888748169,"wires":[["94c55fcb.775f2"]]},{"id":"10393cc7.f2ffb3","type":"function","z":"5d651a81.8ece7c","name":"avg joy","func":"var sentiment = global.get('sentimentMan') || [];\nvar sum = 0;\nfor(var i = 0; i < sentiment.length; i++){\n    sum += sentiment[i];\n}\n\n\n\nvar average = 0;\n\nif(sentiment.length > 0){\n    average = sum/sentiment.length; \n}\n\nmsg.payload = {\"Mood\": average};\nmsg.average = average; \n\nif(msg.finished15 == true){\n    \n    return msg; \n}\nelse{\n\n    return; \n}\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2409.7771186828613,"y":3652.8953914642334,"wires":[["428b3c0f.9d77cc","981263f3.0e8538"]]},{"id":"c331adac.4bfc38","type":"function","z":"5d651a81.8ece7c","name":"joy for line graph","func":"var sentiment = global.get('sentimentMan') || [];\nvar sum = 0;\nfor(var i = 0; i < sentiment.length; i++){\n    sum += sentiment[i];\n}\n\nvar today = new Date();\nvar date = today.getFullYear() + '-' +(today.getMonth()+1) + '-' + today.getDate();\nvar average = 0;\n\nif(sentiment.length > 0){\n    average = sum/sentiment.length; \n}\n\nglobal.set('average_man', average); \nvar object = {\"date\": date, \"joy\": average};\nmsg.payload = object; \n\nif(msg.finished15 == true){\n    global.set('still_processing_man', false);\n    return msg; \n}\n\nelse{\n    global.set('still_processing_man', true);\n    return; \n}\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2491.465618133545,"y":3840.1071434020996,"wires":[["5c39ae58.411f58"]]},{"id":"94c55fcb.775f2","type":"function","z":"5d651a81.8ece7c","name":"","func":"msg.payload = msg.features;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2295.322953224182,"y":3741.2893295288086,"wires":[["f93101be.dfbbf"]],"l":false},{"id":"f93101be.dfbbf","type":"function","z":"5d651a81.8ece7c","name":"create sentiment array","func":"\n\nvar sentiment = global.get('sentimentMan') || [];\n\nsentiment.push(msg.features.emotion.document.emotion.joy);\nglobal.set(\"sentimentMan\", sentiment);\nmsg.payload = sentiment; \n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2455.9593963623047,"y":3736.5012397766113,"wires":[["10393cc7.f2ffb3","c331adac.4bfc38"]]},{"id":"981263f3.0e8538","type":"function","z":"5d651a81.8ece7c","name":"ColorFunction","func":"var average = msg.average;\n// var average = 0.1;\n\nif(0 <= average && average < 0.2){\n    msg.payload = {\n        normal: {\n            fill: \"#cc2316  0.3\",\n            stroke: \"#cc2316\"\n        }\n    };\n    return msg;\n}else if(0.2 <= average && average < 0.4){\n    msg.payload = {\n        normal: {\n            fill: \"#fc7600  0.3\",\n            stroke: \"#fc7600\"\n        }\n    };\n    return msg;\n}else if(0.4 <= average && average < 0.6){\n    msg.payload = {\n        normal: {\n            fill: \"#fbff00  0.3\",\n            stroke: \"#fbff00\"\n        }\n    };\n    return msg;\n}else if(0.6 <= average && average < 0.8){\n    msg.payload = {\n        normal: {\n            fill: \"#00ff11  0.3\",\n            stroke: \"#00ff11\"\n        }\n    };\n    return msg;\n}else if(0.8 <= average && average <= 1){\n    msg.payload = {\n        normal: {\n            fill: \"#049cfc  0.3\",\n            stroke: \"#049cfc\"\n        }\n    };\n    return msg;\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2613.980442047119,"y":3602.743579864502,"wires":[["e222c5a9.ae92a"]]},{"id":"57e6d094.021cc","type":"function","z":"5d651a81.8ece7c","name":"Store Sheffield text in database","func":"var text = global.get('shef_text'); \nmsg.payload = text;\nglobal.set('shef_text', []); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":311.84124755859375,"y":4108.682355880737,"wires":[["68c06bf2.d80ab4"]]},{"id":"4a16f079.62b3c","type":"function","z":"5d651a81.8ece7c","name":"Store Sheffield Tweet count","func":"var tweet = global.get('shef_tweets'); \nmsg.payload = {Tweets: tweet};\nglobal.set('shef_tweets', 0); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":299.84124755859375,"y":4153.682336807251,"wires":[["6c5c240f.4b7a6c"]]},{"id":"4f98f8f2.231878","type":"function","z":"5d651a81.8ece7c","name":"Store Manchester Retweet count","func":"var tweet = global.get('shef_retweets'); \nmsg.payload = {Retweets: tweet};\nglobal.set('shef_retweets', 0); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":321.84124755859375,"y":4206.682355880737,"wires":[["780ede9a.48c708"]]},{"id":"c273c404.b0c77","type":"function","z":"5d651a81.8ece7c","name":"Too many tweets (graph)","func":"var still_processing = global.get('still_processing_shef');\nvar average = global.get('average_shef'); \nvar today = new Date();\nvar date = today.getFullYear() + '-' +(today.getMonth()+1) + '-' + today.getDate();\n\nif(still_processing == true){\n  var object = {\"date\": date, \"joy\": average};\n  msg.payload = object; \n  global.set('still_processing_shef', false);\n  return msg;\n        \n}\nmsg.finished = still_processing; \n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":282.7936096191406,"y":4253.253734588623,"wires":[["e812f02b.e45c7"]]},{"id":"9b827f3a.dcc978","type":"complete","z":"5d651a81.8ece7c","name":"Process New Tweets for Sheffield","scope":["68c06bf2.d80ab4","5c39ae58.411f58"],"uncaught":false,"x":3108.110200881958,"y":3616.610324859619,"wires":[["60affd07.6f4abc","e4e49c72.ae9ff8"]]},{"id":"e4e49c72.ae9ff8","type":"function","z":"5d651a81.8ece7c","name":"declare sentiment global","func":"global.set('sentimentShef',[]);\n// global.set('tweet_num', msg.payload.length);\n// global.set('IC',true);\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3487.7399921417236,"y":3618.9253330230713,"wires":[[]]},{"id":"81be2f26.92cba","type":"function","z":"5d651a81.8ece7c","name":"Function for array of strings","func":"var tweets = []; \n\nvar count; \nfor (var i = 0; i < Object.keys(msg.payload[0]).length; i++){\n\n  tweets.push(msg.payload[0][i].x);\n\n  \n}\n\nmsg.payload = tweets;\nreturn msg;\n\n// for(var i = 0; i < Object.keys(ox2[0]).length; i++){\n//   ox_loc.push({\"x\": ox2[0][i].x, \"value\": ox2[0][i].value});\n// }","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3801.675210952759,"y":3557.2025394439697,"wires":[["a22c3f75.44bd"]]},{"id":"e4963cfd.240fd8","type":"function","z":"5d651a81.8ece7c","name":"Convert to Array of Strings","func":"var tweets = []; \n\nvar count; \nfor (var i = 0; i < Object.keys(msg.payload[0]).length; i++){\n\n  tweets.push(msg.payload[0][i].x);\n\n  \n}\n\nmsg.payload = tweets;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3164.296739578247,"y":3768.8548545837402,"wires":[["a57656ff.3e4e1","e2f212ed.1950c"]]},{"id":"a22c3f75.44bd","type":"delay","z":"5d651a81.8ece7c","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":3976.969774246216,"y":3557.4144201278687,"wires":[["4dcafa7.41af384"]],"l":false},{"id":"a57656ff.3e4e1","type":"function","z":"5d651a81.8ece7c","name":"Get 20 Most Common Words for Word Cloud","func":"words = [];\n\nstopwords = [\"a\", \"able\", \"about\",\n        \"across\", \"after\", \"all\", \"almost\", \"also\", \"am\", \"among\", \"an\",\n        \"and\", \"any\", \"are\", \"as\", \"at\", \"b\", \"be\", \"because\", \"been\",\n        \"but\", \"by\", \"c\", \"can\", \"cannot\", \"could\", \"d\", \"dear\", \"did\",\n        \"do\", \"does\", \"e\", \"either\", \"else\", \"ever\", \"every\", \"f\", \"for\",\n        \"from\", \"g\", \"get\", \"got\", \"h\", \"had\", \"has\", \"have\", \"he\", \"her\",\n        \"hers\", \"him\", \"his\", \"how\", \"however\", \"i\", \"if\", \"in\", \"into\",\n        \"is\", \"it\", \"its\", \"j\", \"just\", \"k\", \"l\", \"least\", \"let\", \"like\",\n        \"likely\", \"m\", \"may\", \"me\", \"might\", \"most\", \"must\", \"my\",\n        \"neither\", \"n\", \"no\", \"nor\", \"not\", \"o\", \"of\", \"off\", \"often\",\n        \"on\", \"only\", \"or\", \"other\", \"our\", \"own\", \"p\", \"q\", \"r\", \"rather\",\n        \"s\", \"said\", \"say\", \"says\", \"she\", \"should\", \"since\", \"so\", \"some\",\n        \"t\", \"than\", \"that\", \"the\", \"their\", \"them\", \"then\", \"there\",\n        \"these\", \"they\", \"this\", \"tis\", \"to\", \"too\", \"twas\", \"u\", \"us\",\n        \"v\", \"w\", \"wants\", \"was\", \"we\", \"were\", \"what\", \"when\", \"where\",\n        \"which\", \"while\", \"who\", \"whom\", \"why\", \"will\", \"with\", \"would\",\n        \"x\", \"y\", \"yet\", \"you\", \"your\", \"z\", \"rt\"];\n\nfor(var i =0; i < msg.payload.length; i++){\n    var temp = msg.payload[i]\n    .replace(/[0-9]/g, \"\")\n    .replace(/(?:https?|ftp):\\/\\/[\\n\\S]+/g, \"\")\n    .replace(/[/.,?!:;&()\"'%@|]/g, \"\")\n\n    .toLowerCase()\n    .replace(/\\n/g, \" \")\n    .replace(/-/g, \"\")\n    .replace(/_/g, \"\")\n    .split(\" \");\n    \n    for(var j = 0; j < temp.length; j++){\n        var stopword = stopwords.includes(temp[j]);\n        if(stopword){\n            temp[j] = \"\";\n        }\n        if(temp[j] != \"\"){\n\n            words.push(temp[j]);\n        }\n\n    }\n}\n\nconst map = words.reduce((acc, word) => {\n\n    let count = acc.get(word) || 0;\n    acc.set(word, ++count)\n    return acc;\n  }, new Map());\n  // Sort by counter first from higher to lower. If counter is the same,\n  // then sort by alphabetical order\n  const topk = [...map].sort((a, b) => b[1] - a[1] || a[0].localeCompare(b[0]));\n  // Return array of k most frequent words\n   \n    msg.payload = topk.slice(0, 20);\n    //.map(item => item[0]);\n    \n    var loc_object = []; \n    //.map(item => item[0]);\n    for(var i = 0; i < msg.payload.length; i++){\n        loc_object[i] = {\"x\": msg.payload[i][0], \"value\": msg.payload[i][1]};\n        \n    }\n\n\n\nmsg.payload = loc_object;\n\n\n\n\n//msg.payload = words\nreturn msg;\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3576.932970046997,"y":3769.8550338745117,"wires":[["ad00bc1d.74d49"]]},{"id":"e2f212ed.1950c","type":"function","z":"5d651a81.8ece7c","name":"Locations Wordcloud ","func":"words = [];\n\nplaces = ['bath',  'birmingham', 'bradford', 'brighton and hove', 'bristol', 'cambridge',  'canterbury', 'carlisle', 'chester', 'chichester', 'coventry', 'derby', 'durham', ' ely ', 'exeter', 'gloucester', 'hereford', 'kingston upon hull', 'lancaster', 'leeds', 'leicester', 'lichfield', 'lincoln', 'liverpool', 'london', 'manchester', 'newcastle upon tyne', 'norwich', 'nottingham', 'oxford', 'peterborough', 'plymouth', 'portsmouth', 'preston', 'ripon', 'salford', 'salisbury', 'sheffield', 'southampton', 'st albans', 'stoke-on-trent', 'sunderland', 'truro', 'wakefield', 'wells', 'westminster', 'winchester', 'wolverhampton', 'worcester', 'york', 'bangor', 'cardiff', 'newport', 'st davids', 'swansea', 'aberdeen', 'dundee', 'edinburgh', 'glasgow', 'inverness', 'stirling', 'armagh', 'belfast', 'londonderry', 'lisburn', 'newry', 'aberdeenshire', 'angus',  'antrim', 'argyll', 'armagh',\n'ayrshire',\n'banffshire',\n'berkshire',\n'berwickshire',\n'bristol',\n'buckinghamshire',\n' bute ',\n'caithness',\n'cambridgeshire',\n'cheshire',\n 'london' ,\n'clackmannanshire',\n'clwyd',\n'cornwall',\n'cumbria',\n'derbyshire',\n'devon',\n'dorset',\n'county down',\n'dumfriesshire',\n'dunbartonshire',\n'durham',\n'dyfed',\n'east lothian',\n'east riding of yorkshire',\n'east sussex',\n'essex',\n'fermanagh',\n'fife',\n'gloucestershire',\n'greater london',\n'greater manchester',\n'gwent',\n'gwynedd',\n'hampshire',\n'herefordshire',\n'hertfordshire',\n'inverness-shire',\n'isle of wight',\n'kent',\n'kincardineshire',\n'kinross-shire',\n'kirkcudbrightshire',\n'lanarkshire',\n'lancashire',\n'leicestershire',\n'lincolnshire',\n'londonderry',\n'merseyside',\n'mid glamorgan',\n'midlothian',\n'moray',\n'nairnshire',\n'norfolk',\n'north yorkshire',\n'northamptonshire',\n'northumberland',\n'nottinghamshire',\n'orkney',\n'oxfordshire',\n'peeblesshire',\n'perthshire',\n'powys',\n'renfrewshire',\n'ross and cromarty',\n'roxburghshire',\n'rutland',\n'selkirkshire',\n'shetland',\n'shropshire',\n'somerset',\n'south glamorgan',\n'south yorkshire',\n'staffordshire',\n'stirlingshire',\n'suffolk',\n'surrey',\n'sutherland',\n'tyne and wear',\n'tyrone',\n'warwickshire',\n'west glamorgan',\n'west lothian',\n'west midlands',\n'west sussex',\n'west yorkshire',\n'wigtownshire',\n'wiltshire',\n'worcestershire']\n\n\n\nfor(var i =0; i < msg.payload.length; i++){\n    var temp = msg.payload[i]\n    .replace(/(?:https?|ftp):\\/\\/[\\n\\S]+/g, \"\")\n    .replace(/[/.,?!:;&()\" ' |@#]/g, \"\")\n    .toLowerCase()\n    .replace(/\\n/g, \" \");\n    //.split(\" \");\n\n    for(var j = 0; j < places.length; j++){\n        var contains = temp.includes(places[j]);\n        if(contains){\n            words.push(places[j]);\n        }\n    }\n}\n\nconst map = words.reduce((acc, word) => {\n\n    let count = acc.get(word) || 0;\n    acc.set(word, ++count)\n    return acc;\n  }, new Map());\n  // Sort by counter first from higher to lower. If counter is the same,\n  // then sort by alphabetical order\n  const top_places = [...map].sort((a, b) => b[1] - a[1] || a[0].localeCompare(b[0]));\n  // Return array of k most frequent words\n   \n    msg.payload = top_places.slice(0, 100);\n    var loc_object = []; \n    //.map(item => item[0]);\n    for(var i = 0; i < msg.payload.length; i++){\n        loc_object[i] = {\"x\": msg.payload[i][0], \"value\": msg.payload[i][1]};\n        \n    }\n\n\n\nmsg.payload = loc_object;\n\n\n\n\nreturn msg;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3505.821672439575,"y":3817.218849182129,"wires":[["5e718c09.69b07c"]]},{"id":"bdb3051c.e329c","type":"function","z":"5d651a81.8ece7c","name":"","func":"msg.finished16 = true; \n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4009.675419807434,"y":3630.264072418213,"wires":[["ca01a833.dcbb28","cad173a6.35d57"]],"l":false},{"id":"70fbc1cc.bd0918","type":"natural-language-understanding","z":"5d651a81.8ece7c","name":"","categories":false,"limitcategories":"8","concepts":false,"maxconcepts":"8","doc-emotion":true,"doc-emotion-target":"","doc-sentiment":false,"doc-sentiment-target":"","entity":false,"entity-emotion":false,"entity-sentiment":false,"maxentities":"50","keyword":false,"keyword-emotion":true,"keyword-sentiment":true,"maxkeywords":"50","metadata":false,"relation":false,"semantic":false,"semantic-entities":true,"semantic-keywords":true,"maxsemantics":"50","limittextcharacters":"0","syntax":false,"syntax-sentences":false,"syntax-tokens-lemma":false,"syntax-tokens-pos":false,"service-endpoint":"https://api.us-south.natural-language-understanding.watson.cloud.ibm.com/instances/3252dc64-1496-4697-bd85-69b0a850cc46","x":3861.675210952759,"y":3718.566213607788,"wires":[["1900e6fb.7ddab9"]]},{"id":"ca01a833.dcbb28","type":"function","z":"5d651a81.8ece7c","name":"avg joy","func":"var sentiment = global.get('sentimentShef') || [];\nvar sum = 0;\nfor(var i = 0; i < sentiment.length; i++){\n    sum += sentiment[i];\n}\n\n\n\nvar average = 0;\n\nif(sentiment.length > 0){\n    average = sum/sentiment.length; \n}\n\nmsg.payload = {\"Mood\": average};\nmsg.average = average; \n\nif(msg.finished16 == true){\n    \n    return msg; \n}\nelse{\n\n    return; \n}\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4177.887319564819,"y":3629.5057163238525,"wires":[["6d05d169.74314","3005047a.f6b4dc"]]},{"id":"cad173a6.35d57","type":"function","z":"5d651a81.8ece7c","name":"joy for line graph","func":"var sentiment = global.get('sentimentShef') || [];\nvar sum = 0;\nfor(var i = 0; i < sentiment.length; i++){\n    sum += sentiment[i];\n}\n\nvar today = new Date();\nvar date = today.getFullYear() + '-' +(today.getMonth()+1) + '-' + today.getDate();\nvar average = 0;\n\nif(sentiment.length > 0){\n    average = sum/sentiment.length; \n}\n\nglobal.set('average_shef', average); \nvar object = {\"date\": date, \"joy\": average};\nmsg.payload = object; \n\nif(msg.finished16 == true){\n    global.set('still_processing_shef', false);\n    return msg; \n}\n\nelse{\n    global.set('still_processing_shef', true);\n    return; \n}\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4259.575819015503,"y":3816.7174682617188,"wires":[["4ab1e0be.d0fff"]]},{"id":"1900e6fb.7ddab9","type":"function","z":"5d651a81.8ece7c","name":"","func":"msg.payload = msg.features;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4063.43315410614,"y":3717.8996543884277,"wires":[["8d1aed9f.ec96c"]],"l":false},{"id":"8d1aed9f.ec96c","type":"function","z":"5d651a81.8ece7c","name":"create sentiment array","func":"\n\nvar sentiment = global.get('sentimentShef') || [];\n\nsentiment.push(msg.features.emotion.document.emotion.joy);\nglobal.set(\"sentimentShef\", sentiment);\nmsg.payload = sentiment; \n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4224.069597244263,"y":3713.1115646362305,"wires":[["ca01a833.dcbb28","cad173a6.35d57"]]},{"id":"3005047a.f6b4dc","type":"function","z":"5d651a81.8ece7c","name":"ColorFunction","func":"var average = msg.average;\n// var average = 0.1;\n\nif(0 <= average && average < 0.2){\n    msg.payload = {\n        normal: {\n            fill: \"#cc2316  0.3\",\n            stroke: \"#cc2316\"\n        }\n    };\n    return msg;\n}else if(0.2 <= average && average < 0.4){\n    msg.payload = {\n        normal: {\n            fill: \"#fc7600  0.3\",\n            stroke: \"#fc7600\"\n        }\n    };\n    return msg;\n}else if(0.4 <= average && average < 0.6){\n    msg.payload = {\n        normal: {\n            fill: \"#fbff00  0.3\",\n            stroke: \"#fbff00\"\n        }\n    };\n    return msg;\n}else if(0.6 <= average && average < 0.8){\n    msg.payload = {\n        normal: {\n            fill: \"#00ff11  0.3\",\n            stroke: \"#00ff11\"\n        }\n    };\n    return msg;\n}else if(0.8 <= average && average <= 1){\n    msg.payload = {\n        normal: {\n            fill: \"#049cfc  0.3\",\n            stroke: \"#049cfc\"\n        }\n    };\n    return msg;\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4382.090642929077,"y":3579.353904724121,"wires":[["4cf9c783.6ecfd"]]},{"id":"5b65b22c.6e1824","type":"complete","z":"5d651a81.8ece7c","name":"Process New Tweets for IBM","scope":["4ab1e0be.d0fff"],"uncaught":false,"x":1330,"y":4120,"wires":[["87a4f47d.d5a77","6076574.38f7c28"]]},{"id":"6076574.38f7c28","type":"function","z":"5d651a81.8ece7c","name":"declare sentiment global","func":"global.set('sentimentIBM',[]);\n// global.set('tweet_num', msg.payload.length);\n// global.set('IC',true);\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1719.6297912597656,"y":4122.315008163452,"wires":[[]]},{"id":"3b96d8c7.d11bd","type":"function","z":"5d651a81.8ece7c","name":"Function for array of strings","func":"var tweets = []; \n\nvar count; \nfor (var i = 0; i < Object.keys(msg.payload[0]).length; i++){\n\n  tweets.push(msg.payload[0][i].x);\n\n  \n}\n\nmsg.payload = tweets;\nreturn msg;\n\n// for(var i = 0; i < Object.keys(ox2[0]).length; i++){\n//   ox_loc.push({\"x\": ox2[0][i].x, \"value\": ox2[0][i].value});\n// }","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2033.5650100708008,"y":4060.5922145843506,"wires":[["ab0d0e78.b0d9d8"]]},{"id":"92daa30a.4768c","type":"function","z":"5d651a81.8ece7c","name":"Convert to Array of Strings","func":"var tweets = []; \n\nvar count; \nfor (var i = 0; i < Object.keys(msg.payload[0]).length; i++){\n\n  tweets.push(msg.payload[0][i].x);\n\n  \n}\n\nmsg.payload = tweets;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1396.186538696289,"y":4272.244529724121,"wires":[["1a107f88.29d75","b4447acd.34e47"]]},{"id":"ab0d0e78.b0d9d8","type":"delay","z":"5d651a81.8ece7c","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2208.859573364258,"y":4060.8040952682495,"wires":[["bc440422.688428"]],"l":false},{"id":"1a107f88.29d75","type":"function","z":"5d651a81.8ece7c","name":"Get 20 Most Common Words for Word Cloud","func":"words = [];\n\nstopwords = [\"a\", \"able\", \"about\",\n        \"across\", \"after\", \"all\", \"almost\", \"also\", \"am\", \"among\", \"an\",\n        \"and\", \"any\", \"are\", \"as\", \"at\", \"b\", \"be\", \"because\", \"been\",\n        \"but\", \"by\", \"c\", \"can\", \"cannot\", \"could\", \"d\", \"dear\", \"did\",\n        \"do\", \"does\", \"e\", \"either\", \"else\", \"ever\", \"every\", \"f\", \"for\",\n        \"from\", \"g\", \"get\", \"got\", \"h\", \"had\", \"has\", \"have\", \"he\", \"her\",\n        \"hers\", \"him\", \"his\", \"how\", \"however\", \"i\", \"if\", \"in\", \"into\",\n        \"is\", \"it\", \"its\", \"j\", \"just\", \"k\", \"l\", \"least\", \"let\", \"like\",\n        \"likely\", \"m\", \"may\", \"me\", \"might\", \"most\", \"must\", \"my\",\n        \"neither\", \"n\", \"no\", \"nor\", \"not\", \"o\", \"of\", \"off\", \"often\",\n        \"on\", \"only\", \"or\", \"other\", \"our\", \"own\", \"p\", \"q\", \"r\", \"rather\",\n        \"s\", \"said\", \"say\", \"says\", \"she\", \"should\", \"since\", \"so\", \"some\",\n        \"t\", \"than\", \"that\", \"the\", \"their\", \"them\", \"then\", \"there\",\n        \"these\", \"they\", \"this\", \"tis\", \"to\", \"too\", \"twas\", \"u\", \"us\",\n        \"v\", \"w\", \"wants\", \"was\", \"we\", \"were\", \"what\", \"when\", \"where\",\n        \"which\", \"while\", \"who\", \"whom\", \"why\", \"will\", \"with\", \"would\",\n        \"x\", \"y\", \"yet\", \"you\", \"your\", \"z\", \"rt\"];\n\nfor(var i =0; i < msg.payload.length; i++){\n    var temp = msg.payload[i]\n    .replace(/[0-9]/g, \"\")\n    .replace(/(?:https?|ftp):\\/\\/[\\n\\S]+/g, \"\")\n    .replace(/[/.,?!:;&()\"'%@|]/g, \"\")\n\n    .toLowerCase()\n    .replace(/\\n/g, \" \")\n    .replace(/-/g, \"\")\n    .replace(/_/g, \"\")\n    .split(\" \");\n    \n    for(var j = 0; j < temp.length; j++){\n        var stopword = stopwords.includes(temp[j]);\n        if(stopword){\n            temp[j] = \"\";\n        }\n        if(temp[j] != \"\"){\n\n            words.push(temp[j]);\n        }\n\n    }\n}\n\nconst map = words.reduce((acc, word) => {\n\n    let count = acc.get(word) || 0;\n    acc.set(word, ++count)\n    return acc;\n  }, new Map());\n  // Sort by counter first from higher to lower. If counter is the same,\n  // then sort by alphabetical order\n  const topk = [...map].sort((a, b) => b[1] - a[1] || a[0].localeCompare(b[0]));\n  // Return array of k most frequent words\n   \n    msg.payload = topk.slice(0, 20);\n    //.map(item => item[0]);\n    \n    var loc_object = []; \n    //.map(item => item[0]);\n    for(var i = 0; i < msg.payload.length; i++){\n        loc_object[i] = {\"x\": msg.payload[i][0], \"value\": msg.payload[i][1]};\n        \n    }\n\n\n\nmsg.payload = loc_object;\n\n\n\n\n//msg.payload = words\nreturn msg;\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1808.822769165039,"y":4273.244709014893,"wires":[["cff4382f.4a8a28"]]},{"id":"b4447acd.34e47","type":"function","z":"5d651a81.8ece7c","name":"Locations Wordcloud ","func":"words = [];\n\nplaces = ['bath',  'birmingham', 'bradford', 'brighton and hove', 'bristol', 'cambridge',  'canterbury', 'carlisle', 'chester', 'chichester', 'coventry', 'derby', 'durham', ' ely ', 'exeter', 'gloucester', 'hereford', 'kingston upon hull', 'lancaster', 'leeds', 'leicester', 'lichfield', 'lincoln', 'liverpool', 'london', 'manchester', 'newcastle upon tyne', 'norwich', 'nottingham', 'oxford', 'peterborough', 'plymouth', 'portsmouth', 'preston', 'ripon', 'salford', 'salisbury', 'sheffield', 'southampton', 'st albans', 'stoke-on-trent', 'sunderland', 'truro', 'wakefield', 'wells', 'westminster', 'winchester', 'wolverhampton', 'worcester', 'york', 'bangor', 'cardiff', 'newport', 'st davids', 'swansea', 'aberdeen', 'dundee', 'edinburgh', 'glasgow', 'inverness', 'stirling', 'armagh', 'belfast', 'londonderry', 'lisburn', 'newry', 'aberdeenshire', 'angus',  'antrim', 'argyll', 'armagh',\n'ayrshire',\n'banffshire',\n'berkshire',\n'berwickshire',\n'bristol',\n'buckinghamshire',\n' bute ',\n'caithness',\n'cambridgeshire',\n'cheshire',\n 'london' ,\n'clackmannanshire',\n'clwyd',\n'cornwall',\n'cumbria',\n'derbyshire',\n'devon',\n'dorset',\n'county down',\n'dumfriesshire',\n'dunbartonshire',\n'durham',\n'dyfed',\n'east lothian',\n'east riding of yorkshire',\n'east sussex',\n'essex',\n'fermanagh',\n'fife',\n'gloucestershire',\n'greater london',\n'greater manchester',\n'gwent',\n'gwynedd',\n'hampshire',\n'herefordshire',\n'hertfordshire',\n'inverness-shire',\n'isle of wight',\n'kent',\n'kincardineshire',\n'kinross-shire',\n'kirkcudbrightshire',\n'lanarkshire',\n'lancashire',\n'leicestershire',\n'lincolnshire',\n'londonderry',\n'merseyside',\n'mid glamorgan',\n'midlothian',\n'moray',\n'nairnshire',\n'norfolk',\n'north yorkshire',\n'northamptonshire',\n'northumberland',\n'nottinghamshire',\n'orkney',\n'oxfordshire',\n'peeblesshire',\n'perthshire',\n'powys',\n'renfrewshire',\n'ross and cromarty',\n'roxburghshire',\n'rutland',\n'selkirkshire',\n'shetland',\n'shropshire',\n'somerset',\n'south glamorgan',\n'south yorkshire',\n'staffordshire',\n'stirlingshire',\n'suffolk',\n'surrey',\n'sutherland',\n'tyne and wear',\n'tyrone',\n'warwickshire',\n'west glamorgan',\n'west lothian',\n'west midlands',\n'west sussex',\n'west yorkshire',\n'wigtownshire',\n'wiltshire',\n'worcestershire']\n\n\n\nfor(var i =0; i < msg.payload.length; i++){\n    var temp = msg.payload[i]\n    .replace(/(?:https?|ftp):\\/\\/[\\n\\S]+/g, \"\")\n    .replace(/[/.,?!:;&()\" ' |@#]/g, \"\")\n    .toLowerCase()\n    .replace(/\\n/g, \" \");\n    //.split(\" \");\n\n    for(var j = 0; j < places.length; j++){\n        var contains = temp.includes(places[j]);\n        if(contains){\n            words.push(places[j]);\n        }\n    }\n}\n\nconst map = words.reduce((acc, word) => {\n\n    let count = acc.get(word) || 0;\n    acc.set(word, ++count)\n    return acc;\n  }, new Map());\n  // Sort by counter first from higher to lower. If counter is the same,\n  // then sort by alphabetical order\n  const top_places = [...map].sort((a, b) => b[1] - a[1] || a[0].localeCompare(b[0]));\n  // Return array of k most frequent words\n   \n    msg.payload = top_places.slice(0, 100);\n    var loc_object = []; \n    //.map(item => item[0]);\n    for(var i = 0; i < msg.payload.length; i++){\n        loc_object[i] = {\"x\": msg.payload[i][0], \"value\": msg.payload[i][1]};\n        \n    }\n\n\n\nmsg.payload = loc_object;\n\n\n\n\nreturn msg;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1737.7114715576172,"y":4320.60852432251,"wires":[["c31f1f72.e7605"]]},{"id":"48febd5a.091cac","type":"function","z":"5d651a81.8ece7c","name":"","func":"msg.finished17 = true; \n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2241.565218925476,"y":4133.653747558594,"wires":[["763a2529.8d7b7c"]],"l":false},{"id":"beb1049d.e3f75","type":"natural-language-understanding","z":"5d651a81.8ece7c","name":"","categories":false,"limitcategories":"8","concepts":false,"maxconcepts":"8","doc-emotion":true,"doc-emotion-target":"","doc-sentiment":false,"doc-sentiment-target":"","entity":false,"entity-emotion":false,"entity-sentiment":false,"maxentities":"50","keyword":false,"keyword-emotion":true,"keyword-sentiment":true,"maxkeywords":"50","metadata":false,"relation":false,"semantic":false,"semantic-entities":true,"semantic-keywords":true,"maxsemantics":"50","limittextcharacters":"0","syntax":false,"syntax-sentences":false,"syntax-tokens-lemma":false,"syntax-tokens-pos":false,"service-endpoint":"https://api.us-south.natural-language-understanding.watson.cloud.ibm.com/instances/3252dc64-1496-4697-bd85-69b0a850cc46","x":2093.565010070801,"y":4221.955888748169,"wires":[["8f9dd69e.49cf"]]},{"id":"763a2529.8d7b7c","type":"function","z":"5d651a81.8ece7c","name":"joy for line graph","func":"var sentiment = global.get('sentimentIBM') || [];\nvar sum = 0;\nfor(var i = 0; i < sentiment.length; i++){\n    sum += sentiment[i];\n}\n\nvar today = new Date();\nvar date = today.getFullYear() + '-' +(today.getMonth()+1) + '-' + today.getDate();\nvar average = 0;\n\nif(sentiment.length > 0){\n    average = sum/sentiment.length; \n}\n\nglobal.set('average_ibm', average); \nvar object = {\"date\": date, \"joy\": average};\nmsg.payload = object; \n\nif(msg.finished17 == true){\n    global.set('still_processing_ibm', false);\n    return msg; \n}\n\nelse{\n    global.set('still_processing_ibm', true);\n    return; \n}\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2460,"y":4320,"wires":[["393f6254.2a54fe"]]},{"id":"8f9dd69e.49cf","type":"function","z":"5d651a81.8ece7c","name":"","func":"msg.payload = msg.features;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2295.322953224182,"y":4221.289329528809,"wires":[["ce575d23.27cb5"]],"l":false},{"id":"ce575d23.27cb5","type":"function","z":"5d651a81.8ece7c","name":"create sentiment array","func":"\n\nvar sentiment = global.get('sentimentIBM') || [];\n\nsentiment.push(msg.features.emotion.document.emotion.joy);\nglobal.set(\"sentimentIBM\", sentiment);\nmsg.payload = sentiment; \n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2455.9593963623047,"y":4216.501239776611,"wires":[["763a2529.8d7b7c"]]},{"id":"dafce75c.7f4a7","type":"function","z":"5d651a81.8ece7c","name":"Store IBM text in database","func":"var text = global.get('ibm_text'); \nmsg.payload = text;\nglobal.set('ibm_text', []); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":280,"y":4340,"wires":[["44cd0f2d.c5ea98"]]},{"id":"42405585.a030a4","type":"function","z":"5d651a81.8ece7c","name":"Store IBM Tweet count","func":"var tweet = global.get('ibm_tweets'); \nmsg.payload = {Tweets: tweet};\nglobal.set('ibm_tweets', 0); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":278,"y":4384.999980926514,"wires":[[]]},{"id":"3c74b998.10e52e","type":"function","z":"5d651a81.8ece7c","name":"Store IBM Retweet count","func":"var tweet = global.get('ibm_retweets'); \nmsg.payload = {Retweets: tweet};\nglobal.set('ibm_retweets', 0); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":270,"y":4438,"wires":[[]]},{"id":"9573cac9.82c4c8","type":"function","z":"5d651a81.8ece7c","name":"Too many tweets (graph)","func":"var still_processing = global.get('still_processing_ibm');\nvar average = global.get('average_ibm'); \nvar today = new Date();\nvar date = today.getFullYear() + '-' +(today.getMonth()+1) + '-' + today.getDate();\n\nif(still_processing == true){\n  var object = {\"date\": date, \"joy\": average};\n  msg.payload = object; \n  global.set('still_processing_ibm', false);\n  return msg;\n        \n}\nmsg.finished = still_processing; \n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":270.9523620605469,"y":4484.571378707886,"wires":[[]]},{"id":"6f563550.5684ac","type":"debug","z":"5d651a81.8ece7c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":4320,"y":1460,"wires":[]},{"id":"473ea3a9.db809c","type":"complete","z":"5d651a81.8ece7c","name":"Process New Tweets for UCL","scope":["393f6254.2a54fe"],"uncaught":false,"x":3090,"y":4140,"wires":[["4f83e89a.4c2be","a13804ef.51fb9"]]},{"id":"a13804ef.51fb9","type":"function","z":"5d651a81.8ece7c","name":"declare sentiment global","func":"global.set('sentimentUC',[]);\n// global.set('tweet_num', msg.payload.length);\n// global.set('IC',true);\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3427.9155807495117,"y":4140.314994812012,"wires":[[]]},{"id":"325e38bb.c6c2e","type":"function","z":"5d651a81.8ece7c","name":"Function for array of strings","func":"var tweets = []; \n\nvar count; \nfor (var i = 0; i < Object.keys(msg.payload[0]).length; i++){\n\n  tweets.push(msg.payload[0][i].x);\n\n  \n}\n\nmsg.payload = tweets;\nreturn msg;\n\n// for(var i = 0; i < Object.keys(ox2[0]).length; i++){\n//   ox_loc.push({\"x\": ox2[0][i].x, \"value\": ox2[0][i].value});\n// }","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3757.850746154785,"y":4080.5921478271484,"wires":[["478606f2.ea60b8"]]},{"id":"8cdcd2b0.5da758","type":"function","z":"5d651a81.8ece7c","name":"Convert to Array of Strings","func":"var tweets = []; \n\nvar count; \nfor (var i = 0; i < Object.keys(msg.payload[0]).length; i++){\n\n  tweets.push(msg.payload[0][i].x);\n\n  \n}\n\nmsg.payload = tweets;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3120.4722747802734,"y":4292.244462966919,"wires":[["3a1adcff.e4a674","3399c8df.009b5"]]},{"id":"478606f2.ea60b8","type":"delay","z":"5d651a81.8ece7c","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":3933.145309448242,"y":4080.8040285110474,"wires":[["99c0ae49.138b8"]],"l":false},{"id":"3a1adcff.e4a674","type":"function","z":"5d651a81.8ece7c","name":"Get 20 Most Common Words for Word Cloud (ucl)","func":"words = [];\n\nstopwords = [\"a\", \"able\", \"about\",\n        \"across\", \"after\", \"all\", \"almost\", \"also\", \"am\", \"among\", \"an\",\n        \"and\", \"any\", \"are\", \"as\", \"at\", \"b\", \"be\", \"because\", \"been\",\n        \"but\", \"by\", \"c\", \"can\", \"cannot\", \"could\", \"d\", \"dear\", \"did\",\n        \"do\", \"does\", \"e\", \"either\", \"else\", \"ever\", \"every\", \"f\", \"for\",\n        \"from\", \"g\", \"get\", \"got\", \"h\", \"had\", \"has\", \"have\", \"he\", \"her\",\n        \"hers\", \"him\", \"his\", \"how\", \"however\", \"i\", \"if\", \"in\", \"into\",\n        \"is\", \"it\", \"its\", \"j\", \"just\", \"k\", \"l\", \"least\", \"let\", \"like\",\n        \"likely\", \"m\", \"may\", \"me\", \"might\", \"most\", \"must\", \"my\",\n        \"neither\", \"n\", \"no\", \"nor\", \"not\", \"o\", \"of\", \"off\", \"often\",\n        \"on\", \"only\", \"or\", \"other\", \"our\", \"own\", \"p\", \"q\", \"r\", \"rather\",\n        \"s\", \"said\", \"say\", \"says\", \"she\", \"should\", \"since\", \"so\", \"some\",\n        \"t\", \"than\", \"that\", \"the\", \"their\", \"them\", \"then\", \"there\",\n        \"these\", \"they\", \"this\", \"tis\", \"to\", \"too\", \"twas\", \"u\", \"us\",\n        \"v\", \"w\", \"wants\", \"was\", \"we\", \"were\", \"what\", \"when\", \"where\",\n        \"which\", \"while\", \"who\", \"whom\", \"why\", \"will\", \"with\", \"would\",\n        \"x\", \"y\", \"yet\", \"you\", \"your\", \"z\", \"rt\"];\n\nfor(var i =0; i < msg.payload.length; i++){\n    var temp = msg.payload[i]\n    .replace(/[0-9]/g, \"\")\n    .replace(/(?:https?|ftp):\\/\\/[\\n\\S]+/g, \"\")\n    .replace(/[/.,?!:;&()\"'%@|]/g, \"\")\n\n    .toLowerCase()\n    .replace(/\\n/g, \" \")\n    .replace(/-/g, \"\")\n    .replace(/_/g, \"\")\n    .split(\" \");\n    \n    for(var j = 0; j < temp.length; j++){\n        var stopword = stopwords.includes(temp[j]);\n        if(stopword){\n            temp[j] = \"\";\n        }\n        if(temp[j] != \"\"){\n\n            words.push(temp[j]);\n        }\n\n    }\n}\n\nconst map = words.reduce((acc, word) => {\n\n    let count = acc.get(word) || 0;\n    acc.set(word, ++count)\n    return acc;\n  }, new Map());\n  // Sort by counter first from higher to lower. If counter is the same,\n  // then sort by alphabetical order\n  const topk = [...map].sort((a, b) => b[1] - a[1] || a[0].localeCompare(b[0]));\n  // Return array of k most frequent words\n   \n    msg.payload = topk.slice(0, 20);\n    //.map(item => item[0]);\n    \n    var loc_object = []; \n    //.map(item => item[0]);\n    for(var i = 0; i < msg.payload.length; i++){\n        loc_object[i] = {\"x\": msg.payload[i][0], \"value\": msg.payload[i][1]};\n        \n    }\n\n\n\nmsg.payload = loc_object;\n\n\n\n\n//msg.payload = words\nreturn msg;\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3553.1085052490234,"y":4293.24464225769,"wires":[["7e95b9ea.d8fc1"]]},{"id":"3399c8df.009b5","type":"function","z":"5d651a81.8ece7c","name":"Locations Wordcloud (ucl)","func":"words = [];\n\nplaces = ['bath',  'birmingham', 'bradford', 'brighton and hove', 'bristol', 'cambridge',  'canterbury', 'carlisle', 'chester', 'chichester', 'coventry', 'derby', 'durham', ' ely ', 'exeter', 'gloucester', 'hereford', 'kingston upon hull', 'lancaster', 'leeds', 'leicester', 'lichfield', 'lincoln', 'liverpool', 'london', 'manchester', 'newcastle upon tyne', 'norwich', 'nottingham', 'oxford', 'peterborough', 'plymouth', 'portsmouth', 'preston', 'ripon', 'salford', 'salisbury', 'sheffield', 'southampton', 'st albans', 'stoke-on-trent', 'sunderland', 'truro', 'wakefield', 'wells', 'westminster', 'winchester', 'wolverhampton', 'worcester', 'york', 'bangor', 'cardiff', 'newport', 'st davids', 'swansea', 'aberdeen', 'dundee', 'edinburgh', 'glasgow', 'inverness', 'stirling', 'armagh', 'belfast', 'londonderry', 'lisburn', 'newry', 'aberdeenshire', 'angus',  'antrim', 'argyll', 'armagh',\n'ayrshire',\n'banffshire',\n'berkshire',\n'berwickshire',\n'bristol',\n'buckinghamshire',\n' bute ',\n'caithness',\n'cambridgeshire',\n'cheshire',\n 'london' ,\n'clackmannanshire',\n'clwyd',\n'cornwall',\n'cumbria',\n'derbyshire',\n'devon',\n'dorset',\n'county down',\n'dumfriesshire',\n'dunbartonshire',\n'durham',\n'dyfed',\n'east lothian',\n'east riding of yorkshire',\n'east sussex',\n'essex',\n'fermanagh',\n'fife',\n'gloucestershire',\n'greater london',\n'greater manchester',\n'gwent',\n'gwynedd',\n'hampshire',\n'herefordshire',\n'hertfordshire',\n'inverness-shire',\n'isle of wight',\n'kent',\n'kincardineshire',\n'kinross-shire',\n'kirkcudbrightshire',\n'lanarkshire',\n'lancashire',\n'leicestershire',\n'lincolnshire',\n'londonderry',\n'merseyside',\n'mid glamorgan',\n'midlothian',\n'moray',\n'nairnshire',\n'norfolk',\n'north yorkshire',\n'northamptonshire',\n'northumberland',\n'nottinghamshire',\n'orkney',\n'oxfordshire',\n'peeblesshire',\n'perthshire',\n'powys',\n'renfrewshire',\n'ross and cromarty',\n'roxburghshire',\n'rutland',\n'selkirkshire',\n'shetland',\n'shropshire',\n'somerset',\n'south glamorgan',\n'south yorkshire',\n'staffordshire',\n'stirlingshire',\n'suffolk',\n'surrey',\n'sutherland',\n'tyne and wear',\n'tyrone',\n'warwickshire',\n'west glamorgan',\n'west lothian',\n'west midlands',\n'west sussex',\n'west yorkshire',\n'wigtownshire',\n'wiltshire',\n'worcestershire']\n\n\n\nfor(var i =0; i < msg.payload.length; i++){\n    var temp = msg.payload[i]\n    .replace(/(?:https?|ftp):\\/\\/[\\n\\S]+/g, \"\")\n    .replace(/[/.,?!:;&()\" ' |@#]/g, \"\")\n    .toLowerCase()\n    .replace(/\\n/g, \" \");\n    //.split(\" \");\n\n    for(var j = 0; j < places.length; j++){\n        var contains = temp.includes(places[j]);\n        if(contains){\n            words.push(places[j]);\n        }\n    }\n}\n\nconst map = words.reduce((acc, word) => {\n\n    let count = acc.get(word) || 0;\n    acc.set(word, ++count)\n    return acc;\n  }, new Map());\n  // Sort by counter first from higher to lower. If counter is the same,\n  // then sort by alphabetical order\n  const top_places = [...map].sort((a, b) => b[1] - a[1] || a[0].localeCompare(b[0]));\n  // Return array of k most frequent words\n   \n    msg.payload = top_places.slice(0, 100);\n    var loc_object = []; \n    //.map(item => item[0]);\n    for(var i = 0; i < msg.payload.length; i++){\n        loc_object[i] = {\"x\": msg.payload[i][0], \"value\": msg.payload[i][1]};\n        \n    }\n\n\n\nmsg.payload = loc_object;\n\n\n\n\nreturn msg;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3481.9972076416016,"y":4340.608457565308,"wires":[["7544b8e7.3344e8"]]},{"id":"7ac224f9.470d9c","type":"function","z":"5d651a81.8ece7c","name":"","func":"msg.finished11 = true; \n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3965.8509550094604,"y":4153.653680801392,"wires":[["21257cd1.8386e4","f811d8d2.98d39"]],"l":false},{"id":"d6c83c98.f311e8","type":"natural-language-understanding","z":"5d651a81.8ece7c","name":"","categories":false,"limitcategories":"8","concepts":false,"maxconcepts":"8","doc-emotion":true,"doc-emotion-target":"","doc-sentiment":false,"doc-sentiment-target":"","entity":false,"entity-emotion":false,"entity-sentiment":false,"maxentities":"50","keyword":false,"keyword-emotion":true,"keyword-sentiment":true,"maxkeywords":"50","metadata":false,"relation":false,"semantic":false,"semantic-entities":true,"semantic-keywords":true,"maxsemantics":"50","limittextcharacters":"0","syntax":false,"syntax-sentences":false,"syntax-tokens-lemma":false,"syntax-tokens-pos":false,"service-endpoint":"https://api.us-south.natural-language-understanding.watson.cloud.ibm.com/instances/3252dc64-1496-4697-bd85-69b0a850cc46","x":3817.850746154785,"y":4241.955821990967,"wires":[["8014a8df.fed308"]]},{"id":"21257cd1.8386e4","type":"function","z":"5d651a81.8ece7c","name":"avg joy","func":"var sentiment = global.get('sentimentUC') || [];\nvar sum = 0;\nfor(var i = 0; i < sentiment.length; i++){\n    sum += sentiment[i];\n}\n\n\n\nvar average = 0;\n\nif(sentiment.length > 0){\n    average = sum/sentiment.length; \n}\n\nmsg.payload = {\"Mood\": average};\nmsg.average = average; \n\nif(msg.finished11 == true){\n    \n    return msg; \n}\nelse{\n\n    return; \n}\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4134.062854766846,"y":4152.895324707031,"wires":[["fa55c68.df37538","d3e2cfc1.50a95"]]},{"id":"f811d8d2.98d39","type":"function","z":"5d651a81.8ece7c","name":"joy for line graph","func":"var sentiment = global.get('sentimentUC') || [];\nvar sum = 0;\nfor(var i = 0; i < sentiment.length; i++){\n    sum += sentiment[i];\n}\n\nvar today = new Date();\nvar date = today.getFullYear() + '-' +(today.getMonth()+1) + '-' + today.getDate();\nvar average = 0;\n\nif(sentiment.length > 0){\n    average = sum/sentiment.length; \n}\n\nglobal.set('average_ucl', average); \nvar object = {\"date\": date, \"joy\": average};\nmsg.payload = object; \n\nif(msg.finished11 == true){\n    global.set('still_processing_ucl', false);\n    return msg; \n}\n\nelse{\n    global.set('still_processing_ucl', true);\n    return; \n}\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4215.751354217529,"y":4340.1070766448975,"wires":[["8f39ba53.94227"]]},{"id":"8014a8df.fed308","type":"function","z":"5d651a81.8ece7c","name":"","func":"msg.payload = msg.features;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4019.6086893081665,"y":4241.289262771606,"wires":[["d6311145.ae0348"]],"l":false},{"id":"d6311145.ae0348","type":"function","z":"5d651a81.8ece7c","name":"create sentiment array","func":"\n\nvar sentiment = global.get('sentimentUC') || [];\n\nsentiment.push(msg.features.emotion.document.emotion.joy);\nglobal.set(\"sentimentUC\", sentiment);\nmsg.payload = sentiment; \n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4180.245132446289,"y":4236.501173019409,"wires":[["21257cd1.8386e4","f811d8d2.98d39"]]},{"id":"d3e2cfc1.50a95","type":"function","z":"5d651a81.8ece7c","name":"ColorFunction","func":"var average = msg.average;\n// var average = 0.1;\n\nif(0 <= average && average < 0.2){\n    msg.payload = {\n        normal: {\n            fill: \"#cc2316  0.3\",\n            stroke: \"#cc2316\"\n        }\n    };\n    return msg;\n}else if(0.2 <= average && average < 0.4){\n    msg.payload = {\n        normal: {\n            fill: \"#fc7600  0.3\",\n            stroke: \"#fc7600\"\n        }\n    };\n    return msg;\n}else if(0.4 <= average && average < 0.6){\n    msg.payload = {\n        normal: {\n            fill: \"#fbff00  0.3\",\n            stroke: \"#fbff00\"\n        }\n    };\n    return msg;\n}else if(0.6 <= average && average < 0.8){\n    msg.payload = {\n        normal: {\n            fill: \"#00ff11  0.3\",\n            stroke: \"#00ff11\"\n        }\n    };\n    return msg;\n}else if(0.8 <= average && average <= 1){\n    msg.payload = {\n        normal: {\n            fill: \"#049cfc  0.3\",\n            stroke: \"#049cfc\"\n        }\n    };\n    return msg;\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4338.2661781311035,"y":4102.7435131073,"wires":[["9a7e3219.81d198"]]},{"id":"8fa6e756.74601","type":"function","z":"5d651a81.8ece7c","name":"","func":"msg.payload = {\"Mood\": \"Retrieving Sentiment Information\"}; \n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":175,"y":4600,"wires":[["9fc49658.d55eb8"]],"l":false},{"id":"26ddb8b3.3b76","type":"function","z":"5d651a81.8ece7c","name":"","func":"msg.payload = {\"Mood\": \"Retrieving Sentiment Information\"}; \n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":175,"y":4640,"wires":[["cee57182.811c98"]],"l":false},{"id":"9f9dea54.98ccd","type":"function","z":"5d651a81.8ece7c","name":"","func":"msg.payload = {\"Mood\": \"Retrieving Sentiment Information\"}; \n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":175,"y":4680,"wires":[["912ac91f.c876a8"]],"l":false},{"id":"f7a41bb3.40fd2","type":"function","z":"5d651a81.8ece7c","name":"","func":"msg.payload = {\"Mood\": \"Retrieving Sentiment Information\"}; \n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":175,"y":4720,"wires":[["d3719047.2f948"]],"l":false},{"id":"33b3d545.300d2a","type":"function","z":"5d651a81.8ece7c","name":"","func":"msg.payload = {\"Mood\": \"Retrieving Sentiment Information\"}; \n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":175,"y":4760,"wires":[["abe325ac.813b58"]],"l":false},{"id":"54bef6d6.66d888","type":"function","z":"5d651a81.8ece7c","name":"","func":"msg.payload = {\"Mood\": \"Retrieving Sentiment Information\"}; \n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":175,"y":4800,"wires":[["3849c300.63a91e"]],"l":false},{"id":"e888e6d8.a35638","type":"function","z":"5d651a81.8ece7c","name":"","func":"msg.payload = {\"Mood\": \"Retrieving Sentiment Information\"}; \n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":175,"y":4840,"wires":[["6f936b01.7556ec"]],"l":false},{"id":"12833367.1c042d","type":"function","z":"5d651a81.8ece7c","name":"","func":"msg.payload = {\"Mood\": \"Retrieving Sentiment Information\"}; \n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":175,"y":4880,"wires":[["c0ae957d.7020f8"]],"l":false},{"id":"b907e6f9.8940d","type":"function","z":"5d651a81.8ece7c","name":"","func":"msg.payload = {\"Mood\": \"Retrieving Sentiment Information\"}; \n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":175,"y":4920,"wires":[["b7b6c2f7.e161b"]],"l":false},{"id":"17388928.9622b7","type":"function","z":"5d651a81.8ece7c","name":"","func":"msg.payload = {\"Mood\": \"Retrieving Sentiment Information\"}; \n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":175,"y":4960,"wires":[["d7d7db85.e9dba"]],"l":false},{"id":"e48da671.cb0d78","type":"function","z":"5d651a81.8ece7c","name":"","func":"msg.payload = {\"Mood\": \"Retrieving Sentiment Information\"}; \n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":175,"y":4560,"wires":[["cf127483.c01b98"]],"l":false},{"id":"d44d8f99.a5746","type":"function","z":"5d651a81.8ece7c","name":"","func":"msg.payload = {\"Mood\": \"Retrieving Sentiment Information\"}; \n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":635,"y":4560,"wires":[["b8758fa2.e16ca8"]],"l":false},{"id":"85411b48.a4e638","type":"function","z":"5d651a81.8ece7c","name":"","func":"msg.payload = {\"Mood\": \"Retrieving Sentiment Information\"}; \n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":635,"y":4600,"wires":[["1e15c89d.23440f"]],"l":false},{"id":"c9d894b2.e7ef9","type":"function","z":"5d651a81.8ece7c","name":"","func":"msg.payload = {\"Mood\": \"Retrieving Sentiment Information\"}; \n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":635,"y":4640,"wires":[["1f6bdcf3.e07253"]],"l":false},{"id":"bdb2c5ad.b1ce98","type":"function","z":"5d651a81.8ece7c","name":"","func":"msg.payload = {\"Mood\": \"Retrieving Sentiment Information\"}; \n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":635,"y":4680,"wires":[["b4300a95.42e0c8"]],"l":false},{"id":"c17f054d.5831b8","type":"function","z":"5d651a81.8ece7c","name":"Store Search Tweet count","func":"var tweet = global.get('search_tweets'); \nmsg.payload = {Tweets: tweet};\nglobal.set('search_tweets', 0); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1720,"y":440,"wires":[["a1800994.eab7a"]]},{"id":"c078827a.625bf","type":"function","z":"5d651a81.8ece7c","name":"Store Search Retweet count","func":"var tweet = global.get('search_retweets'); \nmsg.payload = {Retweets: tweet};\nglobal.set('search_retweets', 0); \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1722,"y":493.0000190734863,"wires":[["a028315e.1080a"]]},{"id":"96aa36eb.2dd4e","type":"function","z":"5d651a81.8ece7c","name":"Tweet Count","func":"var t = global.get('search_tweets'); \n\n\nif(msg.tweet.retweeted_status == null){\n    t++;\n}\nglobal.set('search_tweets', t); \nreturn msg;\n\n    \n      \n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":840,"y":80,"wires":[[]]},{"id":"fae99dc1.c064f8","type":"function","z":"5d651a81.8ece7c","name":"Retweet Count","func":"var rt = global.get('search_retweets'); \nvar icl_push = global.get('icl_push'); \n\n\nif(msg.tweet.retweeted_status != null){\n    rt++;\n}\nglobal.set('search_retweets', rt); \nreturn msg;\n\n    \n      \n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":849,"y":143,"wires":[[]]},{"id":"35ff3fb0.c4623","type":"Firestore out","z":"5d651a81.8ece7c","name":"Average Joy for Map","collection":"University","document":"Imperial College London","operation":"update","admin":"37634fe.5055fb","eject":false,"x":2595.098846435547,"y":1185.2731552124023,"wires":[[]]},{"id":"67be27b4.a36ae","type":"Firestore out","z":"5d651a81.8ece7c","name":"","collection":"Line Graphs ICL","document":"","operation":"add","admin":"37634fe.5055fb","eject":false,"x":2700,"y":1360,"wires":[[]]},{"id":"c95b7c78.16c5b8","type":"Firestore out","z":"5d651a81.8ece7c","name":"","collection":"location icl","document":"Locations","operation":"set","admin":"37634fe.5055fb","eject":false,"x":1952.8119773864746,"y":1373.349585533142,"wires":[[]]},{"id":"6b2b08dd.f2fbc","type":"Firestore out","z":"5d651a81.8ece7c","name":"","collection":"20 icl","document":"Words","operation":"set","admin":"37634fe.5055fb","eject":false,"x":2169.539306640625,"y":1326.9859619140625,"wires":[[]]},{"id":"608b135.252d9ec","type":"Firestore out","z":"5d651a81.8ece7c","name":"ICL Tweets","collection":"Imperial College Tweets","document":"Imperial College","operation":"set","admin":"37634fe.5055fb","eject":false,"x":580.7142791748047,"y":539.9999992847443,"wires":[[]]},{"id":"f8cb026b.c1a138","type":"Firestore out","z":"5d651a81.8ece7c","name":"Update Tweets icl","collection":"University","document":"Imperial College London","operation":"update","admin":"37634fe.5055fb","eject":false,"x":599.7142791748047,"y":586.9999992847443,"wires":[[]]},{"id":"8a04a2ba.2ae0b","type":"Firestore out","z":"5d651a81.8ece7c","name":"Update Retweets icl ","collection":"University","document":"Imperial College London","operation":"update","admin":"37634fe.5055fb","eject":false,"x":610.7142791748047,"y":637.9999992847443,"wires":[[]]},{"id":"4d4551f2.a0bfb8","type":"Firestore out","z":"5d651a81.8ece7c","name":"line icl 2","collection":"Line Graphs ICL","document":"","operation":"add","admin":"37634fe.5055fb","eject":false,"x":572.952392578125,"y":684.5713787078857,"wires":[[]]},{"id":"5acaf130.b11cd8","type":"Firestore out","z":"5d651a81.8ece7c","name":"Colour","collection":"University","document":"Imperial College London","operation":"update","admin":"37634fe.5055fb","eject":false,"x":2738.818115234375,"y":1139.181884765625,"wires":[[]]},{"id":"8a93edba.0d157","type":"Firestore out","z":"5d651a81.8ece7c","name":"Search Tweets","collection":"Search Tweets","document":"Search","operation":"set","admin":"37634fe.5055fb","eject":false,"x":1008,"y":359,"wires":[[]]},{"id":"779765.0506409c","type":"Firestore out","z":"5d651a81.8ece7c","name":"Firestore - updating info","collection":"Search Sentiment","document":"Sentiment","operation":"update","admin":"37634fe.5055fb","eject":false,"x":1821.357421875,"y":568.5713806152344,"wires":[[]]},{"id":"a821541.2ea14a8","type":"Firestore out","z":"5d651a81.8ece7c","name":"","collection":"20 search","document":"Words","operation":"set","admin":"37634fe.5055fb","eject":false,"x":2825.714599609375,"y":876.5476684570312,"wires":[[]]},{"id":"755461bb.11443","type":"Firestore out","z":"5d651a81.8ece7c","name":"","collection":"location search","document":"Locations","operation":"set","admin":"37634fe.5055fb","eject":false,"x":2865.714599609375,"y":924.5476684570312,"wires":[[]]},{"id":"8d21ec43.96b3","type":"Firestore out","z":"5d651a81.8ece7c","name":"Search Sentiment","collection":"Search Sentiment","document":"Sentiment","operation":"update","admin":"37634fe.5055fb","eject":false,"x":2923,"y":689.0000610351562,"wires":[[]]},{"id":"95fe5d8c.76b5e","type":"Firestore out","z":"5d651a81.8ece7c","name":"","collection":"20 ox","document":"Words","operation":"set","admin":"37634fe.5055fb","eject":false,"x":3720.7100830078125,"y":1332.8858633041382,"wires":[[]]},{"id":"f99ddcf1.da2c78","type":"Firestore out","z":"5d651a81.8ece7c","name":"","collection":"location ox","document":"Locations","operation":"set","admin":"37634fe.5055fb","eject":false,"x":3595.982563018799,"y":1379.4717378616333,"wires":[[]]},{"id":"5cb0a996.cbc1c8","type":"Firestore out","z":"5d651a81.8ece7c","name":"Average Joy for Map","collection":"University","document":"University of Oxford","operation":"update","admin":"37634fe.5055fb","eject":false,"x":4238.269432067871,"y":1191.3953075408936,"wires":[[]]},{"id":"44e5fe6c.3d2aa","type":"Firestore out","z":"5d651a81.8ece7c","name":"","collection":"Line Graphs Ox","document":"","operation":"add","admin":"37634fe.5055fb","eject":false,"x":4330.845756530762,"y":1379.0930624008179,"wires":[[]]},{"id":"e2122030.889d5","type":"Firestore out","z":"5d651a81.8ece7c","name":"Colour","collection":"University","document":"University of Oxford","operation":"update","admin":"37634fe.5055fb","eject":false,"x":4381.988700866699,"y":1145.3040370941162,"wires":[[]]},{"id":"fcaadaf8.6b08c","type":"Firestore out","z":"5d651a81.8ece7c","name":"OxTweets","collection":"Oxford University Tweets","document":"Oxford","operation":"set","admin":"37634fe.5055fb","eject":false,"x":582.5555267333984,"y":748.682461977005,"wires":[[]]},{"id":"a69384f5.83a29","type":"Firestore out","z":"5d651a81.8ece7c","name":"Update Tweets Ox","collection":"University","document":"University of Oxford","operation":"update","admin":"37634fe.5055fb","eject":false,"x":621.5555267333984,"y":795.682461977005,"wires":[[]]},{"id":"ee12b22.202565","type":"Firestore out","z":"5d651a81.8ece7c","name":"Update Retweets Ox","collection":"University","document":"University of Oxford","operation":"update","admin":"37634fe.5055fb","eject":false,"x":632.5555267333984,"y":846.682461977005,"wires":[[]]},{"id":"53fa24b2.48e634","type":"Firestore out","z":"5d651a81.8ece7c","name":"line ox 2","collection":"Line Graphs Ox ","document":"","operation":"add","admin":"37634fe.5055fb","eject":false,"x":574.7936401367188,"y":893.2538414001465,"wires":[[]]},{"id":"d8aa3801.96db28","type":"Firestore out","z":"5d651a81.8ece7c","name":"","collection":"20 bham","document":"Words","operation":"set","admin":"37634fe.5055fb","eject":false,"x":2139.1693115234375,"y":1692.507080078125,"wires":[[]]},{"id":"9d637833.473288","type":"Firestore out","z":"5d651a81.8ece7c","name":"","collection":"location bham","document":"Locations","operation":"set","admin":"37634fe.5055fb","eject":false,"x":1964.4418449401855,"y":1739.0930070877075,"wires":[[]]},{"id":"eb00cbc9.27424","type":"Firestore out","z":"5d651a81.8ece7c","name":"Average Joy for Map","collection":"University","document":"University of Birmingham","operation":"update","admin":"37634fe.5055fb","eject":false,"x":2586.728713989258,"y":1551.0165767669678,"wires":[[]]},{"id":"bce9556f.3ccb1","type":"Firestore out","z":"5d651a81.8ece7c","name":"","collection":"Line Graphs Birmingham","document":"","operation":"add","admin":"37634fe.5055fb","eject":false,"x":2719.3050384521484,"y":1738.714331626892,"wires":[[]]},{"id":"f43b59c1.b02df8","type":"Firestore out","z":"5d651a81.8ece7c","name":"Colour","collection":"University","document":"University of Birmingham","operation":"update","admin":"37634fe.5055fb","eject":false,"x":2730.447982788086,"y":1504.9253063201904,"wires":[[]]},{"id":"575c2ea4.b27568","type":"Firestore out","z":"5d651a81.8ece7c","name":"Bham Tweets","collection":"University of Birmingham Tweets","document":"Birmingham","operation":"set","admin":"37634fe.5055fb","eject":false,"x":579.9999847412109,"y":960.57137799263,"wires":[[]]},{"id":"f496dff.ede542","type":"Firestore out","z":"5d651a81.8ece7c","name":"Update Tweets Bham","collection":"University","document":"University of Birmingham","operation":"update","admin":"37634fe.5055fb","eject":false,"x":608.9999847412109,"y":1007.57137799263,"wires":[[]]},{"id":"83520da1.bd16c","type":"Firestore out","z":"5d651a81.8ece7c","name":"Update Retweets Bham","collection":"University","document":"University of Birmingham","operation":"update","admin":"37634fe.5055fb","eject":false,"x":619.9999847412109,"y":1058.57137799263,"wires":[[]]},{"id":"8da01a12.938e3","type":"Firestore out","z":"5d651a81.8ece7c","name":"line bham 2","collection":"Line Graphs Bham","document":"","operation":"add","admin":"37634fe.5055fb","eject":false,"x":572.2380981445312,"y":1105.1427574157715,"wires":[[]]},{"id":"f7ab7f0.8fe96","type":"Firestore out","z":"5d651a81.8ece7c","name":"","collection":"20 bristol","document":"Words","operation":"set","admin":"37634fe.5055fb","eject":false,"x":3861.1693115234375,"y":1686.507080078125,"wires":[[]]},{"id":"70bbe67a.7a646","type":"Firestore out","z":"5d651a81.8ece7c","name":"","collection":"location bristol","document":"Locations","operation":"set","admin":"37634fe.5055fb","eject":false,"x":3676.4418449401855,"y":1733.0930070877075,"wires":[[]]},{"id":"cc75a97c.ba424","type":"Firestore out","z":"5d651a81.8ece7c","name":"Average Joy for Map","collection":"University","document":"University of Bristol","operation":"update","admin":"37634fe.5055fb","eject":false,"x":4298.728713989258,"y":1545.0165767669678,"wires":[[]]},{"id":"406d1f52.e087b","type":"Firestore out","z":"5d651a81.8ece7c","name":"","collection":"Line Graphs Bristol","document":"","operation":"add","admin":"37634fe.5055fb","eject":false,"x":4411.305038452148,"y":1732.714331626892,"wires":[[]]},{"id":"696637e.4a97bc8","type":"Firestore out","z":"5d651a81.8ece7c","name":"Colour","collection":"University","document":"University of Bristol","operation":"update","admin":"37634fe.5055fb","eject":false,"x":4442.447982788086,"y":1498.9253063201904,"wires":[[]]},{"id":"8bd7d19f.946368","type":"Firestore out","z":"5d651a81.8ece7c","name":"Bristol Tweets","collection":"University of Bristol Tweets","document":"Bristol","operation":"set","admin":"37634fe.5055fb","eject":false,"x":567.9999847412109,"y":1172.57137799263,"wires":[[]]},{"id":"69ab6e65.73e8c8","type":"Firestore out","z":"5d651a81.8ece7c","name":"Update Tweets Bristol","collection":"University","document":"University of Bristol","operation":"update","admin":"37634fe.5055fb","eject":false,"x":596.9999847412109,"y":1219.57137799263,"wires":[[]]},{"id":"ace35440.a7f29","type":"Firestore out","z":"5d651a81.8ece7c","name":"Update Retweets Bristol","collection":"University","document":"University of Bristol","operation":"update","admin":"37634fe.5055fb","eject":false,"x":607.9999847412109,"y":1270.57137799263,"wires":[[]]},{"id":"7475feb2.886cd8","type":"Firestore out","z":"5d651a81.8ece7c","name":"line bristol 2","collection":"Line Graphs Bristol","document":"","operation":"add","admin":"37634fe.5055fb","eject":false,"x":560.2380981445312,"y":1317.1427574157715,"wires":[[]]},{"id":"62ee1de8.676f04","type":"Firestore out","z":"5d651a81.8ece7c","name":"","collection":"20 cam","document":"Words","operation":"set","admin":"37634fe.5055fb","eject":false,"x":2138.030288696289,"y":2146.262617111206,"wires":[[]]},{"id":"735f7191.b2c828","type":"Firestore out","z":"5d651a81.8ece7c","name":"","collection":"location cam","document":"Locations","operation":"set","admin":"37634fe.5055fb","eject":false,"x":2005.6104736328125,"y":2191.310277938843,"wires":[[]]},{"id":"2db4d0eb.5b3098","type":"Firestore out","z":"5d651a81.8ece7c","name":"Average Joy for Map","collection":"University","document":"University of Cambridge","operation":"update","admin":"37634fe.5055fb","eject":false,"x":2585.5896911621094,"y":2004.7721138000488,"wires":[[]]},{"id":"47ad45d2.dd0b94","type":"Firestore out","z":"5d651a81.8ece7c","name":"","collection":"Line Graphs Cambridge","document":"","operation":"add","admin":"37634fe.5055fb","eject":false,"x":2718.166015625,"y":2192.469868659973,"wires":[[]]},{"id":"979d1ab4.11ab6","type":"Firestore out","z":"5d651a81.8ece7c","name":"Colour","collection":"University","document":"University of Cambridge","operation":"update","admin":"37634fe.5055fb","eject":false,"x":2729.3089599609375,"y":1958.6808433532715,"wires":[[]]},{"id":"d5c7adf7.343828","type":"Firestore out","z":"5d651a81.8ece7c","name":"Cambridge Tweets","collection":"University of Cambridge Tweets","document":"Cambridge","operation":"set","admin":"37634fe.5055fb","eject":false,"x":597.5983276367188,"y":1398.93913936615,"wires":[[]]},{"id":"e3512686.6cc8a8","type":"Firestore out","z":"5d651a81.8ece7c","name":"Update Tweets Cambridge","collection":"University","document":"University of Cambridge","operation":"update","admin":"37634fe.5055fb","eject":false,"x":626.5983276367188,"y":1445.93913936615,"wires":[[]]},{"id":"19930e92.474b11","type":"Firestore out","z":"5d651a81.8ece7c","name":"Update Retweets Cambridge","collection":"University","document":"University of Cambridge","operation":"update","admin":"37634fe.5055fb","eject":false,"x":637.5983276367188,"y":1496.93913936615,"wires":[[]]},{"id":"79bb281f.7c08f","type":"Firestore out","z":"5d651a81.8ece7c","name":"line cam 2","collection":"Line Graphs Cambridge","document":"","operation":"add","admin":"37634fe.5055fb","eject":false,"x":579.8364410400391,"y":1543.5105187892914,"wires":[[]]},{"id":"1552c91a.85f16f","type":"Firestore out","z":"5d651a81.8ece7c","name":"Cardiff Tweets","collection":"University of Cardiff Tweets","document":"Cardiff","operation":"set","admin":"37634fe.5055fb","eject":false,"x":576.3717651367188,"y":1621.3361120224,"wires":[[]]},{"id":"3c438dc3.86a582","type":"Firestore out","z":"5d651a81.8ece7c","name":"Update Tweets Cardiff","collection":"University","document":"University of Cardiff","operation":"update","admin":"37634fe.5055fb","eject":false,"x":605.3717651367188,"y":1668.3361120224,"wires":[[]]},{"id":"fdd46ab4.e732c8","type":"Firestore out","z":"5d651a81.8ece7c","name":"Update Retweets Cardiff","collection":"University","document":"University of Cardiff","operation":"update","admin":"37634fe.5055fb","eject":false,"x":616.3717651367188,"y":1719.3361120224,"wires":[[]]},{"id":"819c6699.56b03","type":"Firestore out","z":"5d651a81.8ece7c","name":"line card 2","collection":"Line Graphs Cardiff","document":"","operation":"add","admin":"37634fe.5055fb","eject":false,"x":568.6098785400391,"y":1765.9074914455414,"wires":[[]]},{"id":"d2d7b693.69bf8","type":"Firestore out","z":"5d651a81.8ece7c","name":"","collection":"20 cardiff","document":"Words","operation":"set","admin":"37634fe.5055fb","eject":false,"x":3870.710708618164,"y":2115.740888595581,"wires":[[]]},{"id":"5659993c.4da2e8","type":"Firestore out","z":"5d651a81.8ece7c","name":"","collection":"location cardiff","document":"Locations","operation":"set","admin":"37634fe.5055fb","eject":false,"x":3738.2908935546875,"y":2160.788549423218,"wires":[[]]},{"id":"e805554b.5fcb98","type":"Firestore out","z":"5d651a81.8ece7c","name":"Average Joy for Map","collection":"University","document":"University of Cardiff","operation":"update","admin":"37634fe.5055fb","eject":false,"x":4308.27001953125,"y":1974.2503662109375,"wires":[[]]},{"id":"2ebb293b.c9a086","type":"Firestore out","z":"5d651a81.8ece7c","name":"","collection":"Line Graphs Cardiff","document":"","operation":"add","admin":"37634fe.5055fb","eject":false,"x":4420.846435546875,"y":2161.948140144348,"wires":[[]]},{"id":"2ea4f8f0.3d66f8","type":"Firestore out","z":"5d651a81.8ece7c","name":"Colour","collection":"University","document":"University of Cardiff","operation":"update","admin":"37634fe.5055fb","eject":false,"x":4451.9893798828125,"y":1928.1591148376465,"wires":[[]]},{"id":"d9288a2e.dfaf1","type":"Firestore out","z":"5d651a81.8ece7c","name":"","collection":"20 durham","document":"Words","operation":"set","admin":"37634fe.5055fb","eject":false,"x":2162.697036743164,"y":2516.262617111206,"wires":[[]]},{"id":"2614bfca.2c69a8","type":"Firestore out","z":"5d651a81.8ece7c","name":"","collection":"location durham","document":"Locations","operation":"set","admin":"37634fe.5055fb","eject":false,"x":2030.2772216796875,"y":2561.310277938843,"wires":[[]]},{"id":"ef6501.fc901b","type":"Firestore out","z":"5d651a81.8ece7c","name":"Average Joy for Map","collection":"University","document":"University of Durham","operation":"update","admin":"37634fe.5055fb","eject":false,"x":2600.25634765625,"y":2374.7720947265625,"wires":[[]]},{"id":"6ebd084d.47d508","type":"Firestore out","z":"5d651a81.8ece7c","name":"","collection":"Line Graphs Durham","document":"","operation":"add","admin":"37634fe.5055fb","eject":false,"x":2712.832763671875,"y":2562.469868659973,"wires":[[]]},{"id":"a2a115.2afd16e8","type":"Firestore out","z":"5d651a81.8ece7c","name":"Colour","collection":"University","document":"University of Durham","operation":"update","admin":"37634fe.5055fb","eject":false,"x":2743.9757080078125,"y":2328.6808433532715,"wires":[[]]},{"id":"21604d23.fd9b12","type":"Firestore out","z":"5d651a81.8ece7c","name":"Durham Tweets","collection":"University of Durham Tweets","document":"Durham","operation":"set","admin":"37634fe.5055fb","eject":false,"x":580.4444580078125,"y":1831.016043663025,"wires":[[]]},{"id":"4def9722.5efc28","type":"Firestore out","z":"5d651a81.8ece7c","name":"Update Tweets Durham","collection":"University","document":"University of Durham","operation":"update","admin":"37634fe.5055fb","eject":false,"x":609.4444580078125,"y":1878.016043663025,"wires":[[]]},{"id":"35041bc2.792ecc","type":"Firestore out","z":"5d651a81.8ece7c","name":"Update Retweets Durham","collection":"University","document":"University of Durham","operation":"update","admin":"37634fe.5055fb","eject":false,"x":620.4444580078125,"y":1929.016043663025,"wires":[[]]},{"id":"b3589e8a.025d38","type":"Firestore out","z":"5d651a81.8ece7c","name":"line durham 2","collection":"Line Graphs Durham","document":"","operation":"add","admin":"37634fe.5055fb","eject":false,"x":572.6825714111328,"y":1975.5874230861664,"wires":[[]]},{"id":"31a8db32.a7b224","type":"Firestore out","z":"5d651a81.8ece7c","name":"Edinburgh Tweets","collection":"University of Edinburgh Tweets","document":"Edinburgh ","operation":"set","admin":"37634fe.5055fb","eject":false,"x":632.4444122314453,"y":2053.0160443782806,"wires":[[]]},{"id":"f0b0e9b0.5c8f","type":"Firestore out","z":"5d651a81.8ece7c","name":"Update Tweets Edinburgh ","collection":"University","document":"University of Edinburgh","operation":"update","admin":"37634fe.5055fb","eject":false,"x":611.4444580078125,"y":2100.016043663025,"wires":[[]]},{"id":"56165339.32df94","type":"Firestore out","z":"5d651a81.8ece7c","name":"Update Retweets Edinburgh","collection":"University","document":"University of Edinburgh","operation":"update","admin":"37634fe.5055fb","eject":false,"x":622.4444580078125,"y":2151.016043663025,"wires":[[]]},{"id":"21b6ce46.13fc7a","type":"Firestore out","z":"5d651a81.8ece7c","name":"line edin 2","collection":"Line Graphs Edinburgh","document":"","operation":"add","admin":"37634fe.5055fb","eject":false,"x":554.6825714111328,"y":2189.5873334407806,"wires":[[]]},{"id":"b4e0a41e.10d168","type":"Firestore out","z":"5d651a81.8ece7c","name":"","collection":"20 edin","document":"Words","operation":"set","admin":"37634fe.5055fb","eject":false,"x":3876.697036743164,"y":2516.262617111206,"wires":[[]]},{"id":"7ee23f86.3b2958","type":"Firestore out","z":"5d651a81.8ece7c","name":"","collection":"location edin","document":"Locations","operation":"set","admin":"37634fe.5055fb","eject":false,"x":3744.2772216796875,"y":2561.310277938843,"wires":[[]]},{"id":"50ad19ee.af578","type":"Firestore out","z":"5d651a81.8ece7c","name":"Average Joy for Map","collection":"University","document":"University of Edinburgh","operation":"update","admin":"37634fe.5055fb","eject":false,"x":4324.25634765625,"y":2374.7720947265625,"wires":[[]]},{"id":"155a87bd.dfc638","type":"Firestore out","z":"5d651a81.8ece7c","name":"","collection":"Line Graphs Edinburgh","document":"","operation":"add","admin":"37634fe.5055fb","eject":false,"x":4446.832763671875,"y":2562.469868659973,"wires":[[]]},{"id":"ef52651c.c05108","type":"Firestore out","z":"5d651a81.8ece7c","name":"Colour","collection":"University","document":"University of Edinburgh","operation":"update","admin":"37634fe.5055fb","eject":false,"x":4467.9757080078125,"y":2328.6808433532715,"wires":[[]]},{"id":"302850c8.ceeac8","type":"Firestore out","z":"5d651a81.8ece7c","name":"Exeter Tweets","collection":"University of Exeter Tweets","document":"Exeter","operation":"set","admin":"37634fe.5055fb","eject":false,"x":606.4444122314453,"y":2283.0160443782806,"wires":[[]]},{"id":"8768a0a0.7d5a7","type":"Firestore out","z":"5d651a81.8ece7c","name":"Update Tweets Exeter","collection":"University","document":"University of Exeter","operation":"update","admin":"37634fe.5055fb","eject":false,"x":585.4444580078125,"y":2330.016043663025,"wires":[[]]},{"id":"fbea27d5.c280a8","type":"Firestore out","z":"5d651a81.8ece7c","name":"Update Retweets Exeter","collection":"University","document":"University of Exeter","operation":"update","admin":"37634fe.5055fb","eject":false,"x":596.4444580078125,"y":2381.016043663025,"wires":[[]]},{"id":"ea225d43.e5956","type":"Firestore out","z":"5d651a81.8ece7c","name":"add line exeter 2","collection":"Line Graphs Exeter","document":"","operation":"add","admin":"37634fe.5055fb","eject":false,"x":568.6825714111328,"y":2427.5874230861664,"wires":[[]]},{"id":"51249dfa.d26dcc","type":"Firestore out","z":"5d651a81.8ece7c","name":"","collection":"20 ex","document":"Words","operation":"set","admin":"37634fe.5055fb","eject":false,"x":2153.312026977539,"y":2886.364179611206,"wires":[[]]},{"id":"737f78d0.bcb5e","type":"Firestore out","z":"5d651a81.8ece7c","name":"","collection":"location ex","document":"Locations","operation":"set","admin":"37634fe.5055fb","eject":false,"x":2020.8922119140625,"y":2931.411840438843,"wires":[[]]},{"id":"993851e2.6a11a8","type":"Firestore out","z":"5d651a81.8ece7c","name":"Average Joy for Map","collection":"University","document":"University of Exeter","operation":"update","admin":"37634fe.5055fb","eject":false,"x":2610.871337890625,"y":2744.8736572265625,"wires":[[]]},{"id":"38e278a3.1a9ed","type":"Firestore out","z":"5d651a81.8ece7c","name":"","collection":"Line Graphs Exeter","document":"","operation":"add","admin":"37634fe.5055fb","eject":false,"x":2723.44775390625,"y":2932.571431159973,"wires":[[]]},{"id":"b74d2e3a.ce3388","type":"Firestore out","z":"5d651a81.8ece7c","name":"Colour","collection":"University","document":"University of Exeter","operation":"update","admin":"37634fe.5055fb","eject":false,"x":2754.5906982421875,"y":2698.7824058532715,"wires":[[]]},{"id":"797619b.485f6e8","type":"Firestore out","z":"5d651a81.8ece7c","name":"Glasgow Tweets","collection":"University of Glasgow Tweets","document":"Glasgow","operation":"set","admin":"37634fe.5055fb","eject":false,"x":619.22216796875,"y":2517.5713987350464,"wires":[[]]},{"id":"24130a91.5a68d6","type":"Firestore out","z":"5d651a81.8ece7c","name":"Update Tweets Glasgow","collection":"University","document":"University of Glasgow","operation":"update","admin":"37634fe.5055fb","eject":false,"x":598.2222137451172,"y":2564.5713980197906,"wires":[[]]},{"id":"c8883e27.01cc58","type":"Firestore out","z":"5d651a81.8ece7c","name":"Update Retweets Glasgow","collection":"University","document":"University of Glasgow","operation":"update","admin":"37634fe.5055fb","eject":false,"x":609.2222137451172,"y":2615.5713980197906,"wires":[[]]},{"id":"517453d9.eab61c","type":"Firestore out","z":"5d651a81.8ece7c","name":"line glasgow 2","collection":"Line Graphs Glasgow","document":"","operation":"add","admin":"37634fe.5055fb","eject":false,"x":571.4603271484375,"y":2662.142777442932,"wires":[[]]},{"id":"f36d585d.f7f66","type":"Firestore out","z":"5d651a81.8ece7c","name":"","collection":"20 glasgow","document":"Words","operation":"set","admin":"37634fe.5055fb","eject":false,"x":3904.697036743164,"y":2874.262617111206,"wires":[[]]},{"id":"f02ef90a.7f7b08","type":"Firestore out","z":"5d651a81.8ece7c","name":"","collection":"location glasgow","document":"Locations","operation":"set","admin":"37634fe.5055fb","eject":false,"x":3782.2772216796875,"y":2919.310277938843,"wires":[[]]},{"id":"2dba91b7.4d47f6","type":"Firestore out","z":"5d651a81.8ece7c","name":"Average Joy for Map","collection":"University","document":"University of Glasgow","operation":"update","admin":"37634fe.5055fb","eject":false,"x":4342.25634765625,"y":2732.7720947265625,"wires":[[]]},{"id":"d4494ddb.c83f2","type":"Firestore out","z":"5d651a81.8ece7c","name":"","collection":"Line Graphs Glasgow","document":"","operation":"add","admin":"37634fe.5055fb","eject":false,"x":4464.832763671875,"y":2920.469868659973,"wires":[[]]},{"id":"106a1937.273ecf","type":"Firestore out","z":"5d651a81.8ece7c","name":"Colour","collection":"University","document":"University of Glasgow","operation":"update","admin":"37634fe.5055fb","eject":false,"x":4485.9757080078125,"y":2686.6808433532715,"wires":[[]]},{"id":"13249581.9ceb42","type":"Firestore out","z":"5d651a81.8ece7c","name":"UCL Tweets","collection":"University College Tweets","document":"University College","operation":"set","admin":"37634fe.5055fb","eject":false,"x":555.4848480224609,"y":2975.3492300510406,"wires":[[]]},{"id":"17c52cfe.79f47b","type":"Firestore out","z":"5d651a81.8ece7c","name":"Update Tweets ucl","collection":"University","document":"UCL","operation":"update","admin":"37634fe.5055fb","eject":false,"x":574.4848480224609,"y":3022.3492300510406,"wires":[[]]},{"id":"15b69ac2.674005","type":"Firestore out","z":"5d651a81.8ece7c","name":"Update Retweets ucl","collection":"University","document":"UCL","operation":"update","admin":"37634fe.5055fb","eject":false,"x":595.4848480224609,"y":3073.3492300510406,"wires":[[]]},{"id":"a670e538.f185e8","type":"Firestore out","z":"5d651a81.8ece7c","name":"line ucl 2","collection":"Line Graphs UCL","document":"","operation":"add","admin":"37634fe.5055fb","eject":false,"x":547.7229614257812,"y":3119.920609474182,"wires":[[]]},{"id":"dedf4195.e5a66","type":"Firestore out","z":"5d651a81.8ece7c","name":"Leeds Tweets","collection":"Leeds University Tweets","document":"Leeds","operation":"set","admin":"37634fe.5055fb","eject":false,"x":565.8095245361328,"y":3207.4920523166656,"wires":[[]]},{"id":"f1def4eb.dfaf3","type":"Firestore out","z":"5d651a81.8ece7c","name":"Update Tweets Leeds","collection":"University","document":"University of Leeds","operation":"update","admin":"37634fe.5055fb","eject":false,"x":584.8095245361328,"y":3254.4920523166656,"wires":[[]]},{"id":"9299ab82.f2018","type":"Firestore out","z":"5d651a81.8ece7c","name":"Update Retweets Leeds","collection":"University","document":"University of Leeds","operation":"update","admin":"37634fe.5055fb","eject":false,"x":605.8095245361328,"y":3305.4920523166656,"wires":[[]]},{"id":"9213261a.fafb68","type":"Firestore out","z":"5d651a81.8ece7c","name":"line leeds 2","collection":"Line Graphs Leeds","document":"","operation":"add","admin":"37634fe.5055fb","eject":false,"x":558.0476379394531,"y":3352.063431739807,"wires":[[]]},{"id":"c0bf35d0.9f448","type":"Firestore out","z":"5d651a81.8ece7c","name":"","collection":"20 leeds","document":"Words","operation":"set","admin":"37634fe.5055fb","eject":false,"x":2221.6968994140625,"y":3381.484920501709,"wires":[[]]},{"id":"a47bf999.47dae8","type":"Firestore out","z":"5d651a81.8ece7c","name":"","collection":"location leeds","document":"Locations","operation":"set","admin":"37634fe.5055fb","eject":false,"x":2032.9696197509766,"y":3427.848554611206,"wires":[[]]},{"id":"418f8891.72e828","type":"Firestore out","z":"5d651a81.8ece7c","name":"Average Joy for Map","collection":"University","document":"University of Leeds","operation":"update","admin":"37634fe.5055fb","eject":false,"x":2637.2564392089844,"y":3239.772113800049,"wires":[[]]},{"id":"e43acb52.80b258","type":"Firestore out","z":"5d651a81.8ece7c","name":"","collection":"Line Graphs Leeds","document":"","operation":"add","admin":"37634fe.5055fb","eject":false,"x":2739.832763671875,"y":3427.469868659973,"wires":[[]]},{"id":"e330b543.2582c8","type":"Firestore out","z":"5d651a81.8ece7c","name":"Colour","collection":"University","document":"University of Leeds","operation":"update","admin":"37634fe.5055fb","eject":false,"x":2780.9757080078125,"y":3193.6808433532715,"wires":[[]]},{"id":"343ab5d6.4651a2","type":"Firestore out","z":"5d651a81.8ece7c","name":"Liverpool Tweets","collection":"Liverpool University Tweets","document":"Liverpool","operation":"set","admin":"37634fe.5055fb","eject":false,"x":580.4444427490234,"y":3424.793681383133,"wires":[[]]},{"id":"96a87eff.b252a8","type":"Firestore out","z":"5d651a81.8ece7c","name":"Update Tweets Liverpool","collection":"University","document":"University of Liverpool","operation":"update","admin":"37634fe.5055fb","eject":false,"x":599.4444427490234,"y":3471.793681383133,"wires":[[]]},{"id":"3c9d1790.a84428","type":"Firestore out","z":"5d651a81.8ece7c","name":"Update Retweets Liverpool","collection":"University","document":"University of Liverpool","operation":"update","admin":"37634fe.5055fb","eject":false,"x":620.4444427490234,"y":3522.793681383133,"wires":[[]]},{"id":"b4330986.c9535","type":"Firestore out","z":"5d651a81.8ece7c","name":"line liverpool 2","collection":"Line Graphs Liverpool","document":"","operation":"add","admin":"37634fe.5055fb","eject":false,"x":572.6825561523438,"y":3569.3650608062744,"wires":[[]]},{"id":"b72c6693.d28f38","type":"Firestore out","z":"5d651a81.8ece7c","name":"","collection":"20 liverpool","document":"Words","operation":"set","admin":"37634fe.5055fb","eject":false,"x":3931.7147064208984,"y":3350.002088546753,"wires":[[]]},{"id":"30a7ee7e.ba07ca","type":"Firestore out","z":"5d651a81.8ece7c","name":"","collection":"location liverpool","document":"Locations","operation":"set","admin":"37634fe.5055fb","eject":false,"x":3752.9874267578125,"y":3396.36572265625,"wires":[[]]},{"id":"c06d5527.f494a","type":"Firestore out","z":"5d651a81.8ece7c","name":"Average Joy for Map","collection":"University","document":"University of Liverpool","operation":"update","admin":"37634fe.5055fb","eject":false,"x":4337.27424621582,"y":3208.289281845093,"wires":[[]]},{"id":"b8c0a934.28941","type":"Firestore out","z":"5d651a81.8ece7c","name":"","collection":"Line Graphs Liverpool","document":"","operation":"add","admin":"37634fe.5055fb","eject":false,"x":4449.850570678711,"y":3395.987036705017,"wires":[[]]},{"id":"208f9133.d3da46","type":"Firestore out","z":"5d651a81.8ece7c","name":"Colour","collection":"University","document":"University of Liverpool","operation":"update","admin":"37634fe.5055fb","eject":false,"x":4480.993515014648,"y":3162.1980113983154,"wires":[[]]},{"id":"a48f394d.ba9f58","type":"Firestore out","z":"5d651a81.8ece7c","name":"Manchester Tweets","collection":"Manchester University Tweets","document":"Manchester","operation":"set","admin":"37634fe.5055fb","eject":false,"x":643.4483985900879,"y":3884.9323415756226,"wires":[[]]},{"id":"396c68b.b291198","type":"Firestore out","z":"5d651a81.8ece7c","name":"Update Tweets Manchester","collection":"University","document":"University of Manchester","operation":"update","admin":"37634fe.5055fb","eject":false,"x":706.7341461181641,"y":3930.5037698745728,"wires":[[]]},{"id":"aeb9154f.5f5138","type":"Firestore out","z":"5d651a81.8ece7c","name":"Update Retweets Manchester","collection":"University","document":"University of Manchester","operation":"update","admin":"37634fe.5055fb","eject":false,"x":729.1627349853516,"y":3981.5034894943237,"wires":[[]]},{"id":"e89eb2cc.44eb58","type":"Firestore out","z":"5d651a81.8ece7c","name":"line manchester 2","collection":"Line Graphs Manchester","document":"","operation":"add","admin":"37634fe.5055fb","eject":false,"x":598.5436477661133,"y":4029.5037984848022,"wires":[[]]},{"id":"40bea90f.df7978","type":"Firestore out","z":"5d651a81.8ece7c","name":"","collection":"20 manchester","document":"Words","operation":"set","admin":"37634fe.5055fb","eject":false,"x":2247.8834381103516,"y":3793.72945022583,"wires":[[]]},{"id":"686f3b4.b7d0b44","type":"Firestore out","z":"5d651a81.8ece7c","name":"","collection":"location manchester","document":"Locations","operation":"set","admin":"37634fe.5055fb","eject":false,"x":2059.1561584472656,"y":3840.093084335327,"wires":[[]]},{"id":"428b3c0f.9d77cc","type":"Firestore out","z":"5d651a81.8ece7c","name":"Average Joy for Map","collection":"University","document":"University of Manchester","operation":"update","admin":"37634fe.5055fb","eject":false,"x":2633.4429779052734,"y":3652.01664352417,"wires":[[]]},{"id":"5c39ae58.411f58","type":"Firestore out","z":"5d651a81.8ece7c","name":"","collection":"Line Graphs Manchester","document":"","operation":"add","admin":"37634fe.5055fb","eject":false,"x":2756.019302368164,"y":3839.7143983840942,"wires":[[]]},{"id":"e222c5a9.ae92a","type":"Firestore out","z":"5d651a81.8ece7c","name":"Colour","collection":"University","document":"University of Manchester","operation":"update","admin":"37634fe.5055fb","eject":false,"x":2777.1622467041016,"y":3605.9253730773926,"wires":[[]]},{"id":"68c06bf2.d80ab4","type":"Firestore out","z":"5d651a81.8ece7c","name":"Sheffield Tweets","collection":"Sheffield University Tweets","document":"Sheffield","operation":"set","admin":"37634fe.5055fb","eject":false,"x":639.6983909606934,"y":4108.682277679443,"wires":[[]]},{"id":"6c5c240f.4b7a6c","type":"Firestore out","z":"5d651a81.8ece7c","name":"Update Tweets Sheffield","collection":"University","document":"University of Sheffield","operation":"update","admin":"37634fe.5055fb","eject":false,"x":702.9841384887695,"y":4154.253705978394,"wires":[[]]},{"id":"780ede9a.48c708","type":"Firestore out","z":"5d651a81.8ece7c","name":"Update Retweets Sheffield","collection":"University","document":"University of Sheffield","operation":"update","admin":"37634fe.5055fb","eject":false,"x":725.412727355957,"y":4205.2534255981445,"wires":[[]]},{"id":"e812f02b.e45c7","type":"Firestore out","z":"5d651a81.8ece7c","name":"line sheffield 2","collection":"Line Graphs Sheffield","document":"","operation":"add","admin":"37634fe.5055fb","eject":false,"x":594.7936401367188,"y":4253.253734588623,"wires":[[]]},{"id":"ad00bc1d.74d49","type":"Firestore out","z":"5d651a81.8ece7c","name":"","collection":"20 sheffield","document":"Words","operation":"set","admin":"37634fe.5055fb","eject":false,"x":3995.9936389923096,"y":3770.339775085449,"wires":[[]]},{"id":"5e718c09.69b07c","type":"Firestore out","z":"5d651a81.8ece7c","name":"","collection":"location sheffield","document":"Locations","operation":"set","admin":"37634fe.5055fb","eject":false,"x":3817.2663593292236,"y":3816.7034091949463,"wires":[[]]},{"id":"6d05d169.74314","type":"Firestore out","z":"5d651a81.8ece7c","name":"Average Joy for Map","collection":"University","document":"University of Sheffield","operation":"update","admin":"37634fe.5055fb","eject":false,"x":4401.553178787231,"y":3628.626968383789,"wires":[[]]},{"id":"4ab1e0be.d0fff","type":"Firestore out","z":"5d651a81.8ece7c","name":"","collection":"Line Graphs Sheffield","document":"","operation":"add","admin":"37634fe.5055fb","eject":false,"x":4514.129503250122,"y":3816.3247232437134,"wires":[[]]},{"id":"4cf9c783.6ecfd","type":"Firestore out","z":"5d651a81.8ece7c","name":"Colour","collection":"University","document":"University of Sheffield","operation":"update","admin":"37634fe.5055fb","eject":false,"x":4545.27244758606,"y":3582.5356979370117,"wires":[[]]},{"id":"cff4382f.4a8a28","type":"Firestore out","z":"5d651a81.8ece7c","name":"","collection":"20 ibm","document":"Words","operation":"set","admin":"37634fe.5055fb","eject":false,"x":2140,"y":4260,"wires":[[]]},{"id":"c31f1f72.e7605","type":"Firestore out","z":"5d651a81.8ece7c","name":"","collection":"location ibm","document":"Locations","operation":"set","admin":"37634fe.5055fb","eject":false,"x":2029.1561584472656,"y":4320.093084335327,"wires":[[]]},{"id":"393f6254.2a54fe","type":"Firestore out","z":"5d651a81.8ece7c","name":"","collection":"Line Graphs IBM","document":"","operation":"add","admin":"37634fe.5055fb","eject":false,"x":2726.019302368164,"y":4319.714398384094,"wires":[[]]},{"id":"44cd0f2d.c5ea98","type":"Firestore out","z":"5d651a81.8ece7c","name":"IBM Tweets","collection":"IBM Tweets","document":"IBM","operation":"set","admin":"37634fe.5055fb","eject":false,"x":607.8571434020996,"y":4339.999921798706,"wires":[[]]},{"id":"7e95b9ea.d8fc1","type":"Firestore out","z":"5d651a81.8ece7c","name":"","collection":"20 ucl","document":"Words","operation":"set","admin":"37634fe.5055fb","eject":false,"x":3932.169174194336,"y":4293.729383468628,"wires":[[]]},{"id":"7544b8e7.3344e8","type":"Firestore out","z":"5d651a81.8ece7c","name":"","collection":"location ucl","document":"Locations","operation":"set","admin":"37634fe.5055fb","eject":false,"x":3743.44189453125,"y":4340.093017578125,"wires":[[]]},{"id":"fa55c68.df37538","type":"Firestore out","z":"5d651a81.8ece7c","name":"Average Joy for Map","collection":"University","document":"UCL","operation":"update","admin":"37634fe.5055fb","eject":false,"x":4357.728713989258,"y":4152.016576766968,"wires":[[]]},{"id":"8f39ba53.94227","type":"Firestore out","z":"5d651a81.8ece7c","name":"","collection":"Line Graphs UCL","document":"","operation":"add","admin":"37634fe.5055fb","eject":false,"x":4450.305038452148,"y":4339.714331626892,"wires":[[]]},{"id":"9a7e3219.81d198","type":"Firestore out","z":"5d651a81.8ece7c","name":"Colour","collection":"University","document":"UCL","operation":"update","admin":"37634fe.5055fb","eject":false,"x":4501.447982788086,"y":4105.92530632019,"wires":[[]]},{"id":"9fc49658.d55eb8","type":"Firestore out","z":"5d651a81.8ece7c","name":"Firestore - updating info","collection":"University","document":"UCL","operation":"update","admin":"37634fe.5055fb","eject":false,"x":390,"y":4600,"wires":[[]]},{"id":"cee57182.811c98","type":"Firestore out","z":"5d651a81.8ece7c","name":"Firestore - updating info","collection":"University","document":"University of Birmingham","operation":"update","admin":"37634fe.5055fb","eject":false,"x":390,"y":4640,"wires":[[]]},{"id":"912ac91f.c876a8","type":"Firestore out","z":"5d651a81.8ece7c","name":"Firestore - updating info","collection":"University","document":"University of Bristol","operation":"update","admin":"37634fe.5055fb","eject":false,"x":390,"y":4680,"wires":[[]]},{"id":"d3719047.2f948","type":"Firestore out","z":"5d651a81.8ece7c","name":"Firestore - updating info","collection":"University","document":"University of Cambridge","operation":"update","admin":"37634fe.5055fb","eject":false,"x":390,"y":4720,"wires":[[]]},{"id":"abe325ac.813b58","type":"Firestore out","z":"5d651a81.8ece7c","name":"Firestore - updating info","collection":"University","document":"University of Cardiff","operation":"update","admin":"37634fe.5055fb","eject":false,"x":390,"y":4760,"wires":[[]]},{"id":"3849c300.63a91e","type":"Firestore out","z":"5d651a81.8ece7c","name":"Firestore - updating info","collection":"University","document":"University of Durham","operation":"update","admin":"37634fe.5055fb","eject":false,"x":390,"y":4800,"wires":[[]]},{"id":"6f936b01.7556ec","type":"Firestore out","z":"5d651a81.8ece7c","name":"Firestore - updating info","collection":"University","document":"University of Exeter","operation":"update","admin":"37634fe.5055fb","eject":false,"x":390,"y":4840,"wires":[[]]},{"id":"c0ae957d.7020f8","type":"Firestore out","z":"5d651a81.8ece7c","name":"Firestore - updating info","collection":"University","document":"University of Edinburgh","operation":"update","admin":"37634fe.5055fb","eject":false,"x":390,"y":4880,"wires":[[]]},{"id":"b7b6c2f7.e161b","type":"Firestore out","z":"5d651a81.8ece7c","name":"Firestore - updating info","collection":"University","document":"University of Glasgow","operation":"update","admin":"37634fe.5055fb","eject":false,"x":390,"y":4920,"wires":[[]]},{"id":"d7d7db85.e9dba","type":"Firestore out","z":"5d651a81.8ece7c","name":"Firestore - updating info","collection":"University","document":"University of Leeds","operation":"update","admin":"37634fe.5055fb","eject":false,"x":390,"y":4960,"wires":[[]]},{"id":"cf127483.c01b98","type":"Firestore out","z":"5d651a81.8ece7c","name":"Firestore - updating info","collection":"University","document":"Imperial College London","operation":"update","admin":"37634fe.5055fb","eject":false,"x":390,"y":4560,"wires":[[]]},{"id":"b8758fa2.e16ca8","type":"Firestore out","z":"5d651a81.8ece7c","name":"Firestore - updating info","collection":"University","document":"University of Liverpool","operation":"update","admin":"37634fe.5055fb","eject":false,"x":850,"y":4560,"wires":[[]]},{"id":"1e15c89d.23440f","type":"Firestore out","z":"5d651a81.8ece7c","name":"Firestore - updating info","collection":"University","document":"University of Manchester","operation":"update","admin":"37634fe.5055fb","eject":false,"x":850,"y":4600,"wires":[[]]},{"id":"1f6bdcf3.e07253","type":"Firestore out","z":"5d651a81.8ece7c","name":"Firestore - updating info","collection":"University","document":"University of Oxford","operation":"update","admin":"37634fe.5055fb","eject":false,"x":850,"y":4640,"wires":[[]]},{"id":"b4300a95.42e0c8","type":"Firestore out","z":"5d651a81.8ece7c","name":"Firestore - updating info","collection":"University","document":"University of Sheffield","operation":"update","admin":"37634fe.5055fb","eject":false,"x":850,"y":4680,"wires":[[]]},{"id":"a028315e.1080a","type":"Firestore out","z":"5d651a81.8ece7c","name":"Update Retweets Search","collection":"Search Retweets Number","document":"Retweets","operation":"update","admin":"37634fe.5055fb","eject":false,"x":2042.7142791748047,"y":493.0000183582306,"wires":[[]]},{"id":"a1800994.eab7a","type":"Firestore out","z":"5d651a81.8ece7c","name":"Update Tweets Search","collection":"Search Tweets Number","document":"Tweets","operation":"update","admin":"37634fe.5055fb","eject":false,"x":2021.7142791748047,"y":442.0000183582306,"wires":[[]]},{"id":"83781923.8f4e1","type":"Firestore in","z":"5d651a81.8ece7c","name":"","collection":"Imperial College Tweets","group":false,"document":"","realtime":false,"query":[],"admin":"37634fe.5055fb","snapHandler":"\ndocs = [];\nadd = []; \nsnap.forEach(doc => {\n\n        docs.push(doc.data());\n\n});\nreturn docs; \n","eject":false,"x":1667.9481735229492,"y":1233.4851579666138,"wires":[["91b3daff.e51dd","e6993b6b.a7e54"]]},{"id":"70683bcc.2cd29c","type":"Firestore in","z":"5d651a81.8ece7c","name":"","collection":"Search Tweets","group":false,"document":"","realtime":false,"query":[],"admin":"37634fe.5055fb","snapHandler":"\ndocs = [];\nadd = []; \nsnap.forEach(doc => {\n\n        docs.push(doc.data());\n\n});\nreturn docs; \n","eject":false,"x":1675.2144775390625,"y":690.68310546875,"wires":[["65411607.74b07","ce11c226.87ecb8"]]},{"id":"d5420032.2105","type":"Firestore in","z":"5d651a81.8ece7c","name":"","collection":"Oxford University Tweets","group":false,"document":"","realtime":false,"query":[],"admin":"37634fe.5055fb","snapHandler":"\ndocs = [];\nadd = []; \nsnap.forEach(doc => {\n\n        docs.push(doc.data());\n\n});\nreturn docs; \n","eject":false,"x":3311.1187591552734,"y":1239.607310295105,"wires":[["164d6cba.0f6543","6ff4a4.bc5fab5c"]]},{"id":"c9ad83d5.29bd9","type":"Firestore in","z":"5d651a81.8ece7c","name":"","collection":"University of Birmingham Tweets","group":false,"document":"","realtime":false,"query":[],"admin":"37634fe.5055fb","snapHandler":"\ndocs = [];\nadd = []; \nsnap.forEach(doc => {\n\n        docs.push(doc.data());\n\n});\nreturn docs; \n","eject":false,"x":1667.5780029296875,"y":1599.2286376953125,"wires":[["c75aada2.5e3868","327c792f.e9a1a6"]]},{"id":"3bd563ce.1dafec","type":"Firestore in","z":"5d651a81.8ece7c","name":"","collection":"University of Bristol Tweets","group":false,"document":"","realtime":false,"query":[],"admin":"37634fe.5055fb","snapHandler":"\ndocs = [];\nadd = []; \nsnap.forEach(doc => {\n\n        docs.push(doc.data());\n\n});\nreturn docs; \n","eject":false,"x":3349.5780029296875,"y":1593.2286376953125,"wires":[["dfdea2fb.529a9","f41305bd.b43c6"]]},{"id":"19789a26.4041d6","type":"Firestore in","z":"5d651a81.8ece7c","name":"","collection":"University of Cambridge Tweets","group":false,"document":"","realtime":false,"query":[],"admin":"37634fe.5055fb","snapHandler":"\ndocs = [];\nadd = []; \nsnap.forEach(doc => {\n\n        docs.push(doc.data());\n\n});\nreturn docs; \n","eject":false,"x":1656.438980102539,"y":2052.9841747283936,"wires":[["b3e1e496.fd0ea","e898fbdb.3bc4f8"]]},{"id":"96dfb9e.2ea2c48","type":"Firestore in","z":"5d651a81.8ece7c","name":"","collection":"University of Cardiff Tweets","group":false,"document":"","realtime":false,"query":[],"admin":"37634fe.5055fb","snapHandler":"\ndocs = [];\nadd = []; \nsnap.forEach(doc => {\n\n        docs.push(doc.data());\n\n});\nreturn docs; \n","eject":false,"x":3359.119400024414,"y":2022.4624462127686,"wires":[["12b226a4.2379c9","c46b45b3.621fb"]]},{"id":"48006a15.2cd5f4","type":"Firestore in","z":"5d651a81.8ece7c","name":"","collection":"University of Durham Tweets","group":false,"document":"","realtime":false,"query":[],"admin":"37634fe.5055fb","snapHandler":"\ndocs = [];\nadd = []; \nsnap.forEach(doc => {\n\n        docs.push(doc.data());\n\n});\nreturn docs; \n","eject":false,"x":1661.105728149414,"y":2422.9841747283936,"wires":[["c34ad36.30e36b","b54d2ea9.9375d8"]]},{"id":"74a0e5bc.44732c","type":"Firestore in","z":"5d651a81.8ece7c","name":"","collection":"University of Edinburgh Tweets","group":false,"document":"","realtime":false,"query":[],"admin":"37634fe.5055fb","snapHandler":"\ndocs = [];\nadd = []; \nsnap.forEach(doc => {\n\n        docs.push(doc.data());\n\n});\nreturn docs; \n","eject":false,"x":3395.105728149414,"y":2422.9841747283936,"wires":[["ca1e97e3.f8f4b8","f530e14f.d72b3"]]},{"id":"720ff2e7.efda64","type":"Firestore in","z":"5d651a81.8ece7c","name":"","collection":"University of Exeter Tweets","group":false,"document":"","realtime":false,"query":[],"admin":"37634fe.5055fb","snapHandler":"\ndocs = [];\nadd = []; \nsnap.forEach(doc => {\n\n        docs.push(doc.data());\n\n});\nreturn docs; \n","eject":false,"x":1661.720718383789,"y":2793.0857372283936,"wires":[["1753954.9c9916b","5e2f8d2b.ae52ac"]]},{"id":"91fde415.68a848","type":"Firestore in","z":"5d651a81.8ece7c","name":"","collection":"University of Glasgow Tweets","group":false,"document":"","realtime":false,"query":[],"admin":"37634fe.5055fb","snapHandler":"\ndocs = [];\nadd = []; \nsnap.forEach(doc => {\n\n        docs.push(doc.data());\n\n});\nreturn docs; \n","eject":false,"x":3403.105728149414,"y":2780.9841747283936,"wires":[["cdaeb158.688e4","c7114eff.84efe"]]},{"id":"dda5670f.d0681","type":"Firestore in","z":"5d651a81.8ece7c","name":"","collection":"Leeds University Tweets","group":false,"document":"","realtime":false,"query":[],"admin":"37634fe.5055fb","snapHandler":"\ndocs = [];\nadd = []; \nsnap.forEach(doc => {\n\n        docs.push(doc.data());\n\n});\nreturn docs; \n","eject":false,"x":1710.1057662963867,"y":3287.9841165542603,"wires":[["bb5c02c3.0fc078","5c03aa42.50956c"]]},{"id":"276cf04.03aac9","type":"Firestore in","z":"5d651a81.8ece7c","name":"","collection":"Liverpool University Tweets","group":false,"document":"","realtime":false,"query":[],"admin":"37634fe.5055fb","snapHandler":"\ndocs = [];\nadd = []; \nsnap.forEach(doc => {\n\n        docs.push(doc.data());\n\n});\nreturn docs; \n","eject":false,"x":3420.1235733032227,"y":3256.501284599304,"wires":[["c8e19f87.08dcf8","d67231fe.d58c18"]]},{"id":"c4d616c6.0e25","type":"Firestore in","z":"5d651a81.8ece7c","name":"","collection":"Manchester University Tweets","group":false,"document":"","realtime":false,"query":[],"admin":"37634fe.5055fb","snapHandler":"\ndocs = [];\nadd = []; \nsnap.forEach(doc => {\n\n        docs.push(doc.data());\n\n});\nreturn docs; \n","eject":false,"x":1726.2923049926758,"y":3700.2286462783813,"wires":[["429d9a75.24fe9c","220fea8.6446916"]]},{"id":"60affd07.6f4abc","type":"Firestore in","z":"5d651a81.8ece7c","name":"","collection":"Sheffield University Tweets","group":false,"document":"","realtime":false,"query":[],"admin":"37634fe.5055fb","snapHandler":"\ndocs = [];\nadd = []; \nsnap.forEach(doc => {\n\n        docs.push(doc.data());\n\n});\nreturn docs; \n","eject":false,"x":3484.402505874634,"y":3676.8389711380005,"wires":[["81be2f26.92cba","e4963cfd.240fd8"]]},{"id":"87a4f47d.d5a77","type":"Firestore in","z":"5d651a81.8ece7c","name":"","collection":"IBM Tweets","group":false,"document":"","realtime":false,"query":[],"admin":"37634fe.5055fb","snapHandler":"\ndocs = [];\nadd = []; \nsnap.forEach(doc => {\n\n        docs.push(doc.data());\n\n});\nreturn docs; \n","eject":false,"x":1656.2923049926758,"y":4180.228646278381,"wires":[["3b96d8c7.d11bd","92daa30a.4768c"]]},{"id":"4f83e89a.4c2be","type":"Firestore in","z":"5d651a81.8ece7c","name":"","collection":"University College Tweets","group":false,"document":"","realtime":false,"query":[],"admin":"37634fe.5055fb","snapHandler":"\ndocs = [];\nadd = []; \nsnap.forEach(doc => {\n\n        docs.push(doc.data());\n\n});\nreturn docs; \n","eject":false,"x":3440.57804107666,"y":4200.228579521179,"wires":[["325e38bb.c6c2e","8cdcd2b0.5da758"]]},{"id":"86710f5.525267","type":"twitter in","z":"5d651a81.8ece7c","twitter":"6bc8f748.8274a8","tags":"","user":"false","name":"","inputs":1,"x":612,"y":213,"wires":[["2389162a.b24732","fae99dc1.c064f8","96aa36eb.2dd4e"]]},{"id":"1ef9a670.b1ea72","type":"loop","z":"5d651a81.8ece7c","name":"","kind":"enum","count":"","initial":"0","step":"1","condition":"","conditionType":"js","when":"before","enumeration":"payload","enumerationType":"msg","limit":"","loopPayload":"loop-val","finalPayload":"final-last","x":2010.887451171875,"y":1194.3336324691772,"wires":[["9269acee.3fb358"],["91b3daff.e51dd","98d96b84.1d2a2"]]},{"id":"6cc40685.69163","type":"loop","z":"5d651a81.8ece7c","name":"","kind":"enum","count":"","initial":"0","step":"1","condition":"","conditionType":"js","when":"before","enumeration":"payload","enumerationType":"msg","limit":"","loopPayload":"loop-val","finalPayload":"final-last","x":2190.881103515625,"y":661.349853515625,"wires":[["2c29e396.722ff4"],["65411607.74b07","836cf225.06877"]]},{"id":"76e3d1a2.c98bd8","type":"loop","z":"5d651a81.8ece7c","name":"","kind":"enum","count":"","initial":"0","step":"1","condition":"","conditionType":"js","when":"before","enumeration":"payload","enumerationType":"msg","limit":"","loopPayload":"loop-val","finalPayload":"final-last","x":3654.058036804199,"y":1200.4557847976685,"wires":[["a6f48d95.8f8bd8"],["164d6cba.0f6543","864275fc.447f28"]]},{"id":"98e71887.153788","type":"loop","z":"5d651a81.8ece7c","name":"","kind":"enum","count":"","initial":"0","step":"1","condition":"","conditionType":"js","when":"before","enumeration":"payload","enumerationType":"msg","limit":"","loopPayload":"loop-val","finalPayload":"final-last","x":2002.517318725586,"y":1560.0770540237427,"wires":[["5e5a43c5.b981ec"],["c75aada2.5e3868","2c97a3db.59e49c"]]},{"id":"cb014862.efe1a8","type":"loop","z":"5d651a81.8ece7c","name":"","kind":"enum","count":"","initial":"0","step":"1","condition":"","conditionType":"js","when":"before","enumeration":"payload","enumerationType":"msg","limit":"","loopPayload":"loop-val","finalPayload":"final-last","x":3714.517318725586,"y":1554.0770540237427,"wires":[["19adf7c2.608aa8"],["dfdea2fb.529a9","c69cd0f.7c781b"]]},{"id":"46157517.0b3bec","type":"loop","z":"5d651a81.8ece7c","name":"","kind":"enum","count":"","initial":"0","step":"1","condition":"","conditionType":"js","when":"before","enumeration":"payload","enumerationType":"msg","limit":"","loopPayload":"loop-val","finalPayload":"final-last","x":2001.3782958984375,"y":2013.8325910568237,"wires":[["48f633aa.473d34"],["b3e1e496.fd0ea","51e18b60.1dd77c"]]},{"id":"ba512469.65ba78","type":"loop","z":"5d651a81.8ece7c","name":"","kind":"enum","count":"","initial":"0","step":"1","condition":"","conditionType":"js","when":"before","enumeration":"payload","enumerationType":"msg","limit":"","loopPayload":"loop-val","finalPayload":"final-last","x":3724.0587158203125,"y":1983.3108625411987,"wires":[["edfe9da4.56b06"],["12b226a4.2379c9","d1ddf84a.78aa8"]]},{"id":"96f24ac5.46489","type":"loop","z":"5d651a81.8ece7c","name":"","kind":"enum","count":"","initial":"0","step":"1","condition":"","conditionType":"js","when":"before","enumeration":"payload","enumerationType":"msg","limit":"","loopPayload":"loop-val","finalPayload":"final-last","x":2016.0450439453125,"y":2383.8325910568237,"wires":[["b32bfa29.98f62"],["c34ad36.30e36b","b03e9b8d.651948"]]},{"id":"7fd41a0.dcaa668","type":"loop","z":"5d651a81.8ece7c","name":"","kind":"enum","count":"","initial":"0","step":"1","condition":"","conditionType":"js","when":"before","enumeration":"payload","enumerationType":"msg","limit":"","loopPayload":"loop-val","finalPayload":"final-last","x":3740.0450439453125,"y":2383.8325910568237,"wires":[["d47021c7.95f378"],["ca1e97e3.f8f4b8","80c385b0.a34d"]]},{"id":"4fc570a3.83353","type":"loop","z":"5d651a81.8ece7c","name":"","kind":"enum","count":"","initial":"0","step":"1","condition":"","conditionType":"js","when":"before","enumeration":"payload","enumerationType":"msg","limit":"","loopPayload":"loop-val","finalPayload":"final-last","x":2026.6600341796875,"y":2753.9341535568237,"wires":[["5c95f0b5.b32ad"],["1753954.9c9916b","4b1624e9.5796c4"]]},{"id":"bdf3373c.1cb338","type":"loop","z":"5d651a81.8ece7c","name":"","kind":"enum","count":"","initial":"0","step":"1","condition":"","conditionType":"js","when":"before","enumeration":"payload","enumerationType":"msg","limit":"","loopPayload":"loop-val","finalPayload":"final-last","x":3758.0450439453125,"y":2741.8325910568237,"wires":[["428d696b.8733c8"],["cdaeb158.688e4","7aaa6c.91510594"]]},{"id":"53ec697b.f35e68","type":"loop","z":"5d651a81.8ece7c","name":"","kind":"enum","count":"","initial":"0","step":"1","condition":"","conditionType":"js","when":"before","enumeration":"payload","enumerationType":"msg","limit":"","loopPayload":"loop-val","finalPayload":"final-last","x":2053.0450439453125,"y":3248.8325910568237,"wires":[["bdc13402.7f64d"],["bb5c02c3.0fc078","c00037ad.1aceb8"]]},{"id":"79db6a53.9b8e9c","type":"loop","z":"5d651a81.8ece7c","name":"","kind":"enum","count":"","initial":"0","step":"1","condition":"","conditionType":"js","when":"before","enumeration":"payload","enumerationType":"msg","limit":"","loopPayload":"loop-val","finalPayload":"final-last","x":3753.0628509521484,"y":3217.3497591018677,"wires":[["10f4e1f0.b186f6"],["c8e19f87.08dcf8","bf9d0dbb.b1cc68"]]},{"id":"98b31c1f.9aae68","type":"loop","z":"5d651a81.8ece7c","name":"","kind":"enum","count":"","initial":"0","step":"1","condition":"","conditionType":"js","when":"before","enumeration":"payload","enumerationType":"msg","limit":"","loopPayload":"loop-val","finalPayload":"final-last","x":2049.2315826416016,"y":3661.077120780945,"wires":[["15e4f604.e0b462"],["429d9a75.24fe9c","4933b3e4.1efdb4"]]},{"id":"4dcafa7.41af384","type":"loop","z":"5d651a81.8ece7c","name":"","kind":"enum","count":"","initial":"0","step":"1","condition":"","conditionType":"js","when":"before","enumeration":"payload","enumerationType":"msg","limit":"","loopPayload":"loop-val","finalPayload":"final-last","x":3817.3417835235596,"y":3637.687445640564,"wires":[["bdb3051c.e329c"],["81be2f26.92cba","70fbc1cc.bd0918"]]},{"id":"bc440422.688428","type":"loop","z":"5d651a81.8ece7c","name":"","kind":"enum","count":"","initial":"0","step":"1","condition":"","conditionType":"js","when":"before","enumeration":"payload","enumerationType":"msg","limit":"","loopPayload":"loop-val","finalPayload":"final-last","x":2049.2315826416016,"y":4141.077120780945,"wires":[["48febd5a.091cac"],["3b96d8c7.d11bd","beb1049d.e3f75"]]},{"id":"99c0ae49.138b8","type":"loop","z":"5d651a81.8ece7c","name":"","kind":"enum","count":"","initial":"0","step":"1","condition":"","conditionType":"js","when":"before","enumeration":"payload","enumerationType":"msg","limit":"","loopPayload":"loop-val","finalPayload":"final-last","x":3773.517318725586,"y":4161.077054023743,"wires":[["7ac224f9.470d9c"],["325e38bb.c6c2e","d6c83c98.f311e8"]]},{"id":"68f70d9.a54f8f4","type":"countdown","z":"5d651a81.8ece7c","name":"","topic":"","payloadTimerStart":"true","payloadTimerStartType":"bool","payloadTimerStop":"false","payloadTimerStopType":"bool","timer":"","resetWhileRunning":false,"setTimeToNewWhileRunning":true,"startCountdownOnControlMessage":true,"x":570,"y":320,"wires":[[],["9ef341e7.b81cb8","5abf6b3b.f53d2c"]]},{"id":"374f6d16.fc4a4a","type":"inject","z":"105a4573.6dbd83","name":"","props":[{"p":"payload"}],"repeat":"480","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"imperialcollege","payloadType":"str","x":140,"y":260,"wires":[["b1e4f151.e06e38"]]},{"id":"89ee49b4.0b199","type":"inject","z":"105a4573.6dbd83","name":"","props":[{"p":"payload"}],"repeat":"480","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":110,"y":380,"wires":[["a48364bd.609ea"]]},{"id":"baacf107.d93178","type":"function","z":"105a4573.6dbd83","name":"clear search","func":"if(msg.payload == 0){\n    msg.payload = \"\";\n    return msg; \n}\nreturn;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":290,"y":320,"wires":[["b1e4f151.e06e38"]]},{"id":"5f33fab1.7c53fc","type":"function","z":"105a4573.6dbd83","name":"Add Search for Oxford here","func":"if(msg.payload == 0){\n    msg.payload = 'UniofOxford';\n    return msg;\n}\nelse{\n    return; \n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":540,"y":260,"wires":[["1f761494.4d880b"]]},{"id":"16df0656.af7ea2","type":"function","z":"105a4573.6dbd83","name":"Tweet Text","func":"\nvar cam_tweets = global.get('cam_text'); \n\n\n\nvar key = 'x'; \nvar temp = {};\ntemp[key] = msg.tweet.text;\ncam_tweets.push(temp);\nglobal.set('cam_text', cam_tweets);\nmsg.payload = cam_tweets;\nreturn msg;\n\n\n\n// }\n// else{\n//     msg.payload = icl_tweets;    \n//     global.set('icl_text', []);\n//     return msg;\n// }\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2170,"y":80,"wires":[[]]},{"id":"c9d38d27.ae292","type":"function","z":"105a4573.6dbd83","name":"Tweet Count","func":"var t = global.get('cam_tweets'); \n\n\nif(msg.tweet.retweeted_status == null){\n    t++;\n}\nglobal.set('cam_tweets', t); \nreturn msg;\n\n    \n      \n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2168,"y":141.25,"wires":[[]]},{"id":"3957703.178f21","type":"function","z":"105a4573.6dbd83","name":"Retweet Count","func":"var rt = global.get('cam_retweets'); \n\nif(msg.tweet.retweeted_status != null){\n    rt++;\n}\nglobal.set('cam_retweets', rt); \nreturn msg;\n\n    \n      \n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2177,"y":204.25,"wires":[[]]},{"id":"aab0dd20.1dcc3","type":"function","z":"105a4573.6dbd83","name":"Tweet Text","func":"\nvar cardiff_tweets = global.get('cardiff_text'); \n\n\n\nvar key = 'x'; \nvar temp = {};\ntemp[key] = msg.tweet.text;\ncardiff_tweets.push(temp);\nglobal.set('cardiff_text', cardiff_tweets);\nmsg.payload = cardiff_tweets;\nreturn msg;\n\n\n\n// }\n// else{\n//     msg.payload = icl_tweets;    \n//     global.set('icl_text', []);\n//     return msg;\n// }\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2510,"y":80,"wires":[[]]},{"id":"2a251fba.52a83","type":"function","z":"105a4573.6dbd83","name":"Tweet Count","func":"var t = global.get('cardiff_tweets'); \n\n\nif(msg.tweet.retweeted_status == null){\n    t++;\n}\nglobal.set('cardiff_tweets', t); \nreturn msg;\n\n    \n      \n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2508,"y":141.25,"wires":[[]]},{"id":"57c2051a.534174","type":"function","z":"105a4573.6dbd83","name":"Retweet Count","func":"var rt = global.get('cardiff_retweets'); \n\nif(msg.tweet.retweeted_status != null){\n    rt++;\n}\nglobal.set('cardiff_retweets', rt); \nreturn msg;\n\n    \n      \n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2517,"y":204.25,"wires":[[]]},{"id":"56503683.66af28","type":"function","z":"105a4573.6dbd83","name":"Tweet Text","func":"\nvar durh_tweets = global.get('durh_text'); \n\n\n\nvar key = 'x'; \nvar temp = {};\ntemp[key] = msg.tweet.text;\ndurh_tweets.push(temp);\nglobal.set('durh_text', durh_tweets);\nmsg.payload = durh_tweets;\nreturn msg;\n\n\n\n// }\n// else{\n//     msg.payload = icl_tweets;    \n//     global.set('icl_text', []);\n//     return msg;\n// }\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2910,"y":80,"wires":[[]]},{"id":"f94c40fb.3a567","type":"function","z":"105a4573.6dbd83","name":"Tweet Count","func":"var t = global.get('durh_tweets'); \n\n\nif(msg.tweet.retweeted_status == null){\n    t++;\n}\nglobal.set('durh_tweets', t); \nreturn msg;\n\n    \n      \n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2908,"y":141.25,"wires":[[]]},{"id":"4c302c99.a02d3c","type":"function","z":"105a4573.6dbd83","name":"Retweet Count","func":"var rt = global.get('durh_retweets'); \n\nif(msg.tweet.retweeted_status != null){\n    rt++;\n}\nglobal.set('durh_retweets', rt); \nreturn msg;\n\n    \n      \n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2917,"y":204.25,"wires":[[]]},{"id":"d4f895ae.c822d8","type":"function","z":"105a4573.6dbd83","name":"Tweet Text","func":"\nvar edin_tweets = global.get('edin_text'); \n\n\n\nvar key = 'x'; \nvar temp = {};\ntemp[key] = msg.tweet.text;\nedin_tweets.push(temp);\nglobal.set('edin_text', edin_tweets);\nmsg.payload = edin_tweets;\nreturn msg;\n\n\n\n// }\n// else{\n//     msg.payload = icl_tweets;    \n//     global.set('icl_text', []);\n//     return msg;\n// }\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3270,"y":80,"wires":[[]]},{"id":"fb59a801.af279","type":"function","z":"105a4573.6dbd83","name":"Tweet Count","func":"var t = global.get('edin_tweets'); \n\n\nif(msg.tweet.retweeted_status == null){\n    t++;\n}\nglobal.set('edin_tweets', t); \nreturn msg;\n\n    \n      \n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3268,"y":141.25,"wires":[[]]},{"id":"4e7b9ae1.f8663c","type":"function","z":"105a4573.6dbd83","name":"Retweet Count","func":"var rt = global.get('edin_retweets'); \n\nif(msg.tweet.retweeted_status != null){\n    rt++;\n}\nglobal.set('edin_retweets', rt); \nreturn msg;\n\n    \n      \n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3277,"y":204.25,"wires":[[]]},{"id":"4051770.bcbe908","type":"function","z":"105a4573.6dbd83","name":"Tweet Text","func":"\nvar ex_tweets = global.get('ex_text'); \n\n\n\nvar key = 'x'; \nvar temp = {};\ntemp[key] = msg.tweet.text;\nex_tweets.push(temp);\nglobal.set('ex_text', ex_tweets);\nmsg.payload = ex_tweets;\nreturn msg;\n\n\n\n// }\n// else{\n//     msg.payload = icl_tweets;    \n//     global.set('icl_text', []);\n//     return msg;\n// }\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3650,"y":80,"wires":[[]]},{"id":"352d6576.cbd422","type":"function","z":"105a4573.6dbd83","name":"Tweet Count","func":"var t = global.get('ex_tweets'); \n\n\nif(msg.tweet.retweeted_status == null){\n    t++;\n}\nglobal.set('ex_tweets', t); \nreturn msg;\n\n    \n      \n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3648,"y":141.25,"wires":[[]]},{"id":"d98500a7.683558","type":"function","z":"105a4573.6dbd83","name":"Retweet Count","func":"var rt = global.get('ex_retweets'); \n\nif(msg.tweet.retweeted_status != null){\n    rt++;\n}\nglobal.set('ex_retweets', rt); \nreturn msg;\n\n    \n      \n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3657,"y":204.25,"wires":[[]]},{"id":"e0cc2f26.aae768","type":"function","z":"105a4573.6dbd83","name":"Tweet Text","func":"\nvar glas_tweets = global.get('glas_text'); \n\nvar key = 'x'; \nvar temp = {};\ntemp[key] = msg.tweet.text;\nglas_tweets.push(temp);\nglobal.set('glas_text', glas_tweets);\nmsg.payload = glas_tweets;\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4090,"y":80,"wires":[[]]},{"id":"3406c338.2ef084","type":"function","z":"105a4573.6dbd83","name":"Tweet Count","func":"var t = global.get('glas_tweets'); \n\n\nif(msg.tweet.retweeted_status == null){\n    t++;\n}\nglobal.set('glas_tweets', t); \nreturn msg;\n\n    \n      \n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4088.0000076293945,"y":143.24998474121094,"wires":[[]]},{"id":"af077587.0b85d","type":"function","z":"105a4573.6dbd83","name":"Retweet Count","func":"var rt = global.get('glas_retweets'); \n\nif(msg.tweet.retweeted_status != null){\n    rt++;\n}\nglobal.set('glas_retweets', rt); \nreturn msg;\n\n    \n      \n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4097,"y":204.25,"wires":[[]]},{"id":"1707dd09.9dffe3","type":"function","z":"105a4573.6dbd83","name":"Tweet Text","func":"\nvar shef_tweets = global.get('shef_text'); \n\nvar key = 'x'; \nvar temp = {};\ntemp[key] = msg.tweet.text;\nshef_tweets.push(temp);\nglobal.set('shef_text', shef_tweets);\nmsg.payload = shef_tweets;\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4430,"y":80,"wires":[[]]},{"id":"fb60ed16.ecf9c","type":"function","z":"105a4573.6dbd83","name":"Tweet Count","func":"var t = global.get('shef_tweets'); \n\n\nif(msg.tweet.retweeted_status == null){\n    t++;\n}\nglobal.set('shef_tweets', t); \nreturn msg;\n\n    \n      \n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4428.0000076293945,"y":143.24998474121094,"wires":[[]]},{"id":"70a4bf6c.ce2b6","type":"function","z":"105a4573.6dbd83","name":"Retweet Count","func":"var rt = global.get('shef_retweets'); \n\nif(msg.tweet.retweeted_status != null){\n    rt++;\n}\nglobal.set('shef_retweets', rt); \nreturn msg;\n\n    \n      \n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4437,"y":204.25,"wires":[[]]},{"id":"2b2b4514.e01b22","type":"function","z":"105a4573.6dbd83","name":"Tweet Text","func":"\nvar ucl_tweets = global.get('ucl_text'); \n\nvar key = 'x'; \nvar temp = {};\ntemp[key] = msg.tweet.text;\nucl_tweets.push(temp);\nglobal.set('ucl_text', ucl_tweets);\nmsg.payload = ucl_tweets;\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4800,"y":80,"wires":[[]]},{"id":"72506e9f.12b178","type":"function","z":"105a4573.6dbd83","name":"Tweet Count","func":"var t = global.get('ucl_tweets'); \n\n\nif(msg.tweet.retweeted_status == null){\n    t++;\n}\nglobal.set('ucl_tweets', t); \nreturn msg;\n\n    \n      \n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4798.0000076293945,"y":143.24998474121094,"wires":[[]]},{"id":"17e34384.fed4ac","type":"function","z":"105a4573.6dbd83","name":"Retweet Count","func":"var rt = global.get('ucl_retweets'); \n\nif(msg.tweet.retweeted_status != null){\n    rt++;\n}\nglobal.set('ucl_retweets', rt); \nreturn msg;\n\n    \n      \n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4810,"y":220,"wires":[[]]},{"id":"8229a956.7f2ac8","type":"function","z":"105a4573.6dbd83","name":"Tweet Text","func":"\nvar leeds_tweets = global.get('leeds_text'); \n\nvar key = 'x'; \nvar temp = {};\ntemp[key] = msg.tweet.text;\nleeds_tweets.push(temp);\nglobal.set('leeds_text', leeds_tweets);\nmsg.payload = leeds_tweets;\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":640,"y":520,"wires":[[]]},{"id":"a20d385.df6b3c8","type":"function","z":"105a4573.6dbd83","name":"Tweet Count","func":"var t = global.get('leeds_tweets'); \n\n\nif(msg.tweet.retweeted_status == null){\n    t++;\n}\nglobal.set('leeds_tweets', t); \nreturn msg;\n\n    \n      \n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":638.0000076293945,"y":583.2499847412109,"wires":[[]]},{"id":"146ce8a9.392bb7","type":"function","z":"105a4573.6dbd83","name":"Retweet Count","func":"var rt = global.get('leeds_retweets'); \n\nif(msg.tweet.retweeted_status != null){\n    rt++;\n}\nglobal.set('leeds_retweets', rt); \nreturn msg;\n\n    \n      \n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":647,"y":644.25,"wires":[[]]},{"id":"d2b008d0.17fc78","type":"function","z":"105a4573.6dbd83","name":"Tweet Text","func":"\nvar icl_tweets = global.get('icl_text'); \n\n\n\nvar key = 'x'; \nvar temp = {};\ntemp[key] = msg.tweet.text;\nicl_tweets.push(temp);\nglobal.set('icl_text', icl_tweets);\nmsg.payload = icl_tweets;\nreturn msg;\n\n\n\n// }\n// else{\n//     msg.payload = icl_tweets;    \n//     global.set('icl_text', []);\n//     return msg;\n// }\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":550,"y":60,"wires":[[]]},{"id":"3c4e0813.9df158","type":"function","z":"105a4573.6dbd83","name":"Tweet Count","func":"var t = global.get('icl_tweets'); \n\n\nif(msg.tweet.retweeted_status == null){\n    t++;\n}\nglobal.set('icl_tweets', t); \nreturn msg;\n\n    \n      \n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":548,"y":121.25,"wires":[[]]},{"id":"c769febf.71f2b","type":"function","z":"105a4573.6dbd83","name":"Retweet Count","func":"var rt = global.get('icl_retweets'); \nvar icl_push = global.get('icl_push'); \n\n\nif(msg.tweet.retweeted_status != null){\n    rt++;\n}\nglobal.set('icl_retweets', rt); \nreturn msg;\n\n    \n      \n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":557,"y":184.25,"wires":[[]]},{"id":"b3b2dbec.39d7","type":"function","z":"105a4573.6dbd83","name":"","func":"if(msg.payload == 0){\n    msg.payload = true;\n    return msg; \n}\n// return msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":500,"y":440,"wires":[["87a0eb04.db9008"]]},{"id":"bb7883ea.5b97c","type":"function","z":"105a4573.6dbd83","name":"","func":"if(msg.payload == 0){\n    msg.payload = \"\";\n    return msg; \n}\nreturn;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1935,"y":320,"wires":[["469a4f65.93a548"]],"l":false},{"id":"4e788dcf.94892c","type":"function","z":"105a4573.6dbd83","name":"","func":"if(msg.payload == 0){\n    msg.payload = true;\n    return msg; \n}\n// return msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1780,"y":440,"wires":[["acde248.bffda58"]]},{"id":"aa3e591c.ca0408","type":"function","z":"105a4573.6dbd83","name":"Search for Cambridge","func":"if(msg.payload == 0){\n    msg.payload = 'Cambridge_Uni';\n    return msg;\n}\nelse{\n    return; \n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1750,"y":260,"wires":[["469a4f65.93a548"]]},{"id":"30732203.b9aefe","type":"function","z":"105a4573.6dbd83","name":"Search for Cardiff","func":"if(msg.payload == 0){\n    msg.payload = 'cardiffuni';\n    return msg;\n}\nelse{\n    return; \n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2190,"y":260,"wires":[["db6ac94.4df8338"]]},{"id":"222657d2.9afd6","type":"function","z":"105a4573.6dbd83","name":"","func":"if(msg.payload == 0){\n    msg.payload = true;\n    return msg; \n}\n// return msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2220,"y":440,"wires":[["11786c81.bf47e3"]]},{"id":"384398d6.0bb6b8","type":"function","z":"105a4573.6dbd83","name":"","func":"if(msg.payload == 0){\n    msg.payload = \"\";\n    return msg; \n}\nreturn;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2355,"y":320,"wires":[["db6ac94.4df8338"]],"l":false},{"id":"377c1ae7.ddbc66","type":"function","z":"105a4573.6dbd83","name":"","func":"if(msg.payload == 0){\n    msg.payload = true;\n    return msg; \n}\n// return msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2580,"y":440,"wires":[["4d0b9422.9a2c74"]]},{"id":"a42114a9.4d86e8","type":"function","z":"105a4573.6dbd83","name":"Search for Durham","func":"if(msg.payload == 0){\n    msg.payload = 'durham_uni';\n    return msg;\n}\nelse{\n    return; \n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2540,"y":280,"wires":[["95fc928d.04a518"]]},{"id":"d8a2f6d6.1ebc1","type":"function","z":"105a4573.6dbd83","name":"","func":"if(msg.payload == 0){\n    msg.payload = \"\";\n    return msg; \n}\nreturn;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2735,"y":320,"wires":[["95fc928d.04a518"]],"l":false},{"id":"2a56c62c.2b7712","type":"function","z":"105a4573.6dbd83","name":"","func":"if(msg.payload == 0){\n    msg.payload = true;\n    return msg; \n}\n// return msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2960,"y":440,"wires":[["f9f2bcef.75bfa8"]]},{"id":"cbe8181d.81157","type":"function","z":"105a4573.6dbd83","name":"Search for Edinburgh","func":"if(msg.payload == 0){\n    msg.payload = 'EdinburghUni';\n    return msg;\n}\nelse{\n    return; \n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2960,"y":240,"wires":[["1cf7e64b.65d832"]]},{"id":"c35243bc.550aa","type":"function","z":"105a4573.6dbd83","name":"","func":"if(msg.payload == 0){\n    msg.payload = \"\";\n    return msg; \n}\nreturn;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3135,"y":320,"wires":[["1cf7e64b.65d832"]],"l":false},{"id":"e634a610.c62338","type":"function","z":"105a4573.6dbd83","name":"Search for Exeter","func":"if(msg.payload == 0){\n    msg.payload = 'UniofExeter';\n    return msg;\n}\nelse{\n    return; \n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3370,"y":280,"wires":[["48d9870c.d06e68"]]},{"id":"966d55aa.81873","type":"function","z":"105a4573.6dbd83","name":"","func":"if(msg.payload == 0){\n    msg.payload = true;\n    return msg; \n}\n// return msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3380,"y":420,"wires":[["bd659652.332258"]]},{"id":"68c942e2.750784","type":"function","z":"105a4573.6dbd83","name":"","func":"if(msg.payload == 0){\n    msg.payload = \"\";\n    return msg; \n}\nreturn;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3555,"y":320,"wires":[["48d9870c.d06e68"]],"l":false},{"id":"da0c86c6.0e8a1","type":"function","z":"105a4573.6dbd83","name":"Search for Glasgow","func":"if(msg.payload == 0){\n    msg.payload = 'UofGlasgow';\n    return msg;\n}\nelse{\n    return; \n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3740,"y":280,"wires":[["70ffd3e7.cbf71c"]]},{"id":"145e6f0f.3547d9","type":"function","z":"105a4573.6dbd83","name":"","func":"if(msg.payload == 0){\n    msg.payload = true;\n    return msg; \n}\n// return msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3730,"y":440,"wires":[["3cc5a5a6.00a34a"]]},{"id":"976994ee.7e658","type":"function","z":"105a4573.6dbd83","name":"","func":"if(msg.payload == 0){\n    msg.payload = \"\";\n    return msg; \n}\nreturn;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3955,"y":320,"wires":[["70ffd3e7.cbf71c"]],"l":false},{"id":"bd55e9ce.8e90b8","type":"function","z":"105a4573.6dbd83","name":"Search for Sheffield","func":"if(msg.payload == 0){\n    msg.payload = 'sheffielduni';\n    return msg;\n}\nelse{\n    return; \n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4150,"y":300,"wires":[["bd6f6c7d.38ca9"]]},{"id":"ae635311.f35b88","type":"function","z":"105a4573.6dbd83","name":"","func":"if(msg.payload == 0){\n    msg.payload = true;\n    return msg; \n}\n// return msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4150,"y":440,"wires":[["8cd08429.71da8"]]},{"id":"b1e4f151.e06e38","type":"twitter in","z":"105a4573.6dbd83","twitter":"bb10ed42.1d56c","tags":"","user":"false","name":"ICL","inputs":1,"x":330,"y":260,"wires":[["d2b008d0.17fc78","3c4e0813.9df158","c769febf.71f2b"]]},{"id":"3b858b8.b5cb774","type":"twitter in","z":"105a4573.6dbd83","twitter":"bb10ed42.1d56c","tags":"","user":"false","name":"UCL","inputs":1,"x":4630,"y":260,"wires":[["2b2b4514.e01b22","72506e9f.12b178","17e34384.fed4ac"]]},{"id":"8887cb0b.c8298","type":"twitter in","z":"105a4573.6dbd83","twitter":"bb10ed42.1d56c","tags":"","user":"false","name":"Leeds","inputs":1,"x":510,"y":720,"wires":[["8229a956.7f2ac8","a20d385.df6b3c8","146ce8a9.392bb7"]]},{"id":"469a4f65.93a548","type":"twitter in","z":"105a4573.6dbd83","twitter":"bb10ed42.1d56c","tags":"","user":"false","name":"Cambridge","inputs":1,"x":1990,"y":260,"wires":[["16df0656.af7ea2","c9d38d27.ae292","3957703.178f21"]]},{"id":"db6ac94.4df8338","type":"twitter in","z":"105a4573.6dbd83","twitter":"bb10ed42.1d56c","tags":"","user":"false","name":"Cardiff","inputs":1,"x":2370,"y":260,"wires":[["aab0dd20.1dcc3","2a251fba.52a83","57c2051a.534174"]]},{"id":"95fc928d.04a518","type":"twitter in","z":"105a4573.6dbd83","twitter":"bb10ed42.1d56c","tags":"","user":"false","name":"Durham","inputs":1,"x":2740,"y":260,"wires":[["56503683.66af28","f94c40fb.3a567","4c302c99.a02d3c"]]},{"id":"1cf7e64b.65d832","type":"twitter in","z":"105a4573.6dbd83","twitter":"bb10ed42.1d56c","tags":"","user":"false","name":"Edinburgh","inputs":1,"x":3170,"y":280,"wires":[["d4f895ae.c822d8","fb59a801.af279","4e7b9ae1.f8663c"]]},{"id":"48d9870c.d06e68","type":"twitter in","z":"105a4573.6dbd83","twitter":"bb10ed42.1d56c","tags":"","user":"false","name":"Exeter","inputs":1,"x":3550,"y":280,"wires":[["4051770.bcbe908","352d6576.cbd422","d98500a7.683558"]]},{"id":"70ffd3e7.cbf71c","type":"twitter in","z":"105a4573.6dbd83","twitter":"bb10ed42.1d56c","tags":"","user":"false","name":"Glasgow","inputs":1,"x":3940,"y":280,"wires":[["e0cc2f26.aae768","3406c338.2ef084","af077587.0b85d"]]},{"id":"bd6f6c7d.38ca9","type":"twitter in","z":"105a4573.6dbd83","twitter":"bb10ed42.1d56c","tags":"","user":"false","name":"Sheffield","inputs":1,"x":4320,"y":260,"wires":[["1707dd09.9dffe3","fb60ed16.ecf9c","70a4bf6c.ce2b6"]]},{"id":"a48364bd.609ea","type":"countdown","z":"105a4573.6dbd83","name":"Countdown 1","topic":"","payloadTimerStart":"false","payloadTimerStartType":"bool","payloadTimerStop":"true","payloadTimerStopType":"bool","timer":"30","resetWhileRunning":false,"setTimeToNewWhileRunning":true,"startCountdownOnControlMessage":false,"x":320,"y":380,"wires":[[],["baacf107.d93178","5f33fab1.7c53fc","b3b2dbec.39d7"]]},{"id":"87a0eb04.db9008","type":"countdown","z":"105a4573.6dbd83","name":"Countdown Ox","topic":"","payloadTimerStart":"true","payloadTimerStartType":"bool","payloadTimerStop":"false","payloadTimerStopType":"bool","timer":"30","resetWhileRunning":false,"setTimeToNewWhileRunning":true,"startCountdownOnControlMessage":false,"x":660,"y":380,"wires":[[],["2759e789.f1791","c129f4fa.8b9a28","f8c02975.53d1e"]]},{"id":"acde248.bffda58","type":"countdown","z":"105a4573.6dbd83","name":"Countdown Cambridge","topic":"","payloadTimerStart":"true","payloadTimerStartType":"bool","payloadTimerStop":"false","payloadTimerStopType":"bool","timer":"30","resetWhileRunning":false,"setTimeToNewWhileRunning":true,"startCountdownOnControlMessage":false,"x":1970,"y":380,"wires":[[],["bb7883ea.5b97c","30732203.b9aefe","222657d2.9afd6"]]},{"id":"11786c81.bf47e3","type":"countdown","z":"105a4573.6dbd83","name":"Countdown Cardiff","topic":"","payloadTimerStart":"true","payloadTimerStartType":"bool","payloadTimerStop":"false","payloadTimerStopType":"bool","timer":"30","resetWhileRunning":false,"setTimeToNewWhileRunning":true,"startCountdownOnControlMessage":false,"x":2400,"y":380,"wires":[[],["384398d6.0bb6b8","377c1ae7.ddbc66","a42114a9.4d86e8"]]},{"id":"4d0b9422.9a2c74","type":"countdown","z":"105a4573.6dbd83","name":"Countdown Durham","topic":"","payloadTimerStart":"true","payloadTimerStartType":"bool","payloadTimerStop":"false","payloadTimerStopType":"bool","timer":"30","resetWhileRunning":false,"setTimeToNewWhileRunning":true,"startCountdownOnControlMessage":false,"x":2740,"y":380,"wires":[[],["d8a2f6d6.1ebc1","2a56c62c.2b7712","cbe8181d.81157"]]},{"id":"f9f2bcef.75bfa8","type":"countdown","z":"105a4573.6dbd83","name":"Countdown Edinburgh","topic":"","payloadTimerStart":"true","payloadTimerStartType":"bool","payloadTimerStop":"false","payloadTimerStopType":"bool","timer":"30","resetWhileRunning":false,"setTimeToNewWhileRunning":true,"startCountdownOnControlMessage":false,"x":3150,"y":380,"wires":[[],["c35243bc.550aa","e634a610.c62338","966d55aa.81873"]]},{"id":"bd659652.332258","type":"countdown","z":"105a4573.6dbd83","name":"Countdown Exeter","topic":"","payloadTimerStart":"true","payloadTimerStartType":"bool","payloadTimerStop":"false","payloadTimerStopType":"bool","timer":"30","resetWhileRunning":false,"setTimeToNewWhileRunning":true,"startCountdownOnControlMessage":false,"x":3570,"y":380,"wires":[[],["68c942e2.750784","da0c86c6.0e8a1","145e6f0f.3547d9"]]},{"id":"3cc5a5a6.00a34a","type":"countdown","z":"105a4573.6dbd83","name":"Countdown Glasgow","topic":"","payloadTimerStart":"true","payloadTimerStartType":"bool","payloadTimerStop":"false","payloadTimerStopType":"bool","timer":"30","resetWhileRunning":false,"setTimeToNewWhileRunning":true,"startCountdownOnControlMessage":false,"x":3940,"y":380,"wires":[[],["976994ee.7e658","bd55e9ce.8e90b8","ae635311.f35b88"]]},{"id":"8cd08429.71da8","type":"countdown","z":"105a4573.6dbd83","name":"Countdown Sheffield","topic":"","payloadTimerStart":"true","payloadTimerStartType":"bool","payloadTimerStop":"false","payloadTimerStopType":"bool","timer":"30","resetWhileRunning":false,"setTimeToNewWhileRunning":true,"startCountdownOnControlMessage":false,"x":4270,"y":380,"wires":[[],["4dbff783.4433e","38001b0a.41f364","4c760490.ab72bc"]]},{"id":"4dbff783.4433e","type":"function","z":"105a4573.6dbd83","name":"","func":"if(msg.payload == 0){\n    msg.payload = true;\n    return msg; \n}\n// return msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4470,"y":480,"wires":[["5bbf633d.12fa8c"]]},{"id":"4c760490.ab72bc","type":"function","z":"105a4573.6dbd83","name":"Search for UCL","func":"if(msg.payload == 0){\n    msg.payload = 'ucl';\n    return msg;\n}\nelse{\n    return; \n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4460,"y":300,"wires":[["3b858b8.b5cb774"]]},{"id":"38001b0a.41f364","type":"function","z":"105a4573.6dbd83","name":"","func":"if(msg.payload == 0){\n    msg.payload = \"\";\n    return msg; \n}\nreturn;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4275,"y":340,"wires":[["bd6f6c7d.38ca9"]],"l":false},{"id":"5bbf633d.12fa8c","type":"countdown","z":"105a4573.6dbd83","name":"Countdown UCL","topic":"","payloadTimerStart":"true","payloadTimerStartType":"bool","payloadTimerStop":"false","payloadTimerStopType":"bool","timer":"30","resetWhileRunning":false,"setTimeToNewWhileRunning":true,"startCountdownOnControlMessage":false,"x":4680,"y":380,"wires":[[],["91f9d010.eb3ec","13ac4df5.af5b82","982b8a92.dccd68"]]},{"id":"91f9d010.eb3ec","type":"function","z":"105a4573.6dbd83","name":"","func":"if(msg.payload == 0){\n    msg.payload = \"\";\n    return msg; \n}\nreturn;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4655,"y":320,"wires":[["3b858b8.b5cb774"]],"l":false},{"id":"13ac4df5.af5b82","type":"function","z":"105a4573.6dbd83","name":"","func":"if(msg.payload == 0){\n    msg.payload = true;\n    return msg; \n}\n// return msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":230,"y":920,"wires":[["791be279.e76f94"]]},{"id":"982b8a92.dccd68","type":"function","z":"105a4573.6dbd83","name":"Search for Leeds","func":"if(msg.payload == 0){\n    msg.payload = 'UniversityLeeds';\n    return msg;\n}\nelse{\n    return; \n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":280,"y":720,"wires":[["8887cb0b.c8298"]]},{"id":"791be279.e76f94","type":"countdown","z":"105a4573.6dbd83","name":"Countdown Leeds","topic":"","payloadTimerStart":"true","payloadTimerStartType":"bool","payloadTimerStop":"false","payloadTimerStopType":"bool","timer":"30","resetWhileRunning":false,"setTimeToNewWhileRunning":true,"startCountdownOnControlMessage":false,"x":530,"y":860,"wires":[[],["654128d6.ce96e8","a2ea1ac7.703b68","6661df17.d2e6"]]},{"id":"654128d6.ce96e8","type":"function","z":"105a4573.6dbd83","name":"","func":"if(msg.payload == 0){\n    msg.payload = \"\";\n    return msg; \n}\nreturn;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":515,"y":780,"wires":[["8887cb0b.c8298"]],"l":false},{"id":"2759e789.f1791","type":"function","z":"105a4573.6dbd83","name":"","func":"if(msg.payload == 0){\n    msg.payload = \"\";\n    return msg; \n}\nreturn;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":715,"y":320,"wires":[["1f761494.4d880b"]],"l":false},{"id":"ba38eb8f.b32ff","type":"function","z":"105a4573.6dbd83","name":"Tweet Text","func":"\nvar bham_tweets = global.get('bham_text'); \n\n\n\nvar key = 'x'; \nvar temp = {};\ntemp[key] = msg.tweet.text;\nbham_tweets.push(temp);\nglobal.set('bham_text', bham_tweets);\nmsg.payload = bham_tweets;\nreturn msg;\n\n\n\n// }\n// else{\n//     msg.payload = icl_tweets;    \n//     global.set('icl_text', []);\n//     return msg;\n// }\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1330,"y":80,"wires":[[]]},{"id":"e9c57395.d56698","type":"function","z":"105a4573.6dbd83","name":"Tweet Count","func":"var t = global.get('bham_tweets'); \n\n\nif(msg.tweet.retweeted_status == null){\n    t++;\n}\nglobal.set('bham_tweets', t); \nreturn msg;\n\n    \n      \n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1328,"y":141.25,"wires":[[]]},{"id":"787c3928.21eb58","type":"function","z":"105a4573.6dbd83","name":"Retweet Count","func":"var rt = global.get('bham_retweets'); \n\nif(msg.tweet.retweeted_status != null){\n    rt++;\n}\nglobal.set('bham_retweets', rt); \nreturn msg;\n\n    \n      \n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1337,"y":204.25,"wires":[[]]},{"id":"640a37dc.ed2c2","type":"function","z":"105a4573.6dbd83","name":"Tweet Text","func":"\nvar brist_tweets = global.get('brist_text'); \n\n\n\nvar key = 'x'; \nvar temp = {};\ntemp[key] = msg.tweet.text;\nbrist_tweets.push(temp);\nglobal.set('brist_text', brist_tweets);\nmsg.payload = brist_tweets;\nreturn msg;\n\n\n\n// }\n// else{\n//     msg.payload = icl_tweets;    \n//     global.set('icl_text', []);\n//     return msg;\n// }\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1730,"y":80,"wires":[[]]},{"id":"7e4070d5.3493e","type":"function","z":"105a4573.6dbd83","name":"Tweet Count","func":"var t = global.get('brist_tweets'); \n\n\nif(msg.tweet.retweeted_status == null){\n    t++;\n}\nglobal.set('brist_tweets', t); \nreturn msg;\n\n    \n      \n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1728,"y":141.25,"wires":[[]]},{"id":"63e74650.fb0258","type":"function","z":"105a4573.6dbd83","name":"Retweet Count","func":"var rt = global.get('brist_retweets'); \n\nif(msg.tweet.retweeted_status != null){\n    rt++;\n}\nglobal.set('brist_retweets', rt); \nreturn msg;\n\n    \n      \n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1737,"y":204.25,"wires":[[]]},{"id":"5253f939.82eba8","type":"function","z":"105a4573.6dbd83","name":"Tweet Text","func":"\nvar ox_tweets = global.get('ox_text'); \n\n\n\nvar key = 'x'; \nvar temp = {};\ntemp[key] = msg.tweet.text;\nox_tweets.push(temp);\nglobal.set('ox_text', ox_tweets);\nmsg.payload = ox_tweets;\nreturn msg;\n\n\n\n// }\n// else{\n//     msg.payload = icl_tweets;    \n//     global.set('icl_text', []);\n//     return msg;\n// }\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":930,"y":80,"wires":[[]]},{"id":"e960ffdb.d2d97","type":"function","z":"105a4573.6dbd83","name":"Tweet Count","func":"var t = global.get('ox_tweets'); \n\n\nif(msg.tweet.retweeted_status == null){\n    t++;\n}\nglobal.set('ox_tweets', t); \nreturn msg;\n\n    \n      \n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":928,"y":141.25,"wires":[[]]},{"id":"c8c546e3.1c3d","type":"function","z":"105a4573.6dbd83","name":"Retweet Count","func":"var rt = global.get('ox_retweets'); \n\nif(msg.tweet.retweeted_status != null){\n    rt++;\n}\nglobal.set('ox_retweets', rt); \nreturn msg;\n\n    \n      \n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":937,"y":204.25,"wires":[[]]},{"id":"c129f4fa.8b9a28","type":"function","z":"105a4573.6dbd83","name":"Search for Bham","func":"if(msg.payload == 0){\n    msg.payload = 'unibirmingham';\n    return msg;\n}\nelse{\n    return; \n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":950,"y":260,"wires":[["e0edf710.a05e88"]]},{"id":"8756ca6a.08c83","type":"function","z":"105a4573.6dbd83","name":"","func":"if(msg.payload == 0){\n    msg.payload = \"\";\n    return msg; \n}\nreturn;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1155,"y":320,"wires":[["e0edf710.a05e88"]],"l":false},{"id":"e00655ce.ca40f8","type":"function","z":"105a4573.6dbd83","name":"Search for Bristol","func":"if(msg.payload == 0){\n    msg.payload = 'BristolUni';\n    return msg;\n}\nelse{\n    return; \n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1350,"y":260,"wires":[["dec87674.8cfb98"]]},{"id":"8b5f9679.fbcfb","type":"function","z":"105a4573.6dbd83","name":"","func":"if(msg.payload == 0){\n    msg.payload = \"\";\n    return msg; \n}\nreturn;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1555,"y":320,"wires":[["dec87674.8cfb98"]],"l":false},{"id":"f8c02975.53d1e","type":"function","z":"105a4573.6dbd83","name":"","func":"if(msg.payload == 0){\n    msg.payload = true;\n    return msg; \n}\n// return msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":880,"y":440,"wires":[["408e9e1a.80e438"]]},{"id":"fed2981e.bc9af","type":"function","z":"105a4573.6dbd83","name":"","func":"if(msg.payload == 0){\n    msg.payload = true;\n    return msg; \n}\n// return msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1360,"y":440,"wires":[["5c0c2eb7.293b68"]]},{"id":"1f761494.4d880b","type":"twitter in","z":"105a4573.6dbd83","twitter":"bb10ed42.1d56c","tags":"","user":"false","name":"Oxford","inputs":1,"x":760,"y":260,"wires":[["5253f939.82eba8","e960ffdb.d2d97","c8c546e3.1c3d"]]},{"id":"e0edf710.a05e88","type":"twitter in","z":"105a4573.6dbd83","twitter":"bb10ed42.1d56c","tags":"","user":"false","name":"Birmingham","inputs":1,"x":1150,"y":260,"wires":[["ba38eb8f.b32ff","e9c57395.d56698","787c3928.21eb58"]]},{"id":"dec87674.8cfb98","type":"twitter in","z":"105a4573.6dbd83","twitter":"bb10ed42.1d56c","tags":"","user":"false","name":"Bristol","inputs":1,"x":1550,"y":260,"wires":[["640a37dc.ed2c2","7e4070d5.3493e","63e74650.fb0258"]]},{"id":"408e9e1a.80e438","type":"countdown","z":"105a4573.6dbd83","name":"Countdown Bham","topic":"","payloadTimerStart":"true","payloadTimerStartType":"bool","payloadTimerStop":"false","payloadTimerStopType":"bool","timer":"30","resetWhileRunning":false,"setTimeToNewWhileRunning":true,"startCountdownOnControlMessage":false,"x":1150,"y":380,"wires":[[],["8756ca6a.08c83","e00655ce.ca40f8","fed2981e.bc9af"]]},{"id":"5c0c2eb7.293b68","type":"countdown","z":"105a4573.6dbd83","name":"Countdown Bristol","topic":"","payloadTimerStart":"true","payloadTimerStartType":"bool","payloadTimerStop":"false","payloadTimerStopType":"bool","timer":"30","resetWhileRunning":false,"setTimeToNewWhileRunning":true,"startCountdownOnControlMessage":false,"x":1570,"y":380,"wires":[[],["8b5f9679.fbcfb","4e788dcf.94892c","aa3e591c.ca0408"]]},{"id":"a2ea1ac7.703b68","type":"function","z":"105a4573.6dbd83","name":"","func":"if(msg.payload == 0){\n    msg.payload = true;\n    return msg; \n}\n// return msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":790,"y":900,"wires":[["9b9a6d8f.e5f07"]]},{"id":"6661df17.d2e6","type":"function","z":"105a4573.6dbd83","name":"Search for Liverpool","func":"if(msg.payload == 0){\n    msg.payload = 'LivUni';\n    return msg;\n}\nelse{\n    return; \n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":790,"y":740,"wires":[["f91b76d2.167bc8"]]},{"id":"f91b76d2.167bc8","type":"twitter in","z":"105a4573.6dbd83","twitter":"bb10ed42.1d56c","tags":"","user":"false","name":"Liverpool","inputs":1,"x":1060,"y":740,"wires":[["ee511775.38c5d","41744d64.155864","b17ecaa6.8b4b"]]},{"id":"8a38712f.1b4b38","type":"function","z":"105a4573.6dbd83","name":"","func":"if(msg.payload == 0){\n    msg.payload = \"\";\n    return msg; \n}\nreturn;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1055,"y":800,"wires":[["f91b76d2.167bc8"]],"l":false},{"id":"b17ecaa6.8b4b","type":"function","z":"105a4573.6dbd83","name":"Retweet Count","func":"var rt = global.get('liv_retweets'); \n\nif(msg.tweet.retweeted_status != null){\n    rt++;\n}\nglobal.set('liv_retweets', rt); \nreturn msg;\n\n    \n      \n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1187,"y":664.25,"wires":[[]]},{"id":"41744d64.155864","type":"function","z":"105a4573.6dbd83","name":"Tweet Count","func":"var t = global.get('liv_tweets'); \n\n\nif(msg.tweet.retweeted_status == null){\n    t++;\n}\nglobal.set('liv_tweets', t); \nreturn msg;\n\n    \n      \n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1178.0000076293945,"y":603.2499847412109,"wires":[[]]},{"id":"ee511775.38c5d","type":"function","z":"105a4573.6dbd83","name":"Tweet Text","func":"\nvar liv_tweets = global.get('liv_text'); \n\nvar key = 'x'; \nvar temp = {};\ntemp[key] = msg.tweet.text;\nliv_tweets.push(temp);\nglobal.set('liv_text', liv_tweets);\nmsg.payload = liv_tweets;\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1180,"y":540,"wires":[[]]},{"id":"9b9a6d8f.e5f07","type":"countdown","z":"105a4573.6dbd83","name":"Countdown Liverpool","topic":"","payloadTimerStart":"true","payloadTimerStartType":"bool","payloadTimerStop":"false","payloadTimerStopType":"bool","timer":"30","resetWhileRunning":false,"setTimeToNewWhileRunning":true,"startCountdownOnControlMessage":false,"x":1060,"y":860,"wires":[[],["3e9213e7.d1a4d4","cc986917.624a4","8a38712f.1b4b38"]]},{"id":"3e9213e7.d1a4d4","type":"function","z":"105a4573.6dbd83","name":"Search for Manchester","func":"if(msg.payload == 0){\n    msg.payload = 'OfficialUoM';\n    return msg;\n}\nelse{\n    return; \n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1410,"y":740,"wires":[["1cb4294a.d830cf"]]},{"id":"cc986917.624a4","type":"function","z":"105a4573.6dbd83","name":"","func":"if(msg.payload == 0){\n    msg.payload = true;\n    return msg; \n}\n// return msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1400,"y":900,"wires":[["75110982.a7dcd"]]},{"id":"75110982.a7dcd","type":"countdown","z":"105a4573.6dbd83","name":"Countdown Manchester","topic":"","payloadTimerStart":"true","payloadTimerStartType":"bool","payloadTimerStop":"false","payloadTimerStopType":"bool","timer":"30","resetWhileRunning":false,"setTimeToNewWhileRunning":true,"startCountdownOnControlMessage":false,"x":1680,"y":860,"wires":[[],["1881f117.a452df","e292f877.507818","54dff13a.5d9668"]]},{"id":"1cb4294a.d830cf","type":"twitter in","z":"105a4573.6dbd83","twitter":"bb10ed42.1d56c","tags":"","user":"false","name":"Manchester","inputs":1,"x":1680,"y":740,"wires":[["17ef7871.9641a","e1890dd2.0f8e1","dd2ea5a5.dd8d18"]]},{"id":"dd2ea5a5.dd8d18","type":"function","z":"105a4573.6dbd83","name":"Retweet Count","func":"var rt = global.get('man_retweets'); \n\nif(msg.tweet.retweeted_status != null){\n    rt++;\n}\nglobal.set('man_retweets', rt); \nreturn msg;\n\n    \n      \n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1797,"y":664.25,"wires":[[]]},{"id":"e1890dd2.0f8e1","type":"function","z":"105a4573.6dbd83","name":"Tweet Count","func":"var t = global.get('man_tweets'); \n\n\nif(msg.tweet.retweeted_status == null){\n    t++;\n}\nglobal.set('man_tweets', t); \nreturn msg;\n\n    \n      \n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1788.0000076293945,"y":603.2499847412109,"wires":[[]]},{"id":"17ef7871.9641a","type":"function","z":"105a4573.6dbd83","name":"Tweet Text","func":"\nvar man_tweets = global.get('man_text'); \n\nvar key = 'x'; \nvar temp = {};\ntemp[key] = msg.tweet.text;\nman_tweets.push(temp);\nglobal.set('man_text', man_tweets);\nmsg.payload = man_tweets;\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1790,"y":540,"wires":[[]]},{"id":"53e02d8e.0ae7ac","type":"function","z":"105a4573.6dbd83","name":"Tweet Text","func":"\nvar ibm_tweets = global.get('ibm_text'); \n\nvar key = 'x'; \nvar temp = {};\ntemp[key] = msg.tweet.text;\nibm_tweets.push(temp);\nglobal.set('ibm_text', ibm_tweets);\nmsg.payload = ibm_tweets;\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2410,"y":540,"wires":[[]]},{"id":"e292f877.507818","type":"function","z":"105a4573.6dbd83","name":"Search for IBM","func":"if(msg.payload == 0){\n    msg.payload = 'IBM';\n    return msg;\n}\nelse{\n    return; \n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2000,"y":740,"wires":[["2a1af15b.4aa796"]]},{"id":"1881f117.a452df","type":"function","z":"105a4573.6dbd83","name":"","func":"if(msg.payload == 0){\n    msg.payload = true;\n    return msg; \n}\n// return msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2020,"y":900,"wires":[["57136251.d9abe4"]]},{"id":"57136251.d9abe4","type":"countdown","z":"105a4573.6dbd83","name":"Countdown IBM","topic":"","payloadTimerStart":"true","payloadTimerStartType":"bool","payloadTimerStop":"false","payloadTimerStopType":"bool","timer":"30","resetWhileRunning":false,"setTimeToNewWhileRunning":true,"startCountdownOnControlMessage":false,"x":2280,"y":860,"wires":[[],["88652f5f.c5fc78"]]},{"id":"2a1af15b.4aa796","type":"twitter in","z":"105a4573.6dbd83","twitter":"bb10ed42.1d56c","tags":"","user":"false","name":"IBM","inputs":1,"x":2280,"y":740,"wires":[["53e02d8e.0ae7ac","e28e384f.d47c6","3b9b6c86.7fcec4"]]},{"id":"3b9b6c86.7fcec4","type":"function","z":"105a4573.6dbd83","name":"Retweet Count","func":"var rt = global.get('ibm_retweets'); \n\nif(msg.tweet.retweeted_status != null){\n    rt++;\n}\nglobal.set('ibm_retweets', rt); \nreturn msg;\n\n    \n      \n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2417,"y":664.25,"wires":[[]]},{"id":"e28e384f.d47c6","type":"function","z":"105a4573.6dbd83","name":"Tweet Count","func":"var t = global.get('ibm_tweets'); \n\n\nif(msg.tweet.retweeted_status == null){\n    t++;\n}\nglobal.set('ibm_tweets', t); \nreturn msg;\n\n    \n      \n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2408.0000076293945,"y":603.2499847412109,"wires":[[]]},{"id":"a8c881ac.7f5ee","type":"template","z":"5d651a81.8ece7c","name":"Working 18/06/2021","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<html>\n<head>\n  <title>Map & Cloud</title>\n  <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css\" rel=\"stylesheet\" integrity=\"sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x\" crossorigin=\"anonymous\">\n  <link href=\"https://fonts.googleapis.com/css?family=Lato&display=swap\" rel=\"stylesheet\">\n  <style>\n\n    body {\n    \tbackground: linear-gradient(to bottom, white, #049cfc, #00ff11, #fbff00, #fc7600, #cc2316, purple);\n    \tbackground-size: 100%;\n    \tbackground-repeat: no-repeat;\n    \tmargin: 0;\n    \tfont-size: 1.15rem;\n    \tline-height: 1.4em;\n    \talign-items: center;\n    \tsnap-snap-type: y proximity;\n    }\n\n    body:before{\n    \tcontent:'';\n    \tposition: fixed;\n    \ttop: 0;\n    \tbottom: 0;\n    \twidth: 100%;\n    \tz-index: -1;\n    \tbackground: linear-gradient(to right bottom, rgba(255,255,255,0.2), #54bbfc 75%);\n    }\n\n    #SnapParent {\n    \tbackground-color: #ffffff;\n    \tmargin: 2.5%;\n    \t/*padding: 30px 60px;*/\n    \tborder-radius: 20px;\n    \tbox-shadow: 0 3px 26px 0 rgba(0,0,0,0.20);\n    \twidth: 95%;\n    \theight: 90%;\n    \toverflow: auto;\n    \tposition: absolute;\n    \t/*scroll-snap-type: y proximity;*/\n    \tscroll-snap-align: top;\n    }\n    #SnapParent2 {\n    \tbackground-color: #ffffff;\n    \tmargin: 2.5%;\n    \t/*padding: 30px 60px;*/\n    \tborder-radius: 20px;\n    \tbox-shadow: 0 3px 26px 0 rgba(0,0,0,0.20);\n    \twidth: 95%;\n    \theight: 92%;\n    \toverflow: auto;\n    \tposition: absolute;\n    \t/*scroll-snap-type: y proximity;*/\n    \tscroll-snap-align: top;\n    }\n\n\n    .footer-dark {\n      padding:15px 0;\n      color:#f0f9ff;\n      background-color:#282d32;\n    }\n\n    .footer-dark h3 {\n      margin-top:0;\n      margin-bottom:12px;\n      font-weight:bold;\n      font-size:16px;\n    }\n    .footer-dark ul {\n      padding:0;\n      list-style:none;\n      line-height:1.6;\n      font-size:14px;\n      margin-bottom:0;\n    }\n    .footer-dark ul a {\n      color:inherit;\n      text-decoration:none;\n      opacity:0.6;\n    }\n    .footer-dark ul a:hover {\n      opacity:0.8;\n    }\n    @media (max-width:767px) {\n      .footer-dark .item:not(.social) {\n        text-align:center;\n        padding-bottom:20px;\n      }\n    }\n    .footer-dark .item.text {\n      margin-bottom:36px;\n    }\n    @media (max-width:767px) {\n      .footer-dark .item.text {\n        margin-bottom:0;\n      }\n    }\n    @media (max-width:575.5px) {\n      .second{\n          position: relative;\n          top:-48px;\n          margin-bottom:-50px;\n      }\n    }\n    .footer-dark .item.text p {\n      opacity:0.6;\n      margin-bottom:0;\n    }\n    .footer-dark {\n      text-align:center;\n    }\n    @media (max-width:991px) {\n      .footer-dark {\n        text-align:center;\n        margin-top:20px;\n      }\n      .second{\n        padding-top:30px;\n      }\n    }\n    .second{\n        padding-top:30px;\n    }\n    .footer-dark .copyright {\n      text-align:center;\n      padding-top:0px;\n      opacity:0.3;\n      font-size:13px;\n      margin-bottom:0;\n    }\n    .row{\n        display:flex;\n        justify-content:center;\n    }\n\n    *{\n        box-sizing: border-box;\n    }\n\t.circle{\n\t\tposition: absolute;\n\t\tborder-radius: 50%;\n\t\tbackground: white;\n\t\tanimation: ripple 10s infinite;\n\t\tbox-shadow: 0px 0px 1px 0px #508fb9;\n\t}\n\t.small{\n\t\twidth: 10vw;\n\t\theight: 10vw;\n\t\tleft: -5vw;\n\t\ttop: -5vw;\n\t}\n\t.medium{\n\t\twidth: 20vw;\n\t\theight: 20vw;\n\t\tleft: -10vw;\n\t\ttop: -10vw;\n\t}\n\t.large{\n\t\twidth: 30vw;\n\t\theight: 30vw;\n\t\tleft: -15vw;\n\t\ttop: -15vw;\n\t}\n\t.xlarge{\n\t\twidth: 40vw;\n\t\theight: 40vw;\n\t\tleft: -20vw;\n\t\ttop: -20vw;\n\t}\n\t.xxlarge{\n\t\twidth: 50vw;\n\t\theight: 50vw;\n\t\tleft: -25vw;\n\t\ttop: -25vw;\n\t}\n\t.small1{\n\t\twidth: 10vw;\n\t\theight: 10vw;\n\t\tright:  -5vw;\n\t\ttop:  -5vw;\n\t}\n\t.medium1{\n\t\twidth: 20vw;\n\t\theight: 20vw;\n\t\tright:  -10vw;\n\t\ttop:  -10vw;\n\t}\n\t.large1{\n\t\twidth: 30vw;\n\t\theight: 30vw;\n\t\tright:  -15vw;\n\t\ttop:  -15vw;\n\t}\n\t.xlarge1{\n\t\twidth: 40vw;\n\t\theight: 40vw;\n\t\tright:  -20vw;\n\t\ttop:  -20vw;\n\t}\n\t.xxlarge1{\n\t\twidth: 50vw;\n\t\theight: 50vw;\n\t\tright:  -25vw;\n\t\ttop:  -25vw;\n\t}\n\t.shade1{\n\t\topacity: 0.2;\n\t}\n\t.shade2{\n\t\topacity: 0.4;\n\t}\n\t.shade3{\n\t\topacity: 0.5;\n\t}\n\t.shade4{\n\t\topacity: 0.7;\n\t}\n\t.shade5{\n\t\topacity: 0.8;\n\t}\n\t@keyframes ripple{\n\t\t0%{\n\t\t\ttransform: scale(0.8);\n\t\t}\n\t\t50%{\n\t\t\ttransform: scale(1.3);\n\t\t}\n\t\t100%{\n\t\t\ttransform: scale(0.8);\n\t\t}\n\t}\n\t.logo {\n\t\twidth: 30vw;\n\t\tpadding: 0;\n\t}\n\n    /* Create two equal columns that floats next to each other */\n    .row-cont {\n        margin-top:30px;\n        display: flex;\n        flex-direction: column;\n        width:100%;\n    }\n\n    /* Create two equal columns that sits next to each other */\n    .column {\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n    }\n    .flowchart{\n      padding-top:10px;\n      width:70vw;\n      margin-left:3vw;\n\n    }\n    @media screen and (min-width:651px) {\n        .hidden_desktop {\n            display:none;\n        }\n    }\n    @media screen and (max-width:650px) {\n        .hidden_mobile {\n            display:none;\n        }\n        .flowchart{\n            width:50vw;\n            margin:10px;\n        }\n    }\n    li{\n        margin: 10px 0;\n    }\n     .anychart-credits{\n\t\tdisplay: none;\n\t}\n\n    .button {\n      font-size: 1em;\n      padding: 10px;\n      color: #ffffff;\n      border: 2px solid #049cfc;\n      animation: mymove 5s ease infinite alternate;\n      /*border-radius: 20px/50px;*/\n      border-radius: 5px;\n      text-decoration: none;\n      cursor: pointer;\n      transition: all 0.3s ease-out;\n    }\n    @keyframes mymove {\n      from {background-color: #c0d6fa;\n            border: 5px solid #c0d6fa;\n      }\n      to {background-color: #049cfc;\n          border: 5px solid #049cfc;;\n      }\n    }\n\n    .button:hover {\n      /*background: #ffffff;*/\n      color: yellow;\n    }\n\n    .overlay {\n      position: fixed;\n      top: 0;\n      bottom: 0;\n      left: 0;\n      right: 0;\n      background: rgba(0, 0, 0, 0.7);\n      transition: opacity 500ms;\n      visibility: hidden;\n      opacity: 0;\n    }\n    .overlay:target {\n      visibility: visible;\n      opacity: 1;\n    }\n    .popup {\n      margin: 45px auto;\n      padding: 20px;\n      background: #fff;\n      border-radius: 5px;\n      width: 70%;\n      height: 85%;\n      position: relative;\n      transition: all 5s ease-in-out;\n    }\n    .popup h2 {\n      margin-top: 0;\n      color: #333;\n      font-family: Tahoma, Arial, sans-serif;\n    }\n    .popup .close {\n      position: absolute;\n      top: 20px;\n      right: 30px;\n      transition: all 200ms;\n      font-size: 30px;\n      font-weight: bold;\n      text-decoration: none;\n      color: #333;\n    }\n    .popup .close:hover {\n      color: #06D85F;\n    }\n    .popup .content {\n      max-height: 90%;\n      overflow: auto;\n    }\n    @media screen and (max-width: 700px){\n      .box{\n        width: 70%;\n      }\n      .popup{\n        width: 70%;\n      }\n    }\n\n    @import url(\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css\");\n\n    *{\n        box-sizing: border-box;\n    }\n\n    .search-box{\n      width: fit-content;\n      height: fit-content;\n      position: relative;\n    }\n    .input-search{\n      height: 50px;\n      width: 50px;\n      border-style: none;\n      padding: 10px;\n      font-size: 18px;\n      letter-spacing: 2px;\n      outline: none;\n      border-radius: 25px;\n      transition: all .5s ease-in-out;\n      background-color: #22a6b3;\n      padding-right: 40px;\n      color:#fff;\n    }\n    .input-search::placeholder{\n      color:rgba(255,255,255,.5);\n      font-size: 18px;\n      letter-spacing: 2px;\n      font-weight: 100;\n    }\n    .btn-search{\n      width: 50px;\n      height: 50px;\n      border-style: none;\n      font-size: 20px;\n      font-weight: bold;\n      outline: none;\n      cursor: pointer;\n      border-radius: 50%;\n      position: absolute;\n      right: 0px;\n      color:#ffffff ;\n      background-color:transparent;\n      pointer-events: painted;\n    }\n    .btn-search:focus ~ .input-search{\n      width: 300px;\n      border-radius: 0px;\n      background-color: transparent;\n      border-bottom:1px solid rgba(255,255,255,.5);\n      transition: all 500ms cubic-bezier(0, 0.110, 0.35, 2);\n    }\n    .input-search:focus{\n      width: 300px;\n      border-radius: 0px;\n      background-color: transparent;\n      border-bottom:1px solid rgba(255,255,255,.5);\n      transition: all 500ms cubic-bezier(0, 0.110, 0.35, 2);\n    }\n\n    .slider {\n        position: absolute;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        cursor: pointer;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        background-color: #049cfc;\n        border-radius: 5px;\n    }\n\n    input:checked + .slider {\n        background-color: #cc2316;\n    }\n\n    .choice-container{\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        width:100vw;\n        margin-bottom: 1vh;\n\n\n    }\n    .choice-container .choices{\n        position: relative;\n        display: inline-block;\n        width: 80px;\n        height: 40px;\n        background-color: #36B5EB;\n        color: white;\n        display: block;\n        border-color: none;\n        border-radius: 5px;\n        padding: 0.5rem;\n\n        margin-left:1rem ;\n        font-size: 18px;\n        text-align: center;\n        cursor: pointer;\n    }\n    @media screen and (max-width: 1000px){\n        .choice-container .choices{\n\n            width: 50px;\n            height: 25px;\n\n            font-size: 11px;\n\n        }\n    }\n\n  </style>\n</head>\n\n<body>\n\n<!--style=\"vertical-align:middle; text-align:center\"-->\n\n<div id=\"guide\" class=\"overlay\" style=\"position:absolute;z-index:10;\">\n\t<div class=\"popup\">\n\t\t<h2><b>Guide</b></h2>\n\t\t<a class=\"close\" href=\"#\">&times;</a>\n\t\t<div class=\"content\">\n\t\t    <h4><b>Usage</b></h4>\n\t\t    <p>This tool provides a visualisation of sentiment according to tweets across the country. The data used for visualisation can be specified via a search term or defaulted via preset terms. </p>\n\t\t    <h6><b>Interactivity</b></h6>\n\t\t\t<p>Hovering over a bubble on the map or individual words on the word clouds will display a popup with key information. You can click on a bubble to view it's corresponding word cloud. Double click anywhere else on the map to display the default word clouds. You can zoom in and out of the map by using the controls to the left side of the map. Scroll down under the word clouds to view a line graph displaying sentiment over an adjustable time period.</p>\n\t\t    <h6><b>Provided Data Analysis</b></h6>\n\t\t    <p>Upon loading the page this tool is populated with data collected using preset terms.</p>\n\t\t    <h6><b>Custom Data Analysis</b></h6>\n\t\t    <p>The search bar can be used to populate the tool with a user specified input. Searches support hashtags, username handles, and tweet contents.</p>\n\t\t    <h4><b>Display Information</b></h4>\n\t\t    <p>Each point of interest is displayed using 2 overlapping bubbles - 1 of which represents tweets and the other of which represents retweets; the sizes of which are explained below. The colour represents the general sentiment of the tweets/retweets in that location; the relevant key can be found below.</p>\n\t\t\t<h6><b>Bubble Size</b></h6>\n\t\t\t<p>The radius of each bubble is calculated based on the proportion of tweets/retweets in that location when compared with all other points of interest on the map.</p>\n\t\t\t<h6><b>Bubble Colours</b></h6>\n\t\t\t<p>The colour of each bubble indicates the sentiment in that location and is generated from the numerical score assigned from our data analysis.</p>\n\n            <p><b>Key:</b></p>\n\n\t\t\t<div style=\"width:30px;height:30px;background:#cc2316;display:inline-block;border-radius:10px;vertical-align:middle;\"></div>\n\t\t\t<p style=\"display:inline-block;text-indent: 5px;\">Very Unhappy &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><tab></tab>\n            <div style=\"width:30px;height:30px;background:#fc7600;display:inline-block;border-radius:10px;vertical-align:middle;\"></div>\n\t\t\t<p style=\"display:inline-block;text-indent: 5px;\">Unhappy &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><tab></tab>\n            <div style=\"width:30px;height:30px;background:#fbff00;display:inline-block;border-radius:10px;vertical-align:middle;\"></div>\n\t\t\t<p style=\"display:inline-block;text-indent: 5px;\">Neutral &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><tab></tab>\n            <div style=\"width:30px;height:30px;background:#00ff11;display:inline-block;border-radius:10px;vertical-align:middle;\"></div>\n\t\t\t<p style=\"display:inline-block;text-indent: 5px;\">Happy &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><tab></tab>\n            <div style=\"width:30px;height:30px;background:#049cfc;display:inline-block;border-radius:10px;vertical-align:middle;\"></div>\n\t\t\t<p style=\"display:inline-block;text-indent: 5px;\">Very Happy &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><tab></tab>\n\t\t</div>\n\t</div>\n</div>\n\n\t<div id=\"Container_Logo\" style=\"width: 100%; height: 100%; scroll-snap-align: start; overflow: hidden; position: relative;\">\n\n\t    <div class='ripple-background'>\n\t\t\t<div class='circle xxlarge shade1'></div>\n\t\t\t<div class='circle xlarge shade2'></div>\n\t\t\t<div class='circle large shade3'></div>\n\t\t\t<div class='circle medium shade4'></div>\n\t\t\t<div class='circle small shade5'></div>\n\t\t\t<div class='circle xxlarge1 shade1'></div>\n\t\t\t<div class='circle xlarge1 shade2'></div>\n\t\t\t<div class='circle large1 shade3'></div>\n\t\t\t<div class='circle medium1 shade4'></div>\n\t\t\t<div class='circle small1 shade5'></div>\n\t\t</div>\n\t\t<div id=\"Logo\" style=\"width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center;\">\n\t\t\t<img src=\"https://raw.githubusercontent.com/NasimMM/MoodoftheNation/f3b8e17bc2dfd18cdd96734711a2559c325a6823/LOGOSVG.svg\" class=\"rounded mx-auto d-block img-fluid logo\"/>\n\t\t\t<h1 style=\"color: white; font-size: 2.9vw; font-weight: 700;\">Mood of the Nation</h1>\n\t\t\t<p style=\"font-size: 1.2em; color: white;font-weight: 500;\"><span id=\"rotate\">this</span></p>\n            <script type=\"text/javascript\" src=\"//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js\"></script>\n            <script>\n              var terms = [\"A new era of data analysis\", \"Developed by students at Imperial College London\", \"In conjunction with IBM\"];\n\n              function rotateTerm() {\n                var ct = $(\"#rotate\").data(\"term\") || 0;\n                $(\"#rotate\").data(\"term\", ct == terms.length -1 ? 0 : ct + 1).text(terms[ct]).fadeIn().delay(4500).fadeOut(500, rotateTerm);\n              }\n              rotateTerm();\n            </script>\n            <br>\n            <div class=\"box\" style=\"display:flex; justify-items:center\">\n            \t<a class=\"button\" href=\"#guide\"><b>Guide</b></a>\n            </div>\n\n    \t</div>\n\n\t</div>\n\n\n\n<div style=\"width: 100%; height: 100%; align-content: center; align-items: center; scroll-snap-align: start;\">\n\n    <div id=\"SnapParent\">\n        <div style=\"width: 100%; height: 5%; display: flex; justify-content: center; margin-top: 15px; margin-bottom: 15px;\">\n            <h1 style=\"font-weight:bold;\">Dashboard</h1>\n        </div>\n\n        <div class=\"choice-container\" style=\"width: auto;\">\n            <label class=\"choices\">\n                <input type=\"radio\" name=\"type\" value=\"map\" checked  onclick=\"getQ()\" >\n                <span class=\"slider\"><span class=\"op-text\">Map</span></span>\n            </label>\n            <label class=\"choices\">\n                <input type=\"radio\" name=\"type\" value=\"search\" onclick=\"getQ()\">\n                <span class=\"slider\"><span class=\"op-text\">Search</span></span>\n            </label>\n        </div>\n\n    \t<div id=\"main_cont\" style=\"width: 100%; height: 80%; scroll-snap-align: start; display: flex; flex-direction: column;\">\n\n            <div id=\"Main_Container\" style=\"display: flex !important; flex-direction: row; align-items: center; width: 100%; height: 95%;\">\n\n                <div id=\"LeftContainer\" style=\"display: flex !important; flex-direction: column;  align-items: center; width: 50%; height: 100%;\">\n                  <div id= \"Uni_Mood\" style=\"display: flex; flex-direction: column; width:100%;\">\n                    <h4 id= \"Uni\" style=\"margin-left: 15px;\"> Select a University</h4>\n                    <h4 id= \"Mood\" style=\"margin-left: 15px;\"> Mood </h4>\n                  </div>\n                    <div id=\"Map_Container\"></div>\n\n                </div>\n\n                <div id=\"RightContainer\" style=\"overflow: hidden; display:flex; flex-direction:column ; align-items: center;width: 50%; height: 100%; \">\n\n\t\t\t\t\t\t\t\t\t<div class=\"choice-container\">\n\t\t\t\t\t\t\t\t\t\t\t<label class=\"choices\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"radio\" name=\"choice\" value=\"words\" checked onclick=\"getQ()\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"slider\"><span class=\"op-text\">Words</span></span>\n\t\t\t\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t\t\t\t<label class=\"choices\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"radio\" name=\"choice\" value=\"location\" onclick=\"getQ()\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"slider\"><span class=\"op-text\">Location</span></span>\n\t\t\t\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t\t\t\t<label class=\"choices\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"radio\" name=\"choice\" value=\"trend\" onclick=\"getQ()\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"slider\"><span class=\"op-text\">Trend</span></span>\n\t\t\t\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t\t</div>\n\n            \t\t<div id=\"CloudA_ContainerContainer\" style=\"width: 100%; height: 90%; scroll-snap-align: start;\">\n                        <div id=\"CloudA_Container\" style=\"width: 100%; height: 100%;\"></div>\n            \t\t</div>\n            \t\t<div id=\"CloudB_ContainerContainer\" style=\"width: 100%; height: 90%;\">\n            \t\t\t<div id=\"CloudB_Container\" style=\"width: 100%; height: 100%;\"></div>\n            \t\t</div>\n            \t\t<div id=\"CloudC_ContainerContainer\" style=\"width: 100%; height: 90%; scroll-snap-align: start;\">\n            \t\t\t<div id=\"CloudC_Container\" style=\"width: 100%; height: 100%;\"></div>\n            \t\t</div>\n        \t\t</div>\n\n            </div>\n        </div>\n\n    \t<div id=\"SearchPageDiv\" style=\"width: 100%; height: 80%; scroll-snap-align:start;\">\n    \t\t<div id=\"search_header\" style=\"width: 100%; height: 15%; background-color: transparent; \">\n    \t\t\t<form id=\"id_form\">\n    \t\t\t\t<div style=\"padding: 1%;\">\n    \t\t\t\t\t<span style=\"display: flex; justify-content: center;\">\n    \t\t\t\t\t\t<div style=\"margin-right:10px\">\n    \t\t\t\t\t\t    <label>Search:</label>\n    \t\t\t\t\t\t    <input type=\"text\" name=\"name\" placeholder=\"#hashtag / @user / other\" size=\"24\" id=\"id_text\" required/>\n    \t\t\t\t\t\t</div>\n    \t\t\t\t\t\t<div style=\"margin-right: 10px\">\n    \t\t\t\t\t\t    <label>Time Scale:</label>\n    \t\t\t\t\t\t    <input type=\"number\" name=\"number\" placeholder=\"# Minutes\" size=\"3\" id=\"id_number\" style=\"width: 35%\" required/>\n    \t\t\t\t\t\t</div>\n\n    \t\t\t\t\t\t<input type=\"submit\" value=\"Search\" id=\"id_enter\" style=\"background: #049cfc;color: white;border-radius: 5px; font-weight: bold; border-color: #049cfc; height:32px\"/>\n    \t\t\t\t\t</span>\n    \t\t\t\t</div>\n        \t\t</form>\n    \t\t</div>\n    \t\t<div style=\"width: 100%; height: 80%; display: flex; flex-direction: row;\">\n    \t\t\t<div id=\"SearchCloudA\" style=\"width: 50%; height: 100%;\"></div>\n    \t\t\t<div id=\"SearchCloudB\" style=\"width: 50%; height: 100%;\"></div>\n    \t\t</div>\n        <div style = \"display: flex; justify-content: center; align-items: center\">\n        <h2 id= \"SearchMood\">  </h2>\n    \t  </div>\n    \t</div>\n\n    </div>\n</div>\n\n<div class=\"row-cont\" >\n    <div id=\"SnapParent2\">\n        <div class=\"column\">\n            <h1 style=\"text-align: center; padding: 2%; font-weight:bold;\">What we do?</h1>\n            <ol class=\"list_info\" style=\"list-style: none; padding-right:10%\">\n                <li >We have created a web accessible experience for companies to monitor their\n                                            impact on university students across the country</li>\n                <li >We utilise the Twitter API and IBMs Natural Language Understanding API to analyse the happiness of  tweets related to the company and university. Understanding the sentiment of university tweets about a company can act as an\n                                            indicator of the quality of company recruitment programs in universities.</li>\n                <li >The main features of the webpage include:\n                    <ul>\n                        <li>An interactive map of the UK displaying information such as the ‘Happiness’ of a university.\n                        </li>\n                        <li>The 20 most common words from tweets</li>\n                        <li>The most common locations mentioned in tweets</li>\n                        <li>The happiness trend of a university as a line graph</li>\n                    </ul>\n                </li>\n            </ol>\n        </div>\n        <div class=\"column\" >\n            <h1 style=\"text-align: center; padding: 0%; font-weight:bold;\">How we do it?</h1>\n            <img class=\" hidden_desktop flowchart img-responsive\" src=\"https://github.com/moinbukhari/hello-world/blob/master/flowchart.png?raw=true\">\n            <img class=\" hidden_mobile flowchart img-responsive\" src=\"https://github.com/moinbukhari/hello-world/blob/master/flowchart2.png?raw=true\">\n        </div>\n    </div>\n</div>\n\n<div style=\"width: 100%; height: 100%;\"></div>\n\n<div class=\"footer-dark\">\n    <footer>\n        <div class=\"container\">\n            <div class=\"row\">\n                <div class=\"col-sm-6 col-md-3 item\">\n                    <h3>Brought to you by</h3>\n                    <ul>\n                        <li><a href=\"#\">Arjun Ananth</a></li>\n                        <li><a href=\"#\">Moin Bukhari</a></li>\n                        <li><a href=\"#\">Nayan Kad</a></li>\n                    </ul>\n                </div>\n                <div class=\"col-sm-6 col-md-3 item second\">\n                    <ul>\n                        <li><a href=\"#\">Jun Kim</a></li>\n                        <li><a href=\"#\">Nasim Mohammed</a></li>\n                    </ul>\n                </div>\n                <div class=\"col-sm-6 col-md-3 item\">\n                    <h3>In Collaboration with</h3>\n                    <ul>\n                        <li><a href=\"#\">IBM</a></li>\n                        <li><a href=\"#\">Imperial College London</a></li>\n                    </ul>\n                </div>\n            </div>\n            <p class=\"copyright\">Company Name © 2021</p>\n        </div>\n    </footer>\n</div>\n\n\n\n<!--SCRIPTS-->\n\n\n<!--Ajax Search Bar stuff-->\n<script src=\"https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js\"></script>\n<script type=\"text/javascript\">\n    $(document).ready(function(){\n        setupPage();\n    });\n    function setupPage(){\n        //$('#id_hello').hide();\n        $('#id_form').submit(onSubmitClicked);\n        enterbutton();\n    }\n    function processOK(response) {\n        console.log(response);\n        if (response.identifyresponse){\n            //$('#id_textlang').text(langLookup(response.identifyresponse));\n        } else {\n            //$('#id_textlang').text('No response received from service');\n        }\n    }\n    function processNotOK() {\n        console.log('Error Processing');\n        //$('#id_textlang').text('Oops something went wrong');\n    }\n\n    // function refreshPage(time){\n    //   setTimeout(function () {\n    //       location.reload();\n    //     }, (time * 1000)+(10*1000));\n    // });\n\n    function invokeAjax(message) {\n        console.log('AJAX about to be invoked.');\n        console.log(message);\n        var ajaxData = {};\n        ajaxData.msgdata = message;\n        $.ajax({\n            type: 'POST',\n            url: 'search',\n            data: ajaxData,\n            success: processOK,\n            error: processNotOK\n        });\n    }\n    function onSubmitClicked(event){\n        // $('#id_hello').show();\n        event.preventDefault();\n        var txt = $('#id_text').val();\n        var time = $('#id_number').val();\n        invokeAjax({search: txt, time: time});\n        //refreshpage(time);\n    }\n    function enterbutton(){\n        $(function() {\n            $(\"form input\").keypress(function (e) {\n            if ((e.which && e.which == 13) || (e.keyCode && e.keyCode == 13)) {\n                $('#id_enter').click();\n                return false;\n            } else {\n                return true;\n            }\n        });\n    });\n}\n</script>\n\n<!--UKMAP-->\n<div id=\"ac_style_countries-united-kingdom\" style=\"display:none;\">\n    #Map_Container {\n      width: 100%;\n      height: 100%;\n      margin: 0;\n      padding: 0;\n    }\n</div>\n<!--UKMAP Scripts-->\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.3.15/proj4.js\"></script>\n<script src=\"https://cdn.anychart.com/releases/v8/js/anychart-base.min.js\"></script>\n<script src=\"https://cdn.anychart.com/releases/v8/js/anychart-map.min.js\"></script>\n<script src=\"https://cdn.anychart.com/releases/v8/js/anychart-exports.min.js\"></script>\n<script src=\"https://cdn.anychart.com/releases/v8/js/anychart-ui.min.js\"></script>\n<script src=\"https://cdn.anychart.com/geodata/2.1.1/countries/united_kingdom/united_kingdom.js\"></script>\n<script>\n    (function(){\n        function ac_add_to_head(el){\n          var head = document.getElementsByTagName('head')[0];\n          head.insertBefore(el,head.firstChild);\n        }\n        function ac_add_link(url){\n          var el = document.createElement('link');\n          el.rel='stylesheet';el.type='text/css';el.media='all';el.href=url;\n          ac_add_to_head(el);\n        }\n        function ac_add_style(css){\n          var ac_style = document.createElement('style');\n          if (ac_style.styleSheet) ac_style.styleSheet.cssText = css;\n          else ac_style.appendChild(document.createTextNode(css));\n          ac_add_to_head(ac_style);\n        }\n        ac_add_link('https://cdn.anychart.com/releases/v8/css/anychart-ui.min.css');\n        ac_add_link('https://cdn.anychart.com/releases/v8/fonts/css/anychart-font.min.css');\n        ac_add_style(document.getElementById(\"ac_style_countries-united-kingdom\").innerHTML);\n        ac_add_style(\".anychart-embed-countries-united-kingdom{width:100%;height:100%;}\");\n    })();\n</script>\n<!--WordCloud Scripts-->\n<script src=\"https://cdn.anychart.com/releases/v8/js/anychart-base.min.js\"></script>\n<script src=\"https://cdn.anychart.com/releases/v8/js/anychart-tag-cloud.min.js\"></script>\n\n<!--LineGraph-->\n<div id=\"ac_style_samples-stock-range-selection-05\" style=\"display:none;\">\n\t#CloudC_Container {\n    width: 100%;\n    height: 100%;\n    margin: 0;\n    padding: 0;\n\t}\n</div>\n<!--LineGraph Scripts-->\n<div id=\"anychart-embed-samples-stock-range-selection-05\" class=\"anychart-embed anychart-embed-samples-stock-range-selection-05\" style=\"display: none;\">\n<script src=\"https://cdn.anychart.com/releases/8.10.0/js/anychart-core.min.js?hcode=a0c21fc77e1449cc86299c5faa067dc4\"></script>\n<script src=\"https://cdn.anychart.com/releases/8.10.0/js/anychart-stock.min.js?hcode=a0c21fc77e1449cc86299c5faa067dc4\"></script>\n<script src=\"https://cdn.anychart.com/releases/8.10.0/js/anychart-ui.min.js?hcode=a0c21fc77e1449cc86299c5faa067dc4\"></script>\n<script src=\"https://cdn.anychart.com/releases/8.10.0/js/anychart-exports.min.js?hcode=a0c21fc77e1449cc86299c5faa067dc4\"></script>\n<script src=\"https://cdn.anychart.com/csv-data/dji-daily-short.js\"></script>\n\n<script>(function(){\n\tfunction ac_add_to_head(el){\n\t\tvar head = document.getElementsByTagName('head')[0];\n\t\thead.insertBefore(el,head.firstChild);\n\t}\n\tfunction ac_add_link(url){\n\t\tvar el = document.createElement('link');\n\t\tel.rel='stylesheet';el.type='text/css';el.media='all';el.href=url;\n\t\tac_add_to_head(el);\n\t}\n\tfunction ac_add_style(css){\n\t\tvar ac_style = document.createElement('style');\n\t\tif (ac_style.styleSheet) ac_style.styleSheet.cssText = css;\n\t\telse ac_style.appendChild(document.createTextNode(css));\n\t\tac_add_to_head(ac_style);\n\t}\n\tac_add_link('https://cdn.anychart.com/releases/8.10.0/css/anychart-ui.min.css?hcode=a0c21fc77e1449cc86299c5faa067dc4');\n\tac_add_style(document.getElementById(\"ac_style_samples-stock-range-selection-05\").innerHTML);\n\tac_add_style(\".anychart-embed-samples-stock-range-selection-05{width:600px;height:450px;}\");\n\t})();\n</script>\n\n<!--FireBase Scripts-->\n<script src=\"https://www.gstatic.com/firebasejs/8.6.2/firebase-app.js\"></script>\n<script src=\"https://www.gstatic.com/firebasejs/8.6.2/firebase-analytics.js\"></script>\n<script src=\"https://www.gstatic.com/firebasejs/8.6.2/firebase-firestore.js\"></script>\n\n\n<!--Main Code-->\n<!--Main Code-->\n<script>\n\nlet words=1;\nconst rbs = document.querySelectorAll('input[name=\"choice\"]');\nconst rbs1 = document.querySelectorAll('input[name=\"type\"]');\nfunction getQ() {\n\nfor(const rb1 of rbs1){\n    if(rb1.checked){\n        if(rb1.value == \"map\"){\n            document.getElementById(\"main_cont\").style.display=\"flex\";\n            document.getElementById(\"SearchPageDiv\").style.display=\"none\";\n            for (const rb of rbs) {\n                if (rb.checked) {\n                    if (rb.value== \"words\"){\n                        words=1;\n                        displayNames('Select a University', -1, 0, 0);\n                        document.getElementById(\"CloudA_ContainerContainer\").style.display=\"flex\";\n                        document.getElementById(\"CloudB_ContainerContainer\").style.display=\"none\";\n                        document.getElementById(\"CloudC_ContainerContainer\").style.display=\"none\";\n\n                        // document.getElementById(\"CloudA_ContainerContainer\").style.visibility=\"visible\";\n\n                        // document.getElementById(\"CloudB_ContainerContainer\").style.visibility=\"hidden\";\n                        // document.getElementById(\"CloudC_ContainerContainer\").style.visibility=\"hidden\";\n                        // $(\"#CloudA_ContainerContainer\").show();\n                        // $(\"#CloudB_ContainerContainer\").hide();\n                        // $(\"#CloudC_ContainerContainer\").hide();\n\n                    }\n                    else if (rb.value== \"location\"){\n                        words=2;\n                        displayNames('Select a University', -1, 0, 0);\n                        // document.getElementById(\"CloudA_ContainerContainer\").style.visibility=\"hidden\";\n                        // document.getElementById(\"CloudB_ContainerContainer\").style.visibility=\"visible\";\n                        // document.getElementById(\"CloudC_ContainerContainer\").style.visibility=\"hidden\";\n                        document.getElementById(\"CloudB_ContainerContainer\").style.display=\"flex\";\n                        document.getElementById(\"CloudA_ContainerContainer\").style.display=\"none\";\n                        document.getElementById(\"CloudC_ContainerContainer\").style.display=\"none\";\n                        // $(\"#CloudA_ContainerContainer\").hide();\n                        // $(\"#CloudB_ContainerContainer\").show();\n                        // $(\"#CloudC_ContainerContainer\").hide();\n\n                    }\n                    else if (rb.value== \"trend\"){\n                        words=3;\n                        displayNames('Select a University', -1, 0, 0);\n                        // document.getElementById(\"CloudA_ContainerContainer\").style.visibility=\"hidden\";\n                        // document.getElementById(\"CloudB_ContainerContainer\").style.visibility=\"hidden\";\n                        // document.getElementById(\"CloudC_ContainerContainer\").style.visibility=\"visible\";\n                        document.getElementById(\"CloudC_ContainerContainer\").style.display=\"flex\";\n                        document.getElementById(\"CloudB_ContainerContainer\").style.display=\"none\";\n                        document.getElementById(\"CloudA_ContainerContainer\").style.display=\"none\";\n                        // $(\"#CloudA_ContainerContainer\").hide();\n                        // $(\"#CloudB_ContainerContainer\").hide();\n                        // $(\"#CloudC_ContainerContainer\").show();\n\n                    }\n                }\n            }\n        }\n        else if(rb1.value==\"search\"){\n            document.getElementById(\"main_cont\").style.display=\"none\";\n            document.getElementById(\"SearchPageDiv\").style.display=\"block\";\n\n        }\n    }\n}\n}\ngetQ();\n\n    function displayNames(name, mood, tweets, retweets){\n      document.getElementById(\"Uni\").innerHTML = name;\n\n      var sentiment;\n\n\n      if(mood >= 0 && mood < 0.2 && tweets >0 && retweets > 0){\n        sentiment = \"Very Unhappy\";\n        // if(tweets == 0 && retweets == 0){\n        //   sentiment = \"No tweets\";\n        // }\n      }\n      else if(mood >= 0.2 && mood < 0.4){\n        sentiment = \"Unhappy\";\n      }\n      else if(mood >= 0.4 && mood < 0.6){\n        sentiment = \"Neutral\";\n      }\n      else if(mood >= 0.6 && mood < 0.8){\n        sentiment = \"Happy\";\n      }\n      else if(mood >= 0.8 && mood <= 1){\n        sentiment = \"Very Happy\";\n      }\n      else if(mood == \"Retrieving Sentiment Information\"){\n        sentiment = mood;\n      }\n      else{\n        sentiment = \"No Sentiment Information to Display\";\n      }\n      document.getElementById(\"Mood\").innerHTML = sentiment;\n      return;\n    }\n\n    function displayNamesSearch(mood, tweets, retweets){\n      var sentiment;\n      if(tweets == 0 && retweets == 0){\n        sentiment = \"No Sentiment Information to display\"\n      }\n      if(mood >= 0 && mood < 0.2){\n        sentiment = \"Very Unhappy\";\n      }\n      else if(mood >= 0.2 && mood < 0.4){\n        sentiment = \"Unhappy\";\n      }\n      else if(mood >= 0.4 && mood < 0.6){\n        sentiment = \"Neutral\";\n      }\n      else if(mood >= 0.6 && mood < 0.8){\n        sentiment = \"Happy\";\n      }\n      else if(mood >= 0.8 && mood <= 1){\n        sentiment = \"Very Happy\";\n      }\n      else if(mood == \"Retrieving Sentiment Information\"){\n        sentiment = mood;\n      }\n    //   else{\n    //     sentiment = \"Mood\";\n    //   }\n        document.getElementById(\"SearchMood\").innerHTML = sentiment;\n    }\n    // displayNames('default');\n\n    // Your web app's Firebase configuration\n    var firebaseConfig = {\n      apiKey: \"AIzaSyDzlIhPxuvnnFaRD0YEZ8oqIleZluib5GA\",\n      authDomain: \"moodofthenation-e1c5d.firebaseapp.com\",\n      projectId: \"moodofthenation-e1c5d\",\n      storageBucket: \"moodofthenation-e1c5d.appspot.com\",\n      messagingSenderId: \"1022128732979\",\n      appId: \"1:1022128732979:web:13fb6d9e13ac703e535c46\",\n      measurementId: \"G-3MR6VGXKNM\"\n    };\n\n\n    // Initialize Firebase\n    firebase.initializeApp(firebaseConfig);\n    const db = firebase.firestore();\n\n    let ds = []\n\n    let ibm = [];\n    let ibm2 = [];\n    let ibm20 = [];\n    let ibm_loc = [];\n    let ibm_joy = [];\n\n    let icl = [];\n    let icl2 = [];\n    let icl20 = [];\n    let icl_joy = [];\n    let icl_loc = [];\n    let ox = [];\n    let ox2 = [];\n    let ox20 = [];\n    let ox_loc = [];\n    let ox_joy = [];\n    let bham = [];\n    let bham2 = [];\n    let bham20 = [];\n    let bham_loc = [];\n    let bham_joy = [];\n    let bristol = [];\n    let bristol2 = [];\n    let bristol20 = [];\n    let bristol_loc = [];\n    let bristol_joy = [];\n    let cardiff = [];\n    let cardiff2 = [];\n    let cardiff20 = [];\n    let cardiff_loc = [];\n    let cardiff_joy = [];\n    let durham = [];\n    let durham2 = [];\n    let durham20 = [];\n    let durham_loc = [];\n    let durham_joy = [];\n    let edin = [];\n    let edin2 = [];\n    let edin20 = [];\n    let edin_loc = [];\n    let edin_joy = [];\n\n    let ex = [];\n    let ex2 = [];\n    let ex20 = [];\n    let ex_loc = [];\n    let ex_joy = [];\n\n    let glas = [];\n    let glas2 = [];\n    let glas20 = [];\n    let glas_loc = [];\n    let glas_joy = [];\n\n    let kcl = [];\n    let kcl2 = [];\n    let kcl20 = [];\n    let kcl_loc = [];\n    let kcl_joy = [];\n\n    let ucl = [];\n    let ucl2 = [];\n    let ucl20 = [];\n    let ucl_loc = [];\n    let ucl_joy = [];\n\n    let leeds = [];\n    let leeds2 = [];\n    let leeds20 = [];\n    let leeds_loc = [];\n    let leeds_joy = [];\n\n    let liv = [];\n    let liv2 = [];\n    let liv20 = [];\n    let liv_loc = [];\n    let liv_joy = [];\n\n    let lse = [];\n    let lse2 = [];\n    let lse20 = [];\n    let lse_loc = [];\n    let lse_joy = [];\n\n\n    let man = [];\n    let man2 = [];\n    let man20 = [];\n    let man_loc = [];\n    let man_joy = [];\n\n    let shef = [];\n    let shef2 = [];\n    let shef20 = [];\n    let shef_loc = [];\n    let shef_joy = [];\n\n    let camb = [];\n    let camb2 = [];\n    let camb20 = [];\n    let camb_loc = [];\n    let camb_joy = [];\n\n\n    let search = [];\n    let search2 = [];\n    let search20 = [];\n    let search_loc = [];\n    let search_sent = [];\n    let search_tweets = [];\n    let search_retweets = [];\n\n\n\n    function PullfromDB(){\n        return new Promise(function(resolve, reject){\n\n\n          db.collection('20 ibm').get().then(querySnapshot => {\n          querySnapshot.forEach(doc => {\n          ibm.push(doc.data());\n          resolve(ibm);\n        })\n      })\n\n          db.collection('location ibm').get().then(querySnapshot => {\n          querySnapshot.forEach(doc => {\n          ibm2.push(doc.data());\n          resolve(ibm2);\n\n        })\n      })\n\n\n        db.collection('University').get().then(querySnapshot => {\n            querySnapshot.forEach(doc => {\n                ds.push(doc.data());\n                resolve(ds);\n            })\n        })\n\n\n\n        db.collection('Line Graphs IBM').get().then(querySnapshot => {\n          querySnapshot.forEach(doc => {\n            ibm_joy.push(doc.data());\n            resolve(ibm_joy);\n          })\n        })\n\n\n\n\t\t\t\t\t\tdb.collection('Line Graphs ICL').get().then(querySnapshot => {\n\t          \tquerySnapshot.forEach(doc => {\n\t            \ticl_joy.push(doc.data());\n\t            \tresolve(icl_joy);\n\t          \t})\n\t        \t})\n            db.collection('Line Graphs Ox').get().then(querySnapshot => {\n              querySnapshot.forEach(doc => {\n                ox_joy.push(doc.data());\n                resolve(ox_joy);\n              })\n            })\n\n            db.collection('Line Graphs Birmingham').get().then(querySnapshot => {\n              querySnapshot.forEach(doc => {\n                bham_joy.push(doc.data());\n                resolve(bham_joy);\n              })\n            })\n            db.collection('Line Graphs Bristol').get().then(querySnapshot => {\n              querySnapshot.forEach(doc => {\n                bristol_joy.push(doc.data());\n                resolve(bristol_joy);\n              })\n            })\n\n            db.collection('Line Graphs Cardiff').get().then(querySnapshot => {\n              querySnapshot.forEach(doc => {\n                cardiff_joy.push(doc.data());\n                resolve(cardiff_joy);\n              })\n            })\n            db.collection('Line Graphs Durham').get().then(querySnapshot => {\n              querySnapshot.forEach(doc => {\n                durham_joy.push(doc.data());\n                resolve(durham_joy);\n              })\n            })\n\n            db.collection('Line Graphs Edinburgh').get().then(querySnapshot => {\n              querySnapshot.forEach(doc => {\n                edin_joy.push(doc.data());\n                resolve(edin_joy);\n              })\n            })\n            db.collection('Line Graphs Exeter').get().then(querySnapshot => {\n              querySnapshot.forEach(doc => {\n                ex_joy.push(doc.data());\n                resolve(ex_joy);\n              })\n            })\n            db.collection('Line Graphs Glasgow').get().then(querySnapshot => {\n              querySnapshot.forEach(doc => {\n                glas_joy.push(doc.data());\n                resolve(glas_joy);\n              })\n            })\n            db.collection('Line Graphs KCL').get().then(querySnapshot => {\n              querySnapshot.forEach(doc => {\n                kcl_joy.push(doc.data());\n                resolve(kcl_joy);\n              })\n            })\n            db.collection('Line Graphs UCL').get().then(querySnapshot => {\n              querySnapshot.forEach(doc => {\n                ucl_joy.push(doc.data());\n                resolve(ucl_joy);\n              })\n            })\n\n            db.collection('Line Graphs Leeds').get().then(querySnapshot => {\n              querySnapshot.forEach(doc => {\n                leeds_joy.push(doc.data());\n                resolve(leeds_joy);\n              })\n            })\n\n            db.collection('Line Graphs Liverpool').get().then(querySnapshot => {\n              querySnapshot.forEach(doc => {\n                liv_joy.push(doc.data());\n                resolve(liv_joy);\n              })\n            })\n            db.collection('Line Graphs LSE').get().then(querySnapshot => {\n              querySnapshot.forEach(doc => {\n                lse_joy.push(doc.data());\n                resolve(lse_joy);\n              })\n            })\n\n            db.collection('Line Graphs Manchester').get().then(querySnapshot => {\n              querySnapshot.forEach(doc => {\n                man_joy.push(doc.data());\n                resolve(man_joy);\n              })\n            })\n            db.collection('Line Graphs Sheffield').get().then(querySnapshot => {\n              querySnapshot.forEach(doc => {\n                shef_joy.push(doc.data());\n                resolve(shef_joy);\n              })\n            })\n\n            db.collection('20 icl').get().then(querySnapshot => {\n            querySnapshot.forEach(doc => {\n            icl.push(doc.data());\n            resolve(icl);\n          })\n        })\n\n            db.collection('location icl').get().then(querySnapshot => {\n            querySnapshot.forEach(doc => {\n            icl2.push(doc.data());\n            resolve(icl2);\n\n          })\n        })\n\n            db.collection('20 ox').get().then(querySnapshot => {\n            querySnapshot.forEach(doc => {\n            ox.push(doc.data());\n            resolve(ox);\n          })\n        })\n\n            db.collection('location ox').get().then(querySnapshot => {\n            querySnapshot.forEach(doc => {\n            ox2.push(doc.data());\n            resolve(ox2);\n          })\n        })\n            db.collection('20 bham').get().then(querySnapshot => {\n            querySnapshot.forEach(doc => {\n            bham.push(doc.data());\n            resolve(bham);\n          })\n        })\n\n            db.collection('location bham').get().then(querySnapshot => {\n            querySnapshot.forEach(doc => {\n            bham2.push(doc.data());\n            resolve(bham2);\n          })\n        })\n\n            db.collection('20 bristol').get().then(querySnapshot => {\n            querySnapshot.forEach(doc => {\n            bristol.push(doc.data());\n            resolve(bristol);\n          })\n        })\n\n            db.collection('location bristol').get().then(querySnapshot => {\n            querySnapshot.forEach(doc => {\n            bristol2.push(doc.data());\n            resolve(bristol2);\n          })\n        })\n\n            db.collection('20 cardiff').get().then(querySnapshot => {\n            querySnapshot.forEach(doc => {\n            cardiff.push(doc.data());\n            resolve(cardiff);\n          })\n        })\n\n            db.collection('location cardiff').get().then(querySnapshot => {\n            querySnapshot.forEach(doc => {\n            cardiff2.push(doc.data());\n            resolve(cardiff2);\n          })\n        })\n\n            db.collection('20 durham').get().then(querySnapshot => {\n            querySnapshot.forEach(doc => {\n            durham.push(doc.data());\n            resolve(durham);\n          })\n        })\n\n            db.collection('location durham').get().then(querySnapshot => {\n            querySnapshot.forEach(doc => {\n            durham2.push(doc.data());\n            resolve(durham2);\n          })\n        })\n\n            db.collection('20 edin').get().then(querySnapshot => {\n            querySnapshot.forEach(doc => {\n            edin.push(doc.data());\n            resolve(edin);\n          })\n        })\n\n            db.collection('location edin').get().then(querySnapshot => {\n            querySnapshot.forEach(doc => {\n            edin2.push(doc.data());\n            resolve(edin2);\n          })\n        })\n\n            db.collection('20 ex').get().then(querySnapshot => {\n            querySnapshot.forEach(doc => {\n            ex.push(doc.data());\n            resolve(ex);\n          })\n        })\n\n            db.collection('location ex').get().then(querySnapshot => {\n            querySnapshot.forEach(doc => {\n            ex2.push(doc.data());\n            resolve(ex2);\n          })\n        })\n\n            db.collection('20 glasgow').get().then(querySnapshot => {\n            querySnapshot.forEach(doc => {\n            glas.push(doc.data());\n            resolve(glas);\n          })\n        })\n\n            db.collection('location glasgow').get().then(querySnapshot => {\n            querySnapshot.forEach(doc => {\n            glas2.push(doc.data());\n            resolve(glas2);\n          })\n        })\n\n            db.collection('20 kcl').get().then(querySnapshot => {\n            querySnapshot.forEach(doc => {\n            kcl.push(doc.data());\n            resolve(kcl);\n          })\n        })\n\n            db.collection('location kcl').get().then(querySnapshot => {\n            querySnapshot.forEach(doc => {\n            kcl2.push(doc.data());\n            resolve(kcl2);\n          })\n        })\n\n            db.collection('20 ucl').get().then(querySnapshot => {\n            querySnapshot.forEach(doc => {\n            ucl.push(doc.data());\n            resolve(ucl);\n          })\n        })\n\n            db.collection('location ucl').get().then(querySnapshot => {\n            querySnapshot.forEach(doc => {\n            ucl2.push(doc.data());\n            resolve(ucl2);\n          })\n        })\n\n            db.collection('20 leeds').get().then(querySnapshot => {\n            querySnapshot.forEach(doc => {\n            leeds.push(doc.data());\n            resolve(leeds);\n          })\n        })\n\n            db.collection('location leeds').get().then(querySnapshot => {\n            querySnapshot.forEach(doc => {\n            leeds2.push(doc.data());\n            resolve(leeds2);\n          })\n        })\n\n            db.collection('20 liverpool').get().then(querySnapshot => {\n            querySnapshot.forEach(doc => {\n            liv.push(doc.data());\n            resolve(liv);\n          })\n        })\n\n            db.collection('location liverpool').get().then(querySnapshot => {\n            querySnapshot.forEach(doc => {\n            liv2.push(doc.data());\n            resolve(liv2);\n          })\n        })\n\n            db.collection('20 lse').get().then(querySnapshot => {\n            querySnapshot.forEach(doc => {\n            lse.push(doc.data());\n            resolve(lse);\n          })\n        })\n\n            db.collection('location lse').get().then(querySnapshot => {\n            querySnapshot.forEach(doc => {\n            lse2.push(doc.data());\n            resolve(lse2);\n          })\n        })\n\n            db.collection('20 manchester').get().then(querySnapshot => {\n            querySnapshot.forEach(doc => {\n            man.push(doc.data());\n            resolve(man);\n          })\n        })\n\n            db.collection('location manchester').get().then(querySnapshot => {\n            querySnapshot.forEach(doc => {\n            man2.push(doc.data());\n            resolve(man2);\n          })\n        })\n            db.collection('20 sheffield').get().then(querySnapshot => {\n            querySnapshot.forEach(doc => {\n            shef.push(doc.data());\n            resolve(shef);\n          })\n        })\n\n            db.collection('location sheffield').get().then(querySnapshot => {\n            querySnapshot.forEach(doc => {\n            shef2.push(doc.data());\n            resolve(shef2);\n          })\n        })\n\n            db.collection('20 cam').get().then(querySnapshot => {\n            querySnapshot.forEach(doc => {\n            camb.push(doc.data());\n            resolve(camb);\n          })\n        })\n\n            db.collection('location cam').get().then(querySnapshot => {\n            querySnapshot.forEach(doc => {\n            camb2.push(doc.data());\n            resolve(camb2);\n          })\n        })\n\n            db.collection('20 search').get().then(querySnapshot => {\n            querySnapshot.forEach(doc => {\n            search.push(doc.data());\n            resolve(search);\n          })\n        })\n\n            db.collection('location search').get().then(querySnapshot => {\n            querySnapshot.forEach(doc => {\n            search2.push(doc.data());\n            resolve(search2);\n          })\n        })\n\n            db.collection('Search Sentiment').get().then(querySnapshot => {\n            querySnapshot.forEach(doc => {\n            search_sent.push(doc.data());\n            resolve(search_sent);\n                // console.log(search_sent[0].Mood);\n          })\n        })\n\n\n            db.collection('Search Tweets Number').get().then(querySnapshot => {\n            querySnapshot.forEach(doc => {\n            search_tweets.push(doc.data());\n            resolve(search_tweets);\n          })\n        })\n            db.collection('Search Retweets Number').get().then(querySnapshot => {\n            querySnapshot.forEach(doc => {\n            search_retweets.push(doc.data());\n            resolve(search_retweets);\n          })\n        })\n\n      });\n    }\n\n\n    PullfromDB().then(function() {\n\n        anychart.onDocumentReady(function() {\n\n            // displayNamesSearch(search_sent[0].Mood);\n            var map = anychart.map();\n            var dataSet = anychart.data.set(ds);\n            // var tweets = dataSet.mapAs({name: 'Name', lat: 'Latitude', long: 'Longitude', size: 'Retweets' });\n            var tweets = dataSet.mapAs({name: 'Name', lat: 'Latitude', long: 'Longitude', size: 'Tweets' });\n            var series1 = map.bubble(tweets);\n            var retweets = dataSet.mapAs({name: 'Name', lat: 'Latitude', long: 'Longitude', size: 'Retweets' });\n            var series2 = map.bubble(retweets);\n            map.minBubbleSize(\".5%\");\n            map.maxBubbleSize(\"5%\");\n            map.unboundRegions().fill('#C4D5E5')\n            map.unboundRegions().stroke('#C4D5E5');\n\n            map.geoData(anychart.maps['united_kingdom']);\n\n\t\t\t\t\t\t//Credits NEED LICENSE KEY\n\t\t\t\t\t\t//map.credits().enabled(false);\n            var zoomController = anychart.ui.zoom();\n            zoomController.render(map);\n            map.container('Map_Container');\n            map.tooltip(true);\n            series1.tooltip().enabled(false);\n            // series2.tooltip().enabled(false);\n            // series1.tooltip().format(\"Tweets: {%Tweets} \\nMood: {%Mood}\");\n\n            series2.tooltip().format(\"Tweets: {%Tweets} \\nRetweets: {%Retweets} \\nMood: {%Mood}\");\n\n            map.draw();\n\n\t\t\t\t\t\t//Line Graph Code draw to CloudC_Container\n\n            var dataTable = anychart.data.table(\"date\");\n            dataTable.addData(leeds_joy);\n            anychart.format.inputDateTimeFormat('yyyy-MM-dd');\n            var mapping = dataTable.mapAs({value: \"joy\"});\n\n            line = anychart.stock();\n            line.plot().line(mapping);\n            var rangePicker = anychart.ui.rangePicker();\n            rangePicker.format('dd MM yyyy');\n            line.title(\"Trend in Happiness Default\");\n            line.container(\"CloudC_Container\");\n            line.draw();\n            line.selectRange(\"ytd\");\n\n\n\t\t\t\t\t\t//WordCloud Draw to CloudA_Container and CloudB_Container\n\t\t\t\t\t\tvar data1;\n\t\t\t\t\t\tvar data2;\n\t\t\t\t\t\tvar chart1;\n\t\t\t\t\t\tvar chart2;\n\n\t\t\t\t\t\tanychart.onDocumentReady(function(){\n\n            ibm20 = [];\n            ibm_loc = [];\n            for(var i = 0; i < Object.keys(ibm[0]).length; i++){\n              ibm20.push({\"x\": ibm[0][i].x, \"value\": ibm[0][i].value});\n            }\n            data1 = ibm20;\n\n            for(var i = 0; i < Object.keys(ibm2[0]).length; i++){\n              ibm_loc.push({\"x\": ibm2[0][i].x, \"value\": ibm2[0][i].value});\n            }\n\n            data2 = ibm_loc;\n\t\t\t\t\t\tchart1 = anychart.tagCloud(data1);\n\t\t\t\t\t\tchart2 = anychart.tagCloud(data2);\n\t\t\t\t\t\tchart1.title('20 Most Common Words from Tweets')\n\t\t\t\t\t\tchart2.title('Location Word Cloud')\n\t\t\t\t\t\tchart1.angles([0])\n\t\t\t\t\t\tchart2.angles([0])\n\t\t\t\t\t\tchart1.container(\"CloudA_Container\");\n\t\t\t\t\t\tchart2.container(\"CloudB_Container\");\n\t\t\t\t\t\tchart1.draw();\n\t\t\t\t\t\tchart2.draw();\n\t\t\t\t\t});\n\n\n\n\t\t\t\t\t\t\tmap.listen(\"dblClick\", function(e2) {\n\n\t\t\t\t\t\t\t\tif(words==1){\n\t\t\t\t\t\t\t\t\t\tchart1.dispose();\n\t\t\t\t\t\t\t\t\t\tibm20 = [];\n\t\t                for(var i = 0; i < 20; i++){\n\t\t                  ibm20.push({\"x\": ibm[0][i].x, \"value\": ibm[0][i].value});\n\t\t                }\n\t\t                data1 = ibm20;\n\t\t\t\t\t\t\t\t\t\tchart1 = anychart.tagCloud(data1);\n\t\t\t\t\t\t\t\t\t\tchart1.angles([0])\n\t\t\t\t\t\t\t\t\t\tchart1.container(\"CloudA_Container\");\n\t\t\t\t\t\t\t\t\t\tchart1.background().fill(\"transparent\");\n\t\t\t\t\t\t\t\t\t\tchart1.draw();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif(words==2){\n\t\t\t\t\t\t\t\t\t\tchart2.dispose();\n\t\t\t\t\t\t\t\t\t\tibm_loc = [];\n\t\t                for(var i = 0; i < Object.keys(ibm2[0]).length; i++){\n\t\t                  ibm_loc.push({\"x\": ibm2[0][i].x, \"value\": ibm2[0][i].value});\n\t\t                }\n\t\t                data2 = ibm_loc;\n\t\t\t\t\t\t\t\t\t\tchart2 = anychart.tagCloud(data2);\n\t\t\t\t\t\t\t\t\t\tchart2.angles([0])\n\t\t\t\t\t\t\t\t\t\tchart2.container(\"CloudB_Container\");\n\t\t\t\t\t\t\t\t\t\tchart2.background().fill(\"transparent\");\n\t\t\t\t\t\t\t\t\t\tchart2.draw();\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif(words==3){\n\t\t\t\t\t\t\t\t\t\tline.dispose();\n\t\t\t\t\t\t\t\t\t\tvar dataTable = anychart.data.table(\"date\");\n\t\t                dataTable.addData(ibm_joy);\n\t\t                anychart.format.inputDateTimeFormat('yyyy-MM-dd');\n\t\t                var mapping = dataTable.mapAs({value: \"joy\"});\n\t\t                line = anychart.stock();\n\t\t                line.plot().line(mapping);\n\t\t                var rangePicker = anychart.ui.rangePicker();\n\t\t                rangePicker.format('dd MM yyyy');\n\t\t                line.title(\"Trend in Happiness Default\");\n\t\t                line.container(\"CloudC_Container\");\n\t\t                line.draw();\n\t\t                line.selectRange(\"ytd\");\n\t\t\t\t\t\t\t\t}\n                displayNames('Select a University', -1, 0, 0);\n\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tmap.bubble(tweets).listen(\"Click\", function(e) {\n\t\t\t\t\t\t\t\tgetQ();\n\t\t\t\t\t\t\t\tvar dsarray_index = e.pointIndex;\n                console.log(ds[dsarray_index].Name);\n                displayNames(ds[dsarray_index].Name, ds[dsarray_index].Mood, ds[dsarray_index].Tweets, ds[dsarray_index].Retweets);\n\t\t\t\t\t\t\t\tswitch(ds[dsarray_index].Name){\n\n                  case \"Imperial College London\":\n\n                  icl20 = [];\n                  icl_loc = [];\n                    for(var i = 0; i < Object.keys(icl[0]).length; i++){\n                        icl20.push({\"x\": icl[0][i].x, \"value\": icl[0][i].value});\n                      }\n                    for(var i = 0; i < Object.keys(icl2[0]).length; i++){\n                        icl_loc.push({\"x\": icl2[0][i].x, \"value\": icl2[0][i].value});\n                      }\n                    data1 = icl20;\n                    console.log(data1);\n                    data2 = icl_loc;\n                    console.log(data2);\n                    dataTable.addData(icl_joy);\n\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\tcase \"University of Oxford\":\n                  ox20 = [];\n                  ox_loc = [];\n                  for(var i = 0; i < Object.keys(ox[0]).length; i++){\n                      ox20.push({\"x\": ox[0][i].x, \"value\": ox[0][i].value});\n                    }\n                  for(var i = 0; i < Object.keys(ox2[0]).length; i++){\n                      ox_loc.push({\"x\": ox2[0][i].x, \"value\": ox2[0][i].value});\n                    }\n                  data1 = ox20;\n                  console.log(ox20);\n                  data2 = ox_loc;\n                  console.log(ox_loc);\n                  dataTable.addData(ox_joy);\n\t\t\t\t\t\t\t\t\t\tbreak;\n\n                  case \"University of Birmingham\":\n                  bham20 = [];\n                  bham_loc = [];\n                  for(var i = 0; i < Object.keys(bham[0]).length; i++){\n                      bham20.push({\"x\": bham[0][i].x, \"value\": bham[0][i].value});\n                    }\n                  for(var i = 0; i < Object.keys(bham2[0]).length; i++){\n                      bham_loc.push({\"x\": bham2[0][i].x, \"value\": bham2[0][i].value});\n                    }\n                  data1 = bham20;\n                  data2 = bham_loc;\n\n                  dataTable.addData(bham_joy);\n\t\t\t\t\t\t\t\t\t\tbreak;\n\n                  case \"University of Bristol\":\n                  bristol20 = [];\n                  bristol_loc = [];\n                  for(var i = 0; i < Object.keys(bristol[0]).length; i++){\n                      bristol20.push({\"x\": bristol[0][i].x, \"value\": bristol[0][i].value});\n                    }\n                  for(var i = 0; i < Object.keys(bristol2[0]).length; i++){\n                      bristol_loc.push({\"x\": bristol2[0][i].x, \"value\": bristol2[0][i].value});\n                    }\n                  data1 = bristol20;\n                  data2 = bristol_loc;\n\n                  dataTable.addData(bristol_joy);\n\t\t\t\t\t\t\t\t\t\tbreak;\n\n                    case \"University of Cardiff\":\n                    cardiff20 = [];\n                    cardiff_loc = [];\n                    for(var i = 0; i < Object.keys(cardiff[0]).length; i++){\n                        cardiff20.push({\"x\": cardiff[0][i].x, \"value\": cardiff[0][i].value});\n                      }\n                    for(var i = 0; i < Object.keys(cardiff2[0]).length; i++){\n                        cardiff_loc.push({\"x\": cardiff2[0][i].x, \"value\": cardiff2[0][i].value});\n                      }\n                    data1 = cardiff20;\n                    data2 = cardiff_loc;\n\n                    dataTable.addData(cardiff_joy);\n                      break;\n\n                    case \"University of Durham\":\n                    durham20 = [];\n                    durham_loc = [];\n                    for(var i = 0; i < Object.keys(durham[0]).length; i++){\n                        durham20.push({\"x\": durham[0][i].x, \"value\": durham[0][i].value});\n                      }\n                    for(var i = 0; i < Object.keys(durham2[0]).length; i++){\n                        durham_loc.push({\"x\": durham2[0][i].x, \"value\": durham2[0][i].value});\n                      }\n                    data1 = durham20;\n                    data2 = durham_loc;\n\n                    dataTable.addData(durham_joy);\n                      break;\n\n                    case \"University of Edinburgh\":\n                    edin20 = [];\n                    edin_loc = [];\n                    for(var i = 0; i < Object.keys(edin[0]).length; i++){\n                        edin20.push({\"x\": edin[0][i].x, \"value\": edin[0][i].value});\n                      }\n                    for(var i = 0; i < Object.keys(edin2[0]).length; i++){\n                        edin_loc.push({\"x\": edin2[0][i].x, \"value\": edin2[0][i].value});\n                      }\n                    data1 = edin20;\n                    data2 = edin_loc;\n\n                    dataTable.addData(edin_joy);\n                      break;\n\n                    case \"University of Exeter\":\n                    ex20 = [];\n                    ex_loc = [];\n                    for(var i = 0; i < Object.keys(ex[0]).length; i++){\n                        ex20.push({\"x\": ex[0][i].x, \"value\": ex[0][i].value});\n                      }\n                    for(var i = 0; i < Object.keys(ex2[0]).length; i++){\n                        ex_loc.push({\"x\": ex2[0][i].x, \"value\": ex2[0][i].value});\n                      }\n                    data1 = ex20;\n                    data2 = ex_loc;\n\n                    dataTable.addData(ex_joy);\n                      break;\n\n\n                    case \"University of Glasgow\":\n                    glas20 = [];\n                    glas_loc = [];\n                    for(var i = 0; i < Object.keys(glas[0]).length; i++){\n                        glas20.push({\"x\": glas[0][i].x, \"value\": glas[0][i].value});\n                      }\n                    for(var i = 0; i < Object.keys(glas2[0]).length; i++){\n                        glas_loc.push({\"x\": glas2[0][i].x, \"value\": glas2[0][i].value});\n                      }\n                    data1 = glas20;\n                    data2 = glas_loc;\n\n                    dataTable.addData(glas_joy);\n                      break;\n\n                    case \"King's College London\":\n                    kcl20 = [];\n                    kcl_loc = [];\n                    for(var i = 0; i < Object.keys(kcl[0]).length; i++){\n                        kcl20.push({\"x\": kcl[0][i].x, \"value\": kcl[0][i].value});\n                      }\n                    for(var i = 0; i < Object.keys(kcl2[0]).length; i++){\n                        kcl_loc.push({\"x\": kcl2[0][i].x, \"value\": kcl2[0][i].value});\n                      }\n                    data1 = kcl20;\n                    data2 = kcl_loc;\n\n                    dataTable.addData(kcl_joy);\n                      break;\n\n                    case \"University College London\":\n                    ucl20 = [];\n                    ucl_loc = [];\n                    for(var i = 0; i < Object.keys(ucl[0]).length; i++){\n                        ucl20.push({\"x\": ucl[0][i].x, \"value\": ucl[0][i].value});\n                      }\n                    for(var i = 0; i < Object.keys(ucl2[0]).length; i++){\n                        ucl_loc.push({\"x\": ucl2[0][i].x, \"value\": ucl2[0][i].value});\n                      }\n                    data1 = ucl20;\n                    data2 = ucl_loc;\n\n                    dataTable.addData(ucl_joy);\n                      break;\n\n                    case \"University of Leeds\":\n                    leeds20 = [];\n                    leeds_loc = [];\n                    for(var i = 0; i < Object.keys(leeds[0]).length; i++){\n                        leeds20.push({\"x\": leeds[0][i].x, \"value\": leeds[0][i].value});\n                      }\n                    for(var i = 0; i < Object.keys(leeds2[0]).length; i++){\n                        leeds_loc.push({\"x\": leeds2[0][i].x, \"value\": leeds2[0][i].value});\n                      }\n                    data1 = leeds20;\n                    data2 = leeds_loc;\n\n                    dataTable.addData(leeds_joy);\n                      break;\n\n                    case \"University of Liverpool\":\n                    liv20 = [];\n                    liv_loc = [];\n                    for(var i = 0; i < Object.keys(liv[0]).length; i++){\n                        liv20.push({\"x\": liv[0][i].x, \"value\": liv[0][i].value});\n                      }\n                    for(var i = 0; i < Object.keys(liv2[0]).length; i++){\n                        liv_loc.push({\"x\": liv2[0][i].x, \"value\": liv2[0][i].value});\n                      }\n                    data1 = liv20;\n                    data2 = liv_loc;\n\n                    dataTable.addData(liv_joy);\n                      break;\n\n                    case \"London School of Economics\":\n                    lse20 = [];\n                    lse_loc = [];\n                    for(var i = 0; i < Object.keys(lse[0]).length; i++){\n                        lse20.push({\"x\": lse[0][i].x, \"value\": lse[0][i].value});\n                      }\n                    for(var i = 0; i < Object.keys(lse2[0]).length; i++){\n                        lse_loc.push({\"x\": lse2[0][i].x, \"value\": lse2[0][i].value});\n                      }\n                    data1 = lse20;\n                    data2 = lse_loc;\n\n                    dataTable.addData(lse_joy);\n                      break;\n\n                    case \"University of Manchester\":\n                    man20 = [];\n                    man_loc = [];\n                    for(var i = 0; i < Object.keys(man[0]).length; i++){\n                        man20.push({\"x\": man[0][i].x, \"value\": man[0][i].value});\n                      }\n                    for(var i = 0; i < Object.keys(man2[0]).length; i++){\n                        man_loc.push({\"x\": man2[0][i].x, \"value\": man2[0][i].value});\n                      }\n                    data1 = man20;\n                    data2 = man_loc;\n\n                    dataTable.addData(man_joy);\n                      break;\n\n                      case \"University of Sheffield\":\n                      shef20 = [];\n                      shef_loc = [];\n                      for(var i = 0; i < Object.keys(shef[0]).length; i++){\n                          shef20.push({\"x\": shef[0][i].x, \"value\": shef[0][i].value});\n                        }\n                      for(var i = 0; i < Object.keys(shef2[0]).length; i++){\n                          shef_loc.push({\"x\": shef2[0][i].x, \"value\": shef2[0][i].value});\n                        }\n                      data1 = shef20;\n                      data2 = shef_loc;\n\n                      dataTable.addData(shef_joy);\n                        break;\n\n                      case \"University of Cambridge\":\n                      camb20 = [];\n                      camb_loc = [];\n                      for(var i = 0; i < Object.keys(camb [0]).length; i++){\n                          camb20.push({\"x\": camb[0][i].x, \"value\": camb[0][i].value});\n                        }\n                        console.log(camb);\n                      for(var i = 0; i < Object.keys(camb2[0]).length; i++){\n                          camb_loc.push({\"x\": camb2[0][i].x, \"value\": camb2[0][i].value});\n                        }\n                      data1 = camb20;\n                      data2 = camb_loc;\n\n                      dataTable.addData(camb_joy);\n                        break;\n\n\t\t\t\t\t\t\t\t\tdefault:\n\n\t\t\t\t\t\t\t\t}\n\n\n\n\n\t\t\t\t\t\t\t\tif(words==1){\n\t\t\t\t\t\t\t\t\t\tchart1.dispose();\n\t\t\t\t\t\t\t\t\t\tchart1 = anychart.tagCloud(data1);\n\t\t\t\t\t\t\t\t\t\tchart1.title('20 Most Common Words from Tweets')\n\t\t\t\t\t\t\t\t\t\tchart1.angles([0]);\n\t\t\t\t\t\t\t\t\t\tchart1.container(\"CloudA_Container\");\n\t\t\t\t\t\t\t\t\t\tchart1.background().fill(\"transparent\");\n\t\t\t\t\t\t\t\t\t\tchart1.draw();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif(words==2){\n\t\t\t\t\t\t\t\t\t\tchart2.dispose();\n\t\t\t\t\t\t\t\t\t\tchart2 = anychart.tagCloud(data2);\n\t\t\t\t\t\t\t\t\t\tchart2.title('Locations Mentioned in Tweets: ')\n\t\t\t\t\t\t\t\t\t\tchart2.angles([0]);\n\t\t\t\t\t\t\t\t\t\tchart2.container(\"CloudB_Container\");\n\t\t\t\t\t\t\t\t\t\tchart2.background().fill(\"transparent\");\n\t\t\t\t\t\t\t\t\t\tchart2.draw();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif(words==3){\n\t\t\t\t\t\t\t\t\t\tline.dispose();\n\t\t\t\t\t\t\t\t\t\tanychart.format.inputDateTimeFormat('yyyy-MM-dd');\n\t\t                var mapping = dataTable.mapAs({value: \"joy\"});\n\t\t                line = anychart.stock();\n\t\t                line.plot().line(mapping);\n\t\t                var rangePicker = anychart.ui.rangePicker();\n\t\t                rangePicker.format('dd MM yyyy');\n\t\t                line.title(\"Trend in Happiness\");\n\t\t                line.container(\"CloudC_Container\");\n\t\t                line.draw();\n\t\t                line.selectRange(\"ytd\");\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t});\n\n              search20 = [];\n              search_loc = [];\n                for(var i = 0; i < Object.keys(search[0]).length ; i++){\n                    search20.push({\"x\": search[0][i].x, \"value\": search[0][i].value});\n                  }\n                for(var i = 0; i < Object.keys(search2[0]).length; i++){\n                    search_loc.push({\"x\": search2[0][i].x, \"value\": search2[0][i].value});\n                  }\n\n            if(search_tweets != 0 || search_retweets != 0){\n              displayNamesSearch(search_sent[0].Mood, search_tweets, search_retweets);\n              data3 = search20;\n              data4 = search_loc;\n              chart3 = anychart.tagCloud(data3);\n              chart4 = anychart.tagCloud(data4);\n          \t  chart3.title('20 Most Common Words from Tweets')\n\t\t\t        chart4.title('Location Word Cloud')\n              chart3.angles([0])\n              chart4.angles([0])\n              chart3.container(\"SearchCloudA\");\n              chart4.container(\"SearchCloudB\");\n              chart3.draw();\n              chart4.draw();\n            }\n\t\t\t\t});\n\t\t});\n</script>\n</body>\n</html>\n","output":"str","x":1030,"y":540,"wires":[[]]},{"id":"99747f96.0eee08","type":"template","z":"5d651a81.8ece7c","name":"Final","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<html>\n<head>\n\t<title>Map & Cloud</title>\n\t<link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css\" rel=\"stylesheet\" integrity=\"sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x\" crossorigin=\"anonymous\">\n\t<link href=\"https://fonts.googleapis.com/css?family=Lato&display=swap\" rel=\"stylesheet\">\n\t<style>\n\n\t\tbody {\n\t\t\tbackground: linear-gradient(to bottom, white, #049cfc, #00ff11, #fbff00, #fc7600, #cc2316, purple);\n\t\t\tbackground-size: 100%;\n\t\t\tbackground-repeat: no-repeat;\n\t\t\tmargin: 0;\n\t\t\tfont-size: 1.15rem;\n\t\t\tline-height: 1.4em;\n\t\t\talign-items: center;\n\t\t\tsnap-snap-type: y proximity;\n\t\t}\n\n\t\tbody:before{\n\t\t\tcontent:'';\n\t\t\tposition: fixed;\n\t\t\ttop: 0;\n\t\t\tbottom: 0;\n\t\t\twidth: 100%;\n\t\t\tz-index: -1;\n\t\t\tbackground: linear-gradient(to right bottom, rgba(255,255,255,0.2), #54bbfc 75%);\n\t\t}\n\n\t\t#SnapParent {\n\t\t\tbackground-color: #ffffff;\n\t\t\tmargin: 2.5%;\n\t\t\t/*padding: 30px 60px;*/\n\t\t\tborder-radius: 20px;\n\t\t\tbox-shadow: 0 3px 26px 0 rgba(0,0,0,0.20);\n\t\t\twidth: 95%;\n\t\t\theight: 90%;\n\t\t\toverflow: auto;\n\t\t\tposition: absolute;\n\t\t\t/*scroll-snap-type: y proximity;*/\n\t\t\tscroll-snap-align: top;\n\t\t}\n\t\t#SnapParent2 {\n\t\t\tbackground-color: #ffffff;\n\t\t\tmargin: 2.5%;\n\t\t\t/*padding: 30px 60px;*/\n\t\t\tborder-radius: 20px;\n\t\t\tbox-shadow: 0 3px 26px 0 rgba(0,0,0,0.20);\n\t\t\twidth: 95%;\n\t\t\theight: 92%;\n\t\t\toverflow: auto;\n\t\t\tposition: absolute;\n\t\t\t/*scroll-snap-type: y proximity;*/\n\t\t\tscroll-snap-align: top;\n\t\t}\n\n\n\t\t.footer-dark {\n\t\t\tpadding:15px 0;\n\t\t\tcolor:#f0f9ff;\n\t\t\tbackground-color:#282d32;\n\t\t}\n\n\t\t.footer-dark h3 {\n\t\t\tmargin-top:0;\n\t\t\tmargin-bottom:12px;\n\t\t\tfont-weight:bold;\n\t\t\tfont-size:16px;\n\t\t}\n\t\t.footer-dark ul {\n\t\t\tpadding:0;\n\t\t\tlist-style:none;\n\t\t\tline-height:1.6;\n\t\t\tfont-size:14px;\n\t\t\tmargin-bottom:0;\n\t\t}\n\t\t.footer-dark ul a {\n\t\t\tcolor:inherit;\n\t\t\ttext-decoration:none;\n\t\t\topacity:0.6;\n\t\t}\n\t\t.footer-dark ul a:hover {\n\t\t\topacity:0.8;\n\t\t}\n\t\t@media (max-width:767px) {\n\t\t\t.footer-dark .item:not(.social) {\n\t\t\t\ttext-align:center;\n\t\t\t\tpadding-bottom:20px;\n\t\t\t}\n\t\t}\n\t\t.footer-dark .item.text {\n\t\t\tmargin-bottom:36px;\n\t\t}\n\t\t@media (max-width:767px) {\n\t\t\t.footer-dark .item.text {\n\t\t\t\tmargin-bottom:0;\n\t\t\t}\n\t\t}\n\t\t@media (max-width:575.5px) {\n\t\t\t.second{\n\t\t\t\t\tposition: relative;\n\t\t\t\t\ttop:-48px;\n\t\t\t\t\tmargin-bottom:-50px;\n\t\t\t}\n\t\t}\n\t\t.footer-dark .item.text p {\n\t\t\topacity:0.6;\n\t\t\tmargin-bottom:0;\n\t\t}\n\t\t.footer-dark {\n\t\t\ttext-align:center;\n\t\t}\n\t\t@media (max-width:991px) {\n\t\t\t.footer-dark {\n\t\t\t\ttext-align:center;\n\t\t\t\tmargin-top:20px;\n\t\t\t}\n\t\t\t.second{\n\t\t\t\tpadding-top:30px;\n\t\t\t}\n\t\t}\n\t\t.second{\n\t\t\t\tpadding-top:30px;\n\t\t}\n\t\t.footer-dark .copyright {\n\t\t\ttext-align:center;\n\t\t\tpadding-top:0px;\n\t\t\topacity:0.3;\n\t\t\tfont-size:13px;\n\t\t\tmargin-bottom:0;\n\t\t}\n\t\t.row{\n\t\t\t\tdisplay:flex;\n\t\t\t\tjustify-content:center;\n\t\t}\n\n\t\t*{\n\t\t\t\tbox-sizing: border-box;\n\t\t}\n\t\t.circle{\n\t\t\tposition: absolute;\n\t\t\tborder-radius: 50%;\n\t\t\tbackground: white;\n\t\t\tanimation: ripple 10s infinite;\n\t\t\tbox-shadow: 0px 0px 1px 0px #508fb9;\n\t\t}\n\t\t.small{\n\t\t\twidth: 10vw;\n\t\t\theight: 10vw;\n\t\t\tleft: -5vw;\n\t\t\ttop: -5vw;\n\t\t}\n\t\t.medium{\n\t\t\twidth: 20vw;\n\t\t\theight: 20vw;\n\t\t\tleft: -10vw;\n\t\t\ttop: -10vw;\n\t\t}\n\t\t.large{\n\t\t\twidth: 30vw;\n\t\t\theight: 30vw;\n\t\t\tleft: -15vw;\n\t\t\ttop: -15vw;\n\t\t}\n\t\t.xlarge{\n\t\t\twidth: 40vw;\n\t\t\theight: 40vw;\n\t\t\tleft: -20vw;\n\t\t\ttop: -20vw;\n\t\t}\n\t\t.xxlarge{\n\t\t\twidth: 50vw;\n\t\t\theight: 50vw;\n\t\t\tleft: -25vw;\n\t\t\ttop: -25vw;\n\t\t}\n\t\t.small1{\n\t\t\twidth: 10vw;\n\t\t\theight: 10vw;\n\t\t\tright:  -5vw;\n\t\t\ttop:  -5vw;\n\t\t}\n\t\t.medium1{\n\t\t\twidth: 20vw;\n\t\t\theight: 20vw;\n\t\t\tright:  -10vw;\n\t\t\ttop:  -10vw;\n\t\t}\n\t\t.large1{\n\t\t\twidth: 30vw;\n\t\t\theight: 30vw;\n\t\t\tright:  -15vw;\n\t\t\ttop:  -15vw;\n\t\t}\n\t\t.xlarge1{\n\t\t\twidth: 40vw;\n\t\t\theight: 40vw;\n\t\t\tright:  -20vw;\n\t\t\ttop:  -20vw;\n\t\t}\n\t\t.xxlarge1{\n\t\t\twidth: 50vw;\n\t\t\theight: 50vw;\n\t\t\tright:  -25vw;\n\t\t\ttop:  -25vw;\n\t\t}\n\t\t.shade1{\n\t\t\topacity: 0.2;\n\t\t}\n\t\t.shade2{\n\t\t\topacity: 0.4;\n\t\t}\n\t\t.shade3{\n\t\t\topacity: 0.5;\n\t\t}\n\t\t.shade4{\n\t\t\topacity: 0.7;\n\t\t}\n\t\t.shade5{\n\t\t\topacity: 0.8;\n\t\t}\n\t\t@keyframes ripple{\n\t\t\t0%{\n\t\t\t\ttransform: scale(0.8);\n\t\t\t}\n\t\t\t50%{\n\t\t\t\ttransform: scale(1.3);\n\t\t\t}\n\t\t\t100%{\n\t\t\t\ttransform: scale(0.8);\n\t\t\t}\n\t\t}\n\t\t.logo {\n\t\t\twidth: 30vw;\n\t\t\tpadding: 0;\n\t\t}\n\n\t\t/* Create two equal columns that floats next to each other */\n\t\t.row-cont {\n\t\t\t\tmargin-top:30px;\n\t\t\t\tdisplay: flex;\n\t\t\t\tflex-direction: column;\n\t\t\t\twidth:100%;\n\t\t}\n\n\t\t/* Create two equal columns that sits next to each other */\n\t\t.column {\n\t\t\t\tdisplay: flex;\n\t\t\t\tflex-direction: column;\n\t\t\t\talign-items: center;\n\t\t}\n\t\t.flowchart{\n\t\t\tpadding-top:10px;\n\t\t\twidth:70vw;\n\t\t\tmargin-left:3vw;\n\n\t\t}\n\t\t@media screen and (min-width:651px) {\n\t\t\t\t.hidden_desktop {\n\t\t\t\t\t\tdisplay:none;\n\t\t\t\t}\n\t\t}\n\t\t@media screen and (max-width:650px) {\n\t\t\t\t.hidden_mobile {\n\t\t\t\t\t\tdisplay:none;\n\t\t\t\t}\n\t\t\t\t.flowchart{\n\t\t\t\t\t\twidth:50vw;\n\t\t\t\t\t\tmargin:10px;\n\t\t\t\t}\n\t\t}\n\t\tli{\n\t\t\t\tmargin: 10px 0;\n\t\t}\n\t\t .anychart-credits{\n\t\tdisplay: none;\n\t\t}\n\n\t\t.button {\n\t\t\tfont-size: 1em;\n\t\t\tpadding: 10px;\n\t\t\tcolor: #ffffff;\n\t\t\tborder: 2px solid #049cfc;\n\t\t\tanimation: mymove 5s ease infinite alternate;\n\t\t\t/*border-radius: 20px/50px;*/\n\t\t\tborder-radius: 5px;\n\t\t\ttext-decoration: none;\n\t\t\tcursor: pointer;\n\t\t\ttransition: all 0.3s ease-out;\n\t\t}\n\t\t@keyframes mymove {\n\t\t\tfrom {background-color: #c0d6fa;\n\t\t\t\t\t\tborder: 5px solid #c0d6fa;\n\t\t\t}\n\t\t\tto {background-color: #049cfc;\n\t\t\t\t\tborder: 5px solid #049cfc;;\n\t\t\t}\n\t\t}\n\n\t\t.button:hover {\n\t\t\t/*background: #ffffff;*/\n\t\t\tcolor: yellow;\n\t\t}\n\n\t\t.overlay {\n\t\t\tposition: fixed;\n\t\t\ttop: 0;\n\t\t\tbottom: 0;\n\t\t\tleft: 0;\n\t\t\tright: 0;\n\t\t\tbackground: rgba(0, 0, 0, 0.7);\n\t\t\ttransition: opacity 500ms;\n\t\t\tvisibility: hidden;\n\t\t\topacity: 0;\n\t\t}\n\t\t.overlay:target {\n\t\t\tvisibility: visible;\n\t\t\topacity: 1;\n\t\t}\n\t\t.popup {\n\t\t\tmargin: 45px auto;\n\t\t\tpadding: 20px;\n\t\t\tbackground: #fff;\n\t\t\tborder-radius: 5px;\n\t\t\twidth: 70%;\n\t\t\theight: 85%;\n\t\t\tposition: relative;\n\t\t\ttransition: all 5s ease-in-out;\n\t\t}\n\t\t.popup h2 {\n\t\t\tmargin-top: 0;\n\t\t\tcolor: #333;\n\t\t\tfont-family: Tahoma, Arial, sans-serif;\n\t\t}\n\t\t.popup .close {\n\t\t\tposition: absolute;\n\t\t\ttop: 20px;\n\t\t\tright: 30px;\n\t\t\ttransition: all 200ms;\n\t\t\tfont-size: 30px;\n\t\t\tfont-weight: bold;\n\t\t\ttext-decoration: none;\n\t\t\tcolor: #333;\n\t\t}\n\t\t.popup .close:hover {\n\t\t\tcolor: #06D85F;\n\t\t}\n\t\t.popup .content {\n\t\t\tmax-height: 90%;\n\t\t\toverflow: auto;\n\t\t}\n\t\t@media screen and (max-width: 700px){\n\t\t\t.box{\n\t\t\t\twidth: 70%;\n\t\t\t}\n\t\t\t.popup{\n\t\t\t\twidth: 70%;\n\t\t\t}\n\t\t}\n\n\t\t@import url(\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css\");\n\n\t\t*{\n\t\t\t\tbox-sizing: border-box;\n\t\t}\n\n\t\t.search-box{\n\t\t\twidth: fit-content;\n\t\t\theight: fit-content;\n\t\t\tposition: relative;\n\t\t}\n\t\t.input-search{\n\t\t\theight: 50px;\n\t\t\twidth: 50px;\n\t\t\tborder-style: none;\n\t\t\tpadding: 10px;\n\t\t\tfont-size: 18px;\n\t\t\tletter-spacing: 2px;\n\t\t\toutline: none;\n\t\t\tborder-radius: 25px;\n\t\t\ttransition: all .5s ease-in-out;\n\t\t\tbackground-color: #22a6b3;\n\t\t\tpadding-right: 40px;\n\t\t\tcolor:#fff;\n\t\t}\n\t\t.input-search::placeholder{\n\t\t\tcolor:rgba(255,255,255,.5);\n\t\t\tfont-size: 18px;\n\t\t\tletter-spacing: 2px;\n\t\t\tfont-weight: 100;\n\t\t}\n\t\t.btn-search{\n\t\t\twidth: 50px;\n\t\t\theight: 50px;\n\t\t\tborder-style: none;\n\t\t\tfont-size: 20px;\n\t\t\tfont-weight: bold;\n\t\t\toutline: none;\n\t\t\tcursor: pointer;\n\t\t\tborder-radius: 50%;\n\t\t\tposition: absolute;\n\t\t\tright: 0px;\n\t\t\tcolor:#ffffff ;\n\t\t\tbackground-color:transparent;\n\t\t\tpointer-events: painted;\n\t\t}\n\t\t.btn-search:focus ~ .input-search{\n\t\t\twidth: 300px;\n\t\t\tborder-radius: 0px;\n\t\t\tbackground-color: transparent;\n\t\t\tborder-bottom:1px solid rgba(255,255,255,.5);\n\t\t\ttransition: all 500ms cubic-bezier(0, 0.110, 0.35, 2);\n\t\t}\n\t\t.input-search:focus{\n\t\t\twidth: 300px;\n\t\t\tborder-radius: 0px;\n\t\t\tbackground-color: transparent;\n\t\t\tborder-bottom:1px solid rgba(255,255,255,.5);\n\t\t\ttransition: all 500ms cubic-bezier(0, 0.110, 0.35, 2);\n\t\t}\n\n\t\t.slider {\n\t\t\t\tposition: absolute;\n\t\t\t\tdisplay: flex;\n\t\t\t\tjustify-content: center;\n\t\t\t\talign-items: center;\n\t\t\t\tcursor: pointer;\n\t\t\t\ttop: 0;\n\t\t\t\tleft: 0;\n\t\t\t\tright: 0;\n\t\t\t\tbottom: 0;\n\t\t\t\tbackground-color: #049cfc;\n\t\t\t\tborder-radius: 5px;\n\t\t}\n\n\t\tinput:checked + .slider {\n\t\t\t\tbackground-color: #cc2316;\n\t\t}\n\n\t\t.choice-container{\n\t\t\t\tdisplay: flex;\n\t\t\t\tjustify-content: center;\n\t\t\t\talign-items: center;\n\t\t\t\twidth:100vw;\n\t\t\t\tmargin-bottom: 1vh;\n\n\n\t\t}\n\t\t.choice-container .choices{\n\t\t\t\tposition: relative;\n\t\t\t\tdisplay: inline-block;\n\t\t\t\twidth: 80px;\n\t\t\t\theight: 40px;\n\t\t\t\tbackground-color: #36B5EB;\n\t\t\t\tcolor: white;\n\t\t\t\tdisplay: block;\n\t\t\t\tborder-color: none;\n\t\t\t\tborder-radius: 5px;\n\t\t\t\tpadding: 0.5rem;\n\n\t\t\t\tmargin-left:1rem ;\n\t\t\t\tfont-size: 18px;\n\t\t\t\ttext-align: center;\n\t\t\t\tcursor: pointer;\n\t\t}\n\t\t@media screen and (max-width: 1000px){\n\t\t\t\t.choice-container .choices{\n\n\t\t\t\t\t\twidth: 50px;\n\t\t\t\t\t\theight: 25px;\n\n\t\t\t\t\t\tfont-size: 11px;\n\n\t\t\t\t}\n\t\t}\n\n\t</style>\n</head>\n\n<body>\n\n<!--style=\"vertical-align:middle; text-align:center\"-->\n\n<div id=\"guide\" class=\"overlay\" style=\"position:absolute;z-index:10;\">\n\t<div class=\"popup\">\n\t\t<h2><b>Guide</b></h2>\n\t\t<a class=\"close\" href=\"#\">&times;</a>\n\t\t<div class=\"content\">\n\t\t\t\t<h4><b>Usage</b></h4>\n\t\t\t\t<p>This tool provides a visualisation of sentiment according to tweets across the country. The data used for visualisation can be specified via a search term or defaulted via preset terms. </p>\n\t\t\t\t<h6><b>Interactivity</b></h6>\n\t\t\t<p>Hovering over a bubble on the map or individual words on the word clouds will display a popup with key information. You can click on a bubble to view it's corresponding word cloud. Double click anywhere else on the map to display the default word clouds. You can zoom in and out of the map by using the controls to the left side of the map. Scroll down under the word clouds to view a line graph displaying sentiment over an adjustable time period.</p>\n\t\t\t\t<h6><b>Provided Data Analysis</b></h6>\n\t\t\t\t<p>Upon loading the page this tool is populated with data collected using preset terms.</p>\n\t\t\t\t<h6><b>Custom Data Analysis</b></h6>\n\t\t\t\t<p>The search bar can be used to populate the tool with a user specified input. Searches support hashtags, username handles, and tweet contents.</p>\n\t\t\t\t<h4><b>Display Information</b></h4>\n\t\t\t\t<p>Each point of interest is displayed using 2 overlapping bubbles - 1 of which represents tweets and the other of which represents retweets; the sizes of which are explained below. The colour represents the general sentiment of the tweets/retweets in that location; the relevant key can be found below.</p>\n\t\t\t<h6><b>Bubble Size</b></h6>\n\t\t\t<p>The radius of each bubble is calculated based on the proportion of tweets/retweets in that location when compared with all other points of interest on the map.</p>\n\t\t\t<h6><b>Bubble Colours</b></h6>\n\t\t\t<p>The colour of each bubble indicates the sentiment in that location and is generated from the numerical score assigned from our data analysis.</p>\n\n\t\t\t\t\t\t<p><b>Key:</b></p>\n\n\t\t\t<div style=\"width:30px;height:30px;background:#cc2316;display:inline-block;border-radius:10px;vertical-align:middle;\"></div>\n\t\t\t<p style=\"display:inline-block;text-indent: 5px;\">Very Unhappy &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><tab></tab>\n\t\t\t\t\t\t<div style=\"width:30px;height:30px;background:#fc7600;display:inline-block;border-radius:10px;vertical-align:middle;\"></div>\n\t\t\t<p style=\"display:inline-block;text-indent: 5px;\">Unhappy &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><tab></tab>\n\t\t\t\t\t\t<div style=\"width:30px;height:30px;background:#fbff00;display:inline-block;border-radius:10px;vertical-align:middle;\"></div>\n\t\t\t<p style=\"display:inline-block;text-indent: 5px;\">Neutral &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><tab></tab>\n\t\t\t\t\t\t<div style=\"width:30px;height:30px;background:#00ff11;display:inline-block;border-radius:10px;vertical-align:middle;\"></div>\n\t\t\t<p style=\"display:inline-block;text-indent: 5px;\">Happy &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><tab></tab>\n\t\t\t\t\t\t<div style=\"width:30px;height:30px;background:#049cfc;display:inline-block;border-radius:10px;vertical-align:middle;\"></div>\n\t\t\t<p style=\"display:inline-block;text-indent: 5px;\">Very Happy &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><tab></tab>\n\t\t</div>\n\t</div>\n</div>\n\n\t<div id=\"Container_Logo\" style=\"width: 100%; height: 100%; scroll-snap-align: start; overflow: hidden; position: relative;\">\n\n\t\t\t<div class='ripple-background'>\n\t\t\t<div class='circle xxlarge shade1'></div>\n\t\t\t<div class='circle xlarge shade2'></div>\n\t\t\t<div class='circle large shade3'></div>\n\t\t\t<div class='circle medium shade4'></div>\n\t\t\t<div class='circle small shade5'></div>\n\t\t\t<div class='circle xxlarge1 shade1'></div>\n\t\t\t<div class='circle xlarge1 shade2'></div>\n\t\t\t<div class='circle large1 shade3'></div>\n\t\t\t<div class='circle medium1 shade4'></div>\n\t\t\t<div class='circle small1 shade5'></div>\n\t\t</div>\n\t\t<div id=\"Logo\" style=\"width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center;\">\n\t\t\t<img src=\"https://raw.githubusercontent.com/NasimMM/MoodoftheNation/f3b8e17bc2dfd18cdd96734711a2559c325a6823/LOGOSVG.svg\" class=\"rounded mx-auto d-block img-fluid logo\"/>\n\t\t\t<h1 style=\"color: white; font-size: 2.9vw; font-weight: 700;\">Mood of the Nation</h1>\n\t\t\t<p style=\"font-size: 1.2em; color: white;font-weight: 500;\"><span id=\"rotate\">this</span></p>\n\t\t\t\t\t\t<script type=\"text/javascript\" src=\"//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js\"></script>\n\t\t\t\t\t\t<script>\n\t\t\t\t\t\t\tvar terms = [\"A new era of data analysis\", \"Developed by students at Imperial College London\", \"In conjunction with IBM\"];\n\t\t\t\t\t\t\tfunction rotateTerm() {\n\t\t\t\t\t\t\t\tvar ct = $(\"#rotate\").data(\"term\") || 0;\n\t\t\t\t\t\t\t\t$(\"#rotate\").data(\"term\", ct == terms.length -1 ? 0 : ct + 1).text(terms[ct]).fadeIn().delay(4500).fadeOut(500, rotateTerm);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\trotateTerm();\n\t\t\t\t\t\t</script>\n\t\t\t\t\t\t<br>\n\t\t\t\t\t\t<div class=\"box\" style=\"display:flex; justify-items:center\">\n\t\t\t\t\t\t\t<a class=\"button\" href=\"#guide\"><b>Guide</b></a>\n\t\t\t\t\t\t</div>\n\n\t\t\t</div>\n\n\t</div>\n\n\n\n<div style=\"width: 100%; height: 100%; align-content: center; align-items: center; scroll-snap-align: start;\">\n\n\t\t<div id=\"SnapParent\">\n\t\t\t\t<div style=\"width: 100%; height: 5%; display: flex; justify-content: center; margin-top: 15px; margin-bottom: 15px;\">\n\t\t\t\t\t\t<h1 style=\"font-weight:bold;\">Dashboard</h1>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"choice-container\" style=\"width: auto;\">\n\t\t\t\t\t\t<label class=\"choices\">\n\t\t\t\t\t\t\t\t<input type=\"radio\" name=\"type\" value=\"map\" checked  onclick=\"getQ()\" >\n\t\t\t\t\t\t\t\t<span class=\"slider\"><span class=\"op-text\">Map</span></span>\n\t\t\t\t\t\t</label>\n\t\t\t\t\t\t<label class=\"choices\">\n\t\t\t\t\t\t\t\t<input type=\"radio\" name=\"type\" value=\"search\" onclick=\"getQ()\">\n\t\t\t\t\t\t\t\t<span class=\"slider\"><span class=\"op-text\">Search</span></span>\n\t\t\t\t\t\t</label>\n\t\t\t\t</div>\n\n\t\t\t<div id=\"main_cont\" style=\"width: 100%; height: 80%; scroll-snap-align: start; display: flex; flex-direction: column;\">\n\n\t\t\t\t\t\t<div id=\"Main_Container\" style=\"display: flex !important; flex-direction: row; align-items: center; width: 100%; height: 95%;\">\n\n\t\t\t\t\t\t\t\t<div id=\"LeftContainer\" style=\"display: flex !important; flex-direction: column;  align-items: center; width: 50%; height: 100%;\">\n\t\t\t\t\t\t\t\t\t<div id= \"Uni_Mood\" style=\"display: flex; flex-direction: column; width:100%;\">\n\t\t\t\t\t\t\t\t\t\t<h4 id= \"Uni\" style=\"margin-left: 15px;\"> Select a University</h4>\n\t\t\t\t\t\t\t\t\t\t<h4 id= \"Mood\" style=\"margin-left: 15px;\"> Mood </h4>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div id=\"Map_Container\"></div>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<div id=\"RightContainer\" style=\"overflow: hidden; display:flex; flex-direction:column ; align-items: center;width: 50%; height: 100%; \">\n\n\t\t\t\t\t\t\t\t\t<div class=\"choice-container\">\n\t\t\t\t\t\t\t\t\t\t\t<label class=\"choices\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"radio\" name=\"choice\" value=\"words\" checked onclick=\"getQ()\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"slider\"><span class=\"op-text\">Words</span></span>\n\t\t\t\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t\t\t\t<label class=\"choices\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"radio\" name=\"choice\" value=\"location\" onclick=\"getQ()\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"slider\"><span class=\"op-text\">Location</span></span>\n\t\t\t\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t\t\t\t<label class=\"choices\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"radio\" name=\"choice\" value=\"trend\" onclick=\"getQ()\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"slider\"><span class=\"op-text\">Trend</span></span>\n\t\t\t\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<div id=\"CloudA_ContainerContainer\" style=\"width: 100%; height: 90%; scroll-snap-align: start;\">\n\t\t\t\t\t\t\t\t\t\t\t\t<div id=\"CloudA_Container\" style=\"width: 100%; height: 100%;\"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div id=\"CloudB_ContainerContainer\" style=\"width: 100%; height: 90%;\">\n\t\t\t\t\t\t\t\t\t<div id=\"CloudB_Container\" style=\"width: 100%; height: 100%;\"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div id=\"CloudC_ContainerContainer\" style=\"width: 100%; height: 90%; scroll-snap-align: start;\">\n\t\t\t\t\t\t\t\t\t<div id=\"CloudC_Container\" style=\"width: 100%; height: 100%;\"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t<div id=\"SearchPageDiv\" style=\"width: 100%; height: 80%; scroll-snap-align:start;\">\n\t\t\t\t<div id=\"search_header\" style=\"width: 100%; height: 15%; background-color: transparent; \">\n\n\t\t\t\t\t<form id=\"id_form\">\n\t\t\t\t\t\t<div style=\"padding: 1%;\">\n\t\t\t\t\t\t\t<span style=\"display: flex; justify-content: center;\">\n\t\t\t\t\t\t\t\t<div style=\"margin-right:10px\">\n\t\t\t\t\t\t\t\t\t\t<label>Search:</label>\n\t\t\t\t\t\t\t\t\t\t<input type=\"text\" name=\"name\" placeholder=\"#hashtag / @user / other\" size=\"24\" id=\"id_text\" required/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div style=\"margin-right: 10px\">\n\t\t\t\t\t\t\t\t\t\t<label>Time Scale:</label>\n\t\t\t\t\t\t\t\t\t\t<input type=\"number\" name=\"number\" placeholder=\"# Minutes\" size=\"3\" id=\"id_number\" style=\"width: 35%\" required/>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<input type=\"submit\" value=\"Search\" id=\"id_enter\" style=\"background: #049cfc; color: white; border-radius: 5px; font-weight: bold; border-color: #049cfc; height:32px\" onclick=\"timer_search()\"/>\n\t\t\t\t\t\t\t\t<h2 id=\"timedisplayer\" style=\"margin-left: 10px; margin-bottom: 10px;\"> </h2>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</form>\n\n\t\t\t\t</div>\n\n\t\t\t\t<div style=\"width: 100%; height: 80%; display: flex; flex-direction: row;\">\n\t\t\t\t\t<div id=\"SearchCloudA\" style=\"width: 50%; height: 100%;\"></div>\n\t\t\t\t\t<div id=\"SearchCloudB\" style=\"width: 50%; height: 100%;\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div style = \"display: flex; justify-content: center; align-items: center\">\n\t\t\t\t<h2 id= \"SearchMood\">  </h2>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t</div>\n</div>\n\n<div class=\"row-cont\" >\n\t\t<div id=\"SnapParent2\">\n\t\t\t\t<div class=\"column\">\n\t\t\t\t\t\t<h1 style=\"text-align: center; padding: 2%; font-weight:bold;\">What we do?</h1>\n\t\t\t\t\t\t<ol class=\"list_info\" style=\"list-style: none; padding-right:10%\">\n\t\t\t\t\t\t\t\t<li >We have created a web accessible experience for companies to monitor their\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\timpact on university students across the country</li>\n\t\t\t\t\t\t\t\t<li >We utilise the Twitter API and IBMs Natural Language Understanding API to analyse the happiness of  tweets related to the company and university. Understanding the sentiment of university tweets about a company can act as an\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tindicator of the quality of company recruitment programs in universities.</li>\n\t\t\t\t\t\t\t\t<li >The main features of the webpage include:\n\t\t\t\t\t\t\t\t\t\t<ul>\n\t\t\t\t\t\t\t\t\t\t\t\t<li>An interactive map of the UK displaying information such as the ‘Happiness’ of a university.\n\t\t\t\t\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t\t\t\t\t<li>The 20 most common words from tweets</li>\n\t\t\t\t\t\t\t\t\t\t\t\t<li>The most common locations mentioned in tweets</li>\n\t\t\t\t\t\t\t\t\t\t\t\t<li>The happiness trend of a university as a line graph</li>\n\t\t\t\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t</ol>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"column\" >\n\t\t\t\t\t\t<h1 style=\"text-align: center; padding: 0%; font-weight:bold;\">How we do it?</h1>\n\t\t\t\t\t\t<img class=\" hidden_desktop flowchart img-responsive\" src=\"https://github.com/moinbukhari/hello-world/blob/master/flowchart.png?raw=true\">\n\t\t\t\t\t\t<img class=\" hidden_mobile flowchart img-responsive\" src=\"https://github.com/moinbukhari/hello-world/blob/master/flowchart2.png?raw=true\">\n\t\t\t\t</div>\n\t\t</div>\n</div>\n\n<div style=\"width: 100%; height: 100%;\"></div>\n\n<div class=\"footer-dark\">\n\t\t<footer>\n\t\t\t\t<div class=\"container\">\n\t\t\t\t\t\t<div class=\"row\">\n\t\t\t\t\t\t\t\t<div class=\"col-sm-6 col-md-3 item\">\n\t\t\t\t\t\t\t\t\t\t<h3>Brought to you by</h3>\n\t\t\t\t\t\t\t\t\t\t<ul>\n\t\t\t\t\t\t\t\t\t\t\t\t<li><a href=\"#\">Arjun Ananth</a></li>\n\t\t\t\t\t\t\t\t\t\t\t\t<li><a href=\"#\">Moin Bukhari</a></li>\n\t\t\t\t\t\t\t\t\t\t\t\t<li><a href=\"#\">Nayan Kad</a></li>\n\t\t\t\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"col-sm-6 col-md-3 item second\">\n\t\t\t\t\t\t\t\t\t\t<ul>\n\t\t\t\t\t\t\t\t\t\t\t\t<li><a href=\"#\">Jun Kim</a></li>\n\t\t\t\t\t\t\t\t\t\t\t\t<li><a href=\"#\">Nasim Mohammed</a></li>\n\t\t\t\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"col-sm-6 col-md-3 item\">\n\t\t\t\t\t\t\t\t\t\t<h3>In Collaboration with</h3>\n\t\t\t\t\t\t\t\t\t\t<ul>\n\t\t\t\t\t\t\t\t\t\t\t\t<li><a href=\"#\">IBM</a></li>\n\t\t\t\t\t\t\t\t\t\t\t\t<li><a href=\"#\">Imperial College London</a></li>\n\t\t\t\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<p class=\"copyright\">Company Name © 2021</p>\n\t\t\t\t</div>\n\t\t</footer>\n</div>\n\n\n\n<!--SCRIPTS-->\n\n\n<!--Ajax Search Bar stuff-->\n<script src=\"https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js\"></script>\n<script type=\"text/javascript\">\n\t\t$(document).ready(function(){\n\t\t\t\tsetupPage();\n\t\t});\n\t\tfunction setupPage(){\n\t\t\t\t//$('#id_hello').hide();\n\t\t\t\t$('#id_form').submit(onSubmitClicked);\n\t\t\t\tenterbutton();\n\t\t}\n\t\tfunction processOK(response) {\n\t\t\tconsole.log('AJAX Response:');\n\t\t\t\tconsole.log(response);\n\t\t\t\tif (response.identifyresponse){\n\t\t\t\t\t\t//$('#id_textlang').text(langLookup(response.identifyresponse));\n\t\t\t\t} else {\n\t\t\t\t\t\t//$('#id_textlang').text('No response received from service');\n\t\t\t\t}\n\t\t}\n\t\tfunction processNotOK() {\n\t\t\t\tconsole.log('Error Processing');\n\t\t\t\t//$('#id_textlang').text('Oops something went wrong');\n\t\t}\n\n\t\t// function refreshPage(time){\n\t\t//   setTimeout(function () {\n\t\t//       location.reload();\n\t\t//     }, (time * 1000)+(10*1000));\n\t\t// });\n\n\t\tfunction invokeAjax(message) {\n\t\t\t\tconsole.log('AJAX about to be invoked.');\n\t\t\t\tconsole.log(message);\n\t\t\t\tvar ajaxData = {};\n\t\t\t\tajaxData.msgdata = message;\n\t\t\t\t$.ajax({\n\t\t\t\t\t\ttype: 'POST',\n\t\t\t\t\t\turl: 'search',\n\t\t\t\t\t\tdata: ajaxData,\n\t\t\t\t\t\tsuccess: processOK,\n\t\t\t\t\t\terror: processNotOK\n\t\t\t\t});\n\t\t}\n\t\tfunction onSubmitClicked(event){\n\t\t\t\t// $('#id_hello').show();\n\t\t\t\tevent.preventDefault();\n\t\t\t\tvar txt = $('#id_text').val();\n\t\t\t\tvar time = $('#id_number').val();\n\t\t\t\tinvokeAjax({search: txt, time: time});\n\t\t\t\t//refreshpage(time);\n\t\t}\n\t\tfunction enterbutton(){\n\t\t\t\t$(function() {\n\t\t\t\t\t\t$(\"form input\").keypress(function (e) {\n\t\t\t\t\t\tif ((e.which && e.which == 13) || (e.keyCode && e.keyCode == 13)) {\n\t\t\t\t\t\t\t\t$('#id_enter').click();\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t});\n\t\t});\n\t}\t\n</script>\n\n<!--UKMAP-->\n<div id=\"ac_style_countries-united-kingdom\" style=\"display:none;\">\n\t\t#Map_Container {\n\t\t\twidth: 100%;\n\t\t\theight: 100%;\n\t\t\tmargin: 0;\n\t\t\tpadding: 0;\n\t\t}\n</div>\n<!--UKMAP Scripts-->\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.3.15/proj4.js\"></script>\n<script src=\"https://cdn.anychart.com/releases/v8/js/anychart-base.min.js\"></script>\n<script src=\"https://cdn.anychart.com/releases/v8/js/anychart-map.min.js\"></script>\n<script src=\"https://cdn.anychart.com/releases/v8/js/anychart-exports.min.js\"></script>\n<script src=\"https://cdn.anychart.com/releases/v8/js/anychart-ui.min.js\"></script>\n<script src=\"https://cdn.anychart.com/geodata/2.1.1/countries/united_kingdom/united_kingdom.js\"></script>\n<script>\n\t\t(function(){\n\t\t\t\tfunction ac_add_to_head(el){\n\t\t\t\t\tvar head = document.getElementsByTagName('head')[0];\n\t\t\t\t\thead.insertBefore(el,head.firstChild);\n\t\t\t\t}\n\t\t\t\tfunction ac_add_link(url){\n\t\t\t\t\tvar el = document.createElement('link');\n\t\t\t\t\tel.rel='stylesheet';el.type='text/css';el.media='all';el.href=url;\n\t\t\t\t\tac_add_to_head(el);\n\t\t\t\t}\n\t\t\t\tfunction ac_add_style(css){\n\t\t\t\t\tvar ac_style = document.createElement('style');\n\t\t\t\t\tif (ac_style.styleSheet) ac_style.styleSheet.cssText = css;\n\t\t\t\t\telse ac_style.appendChild(document.createTextNode(css));\n\t\t\t\t\tac_add_to_head(ac_style);\n\t\t\t\t}\n\t\t\t\tac_add_link('https://cdn.anychart.com/releases/v8/css/anychart-ui.min.css');\n\t\t\t\tac_add_link('https://cdn.anychart.com/releases/v8/fonts/css/anychart-font.min.css');\n\t\t\t\tac_add_style(document.getElementById(\"ac_style_countries-united-kingdom\").innerHTML);\n\t\t\t\tac_add_style(\".anychart-embed-countries-united-kingdom{width:100%;height:100%;}\");\n\t\t})();\n</script>\n<!--WordCloud Scripts-->\n<script src=\"https://cdn.anychart.com/releases/v8/js/anychart-base.min.js\"></script>\n<script src=\"https://cdn.anychart.com/releases/v8/js/anychart-tag-cloud.min.js\"></script>\n\n<!--LineGraph-->\n<div id=\"ac_style_samples-stock-range-selection-05\" style=\"display:none;\">\n\t#CloudC_Container {\n\t\twidth: 100%;\n\t\theight: 100%;\n\t\tmargin: 0;\n\t\tpadding: 0;\n\t}\n</div>\n<!--LineGraph Scripts-->\n<div id=\"anychart-embed-samples-stock-range-selection-05\" class=\"anychart-embed anychart-embed-samples-stock-range-selection-05\" style=\"display: none;\">\n<script src=\"https://cdn.anychart.com/releases/8.10.0/js/anychart-core.min.js?hcode=a0c21fc77e1449cc86299c5faa067dc4\"></script>\n<script src=\"https://cdn.anychart.com/releases/8.10.0/js/anychart-stock.min.js?hcode=a0c21fc77e1449cc86299c5faa067dc4\"></script>\n<script src=\"https://cdn.anychart.com/releases/8.10.0/js/anychart-ui.min.js?hcode=a0c21fc77e1449cc86299c5faa067dc4\"></script>\n<script src=\"https://cdn.anychart.com/releases/8.10.0/js/anychart-exports.min.js?hcode=a0c21fc77e1449cc86299c5faa067dc4\"></script>\n<script src=\"https://cdn.anychart.com/csv-data/dji-daily-short.js\"></script>\n\n<script>(function(){\n\tfunction ac_add_to_head(el){\n\t\tvar head = document.getElementsByTagName('head')[0];\n\t\thead.insertBefore(el,head.firstChild);\n\t}\n\tfunction ac_add_link(url){\n\t\tvar el = document.createElement('link');\n\t\tel.rel='stylesheet';el.type='text/css';el.media='all';el.href=url;\n\t\tac_add_to_head(el);\n\t}\n\tfunction ac_add_style(css){\n\t\tvar ac_style = document.createElement('style');\n\t\tif (ac_style.styleSheet) ac_style.styleSheet.cssText = css;\n\t\telse ac_style.appendChild(document.createTextNode(css));\n\t\tac_add_to_head(ac_style);\n\t}\n\tac_add_link('https://cdn.anychart.com/releases/8.10.0/css/anychart-ui.min.css?hcode=a0c21fc77e1449cc86299c5faa067dc4');\n\tac_add_style(document.getElementById(\"ac_style_samples-stock-range-selection-05\").innerHTML);\n\tac_add_style(\".anychart-embed-samples-stock-range-selection-05{width:600px;height:450px;}\");\n\t})();\n</script>\n\n<!--FireBase Scripts-->\n<script src=\"https://www.gstatic.com/firebasejs/8.6.2/firebase-app.js\"></script>\n<script src=\"https://www.gstatic.com/firebasejs/8.6.2/firebase-analytics.js\"></script>\n<script src=\"https://www.gstatic.com/firebasejs/8.6.2/firebase-firestore.js\"></script>\n\n\n<!--Main Code-->\n<script>\n\n//*********************************************************************************************************************************INITILISE VARIABLES****************************************************************************************************\n\n\nlet words = 1;\nconst rbs = document.querySelectorAll('input[name=\"choice\"]');\nconst rbs1 = document.querySelectorAll('input[name=\"type\"]');\n// displayNames('default');\n\n// Your web app's Firebase configuration\nvar firebaseConfig = {\n\tapiKey: \"AIzaSyDzlIhPxuvnnFaRD0YEZ8oqIleZluib5GA\",\n\tauthDomain: \"moodofthenation-e1c5d.firebaseapp.com\",\n\tprojectId: \"moodofthenation-e1c5d\",\n\tstorageBucket: \"moodofthenation-e1c5d.appspot.com\",\n\tmessagingSenderId: \"1022128732979\",\n\tappId: \"1:1022128732979:web:13fb6d9e13ac703e535c46\",\n\tmeasurementId: \"G-3MR6VGXKNM\"\n};\n\n\n// Initialize Firebase\nfirebase.initializeApp(firebaseConfig);\nconst db = firebase.firestore();\n\nlet ds = []\n\nlet ibm = [];\nlet ibm2 = [];\nlet ibm20 = [];\nlet ibm_loc = [];\nlet ibm_joy = [];\n\nlet icl = [];\nlet icl2 = [];\nlet icl20 = [];\nlet icl_joy = [];\nlet icl_loc = [];\nlet ox = [];\nlet ox2 = [];\nlet ox20 = [];\nlet ox_loc = [];\nlet ox_joy = [];\nlet bham = [];\nlet bham2 = [];\nlet bham20 = [];\nlet bham_loc = [];\nlet bham_joy = [];\nlet bristol = [];\nlet bristol2 = [];\nlet bristol20 = [];\nlet bristol_loc = [];\nlet bristol_joy = [];\nlet cardiff = [];\nlet cardiff2 = [];\nlet cardiff20 = [];\nlet cardiff_loc = [];\nlet cardiff_joy = [];\nlet durham = [];\nlet durham2 = [];\nlet durham20 = [];\nlet durham_loc = [];\nlet durham_joy = [];\nlet edin = [];\nlet edin2 = [];\nlet edin20 = [];\nlet edin_loc = [];\nlet edin_joy = [];\n\nlet ex = [];\nlet ex2 = [];\nlet ex20 = [];\nlet ex_loc = [];\nlet ex_joy = [];\n\nlet glas = [];\nlet glas2 = [];\nlet glas20 = [];\nlet glas_loc = [];\nlet glas_joy = [];\n\nlet kcl = [];\nlet kcl2 = [];\nlet kcl20 = [];\nlet kcl_loc = [];\nlet kcl_joy = [];\n\nlet ucl = [];\nlet ucl2 = [];\nlet ucl20 = [];\nlet ucl_loc = [];\nlet ucl_joy = [];\n\nlet leeds = [];\nlet leeds2 = [];\nlet leeds20 = [];\nlet leeds_loc = [];\nlet leeds_joy = [];\n\nlet liv = [];\nlet liv2 = [];\nlet liv20 = [];\nlet liv_loc = [];\nlet liv_joy = [];\n\nlet lse = [];\nlet lse2 = [];\nlet lse20 = [];\nlet lse_loc = [];\nlet lse_joy = [];\n\n\nlet man = [];\nlet man2 = [];\nlet man20 = [];\nlet man_loc = [];\nlet man_joy = [];\n\nlet shef = [];\nlet shef2 = [];\nlet shef20 = [];\nlet shef_loc = [];\nlet shef_joy = [];\n\nlet camb = [];\nlet camb2 = [];\nlet camb20 = [];\nlet camb_loc = [];\nlet camb_joy = [];\n\n\nlet search = [];\nlet search2 = [];\nlet search20 = [];\nlet search_loc = [];\nlet search_sent = [];\nlet search_tweets = [];\nlet search_retweets = [];\n\nvar chart3;\nvar chart4;\n\n\n\n\n//GetQ gets the radio button queries and displays relevant map or search outputs\nfunction getQ() {\n  \tfor(const rb1 of rbs1){\n\t\tif(rb1.checked){\n\t\t\tif(rb1.value == \"map\"){\n\t\t\t\tdocument.getElementById(\"main_cont\").style.display=\"flex\";\n\t\t\t\tdocument.getElementById(\"SearchPageDiv\").style.display=\"none\";\n\t\t\t\tfor (const rb of rbs) {\n\t\t\t\t\tif (rb.checked) {\n\t\t\t\t\t\tif (rb.value== \"words\"){\n\t\t\t\t\t\t\twords=1;\n\t\t\t\t\t\t\tdisplayNames('Select a University', -1, 0, 0);\n\t\t\t\t\t\t\tdocument.getElementById(\"CloudA_ContainerContainer\").style.display=\"flex\";\n\t\t\t\t\t\t\tdocument.getElementById(\"CloudB_ContainerContainer\").style.display=\"none\";\n\t\t\t\t\t\t\tdocument.getElementById(\"CloudC_ContainerContainer\").style.display=\"none\";\n\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (rb.value== \"location\"){\n\t\t\t\t\t\t\twords=2;\n\t\t\t\t\t\t\tdisplayNames('Select a University', -1, 0, 0);\n\t\t\t\t\t\t\tdocument.getElementById(\"CloudB_ContainerContainer\").style.display=\"flex\";\n\t\t\t\t\t\t\tdocument.getElementById(\"CloudA_ContainerContainer\").style.display=\"none\";\n\t\t\t\t\t\t\tdocument.getElementById(\"CloudC_ContainerContainer\").style.display=\"none\";\n\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (rb.value== \"trend\"){\n\t\t\t\t\t\t\twords=3;\n\t\t\t\t\t\t\tdisplayNames('Select a University', -1, 0, 0);\n\t\t\t\t\t\t\tdocument.getElementById(\"CloudC_ContainerContainer\").style.display=\"flex\";\n\t\t\t\t\t\t\tdocument.getElementById(\"CloudB_ContainerContainer\").style.display=\"none\";\n\t\t\t\t\t\t\tdocument.getElementById(\"CloudA_ContainerContainer\").style.display=\"none\";\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if(rb1.value==\"search\"){\n\t\t\t\tdocument.getElementById(\"main_cont\").style.display=\"none\";\n\t\t\t\tdocument.getElementById(\"SearchPageDiv\").style.display=\"block\";\n\t\t\t}\n\t\t}\n\t}\n}\n\n//Gets the uni clicked on and displays their mood\nfunction displayNames(name, mood, tweets, retweets){\n\tdocument.getElementById(\"Uni\").innerHTML = name;\n\n\tvar sentiment;\n\n\n\tif(mood >= 0 && mood < 0.2 && tweets >0 && retweets > 0){\n\t\tsentiment = \"Very Unhappy\";\n\t\t// if(tweets == 0 && retweets == 0){\n\t\t//   sentiment = \"No tweets\";\n\t\t// }\n\t}\n\telse if(mood >= 0.2 && mood < 0.4){\n\t\tsentiment = \"Unhappy\";\n\t}\n\telse if(mood >= 0.4 && mood < 0.6){\n\t\tsentiment = \"Neutral\";\n\t}\n\telse if(mood >= 0.6 && mood < 0.8){\n\t\tsentiment = \"Happy\";\n\t}\n\telse if(mood >= 0.8 && mood <= 1){\n\t\tsentiment = \"Very Happy\";\n\t}\n\telse if(mood == \"Retrieving Sentiment Information\"){\n\t\tsentiment = mood;\n\t}\n\telse{\n\t\tsentiment = \"No Sentiment Information to Display\";\n\t}\n\tdocument.getElementById(\"Mood\").innerHTML = sentiment;\n\treturn;\n}\n\n//displays the sentiment of the search term\nfunction displayNamesSearch(mood, tweets, retweets){\n\tvar sentiment;\n\tif(tweets == 0 && retweets == 0){\n\t\tsentiment = \"No Sentiment Information to display\"\n\t}\n\tif(mood >= 0 && mood < 0.2){\n\t\tsentiment = \"Very Unhappy\";\n\t}\n\telse if(mood >= 0.2 && mood < 0.4){\n\t\tsentiment = \"Unhappy\";\n\t}\n\telse if(mood >= 0.4 && mood < 0.6){\n\t\tsentiment = \"Neutral\";\n\t}\n\telse if(mood >= 0.6 && mood < 0.8){\n\t\tsentiment = \"Happy\";\n\t}\n\telse if(mood >= 0.8 && mood <= 1){\n\t\tsentiment = \"Very Happy\";\n\t}\n\telse if(mood == \"Retrieving Sentiment Information\"){\n\t\tsentiment = mood;\n\t}\n\n\tdocument.getElementById(\"SearchMood\").innerHTML = sentiment;\n}\n\nfunction PullfromDB(){\n\treturn new Promise( function (resolve, reject) {\n\t\tconsole.log(\"Pull from DB\");\n\n\t\tdb.collection('20 ibm').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tibm.push(doc.data());\n\t\t\t\tresolve(ibm);\n\t\t\t})\n\t\t})\n\t\tconsole.log(ibm);\n\n\t\tdb.collection('location ibm').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tibm2.push(doc.data());\n\t\t\t\tresolve(ibm2);\n\t\t\t})\n\t\t})\n\n\t\tconsole.log(ibm2);\n\n\t\tdb.collection('University').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tds.push(doc.data());\n\t\t\t\tresolve(ds);\n\t\t\t})\n\t\t})\n\t\tconsole.log(ds);\n\n\t\tdb.collection('Line Graphs IBM').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tibm_joy.push(doc.data());\n\t\t\t\tresolve(ibm_joy);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('Line Graphs ICL').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\ticl_joy.push(doc.data());\n\t\t\t\tresolve(icl_joy);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('Line Graphs Ox').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tox_joy.push(doc.data());\n\t\t\t\tresolve(ox_joy);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('Line Graphs Birmingham').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tbham_joy.push(doc.data());\n\t\t\t\tresolve(bham_joy);\n\t\t\t})\n\t\t})\n\n\n\t\tdb.collection('Line Graphs Bristol').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tbristol_joy.push(doc.data());\n\t\t\t\tresolve(bristol_joy);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('Line Graphs Cardiff').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tcardiff_joy.push(doc.data());\n\t\t\t\tresolve(cardiff_joy);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('Line Graphs Durham').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tdurham_joy.push(doc.data());\n\t\t\t\tresolve(durham_joy);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('Line Graphs Edinburgh').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tedin_joy.push(doc.data());\n\t\t\t\tresolve(edin_joy);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('Line Graphs Exeter').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tex_joy.push(doc.data());\n\t\t\t\tresolve(ex_joy);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('Line Graphs Glasgow').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tglas_joy.push(doc.data());\n\t\t\t\tresolve(glas_joy);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('Line Graphs KCL').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tkcl_joy.push(doc.data());\n\t\t\t\tresolve(kcl_joy);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('Line Graphs UCL').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tucl_joy.push(doc.data());\n\t\t\t\tresolve(ucl_joy);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('Line Graphs Leeds').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tleeds_joy.push(doc.data());\n\t\t\t\tresolve(leeds_joy);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('Line Graphs Liverpool').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tliv_joy.push(doc.data());\n\t\t\t\tresolve(liv_joy);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('Line Graphs LSE').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tlse_joy.push(doc.data());\n\t\t\t\tresolve(lse_joy);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('Line Graphs Manchester').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tman_joy.push(doc.data());\n\t\t\t\tresolve(man_joy);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('Line Graphs Sheffield').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tshef_joy.push(doc.data());\n\t\t\t\tresolve(shef_joy);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('20 icl').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\ticl.push(doc.data());\n\t\t\t\tresolve(icl);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('location icl').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\ticl2.push(doc.data());\n\t\t\t\tresolve(icl2);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('20 ox').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tox.push(doc.data());\n\t\t\t\tresolve(ox);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('location ox').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tox2.push(doc.data());\n\t\t\t\tresolve(ox2);\n\t\t\t})\n\t\t})\n\t\tdb.collection('20 bham').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\tbham.push(doc.data());\n\t\t\tresolve(bham);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('location bham').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tbham2.push(doc.data());\n\t\t\t\tresolve(bham2);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('20 bristol').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tbristol.push(doc.data());\n\t\t\t\tresolve(bristol);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('location bristol').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tbristol2.push(doc.data());\n\t\t\t\tresolve(bristol2);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('20 cardiff').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tcardiff.push(doc.data());\n\t\t\t\tresolve(cardiff);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('location cardiff').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tcardiff2.push(doc.data());\n\t\t\t\tresolve(cardiff2);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('20 durham').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tdurham.push(doc.data());\n\t\t\t\tresolve(durham);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('location durham').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tdurham2.push(doc.data());\n\t\t\t\tresolve(durham2);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('20 edin').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tedin.push(doc.data());\n\t\t\t\tresolve(edin);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('location edin').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tedin2.push(doc.data());\n\t\t\t\tresolve(edin2);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('20 ex').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tex.push(doc.data());\n\t\t\t\tresolve(ex);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('location ex').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tex2.push(doc.data());\n\t\t\t\tresolve(ex2);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('20 glasgow').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tglas.push(doc.data());\n\t\t\t\tresolve(glas);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('location glasgow').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tglas2.push(doc.data());\n\t\t\t\tresolve(glas2);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('20 kcl').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tkcl.push(doc.data());\n\t\t\t\tresolve(kcl);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('location kcl').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tkcl2.push(doc.data());\n\t\t\t\tresolve(kcl2);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('20 ucl').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tucl.push(doc.data());\n\t\t\t\tresolve(ucl);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('location ucl').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tucl2.push(doc.data());\n\t\t\t\tresolve(ucl2);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('20 leeds').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tleeds.push(doc.data());\n\t\t\t\tresolve(leeds);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('location leeds').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tleeds2.push(doc.data());\n\t\t\t\tresolve(leeds2);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('20 liverpool').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tliv.push(doc.data());\n\t\t\t\tresolve(liv);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('location liverpool').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tliv2.push(doc.data());\n\t\t\t\tresolve(liv2);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('20 lse').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tlse.push(doc.data());\n\t\t\t\tresolve(lse);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('location lse').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tlse2.push(doc.data());\n\t\t\t\tresolve(lse2);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('20 manchester').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tman.push(doc.data());\n\t\t\t\tresolve(man);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('location manchester').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tman2.push(doc.data());\n\t\t\t\tresolve(man2);\n\t\t\t})\n\t\t})\n\t\tdb.collection('20 sheffield').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tshef.push(doc.data());\n\t\t\t\tresolve(shef);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('location sheffield').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tshef2.push(doc.data());\n\t\t\t\tresolve(shef2);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('20 cam').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tcamb.push(doc.data());\n\t\t\t\tresolve(camb);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('location cam').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tcamb2.push(doc.data());\n\t\t\t\tresolve(camb2);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('20 search').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tsearch.push(doc.data());\n\t\t\t\tresolve(search);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('location search').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tsearch2.push(doc.data());\n\t\t\t\tresolve(search2);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('Search Sentiment').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tsearch_sent.push(doc.data());\n\t\t\t\tresolve(search_sent);\n\t\t\t\t// console.log(search_sent[0].Mood);\n\t\t\t})\n\t\t})\n\n\n\t\tdb.collection('Search Tweets Number').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tsearch_tweets.push(doc.data());\n\t\t\t\tresolve(search_tweets);\n\t\t\t})\n\t\t})\n\t\tdb.collection('Search Retweets Number').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tsearch_retweets.push(doc.data());\n\t\t\t\tresolve(search_retweets);\n\t\t\t})\n\t\t})\n\n\t});\n}\n\nfunction PullSearchDB(){\n\treturn new Promise(function(resolve, reject){\n\t\tconsole.log(\"Pull for Search\");\n\t\tsearch=[];\n\t\tdb.collection('20 search').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tsearch.push(doc.data());\n\t\t\t\tresolve(search);\n\t\t\t})\n\t\t})\n\t\tconsole.log(search[0]);\n\n\t\tsearch2=[];\n\t\t\n\t\tdb.collection('location search').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tsearch2.push(doc.data());\n\t\t\t\tresolve(search2);\n\t\t\t})\n\t\t})\n\n\t\tconsole.log(\"HELLO\");\n\t\tconsole.log(search2[0]);\n\n\t\tsearch_sent = [];\n\t\tdb.collection('Search Sentiment').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tsearch_sent.push(doc.data());\n\t\t\t\tresolve(search_sent);\n\t\t\t})\n\t\t})\n\t\tsearch_tweets = [];\n\t\tdb.collection('Search Tweets Number').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tsearch_tweets.push(doc.data());\n\t\t\t\tresolve(search_tweets);\n\t\t\t})\n\t\t})\n\t\tsearch_retweets = [];\n\t\tdb.collection('Search Retweets Number').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tsearch_retweets.push(doc.data());\n\t\t\t\tresolve(search_retweets);\n\t\t\t})\n\t\t})\n\n\t});\n}\n\nfunction drawCloud(data, title, container){\n\tchartA = anychart.tagCloud(data);\n\tchartA.title(title)\n\tchartA.angles([0])\n\tchartA.container(container);\n\tchartA.draw();\n\treturn chartA;\n}\n\nfunction sleep(ms) {\n\treturn new Promise(resolve => setTimeout(resolve, ms));\n}\n\nfunction startTimer(duration, display) {\n\tconsole.log(\"HELLO\");\n\tvar timer = duration, minutes, seconds;\n\n\tvar thing = setInterval(function () {\n\n\t\tminutes = parseInt(timer / 60, 10);\n\t\tseconds = parseInt(timer % 60, 10);\n\t\tminutes = minutes < 10 ? \"0\" + minutes : minutes;\n\t\tseconds = seconds < 10 ? \"0\" + seconds : seconds;\n\t\tdisplay.textContent = minutes + \":\" + seconds;\n\n\t\tif (--timer < 0) {\n\t\t\ttimer = 0,0,0;\n\t\t\tclearInterval(thing);\n\t\t\tconsole.log(\"Starting Delay\");\n\t\t\tsleep(1000).then(() => { \n\t\t\t\t\n\t\t\t\tconsole.log(\"World!\");\n\t\t\t\tPullSearchDB().then(()=>{\n\t\t\t\t\tsleep(3000).then(() => {\n\n\t\t\t\t\t\tconsole.log(\"Delay Complete\");\n\t\t\t\t\t\tsearch20 = [];\n\t\t\t\t\t\tsearch_loc = [];\n\t\t\t\t\t\tconsole.log(search[0]);\n\t\t\t\t\t\tconsole.log(search2[0]);\n\t\t\t\t\t\tif (search.length != 0) {\n\t\t\t\t\t\t\tfor(var i = 0; i < Object.keys(search[0]).length ; i++){\n\t\t\t\t\t\t\t\tsearch20.push({\"x\": search[0][i].x, \"value\": search[0][i].value});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (search2.length != 0) {\n\t\t\t\t\t\t\tfor(var i = 0; i < Object.keys(search2[0]).length; i++){\n\t\t\t\t\t\t\t\tsearch_loc.push({\"x\": search2[0][i].x, \"value\": search2[0][i].value});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tchart3.dispose();\n\t\t\t\t\t\tchart4.dispose();\n\t\t\t\t\t\tconsole.log(\"Charts Disposed.\");\n\t\t\t\t\t\tchart3 = drawCloud(search20, '20 Most Common SEARCH', 'SearchCloudA');\n\t\t\t\t\t\tconsole.log(\"Half way there\");\n\t\t\t\t\t\tchart4 = drawCloud(search_loc, 'Locations SEARCH', 'SearchCloudB');\n\t\t\t\t\t\tconsole.log(\"Drawing Attempted.\");\n\t\t\t\t\t});\n\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t} , 1000);\n}\n\nfunction timer_search(){\n\tconsole.log(\"Search Pressed.\");\n\tvar time = document.getElementById(\"id_number\").value * 60;\n\tconsole.log(time);\n\tdisplay = document.querySelector('#timedisplayer');\n\tstartTimer(time, display);\n}\n\n\ngetQ();\t\t\n\nPullfromDB().then(function() {\n\tconsole.log(\"Drawing function\");\n\tanychart.onDocumentReady(function() {\n\n\t\t// displayNamesSearch(search_sent[0].Mood);\n\t\tvar map = anychart.map();\n\t\tvar dataSet = anychart.data.set(ds);\n\t\tvar tweets = dataSet.mapAs({name: 'Name', lat: 'Latitude', long: 'Longitude', size: 'Tweets' });\n\t\tvar series1 = map.bubble(tweets);\n\t\tvar retweets = dataSet.mapAs({name: 'Name', lat: 'Latitude', long: 'Longitude', size: 'Retweets' });\n\t\tvar series2 = map.bubble(retweets);\n\t\tmap.minBubbleSize(\".5%\");\n\t\tmap.maxBubbleSize(\"5%\");\n\t\tmap.unboundRegions().fill('#C4D5E5')\n\t\tmap.unboundRegions().stroke('#C4D5E5');\n\n\t\tmap.geoData(anychart.maps['united_kingdom']);\n\n\t\t//Credits NEED LICENSE KEY\n\t\t//map.credits().enabled(false);\n\t\tvar zoomController = anychart.ui.zoom();\n\t\tzoomController.render(map);\n\t\tmap.container('Map_Container');\n\t\tmap.tooltip(true);\n\t\tseries1.tooltip().enabled(false);\n\t\tseries2.tooltip().format(\"Tweets: {%Tweets} \\nRetweets: {%Retweets} \\nMood: {%Mood}\");\n\n\t\tmap.draw();\n\n\t\t//Line Graph Code draw to CloudC_Container\n\t\tvar dataTable = anychart.data.table(\"date\");\n\t\tdataTable.addData(leeds_joy);\n\t\tanychart.format.inputDateTimeFormat('yyyy-MM-dd');\n\t\tvar mapping = dataTable.mapAs({value: \"joy\"});\n\n\t\tline = anychart.stock();\n\t\tline.plot().line(mapping);\n\t\tvar rangePicker = anychart.ui.rangePicker();\n\t\trangePicker.format('dd MM yyyy');\n\t\tline.title(\"Trend in Happiness - IBM\");\n\t\tline.container(\"CloudC_Container\");\n\t\tline.draw();\n\t\tline.selectRange(\"ytd\");\n\n\n\t\t//WordCloud Draw to CloudA_Container and CloudB_Container\n\t\tvar data1;\n\t\tvar data2;\n\t\tvar chart1;\n\t\tvar chart2;\n\n\t\n\t\tibm20 = [];\n\t\tibm_loc = [];\n\t\tfor(var i = 0; i < Object.keys(ibm[0]).length; i++){\n\t\t\tibm20.push({\"x\": ibm[0][i].x, \"value\": ibm[0][i].value});\n\t\t}\n\t\tdata1 = ibm20;\n\t\tfor(var i = 0; i < Object.keys(ibm2[0]).length; i++){\n\t\t\tibm_loc.push({\"x\": ibm2[0][i].x, \"value\": ibm2[0][i].value});\n\t\t}\n\t\tdata2 = ibm_loc;\n\n\t\tchart1 = anychart.tagCloud(data1);\n\t\tchart2 = anychart.tagCloud(data2);\n\t\tchart1.title('20 Most Common Words from Tweets')\n\t\tchart2.title('Location Word Cloud')\n\t\tchart1.angles([0])\n\t\tchart2.angles([0])\n\t\tchart1.container(\"CloudA_Container\");\n\t\tchart2.container(\"CloudB_Container\");\n\t\tchart1.draw();\n\t\tchart2.draw();\n\n\n\t\tmap.listen(\"dblClick\", function(e2) {\n\n\t\t\tif(words==1){\n\t\t\t\tchart1.dispose();\n\t\t\t\tibm20 = [];\n\t\t\t\tfor(var i = 0; i < 20; i++){\n\t\t\t\t\tibm20.push({\"x\": ibm[0][i].x, \"value\": ibm[0][i].value});\n\t\t\t\t}\n\t\t\t\tdata1 = ibm20;\n\t\t\t\tchart1 = anychart.tagCloud(data1);\n\t\t\t\tchart1.angles([0])\n\t\t\t\tchart1.container(\"CloudA_Container\");\n\t\t\t    chart1.title('20 Most Common Words from Tweets - IBM')\n\t\t\t\tchart1.background().fill(\"transparent\");\n\t\t\t\tchart1.draw();\n\t\t\t}\n\t\t\tif(words==2){\n\t\t\t\tchart2.dispose();\n\t\t\t\tibm_loc = [];\n\t\t\t\tfor(var i = 0; i < Object.keys(ibm2[0]).length; i++){\n\t\t\t\t\tibm_loc.push({\"x\": ibm2[0][i].x, \"value\": ibm2[0][i].value});\n\t\t\t\t}\n\t\t\t\tdata2 = ibm_loc;\n\t\t\t\tchart2 = anychart.tagCloud(data2);\n\t\t\t\tchart2.angles([0])\n\t\t\t\tchart2.title('Locations Mentioned in Tweets: ')\n\t\t\t\tchart2.container(\"CloudB_Container\");\n\t\t\n\t\t\t\tchart2.background().fill(\"transparent\");\n\t\t\t\tchart2.draw();\n\t\t\t}\n\t\t\tif(words==3){\n\t\t\t\tline.dispose();\n\t\t\t\tvar dataTable = anychart.data.table(\"date\");\n\t\t\t\tdataTable.addData(ibm_joy);\n\t\t\t\tanychart.format.inputDateTimeFormat('yyyy-MM-dd');\n\t\t\t\tvar mapping = dataTable.mapAs({value: \"joy\"});\n\t\t\t\tline = anychart.stock();\n\t\t\t\tline.plot().line(mapping);\n\t\t\t\tvar rangePicker = anychart.ui.rangePicker();\n\t\t\t\trangePicker.format('dd MM yyyy');\n\t\t\t\tline.title(\"Trend in Happiness - IBM\");\n\t\t\t\tline.container(\"CloudC_Container\");\n\t\t\t\tline.draw();\n\t\t\t\tline.selectRange(\"ytd\");\n\t\t\t}\n\n\t\t\tdisplayNames('Select a University', -1, 0, 0);\n\n\t\t});\n\n\t\tmap.bubble(tweets).listen(\"Click\", function(e) {\n\t\t\tgetQ();\n\t\t\tvar dsarray_index = e.pointIndex;\n\t\t\tconsole.log(ds[dsarray_index].Name);\n\t\t\tdisplayNames(ds[dsarray_index].Name, ds[dsarray_index].Mood, ds[dsarray_index].Tweets, ds[dsarray_index].Retweets);\n\t\t\tswitch(ds[dsarray_index].Name){\n\n\t\t\t\tcase \"Imperial College London\":\n\t\t\t\t\ticl20 = [];\n\t\t\t\t\ticl_loc = [];\n\t\t\t\t\tfor(var i = 0; i < Object.keys(icl[0]).length; i++){\n\t\t\t\t\t\t\ticl20.push({\"x\": icl[0][i].x, \"value\": icl[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tfor(var i = 0; i < Object.keys(icl2[0]).length; i++){\n\t\t\t\t\t\t\ticl_loc.push({\"x\": icl2[0][i].x, \"value\": icl2[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tdata1 = icl20;\n\t\t\t\t\tconsole.log(data1);\n\t\t\t\t\tdata2 = icl_loc;\n\t\t\t\t\tconsole.log(data2);\n\t\t\t\t\tdataTable.addData(icl_joy);\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"University of Oxford\":\n\t\t\t\t\tox20 = [];\n\t\t\t\t\tox_loc = [];\n\t\t\t\t\tfor(var i = 0; i < Object.keys(ox[0]).length; i++){\n\t\t\t\t\t\t\tox20.push({\"x\": ox[0][i].x, \"value\": ox[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tfor(var i = 0; i < Object.keys(ox2[0]).length; i++){\n\t\t\t\t\t\t\tox_loc.push({\"x\": ox2[0][i].x, \"value\": ox2[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tdata1 = ox20;\n\t\t\t\t\tconsole.log(ox20);\n\t\t\t\t\tdata2 = ox_loc;\n\t\t\t\t\tconsole.log(ox_loc);\n\t\t\t\t\tdataTable.addData(ox_joy);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"University of Birmingham\":\n\t\t\t\t\tbham20 = [];\n\t\t\t\t\tbham_loc = [];\n\t\t\t\t\tfor(var i = 0; i < Object.keys(bham[0]).length; i++){\n\t\t\t\t\t\t\tbham20.push({\"x\": bham[0][i].x, \"value\": bham[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tfor(var i = 0; i < Object.keys(bham2[0]).length; i++){\n\t\t\t\t\t\t\tbham_loc.push({\"x\": bham2[0][i].x, \"value\": bham2[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tdata1 = bham20;\n\t\t\t\t\tdata2 = bham_loc;\n\n\t\t\t\t\tdataTable.addData(bham_joy);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"University of Bristol\":\n\t\t\t\t\tbristol20 = [];\n\t\t\t\t\tbristol_loc = [];\n\t\t\t\t\tfor(var i = 0; i < Object.keys(bristol[0]).length; i++){\n\t\t\t\t\t\t\tbristol20.push({\"x\": bristol[0][i].x, \"value\": bristol[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tfor(var i = 0; i < Object.keys(bristol2[0]).length; i++){\n\t\t\t\t\t\t\tbristol_loc.push({\"x\": bristol2[0][i].x, \"value\": bristol2[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tdata1 = bristol20;\n\t\t\t\t\tdata2 = bristol_loc;\n\n\t\t\t\t\tdataTable.addData(bristol_joy);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"University of Cardiff\":\n\t\t\t\t\tcardiff20 = [];\n\t\t\t\t\tcardiff_loc = [];\n\t\t\t\t\tfor(var i = 0; i < Object.keys(cardiff[0]).length; i++){\n\t\t\t\t\t\t\tcardiff20.push({\"x\": cardiff[0][i].x, \"value\": cardiff[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tfor(var i = 0; i < Object.keys(cardiff2[0]).length; i++){\n\t\t\t\t\t\t\tcardiff_loc.push({\"x\": cardiff2[0][i].x, \"value\": cardiff2[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tdata1 = cardiff20;\n\t\t\t\t\tdata2 = cardiff_loc;\n\n\t\t\t\t\tdataTable.addData(cardiff_joy);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"University of Durham\":\n\t\t\t\t\tdurham20 = [];\n\t\t\t\t\tdurham_loc = [];\n\t\t\t\t\tfor(var i = 0; i < Object.keys(durham[0]).length; i++){\n\t\t\t\t\t\t\tdurham20.push({\"x\": durham[0][i].x, \"value\": durham[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tfor(var i = 0; i < Object.keys(durham2[0]).length; i++){\n\t\t\t\t\t\t\tdurham_loc.push({\"x\": durham2[0][i].x, \"value\": durham2[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tdata1 = durham20;\n\t\t\t\t\tdata2 = durham_loc;\n\n\t\t\t\t\tdataTable.addData(durham_joy);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"University of Edinburgh\":\n\t\t\t\t\tedin20 = [];\n\t\t\t\t\tedin_loc = [];\n\t\t\t\t\tfor(var i = 0; i < Object.keys(edin[0]).length; i++){\n\t\t\t\t\t\t\tedin20.push({\"x\": edin[0][i].x, \"value\": edin[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tfor(var i = 0; i < Object.keys(edin2[0]).length; i++){\n\t\t\t\t\t\t\tedin_loc.push({\"x\": edin2[0][i].x, \"value\": edin2[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tdata1 = edin20;\n\t\t\t\t\tdata2 = edin_loc;\n\n\t\t\t\t\tdataTable.addData(edin_joy);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"University of Exeter\":\n\t\t\t\t\tex20 = [];\n\t\t\t\t\tex_loc = [];\n\t\t\t\t\tfor(var i = 0; i < Object.keys(ex[0]).length; i++){\n\t\t\t\t\t\t\tex20.push({\"x\": ex[0][i].x, \"value\": ex[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tfor(var i = 0; i < Object.keys(ex2[0]).length; i++){\n\t\t\t\t\t\t\tex_loc.push({\"x\": ex2[0][i].x, \"value\": ex2[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tdata1 = ex20;\n\t\t\t\t\tdata2 = ex_loc;\n\n\t\t\t\t\tdataTable.addData(ex_joy);\n\t\t\t\t\tbreak;\n\n\n\t\t\t\tcase \"University of Glasgow\":\n\t\t\t\t\tglas20 = [];\n\t\t\t\t\tglas_loc = [];\n\t\t\t\t\tfor(var i = 0; i < Object.keys(glas[0]).length; i++){\n\t\t\t\t\t\t\tglas20.push({\"x\": glas[0][i].x, \"value\": glas[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tfor(var i = 0; i < Object.keys(glas2[0]).length; i++){\n\t\t\t\t\t\t\tglas_loc.push({\"x\": glas2[0][i].x, \"value\": glas2[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tdata1 = glas20;\n\t\t\t\t\tdata2 = glas_loc;\n\n\t\t\t\t\tdataTable.addData(glas_joy);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"King's College London\":\n\t\t\t\t\tkcl20 = [];\n\t\t\t\t\tkcl_loc = [];\n\t\t\t\t\tfor(var i = 0; i < Object.keys(kcl[0]).length; i++){\n\t\t\t\t\t\t\tkcl20.push({\"x\": kcl[0][i].x, \"value\": kcl[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tfor(var i = 0; i < Object.keys(kcl2[0]).length; i++){\n\t\t\t\t\t\t\tkcl_loc.push({\"x\": kcl2[0][i].x, \"value\": kcl2[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tdata1 = kcl20;\n\t\t\t\t\tdata2 = kcl_loc;\n\n\t\t\t\t\tdataTable.addData(kcl_joy);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"University College London\":\n\t\t\t\t\tucl20 = [];\n\t\t\t\t\tucl_loc = [];\n\t\t\t\t\tfor(var i = 0; i < Object.keys(ucl[0]).length; i++){\n\t\t\t\t\t\t\tucl20.push({\"x\": ucl[0][i].x, \"value\": ucl[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tfor(var i = 0; i < Object.keys(ucl2[0]).length; i++){\n\t\t\t\t\t\t\tucl_loc.push({\"x\": ucl2[0][i].x, \"value\": ucl2[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tdata1 = ucl20;\n\t\t\t\t\tdata2 = ucl_loc;\n\n\t\t\t\t\tdataTable.addData(ucl_joy);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"University of Leeds\":\n\t\t\t\t\tleeds20 = [];\n\t\t\t\t\tleeds_loc = [];\n\t\t\t\t\tfor(var i = 0; i < Object.keys(leeds[0]).length; i++){\n\t\t\t\t\t\t\tleeds20.push({\"x\": leeds[0][i].x, \"value\": leeds[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tfor(var i = 0; i < Object.keys(leeds2[0]).length; i++){\n\t\t\t\t\t\t\tleeds_loc.push({\"x\": leeds2[0][i].x, \"value\": leeds2[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tdata1 = leeds20;\n\t\t\t\t\tdata2 = leeds_loc;\n\n\t\t\t\t\tdataTable.addData(leeds_joy);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"University of Liverpool\":\n\t\t\t\t\tliv20 = [];\n\t\t\t\t\tliv_loc = [];\n\t\t\t\t\tfor(var i = 0; i < Object.keys(liv[0]).length; i++){\n\t\t\t\t\t\t\tliv20.push({\"x\": liv[0][i].x, \"value\": liv[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tfor(var i = 0; i < Object.keys(liv2[0]).length; i++){\n\t\t\t\t\t\t\tliv_loc.push({\"x\": liv2[0][i].x, \"value\": liv2[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tdata1 = liv20;\n\t\t\t\t\tdata2 = liv_loc;\n\n\t\t\t\t\tdataTable.addData(liv_joy);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"London School of Economics\":\n\t\t\t\t\tlse20 = [];\n\t\t\t\t\tlse_loc = [];\n\t\t\t\t\tfor(var i = 0; i < Object.keys(lse[0]).length; i++){\n\t\t\t\t\t\t\tlse20.push({\"x\": lse[0][i].x, \"value\": lse[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tfor(var i = 0; i < Object.keys(lse2[0]).length; i++){\n\t\t\t\t\t\t\tlse_loc.push({\"x\": lse2[0][i].x, \"value\": lse2[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tdata1 = lse20;\n\t\t\t\t\tdata2 = lse_loc;\n\n\t\t\t\t\tdataTable.addData(lse_joy);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"University of Manchester\":\n\t\t\t\t\tman20 = [];\n\t\t\t\t\tman_loc = [];\n\t\t\t\t\tfor(var i = 0; i < Object.keys(man[0]).length; i++){\n\t\t\t\t\t\t\tman20.push({\"x\": man[0][i].x, \"value\": man[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tfor(var i = 0; i < Object.keys(man2[0]).length; i++){\n\t\t\t\t\t\t\tman_loc.push({\"x\": man2[0][i].x, \"value\": man2[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tdata1 = man20;\n\t\t\t\t\tdata2 = man_loc;\n\n\t\t\t\t\tdataTable.addData(man_joy);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"University of Sheffield\":\n\t\t\t\t\tshef20 = [];\n\t\t\t\t\tshef_loc = [];\n\t\t\t\t\tfor(var i = 0; i < Object.keys(shef[0]).length; i++){\n\t\t\t\t\t\t\tshef20.push({\"x\": shef[0][i].x, \"value\": shef[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tfor(var i = 0; i < Object.keys(shef2[0]).length; i++){\n\t\t\t\t\t\t\tshef_loc.push({\"x\": shef2[0][i].x, \"value\": shef2[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tdata1 = shef20;\n\t\t\t\t\tdata2 = shef_loc;\n\n\t\t\t\t\tdataTable.addData(shef_joy);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"University of Cambridge\":\n\t\t\t\t\tcamb20 = [];\n\t\t\t\t\tcamb_loc = [];\n\t\t\t\t\tfor(var i = 0; i < Object.keys(camb [0]).length; i++){\n\t\t\t\t\t\t\tcamb20.push({\"x\": camb[0][i].x, \"value\": camb[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconsole.log(camb);\n\t\t\t\t\tfor(var i = 0; i < Object.keys(camb2[0]).length; i++){\n\t\t\t\t\t\t\tcamb_loc.push({\"x\": camb2[0][i].x, \"value\": camb2[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tdata1 = camb20;\n\t\t\t\t\tdata2 = camb_loc;\n\n\t\t\t\t\tdataTable.addData(camb_joy);\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\n\t\t\t}\n\n\t\t\t\n\n\t\t\tif(words==1){\n\t\t\t\tchart1.dispose();\n\t\t\t\tchart1 = anychart.tagCloud(data1);\n\t\t\t\tchart1.title('20 Most Common Words from Tweets')\n\t\t\t\tchart1.angles([0]);\n\t\t\t\tchart1.container(\"CloudA_Container\");\n\t\t\t\tchart1.background().fill(\"transparent\");\n\t\t\t\tchart1.draw();\n\t\t\t}\n\t\t\tif(words==2){\n\t\t\t\tchart2.dispose();\n\t\t\t\tchart2 = anychart.tagCloud(data2);\n\t\t\t\tchart2.title('Locations Mentioned in Tweets: ')\n\t\t\t\tchart2.angles([0]);\n\t\t\t\tchart2.container(\"CloudB_Container\");\n\t\t\t\tchart2.background().fill(\"transparent\");\n\t\t\t\tchart2.draw();\n\t\t\t}\n\t\t\tif(words==3){\n\t\t\t\tline.dispose();\n\t\t\t\tanychart.format.inputDateTimeFormat('yyyy-MM-dd');\n\t\t\t\tvar mapping = dataTable.mapAs({value: \"joy\"});\n\t\t\t\tline = anychart.stock();\n\t\t\t\tline.plot().line(mapping);\n\t\t\t\tvar rangePicker = anychart.ui.rangePicker();\n\t\t\t\trangePicker.format('dd MM yyyy');\n\t\t\t\tline.title(\"Trend in Happiness\");\n\t\t\t\tline.container(\"CloudC_Container\");\n\t\t\t\tline.draw();\n\t\t\t\tline.selectRange(\"ytd\");\n\t\t\t}\n\t\t});\n\n\n\t\tsearch20 = [];\n\t\tsearch_loc = [];\n\t\tfor(var i = 0; i < Object.keys(search[0]).length ; i++){\n\t\t\tsearch20.push({\"x\": search[0][i].x, \"value\": search[0][i].value});\n\t\t}\n\t\tfor(var i = 0; i < Object.keys(search2[0]).length; i++){\n\t\t\tsearch_loc.push({\"x\": search2[0][i].x, \"value\": search2[0][i].value});\n\t\t}\n\t\tif(search_tweets != 0 || search_retweets != 0){\n\t\t\tdisplayNamesSearch(search_sent[0].Mood, search_tweets, search_retweets);\n\n\t\t\t// chart3 = drawCloud(search20, '20 Most Common Words from Tweets', 'SearchCloudA');\n\t\t\t// chart4 = drawCloud(search_loc, 'Location Word Cloud', \"SearchCloudB\");\n\n\t\t\tdata3 = search20;\n\t\t\tdata4 = search_loc;\n\t\t\tchart3 = anychart.tagCloud(data3);\n\t\t\tchart4 = anychart.tagCloud(data4);\n\t\t\tchart3.title('20 Most Common Words from Tweets')\n\t\t\tchart4.title('Location Word Cloud')\n\t\t\tchart3.angles([0])\n\t\t\tchart4.angles([0])\n\t\t\tchart3.container(\"SearchCloudA\");\n\t\t\tchart4.container(\"SearchCloudB\");\n\t\t\tchart3.draw();\n\t\t\tchart4.draw();\n\t\t}\n\t});\n});\n\n \n\n\t\n\n\n\n\t\n\n</script>\n\n</body>\n</html>\n","output":"str","x":730,"y":460,"wires":[["553764c9.71696c"]]},{"id":"bea7a416.e0b988","type":"template","z":"5d651a81.8ece7c","name":"Experimental 23/06/2021","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<html>\n<head>\n\t<title>Map & Cloud</title>\n\t<link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css\" rel=\"stylesheet\" integrity=\"sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x\" crossorigin=\"anonymous\">\n\t<link href=\"https://fonts.googleapis.com/css?family=Lato&display=swap\" rel=\"stylesheet\">\n\t<style>\n\n\t\tbody {\n\t\t\tbackground: linear-gradient(to bottom, white, #049cfc, #00ff11, #fbff00, #fc7600, #cc2316, purple);\n\t\t\tbackground-size: 100%;\n\t\t\tbackground-repeat: no-repeat;\n\t\t\tmargin: 0;\n\t\t\tfont-size: 1.15rem;\n\t\t\tline-height: 1.4em;\n\t\t\talign-items: center;\n\t\t\tsnap-snap-type: y proximity;\n\t\t}\n\n\t\tbody:before{\n\t\t\tcontent:'';\n\t\t\tposition: fixed;\n\t\t\ttop: 0;\n\t\t\tbottom: 0;\n\t\t\twidth: 100%;\n\t\t\tz-index: -1;\n\t\t\tbackground: linear-gradient(to right bottom, rgba(255,255,255,0.2), #54bbfc 75%);\n\t\t}\n\n\t\t#SnapParent {\n\t\t\tbackground-color: #ffffff;\n\t\t\tmargin: 2.5%;\n\t\t\t/*padding: 30px 60px;*/\n\t\t\tborder-radius: 20px;\n\t\t\tbox-shadow: 0 3px 26px 0 rgba(0,0,0,0.20);\n\t\t\twidth: 95%;\n\t\t\theight: 90%;\n\t\t\toverflow: auto;\n\t\t\tposition: absolute;\n\t\t\t/*scroll-snap-type: y proximity;*/\n\t\t\tscroll-snap-align: top;\n\t\t}\n\t\t#SnapParent2 {\n\t\t\tbackground-color: #ffffff;\n\t\t\tmargin: 2.5%;\n\t\t\t/*padding: 30px 60px;*/\n\t\t\tborder-radius: 20px;\n\t\t\tbox-shadow: 0 3px 26px 0 rgba(0,0,0,0.20);\n\t\t\twidth: 95%;\n\t\t\theight: 92%;\n\t\t\toverflow: auto;\n\t\t\tposition: absolute;\n\t\t\t/*scroll-snap-type: y proximity;*/\n\t\t\tscroll-snap-align: top;\n\t\t}\n\n\n\t\t.footer-dark {\n\t\t\tpadding:15px 0;\n\t\t\tcolor:#f0f9ff;\n\t\t\tbackground-color:#282d32;\n\t\t}\n\n\t\t.footer-dark h3 {\n\t\t\tmargin-top:0;\n\t\t\tmargin-bottom:12px;\n\t\t\tfont-weight:bold;\n\t\t\tfont-size:16px;\n\t\t}\n\t\t.footer-dark ul {\n\t\t\tpadding:0;\n\t\t\tlist-style:none;\n\t\t\tline-height:1.6;\n\t\t\tfont-size:14px;\n\t\t\tmargin-bottom:0;\n\t\t}\n\t\t.footer-dark ul a {\n\t\t\tcolor:inherit;\n\t\t\ttext-decoration:none;\n\t\t\topacity:0.6;\n\t\t}\n\t\t.footer-dark ul a:hover {\n\t\t\topacity:0.8;\n\t\t}\n\t\t@media (max-width:767px) {\n\t\t\t.footer-dark .item:not(.social) {\n\t\t\t\ttext-align:center;\n\t\t\t\tpadding-bottom:20px;\n\t\t\t}\n\t\t}\n\t\t.footer-dark .item.text {\n\t\t\tmargin-bottom:36px;\n\t\t}\n\t\t@media (max-width:767px) {\n\t\t\t.footer-dark .item.text {\n\t\t\t\tmargin-bottom:0;\n\t\t\t}\n\t\t}\n\t\t@media (max-width:575.5px) {\n\t\t\t.second{\n\t\t\t\t\tposition: relative;\n\t\t\t\t\ttop:-48px;\n\t\t\t\t\tmargin-bottom:-50px;\n\t\t\t}\n\t\t}\n\t\t.footer-dark .item.text p {\n\t\t\topacity:0.6;\n\t\t\tmargin-bottom:0;\n\t\t}\n\t\t.footer-dark {\n\t\t\ttext-align:center;\n\t\t}\n\t\t@media (max-width:991px) {\n\t\t\t.footer-dark {\n\t\t\t\ttext-align:center;\n\t\t\t\tmargin-top:20px;\n\t\t\t}\n\t\t\t.second{\n\t\t\t\tpadding-top:30px;\n\t\t\t}\n\t\t}\n\t\t.second{\n\t\t\t\tpadding-top:30px;\n\t\t}\n\t\t.footer-dark .copyright {\n\t\t\ttext-align:center;\n\t\t\tpadding-top:0px;\n\t\t\topacity:0.3;\n\t\t\tfont-size:13px;\n\t\t\tmargin-bottom:0;\n\t\t}\n\t\t.row{\n\t\t\t\tdisplay:flex;\n\t\t\t\tjustify-content:center;\n\t\t}\n\n\t\t*{\n\t\t\t\tbox-sizing: border-box;\n\t\t}\n\t\t.circle{\n\t\t\tposition: absolute;\n\t\t\tborder-radius: 50%;\n\t\t\tbackground: white;\n\t\t\tanimation: ripple 10s infinite;\n\t\t\tbox-shadow: 0px 0px 1px 0px #508fb9;\n\t\t}\n\t\t.small{\n\t\t\twidth: 10vw;\n\t\t\theight: 10vw;\n\t\t\tleft: -5vw;\n\t\t\ttop: -5vw;\n\t\t}\n\t\t.medium{\n\t\t\twidth: 20vw;\n\t\t\theight: 20vw;\n\t\t\tleft: -10vw;\n\t\t\ttop: -10vw;\n\t\t}\n\t\t.large{\n\t\t\twidth: 30vw;\n\t\t\theight: 30vw;\n\t\t\tleft: -15vw;\n\t\t\ttop: -15vw;\n\t\t}\n\t\t.xlarge{\n\t\t\twidth: 40vw;\n\t\t\theight: 40vw;\n\t\t\tleft: -20vw;\n\t\t\ttop: -20vw;\n\t\t}\n\t\t.xxlarge{\n\t\t\twidth: 50vw;\n\t\t\theight: 50vw;\n\t\t\tleft: -25vw;\n\t\t\ttop: -25vw;\n\t\t}\n\t\t.small1{\n\t\t\twidth: 10vw;\n\t\t\theight: 10vw;\n\t\t\tright:  -5vw;\n\t\t\ttop:  -5vw;\n\t\t}\n\t\t.medium1{\n\t\t\twidth: 20vw;\n\t\t\theight: 20vw;\n\t\t\tright:  -10vw;\n\t\t\ttop:  -10vw;\n\t\t}\n\t\t.large1{\n\t\t\twidth: 30vw;\n\t\t\theight: 30vw;\n\t\t\tright:  -15vw;\n\t\t\ttop:  -15vw;\n\t\t}\n\t\t.xlarge1{\n\t\t\twidth: 40vw;\n\t\t\theight: 40vw;\n\t\t\tright:  -20vw;\n\t\t\ttop:  -20vw;\n\t\t}\n\t\t.xxlarge1{\n\t\t\twidth: 50vw;\n\t\t\theight: 50vw;\n\t\t\tright:  -25vw;\n\t\t\ttop:  -25vw;\n\t\t}\n\t\t.shade1{\n\t\t\topacity: 0.2;\n\t\t}\n\t\t.shade2{\n\t\t\topacity: 0.4;\n\t\t}\n\t\t.shade3{\n\t\t\topacity: 0.5;\n\t\t}\n\t\t.shade4{\n\t\t\topacity: 0.7;\n\t\t}\n\t\t.shade5{\n\t\t\topacity: 0.8;\n\t\t}\n\t\t@keyframes ripple{\n\t\t\t0%{\n\t\t\t\ttransform: scale(0.8);\n\t\t\t}\n\t\t\t50%{\n\t\t\t\ttransform: scale(1.3);\n\t\t\t}\n\t\t\t100%{\n\t\t\t\ttransform: scale(0.8);\n\t\t\t}\n\t\t}\n\t\t.logo {\n\t\t\twidth: 30vw;\n\t\t\tpadding: 0;\n\t\t}\n\n\t\t/* Create two equal columns that floats next to each other */\n\t\t.row-cont {\n\t\t\t\tmargin-top:30px;\n\t\t\t\tdisplay: flex;\n\t\t\t\tflex-direction: column;\n\t\t\t\twidth:100%;\n\t\t}\n\n\t\t/* Create two equal columns that sits next to each other */\n\t\t.column {\n\t\t\t\tdisplay: flex;\n\t\t\t\tflex-direction: column;\n\t\t\t\talign-items: center;\n\t\t}\n\t\t.flowchart{\n\t\t\tpadding-top:10px;\n\t\t\twidth:70vw;\n\t\t\tmargin-left:3vw;\n\n\t\t}\n\t\t@media screen and (min-width:651px) {\n\t\t\t\t.hidden_desktop {\n\t\t\t\t\t\tdisplay:none;\n\t\t\t\t}\n\t\t}\n\t\t@media screen and (max-width:650px) {\n\t\t\t\t.hidden_mobile {\n\t\t\t\t\t\tdisplay:none;\n\t\t\t\t}\n\t\t\t\t.flowchart{\n\t\t\t\t\t\twidth:50vw;\n\t\t\t\t\t\tmargin:10px;\n\t\t\t\t}\n\t\t}\n\t\tli{\n\t\t\t\tmargin: 10px 0;\n\t\t}\n\t\t .anychart-credits{\n\t\tdisplay: none;\n\t\t}\n\n\t\t.button {\n\t\t\tfont-size: 1em;\n\t\t\tpadding: 10px;\n\t\t\tcolor: #ffffff;\n\t\t\tborder: 2px solid #049cfc;\n\t\t\tanimation: mymove 5s ease infinite alternate;\n\t\t\t/*border-radius: 20px/50px;*/\n\t\t\tborder-radius: 5px;\n\t\t\ttext-decoration: none;\n\t\t\tcursor: pointer;\n\t\t\ttransition: all 0.3s ease-out;\n\t\t}\n\t\t@keyframes mymove {\n\t\t\tfrom {background-color: #c0d6fa;\n\t\t\t\t\t\tborder: 5px solid #c0d6fa;\n\t\t\t}\n\t\t\tto {background-color: #049cfc;\n\t\t\t\t\tborder: 5px solid #049cfc;;\n\t\t\t}\n\t\t}\n\n\t\t.button:hover {\n\t\t\t/*background: #ffffff;*/\n\t\t\tcolor: yellow;\n\t\t}\n\n\t\t.overlay {\n\t\t\tposition: fixed;\n\t\t\ttop: 0;\n\t\t\tbottom: 0;\n\t\t\tleft: 0;\n\t\t\tright: 0;\n\t\t\tbackground: rgba(0, 0, 0, 0.7);\n\t\t\ttransition: opacity 500ms;\n\t\t\tvisibility: hidden;\n\t\t\topacity: 0;\n\t\t}\n\t\t.overlay:target {\n\t\t\tvisibility: visible;\n\t\t\topacity: 1;\n\t\t}\n\t\t.popup {\n\t\t\tmargin: 45px auto;\n\t\t\tpadding: 20px;\n\t\t\tbackground: #fff;\n\t\t\tborder-radius: 5px;\n\t\t\twidth: 70%;\n\t\t\theight: 85%;\n\t\t\tposition: relative;\n\t\t\ttransition: all 5s ease-in-out;\n\t\t}\n\t\t.popup h2 {\n\t\t\tmargin-top: 0;\n\t\t\tcolor: #333;\n\t\t\tfont-family: Tahoma, Arial, sans-serif;\n\t\t}\n\t\t.popup .close {\n\t\t\tposition: absolute;\n\t\t\ttop: 20px;\n\t\t\tright: 30px;\n\t\t\ttransition: all 200ms;\n\t\t\tfont-size: 30px;\n\t\t\tfont-weight: bold;\n\t\t\ttext-decoration: none;\n\t\t\tcolor: #333;\n\t\t}\n\t\t.popup .close:hover {\n\t\t\tcolor: #06D85F;\n\t\t}\n\t\t.popup .content {\n\t\t\tmax-height: 90%;\n\t\t\toverflow: auto;\n\t\t}\n\t\t@media screen and (max-width: 700px){\n\t\t\t.box{\n\t\t\t\twidth: 70%;\n\t\t\t}\n\t\t\t.popup{\n\t\t\t\twidth: 70%;\n\t\t\t}\n\t\t}\n\n\t\t@import url(\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css\");\n\n\t\t*{\n\t\t\t\tbox-sizing: border-box;\n\t\t}\n\n\t\t.search-box{\n\t\t\twidth: fit-content;\n\t\t\theight: fit-content;\n\t\t\tposition: relative;\n\t\t}\n\t\t.input-search{\n\t\t\theight: 50px;\n\t\t\twidth: 50px;\n\t\t\tborder-style: none;\n\t\t\tpadding: 10px;\n\t\t\tfont-size: 18px;\n\t\t\tletter-spacing: 2px;\n\t\t\toutline: none;\n\t\t\tborder-radius: 25px;\n\t\t\ttransition: all .5s ease-in-out;\n\t\t\tbackground-color: #22a6b3;\n\t\t\tpadding-right: 40px;\n\t\t\tcolor:#fff;\n\t\t}\n\t\t.input-search::placeholder{\n\t\t\tcolor:rgba(255,255,255,.5);\n\t\t\tfont-size: 18px;\n\t\t\tletter-spacing: 2px;\n\t\t\tfont-weight: 100;\n\t\t}\n\t\t.btn-search{\n\t\t\twidth: 50px;\n\t\t\theight: 50px;\n\t\t\tborder-style: none;\n\t\t\tfont-size: 20px;\n\t\t\tfont-weight: bold;\n\t\t\toutline: none;\n\t\t\tcursor: pointer;\n\t\t\tborder-radius: 50%;\n\t\t\tposition: absolute;\n\t\t\tright: 0px;\n\t\t\tcolor:#ffffff ;\n\t\t\tbackground-color:transparent;\n\t\t\tpointer-events: painted;\n\t\t}\n\t\t.btn-search:focus ~ .input-search{\n\t\t\twidth: 300px;\n\t\t\tborder-radius: 0px;\n\t\t\tbackground-color: transparent;\n\t\t\tborder-bottom:1px solid rgba(255,255,255,.5);\n\t\t\ttransition: all 500ms cubic-bezier(0, 0.110, 0.35, 2);\n\t\t}\n\t\t.input-search:focus{\n\t\t\twidth: 300px;\n\t\t\tborder-radius: 0px;\n\t\t\tbackground-color: transparent;\n\t\t\tborder-bottom:1px solid rgba(255,255,255,.5);\n\t\t\ttransition: all 500ms cubic-bezier(0, 0.110, 0.35, 2);\n\t\t}\n\n\t\t.slider {\n\t\t\t\tposition: absolute;\n\t\t\t\tdisplay: flex;\n\t\t\t\tjustify-content: center;\n\t\t\t\talign-items: center;\n\t\t\t\tcursor: pointer;\n\t\t\t\ttop: 0;\n\t\t\t\tleft: 0;\n\t\t\t\tright: 0;\n\t\t\t\tbottom: 0;\n\t\t\t\tbackground-color: #049cfc;\n\t\t\t\tborder-radius: 5px;\n\t\t}\n\n\t\tinput:checked + .slider {\n\t\t\t\tbackground-color: #cc2316;\n\t\t}\n\n\t\t.choice-container{\n\t\t\t\tdisplay: flex;\n\t\t\t\tjustify-content: center;\n\t\t\t\talign-items: center;\n\t\t\t\twidth:100vw;\n\t\t\t\tmargin-bottom: 1vh;\n\n\n\t\t}\n\t\t.choice-container .choices{\n\t\t\t\tposition: relative;\n\t\t\t\tdisplay: inline-block;\n\t\t\t\twidth: 80px;\n\t\t\t\theight: 40px;\n\t\t\t\tbackground-color: #36B5EB;\n\t\t\t\tcolor: white;\n\t\t\t\tdisplay: block;\n\t\t\t\tborder-color: none;\n\t\t\t\tborder-radius: 5px;\n\t\t\t\tpadding: 0.5rem;\n\n\t\t\t\tmargin-left:1rem ;\n\t\t\t\tfont-size: 18px;\n\t\t\t\ttext-align: center;\n\t\t\t\tcursor: pointer;\n\t\t}\n\t\t@media screen and (max-width: 1000px){\n\t\t\t\t.choice-container .choices{\n\n\t\t\t\t\t\twidth: 50px;\n\t\t\t\t\t\theight: 25px;\n\n\t\t\t\t\t\tfont-size: 11px;\n\n\t\t\t\t}\n\t\t}\n\n\t</style>\n</head>\n\n<body>\n\n<!--style=\"vertical-align:middle; text-align:center\"-->\n\n<div id=\"guide\" class=\"overlay\" style=\"position:absolute;z-index:10;\">\n\t<div class=\"popup\">\n\t\t<h2><b>Guide</b></h2>\n\t\t<a class=\"close\" href=\"#\">&times;</a>\n\t\t<div class=\"content\">\n\t\t\t\t<h4><b>Usage</b></h4>\n\t\t\t\t<p>This tool provides a visualisation of sentiment according to tweets across the country. The data used for visualisation can be specified via a search term or defaulted via preset terms. </p>\n\t\t\t\t<h6><b>Interactivity</b></h6>\n\t\t\t<p>Hovering over a bubble on the map or individual words on the word clouds will display a popup with key information. You can click on a bubble to view it's corresponding word cloud. Double click anywhere else on the map to display the default word clouds. You can zoom in and out of the map by using the controls to the left side of the map. Scroll down under the word clouds to view a line graph displaying sentiment over an adjustable time period.</p>\n\t\t\t\t<h6><b>Provided Data Analysis</b></h6>\n\t\t\t\t<p>Upon loading the page this tool is populated with data collected using preset terms.</p>\n\t\t\t\t<h6><b>Custom Data Analysis</b></h6>\n\t\t\t\t<p>The search bar can be used to populate the tool with a user specified input. Searches support hashtags, username handles, and tweet contents.</p>\n\t\t\t\t<h4><b>Display Information</b></h4>\n\t\t\t\t<p>Each point of interest is displayed using 2 overlapping bubbles - 1 of which represents tweets and the other of which represents retweets; the sizes of which are explained below. The colour represents the general sentiment of the tweets/retweets in that location; the relevant key can be found below.</p>\n\t\t\t<h6><b>Bubble Size</b></h6>\n\t\t\t<p>The radius of each bubble is calculated based on the proportion of tweets/retweets in that location when compared with all other points of interest on the map.</p>\n\t\t\t<h6><b>Bubble Colours</b></h6>\n\t\t\t<p>The colour of each bubble indicates the sentiment in that location and is generated from the numerical score assigned from our data analysis.</p>\n\n\t\t\t\t\t\t<p><b>Key:</b></p>\n\n\t\t\t<div style=\"width:30px;height:30px;background:#cc2316;display:inline-block;border-radius:10px;vertical-align:middle;\"></div>\n\t\t\t<p style=\"display:inline-block;text-indent: 5px;\">Very Unhappy &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><tab></tab>\n\t\t\t\t\t\t<div style=\"width:30px;height:30px;background:#fc7600;display:inline-block;border-radius:10px;vertical-align:middle;\"></div>\n\t\t\t<p style=\"display:inline-block;text-indent: 5px;\">Unhappy &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><tab></tab>\n\t\t\t\t\t\t<div style=\"width:30px;height:30px;background:#fbff00;display:inline-block;border-radius:10px;vertical-align:middle;\"></div>\n\t\t\t<p style=\"display:inline-block;text-indent: 5px;\">Neutral &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><tab></tab>\n\t\t\t\t\t\t<div style=\"width:30px;height:30px;background:#00ff11;display:inline-block;border-radius:10px;vertical-align:middle;\"></div>\n\t\t\t<p style=\"display:inline-block;text-indent: 5px;\">Happy &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><tab></tab>\n\t\t\t\t\t\t<div style=\"width:30px;height:30px;background:#049cfc;display:inline-block;border-radius:10px;vertical-align:middle;\"></div>\n\t\t\t<p style=\"display:inline-block;text-indent: 5px;\">Very Happy &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><tab></tab>\n\t\t</div>\n\t</div>\n</div>\n\n<div id=\"Container_Logo\" style=\"width: 100%; height: 100%; scroll-snap-align: start; overflow: hidden; position: relative;\">\n\n\t\t\t<div class='ripple-background'>\n\t\t\t<div class='circle xxlarge shade1'></div>\n\t\t\t<div class='circle xlarge shade2'></div>\n\t\t\t<div class='circle large shade3'></div>\n\t\t\t<div class='circle medium shade4'></div>\n\t\t\t<div class='circle small shade5'></div>\n\t\t\t<div class='circle xxlarge1 shade1'></div>\n\t\t\t<div class='circle xlarge1 shade2'></div>\n\t\t\t<div class='circle large1 shade3'></div>\n\t\t\t<div class='circle medium1 shade4'></div>\n\t\t\t<div class='circle small1 shade5'></div>\n\t\t</div>\n\t\t<div id=\"Logo\" style=\"width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center;\">\n\t\t\t<img src=\"https://raw.githubusercontent.com/NasimMM/MoodoftheNation/f3b8e17bc2dfd18cdd96734711a2559c325a6823/LOGOSVG.svg\" class=\"rounded mx-auto d-block img-fluid logo\"/>\n\t\t\t<h1 style=\"color: white; font-size: 2.9vw; font-weight: 700;\">Mood of the Nation</h1>\n\t\t\t<p style=\"font-size: 1.2em; color: white;font-weight: 500;\"><span id=\"rotate\">this</span></p>\n\t\t\t\t\t\t<script type=\"text/javascript\" src=\"//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js\"></script>\n\t\t\t\t\t\t<script>\n\t\t\t\t\t\t\tvar terms = [\"A new era of data analysis\", \"Developed by students at Imperial College London\", \"In conjunction with IBM\"];\n\t\t\t\t\t\t\tfunction rotateTerm() {\n\t\t\t\t\t\t\t\tvar ct = $(\"#rotate\").data(\"term\") || 0;\n\t\t\t\t\t\t\t\t$(\"#rotate\").data(\"term\", ct == terms.length -1 ? 0 : ct + 1).text(terms[ct]).fadeIn().delay(4500).fadeOut(500, rotateTerm);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\trotateTerm();\n\t\t\t\t\t\t</script>\n\t\t\t\t\t\t<br>\n\t\t\t\t\t\t<div class=\"box\" style=\"display:flex; justify-items:center\">\n\t\t\t\t\t\t\t<a class=\"button\" href=\"#guide\"><b>Guide</b></a>\n\t\t\t\t\t\t</div>\n\n\t\t\t</div>\n\n\t</div>\n\n<div style=\"width: 100%; height: 100%; align-content: center; align-items: center; scroll-snap-align: start;\">\n\n\t\t<div id=\"SnapParent\">\n\t\t\t\t<div style=\"width: 100%; height: 5%; display: flex; justify-content: center; margin-top: 15px; margin-bottom: 15px;\">\n\t\t\t\t\t\t<h1 style=\"font-weight:bold;\">Dashboard</h1>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"choice-container\" style=\"width: auto;\">\n\t\t\t\t\t\t<label class=\"choices\">\n\t\t\t\t\t\t\t\t<input type=\"radio\" name=\"type\" value=\"map\" checked  onclick=\"getQ()\" >\n\t\t\t\t\t\t\t\t<span class=\"slider\"><span class=\"op-text\">Map</span></span>\n\t\t\t\t\t\t</label>\n\t\t\t\t\t\t<label class=\"choices\">\n\t\t\t\t\t\t\t\t<input type=\"radio\" name=\"type\" value=\"search\" onclick=\"getQ()\">\n\t\t\t\t\t\t\t\t<span class=\"slider\"><span class=\"op-text\">Search</span></span>\n\t\t\t\t\t\t</label>\n\t\t\t\t</div>\n\n\t\t\t<div id=\"main_cont\" style=\"width: 100%; height: 80%; scroll-snap-align: start; display: flex; flex-direction: column;\">\n\n\t\t\t\t\t\t<div id=\"Main_Container\" style=\"display: flex !important; flex-direction: row; align-items: center; width: 100%; height: 95%;\">\n\n\t\t\t\t\t\t\t\t<div id=\"LeftContainer\" style=\"display: flex !important; flex-direction: column;  align-items: center; width: 50%; height: 100%;\">\n\t\t\t\t\t\t\t\t\t<div id= \"Uni_Mood\" style=\"display: flex; flex-direction: column; width:100%;\">\n\t\t\t\t\t\t\t\t\t\t<h4 id= \"Uni\" style=\"margin-left: 15px;\"> Select a University</h4>\n\t\t\t\t\t\t\t\t\t\t<h4 id= \"Mood\" style=\"margin-left: 15px;\"> Mood </h4>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div id=\"Map_Container\"></div>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<div id=\"RightContainer\" style=\"overflow: hidden; display:flex; flex-direction:column ; align-items: center;width: 50%; height: 100%; \">\n\n\t\t\t\t\t\t\t\t\t<div class=\"choice-container\">\n\t\t\t\t\t\t\t\t\t\t\t<label class=\"choices\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"radio\" name=\"choice\" value=\"words\" checked onclick=\"getQ()\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"slider\"><span class=\"op-text\">Words</span></span>\n\t\t\t\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t\t\t\t<label class=\"choices\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"radio\" name=\"choice\" value=\"location\" onclick=\"getQ()\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"slider\"><span class=\"op-text\">Location</span></span>\n\t\t\t\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t\t\t\t<label class=\"choices\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"radio\" name=\"choice\" value=\"trend\" onclick=\"getQ()\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"slider\"><span class=\"op-text\">Trend</span></span>\n\t\t\t\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<div id=\"CloudA_ContainerContainer\" style=\"width: 100%; height: 90%; scroll-snap-align: start;\">\n\t\t\t\t\t\t\t\t\t\t\t\t<div id=\"CloudA_Container\" style=\"width: 100%; height: 100%;\"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div id=\"CloudB_ContainerContainer\" style=\"width: 100%; height: 90%;\">\n\t\t\t\t\t\t\t\t\t<div id=\"CloudB_Container\" style=\"width: 100%; height: 100%;\"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div id=\"CloudC_ContainerContainer\" style=\"width: 100%; height: 90%; scroll-snap-align: start;\">\n\t\t\t\t\t\t\t\t\t<div id=\"CloudC_Container\" style=\"width: 100%; height: 100%;\"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t<div id=\"SearchPageDiv\" style=\"width: 100%; height: 80%; scroll-snap-align:start;\">\n\t\t\t\t<div id=\"search_header\" style=\"width: 100%; height: 15%; background-color: transparent; \">\n\n\t\t\t\t\t<form id=\"id_form\">\n\t\t\t\t\t\t<div style=\"padding: 1%;\">\n\t\t\t\t\t\t\t<span style=\"display: flex; justify-content: center;\">\n\t\t\t\t\t\t\t\t<div style=\"margin-right:10px\">\n\t\t\t\t\t\t\t\t\t\t<label>Search:</label>\n\t\t\t\t\t\t\t\t\t\t<input type=\"text\" name=\"name\" placeholder=\"#hashtag / @user / other\" size=\"24\" id=\"id_text\" required/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div style=\"margin-right: 10px\">\n\t\t\t\t\t\t\t\t\t\t<label>Time Scale:</label>\n\t\t\t\t\t\t\t\t\t\t<input type=\"number\" name=\"number\" placeholder=\"# Minutes\" size=\"3\" id=\"id_number\" style=\"width: 35%\" required/>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<input type=\"submit\" value=\"Search\" id=\"id_enter\" style=\"background: #049cfc; color: white; border-radius: 5px; font-weight: bold; border-color: #049cfc; height:32px\" onclick=\"timer_search()\"/>\n\t\t\t\t\t\t\t\t<h2 id=\"timedisplayer\" style=\"margin-left: 10px; margin-bottom: 10px;\"> </h2>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</form>\n\n\t\t\t\t</div>\n\n\t\t\t\t<div style=\"width: 100%; height: 80%; display: flex; flex-direction: row;\">\n\t\t\t\t\t<div id=\"SearchCloudA\" style=\"width: 50%; height: 100%;\"></div>\n\t\t\t\t\t<div id=\"SearchCloudB\" style=\"width: 50%; height: 100%;\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div style = \"display: flex; justify-content: center; align-items: center\">\n\t\t\t\t<h2 id= \"SearchMood\">  </h2>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t</div>\n</div>\n\n<div class=\"row-cont\" >\n\t\t<div id=\"SnapParent2\">\n\t\t\t\t<div class=\"column\">\n\t\t\t\t\t\t<h1 style=\"text-align: center; padding: 2%; font-weight:bold;\">What we do?</h1>\n\t\t\t\t\t\t<ol class=\"list_info\" style=\"list-style: none; padding-right:10%\">\n\t\t\t\t\t\t\t\t<li >We have created a web accessible experience for companies to monitor their\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\timpact on university students across the country</li>\n\t\t\t\t\t\t\t\t<li >We utilise the Twitter API and IBMs Natural Language Understanding API to analyse the happiness of  tweets related to the company and university. Understanding the sentiment of university tweets about a company can act as an\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tindicator of the quality of company recruitment programs in universities.</li>\n\t\t\t\t\t\t\t\t<li >The main features of the webpage include:\n\t\t\t\t\t\t\t\t\t\t<ul>\n\t\t\t\t\t\t\t\t\t\t\t\t<li>An interactive map of the UK displaying information such as the ‘Happiness’ of a university.\n\t\t\t\t\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t\t\t\t\t<li>The 20 most common words from tweets</li>\n\t\t\t\t\t\t\t\t\t\t\t\t<li>The most common locations mentioned in tweets</li>\n\t\t\t\t\t\t\t\t\t\t\t\t<li>The happiness trend of a university as a line graph</li>\n\t\t\t\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t</ol>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"column\" >\n\t\t\t\t\t\t<h1 style=\"text-align: center; padding: 0%; font-weight:bold;\">How we do it?</h1>\n\t\t\t\t\t\t<img class=\" hidden_desktop flowchart img-responsive\" src=\"https://github.com/moinbukhari/hello-world/blob/master/flowchart.png?raw=true\">\n\t\t\t\t\t\t<img class=\" hidden_mobile flowchart img-responsive\" src=\"https://github.com/moinbukhari/hello-world/blob/master/flowchart2.png?raw=true\">\n\t\t\t\t</div>\n\t\t</div>\n</div>\n\n<div style=\"width: 100%; height: 100%;\"></div>\n\n<div class=\"footer-dark\">\n\t\t<footer>\n\t\t\t\t<div class=\"container\">\n\t\t\t\t\t\t<div class=\"row\">\n\t\t\t\t\t\t\t\t<div class=\"col-sm-6 col-md-3 item\">\n\t\t\t\t\t\t\t\t\t\t<h3>Brought to you by</h3>\n\t\t\t\t\t\t\t\t\t\t<ul>\n\t\t\t\t\t\t\t\t\t\t\t\t<li><a href=\"#\">Arjun Ananth</a></li>\n\t\t\t\t\t\t\t\t\t\t\t\t<li><a href=\"#\">Moin Bukhari</a></li>\n\t\t\t\t\t\t\t\t\t\t\t\t<li><a href=\"#\">Nayan Kad</a></li>\n\t\t\t\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"col-sm-6 col-md-3 item second\">\n\t\t\t\t\t\t\t\t\t\t<ul>\n\t\t\t\t\t\t\t\t\t\t\t\t<li><a href=\"#\">Jun Kim</a></li>\n\t\t\t\t\t\t\t\t\t\t\t\t<li><a href=\"#\">Nasim Mohammed</a></li>\n\t\t\t\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"col-sm-6 col-md-3 item\">\n\t\t\t\t\t\t\t\t\t\t<h3>In Collaboration with</h3>\n\t\t\t\t\t\t\t\t\t\t<ul>\n\t\t\t\t\t\t\t\t\t\t\t\t<li><a href=\"#\">IBM</a></li>\n\t\t\t\t\t\t\t\t\t\t\t\t<li><a href=\"#\">Imperial College London</a></li>\n\t\t\t\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<p class=\"copyright\">Company Name © 2021</p>\n\t\t\t\t</div>\n\t\t</footer>\n</div>\n\n\n\n<!--SCRIPTS-->\n\n\n<!--Ajax Search Bar stuff-->\n<script src=\"https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js\"></script>\n<script type=\"text/javascript\">\n\t\t$(document).ready(function(){\n\t\t\t\tsetupPage();\n\t\t});\n\t\tfunction setupPage(){\n\t\t\t\t//$('#id_hello').hide();\n\t\t\t\t$('#id_form').submit(onSubmitClicked);\n\t\t\t\tenterbutton();\n\t\t}\n\t\tfunction processOK(response) {\n\t\t\tconsole.log('AJAX Response:');\n\t\t\t\tconsole.log(response);\n\t\t\t\tif (response.identifyresponse){\n\t\t\t\t\t\t//$('#id_textlang').text(langLookup(response.identifyresponse));\n\t\t\t\t} else {\n\t\t\t\t\t\t//$('#id_textlang').text('No response received from service');\n\t\t\t\t}\n\t\t}\n\t\tfunction processNotOK() {\n\t\t\t\tconsole.log('Error Processing');\n\t\t\t\t//$('#id_textlang').text('Oops something went wrong');\n\t\t}\n\n\t\t// function refreshPage(time){\n\t\t//   setTimeout(function () {\n\t\t//       location.reload();\n\t\t//     }, (time * 1000)+(10*1000));\n\t\t// });\n\n\t\tfunction invokeAjax(message) {\n\t\t\t\tconsole.log('AJAX about to be invoked.');\n\t\t\t\tconsole.log(message);\n\t\t\t\tvar ajaxData = {};\n\t\t\t\tajaxData.msgdata = message;\n\t\t\t\t$.ajax({\n\t\t\t\t\t\ttype: 'POST',\n\t\t\t\t\t\turl: 'search',\n\t\t\t\t\t\tdata: ajaxData,\n\t\t\t\t\t\tsuccess: processOK,\n\t\t\t\t\t\terror: processNotOK\n\t\t\t\t});\n\t\t}\n\t\tfunction onSubmitClicked(event){\n\t\t\t\t// $('#id_hello').show();\n\t\t\t\tevent.preventDefault();\n\t\t\t\tvar txt = $('#id_text').val();\n\t\t\t\tvar time = $('#id_number').val();\n\t\t\t\tinvokeAjax({search: txt, time: time});\n\t\t\t\t//refreshpage(time);\n\t\t}\n\t\tfunction enterbutton(){\n\t\t\t\t$(function() {\n\t\t\t\t\t\t$(\"form input\").keypress(function (e) {\n\t\t\t\t\t\tif ((e.which && e.which == 13) || (e.keyCode && e.keyCode == 13)) {\n\t\t\t\t\t\t\t\t$('#id_enter').click();\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t});\n\t\t});\n\t}\n</script>\n\n<!--UKMAP-->\n<div id=\"ac_style_countries-united-kingdom\" style=\"display:none;\">\n\t\t#Map_Container {\n\t\t\twidth: 100%;\n\t\t\theight: 100%;\n\t\t\tmargin: 0;\n\t\t\tpadding: 0;\n\t\t}\n</div>\n<!--UKMAP Scripts-->\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.3.15/proj4.js\"></script>\n<script src=\"https://cdn.anychart.com/releases/v8/js/anychart-base.min.js\"></script>\n<script src=\"https://cdn.anychart.com/releases/v8/js/anychart-map.min.js\"></script>\n<script src=\"https://cdn.anychart.com/releases/v8/js/anychart-exports.min.js\"></script>\n<script src=\"https://cdn.anychart.com/releases/v8/js/anychart-ui.min.js\"></script>\n<script src=\"https://cdn.anychart.com/geodata/2.1.1/countries/united_kingdom/united_kingdom.js\"></script>\n<script>\n\t\t(function(){\n\t\t\t\tfunction ac_add_to_head(el){\n\t\t\t\t\tvar head = document.getElementsByTagName('head')[0];\n\t\t\t\t\thead.insertBefore(el,head.firstChild);\n\t\t\t\t}\n\t\t\t\tfunction ac_add_link(url){\n\t\t\t\t\tvar el = document.createElement('link');\n\t\t\t\t\tel.rel='stylesheet';el.type='text/css';el.media='all';el.href=url;\n\t\t\t\t\tac_add_to_head(el);\n\t\t\t\t}\n\t\t\t\tfunction ac_add_style(css){\n\t\t\t\t\tvar ac_style = document.createElement('style');\n\t\t\t\t\tif (ac_style.styleSheet) ac_style.styleSheet.cssText = css;\n\t\t\t\t\telse ac_style.appendChild(document.createTextNode(css));\n\t\t\t\t\tac_add_to_head(ac_style);\n\t\t\t\t}\n\t\t\t\tac_add_link('https://cdn.anychart.com/releases/v8/css/anychart-ui.min.css');\n\t\t\t\tac_add_link('https://cdn.anychart.com/releases/v8/fonts/css/anychart-font.min.css');\n\t\t\t\tac_add_style(document.getElementById(\"ac_style_countries-united-kingdom\").innerHTML);\n\t\t\t\tac_add_style(\".anychart-embed-countries-united-kingdom{width:100%;height:100%;}\");\n\t\t})();\n</script>\n<!--WordCloud Scripts-->\n<script src=\"https://cdn.anychart.com/releases/v8/js/anychart-base.min.js\"></script>\n<script src=\"https://cdn.anychart.com/releases/v8/js/anychart-tag-cloud.min.js\"></script>\n\n<!--LineGraph-->\n<div id=\"ac_style_samples-stock-range-selection-05\" style=\"display:none;\">\n\t#CloudC_Container {\n\t\twidth: 100%;\n\t\theight: 100%;\n\t\tmargin: 0;\n\t\tpadding: 0;\n\t}\n</div>\n<!--LineGraph Scripts-->\n<div id=\"anychart-embed-samples-stock-range-selection-05\" class=\"anychart-embed anychart-embed-samples-stock-range-selection-05\" style=\"display: none;\">\n<script src=\"https://cdn.anychart.com/releases/8.10.0/js/anychart-core.min.js?hcode=a0c21fc77e1449cc86299c5faa067dc4\"></script>\n<script src=\"https://cdn.anychart.com/releases/8.10.0/js/anychart-stock.min.js?hcode=a0c21fc77e1449cc86299c5faa067dc4\"></script>\n<script src=\"https://cdn.anychart.com/releases/8.10.0/js/anychart-ui.min.js?hcode=a0c21fc77e1449cc86299c5faa067dc4\"></script>\n<script src=\"https://cdn.anychart.com/releases/8.10.0/js/anychart-exports.min.js?hcode=a0c21fc77e1449cc86299c5faa067dc4\"></script>\n<script src=\"https://cdn.anychart.com/csv-data/dji-daily-short.js\"></script>\n\n<script>(function(){\n\tfunction ac_add_to_head(el){\n\t\tvar head = document.getElementsByTagName('head')[0];\n\t\thead.insertBefore(el,head.firstChild);\n\t}\n\tfunction ac_add_link(url){\n\t\tvar el = document.createElement('link');\n\t\tel.rel='stylesheet';el.type='text/css';el.media='all';el.href=url;\n\t\tac_add_to_head(el);\n\t}\n\tfunction ac_add_style(css){\n\t\tvar ac_style = document.createElement('style');\n\t\tif (ac_style.styleSheet) ac_style.styleSheet.cssText = css;\n\t\telse ac_style.appendChild(document.createTextNode(css));\n\t\tac_add_to_head(ac_style);\n\t}\n\tac_add_link('https://cdn.anychart.com/releases/8.10.0/css/anychart-ui.min.css?hcode=a0c21fc77e1449cc86299c5faa067dc4');\n\tac_add_style(document.getElementById(\"ac_style_samples-stock-range-selection-05\").innerHTML);\n\tac_add_style(\".anychart-embed-samples-stock-range-selection-05{width:600px;height:450px;}\");\n\t})();\n</script>\n\n<!--FireBase Scripts-->\n<script src=\"https://www.gstatic.com/firebasejs/8.6.2/firebase-app.js\"></script>\n<script src=\"https://www.gstatic.com/firebasejs/8.6.2/firebase-analytics.js\"></script>\n<script src=\"https://www.gstatic.com/firebasejs/8.6.2/firebase-firestore.js\"></script>\n\n\n<!--Main Code-->\n<script>\n\n//*********************************************************************************************************************************INITILISE VARIABLES****************************************************************************************************\n\n\nlet words = 1;\nconst rbs = document.querySelectorAll('input[name=\"choice\"]');\nconst rbs1 = document.querySelectorAll('input[name=\"type\"]');\n// displayNames('default');\n\n// Your web app's Firebase configuration\nvar firebaseConfig = {\n\tapiKey: \"AIzaSyDzlIhPxuvnnFaRD0YEZ8oqIleZluib5GA\",\n\tauthDomain: \"moodofthenation-e1c5d.firebaseapp.com\",\n\tprojectId: \"moodofthenation-e1c5d\",\n\tstorageBucket: \"moodofthenation-e1c5d.appspot.com\",\n\tmessagingSenderId: \"1022128732979\",\n\tappId: \"1:1022128732979:web:13fb6d9e13ac703e535c46\",\n\tmeasurementId: \"G-3MR6VGXKNM\"\n};\n\n\n// Initialize Firebase\nfirebase.initializeApp(firebaseConfig);\nconst db = firebase.firestore();\n\nlet ds = []\n\nlet ibm = [];\nlet ibm2 = [];\nlet ibm20 = [];\nlet ibm_loc = [];\nlet ibm_joy = [];\n\nlet icl = [];\nlet icl2 = [];\nlet icl20 = [];\nlet icl_joy = [];\nlet icl_loc = [];\nlet ox = [];\nlet ox2 = [];\nlet ox20 = [];\nlet ox_loc = [];\nlet ox_joy = [];\nlet bham = [];\nlet bham2 = [];\nlet bham20 = [];\nlet bham_loc = [];\nlet bham_joy = [];\nlet bristol = [];\nlet bristol2 = [];\nlet bristol20 = [];\nlet bristol_loc = [];\nlet bristol_joy = [];\nlet cardiff = [];\nlet cardiff2 = [];\nlet cardiff20 = [];\nlet cardiff_loc = [];\nlet cardiff_joy = [];\nlet durham = [];\nlet durham2 = [];\nlet durham20 = [];\nlet durham_loc = [];\nlet durham_joy = [];\nlet edin = [];\nlet edin2 = [];\nlet edin20 = [];\nlet edin_loc = [];\nlet edin_joy = [];\n\nlet ex = [];\nlet ex2 = [];\nlet ex20 = [];\nlet ex_loc = [];\nlet ex_joy = [];\n\nlet glas = [];\nlet glas2 = [];\nlet glas20 = [];\nlet glas_loc = [];\nlet glas_joy = [];\n\nlet kcl = [];\nlet kcl2 = [];\nlet kcl20 = [];\nlet kcl_loc = [];\nlet kcl_joy = [];\n\nlet ucl = [];\nlet ucl2 = [];\nlet ucl20 = [];\nlet ucl_loc = [];\nlet ucl_joy = [];\n\nlet leeds = [];\nlet leeds2 = [];\nlet leeds20 = [];\nlet leeds_loc = [];\nlet leeds_joy = [];\n\nlet liv = [];\nlet liv2 = [];\nlet liv20 = [];\nlet liv_loc = [];\nlet liv_joy = [];\n\nlet lse = [];\nlet lse2 = [];\nlet lse20 = [];\nlet lse_loc = [];\nlet lse_joy = [];\n\n\nlet man = [];\nlet man2 = [];\nlet man20 = [];\nlet man_loc = [];\nlet man_joy = [];\n\nlet shef = [];\nlet shef2 = [];\nlet shef20 = [];\nlet shef_loc = [];\nlet shef_joy = [];\n\nlet camb = [];\nlet camb2 = [];\nlet camb20 = [];\nlet camb_loc = [];\nlet camb_joy = [];\n\n\nlet search = [];\nlet search2 = [];\nlet search20 = [];\nlet search_loc = [];\nlet search_sent = [];\nlet search_tweets = [];\nlet search_retweets = [];\n\nvar chart3;\nvar chart4;\n\n\n\n\n//GetQ gets the radio button queries and displays relevant map or search outputs\nfunction getQ() {\n  \tfor(const rb1 of rbs1){\n\t\tif(rb1.checked){\n\t\t\tif(rb1.value == \"map\"){\n\t\t\t\tdocument.getElementById(\"main_cont\").style.display=\"flex\";\n\t\t\t\tdocument.getElementById(\"SearchPageDiv\").style.display=\"none\";\n\t\t\t\tfor (const rb of rbs) {\n\t\t\t\t\tif (rb.checked) {\n\t\t\t\t\t\tif (rb.value== \"words\"){\n\t\t\t\t\t\t\twords=1;\n\t\t\t\t\t\t\t// displayNames('Select a University', -1, 0, 0);\n\t\t\t\t\t\t\tdocument.getElementById(\"CloudA_ContainerContainer\").style.display=\"flex\";\n\t\t\t\t\t\t\tdocument.getElementById(\"CloudB_ContainerContainer\").style.display=\"none\";\n\t\t\t\t\t\t\tdocument.getElementById(\"CloudC_ContainerContainer\").style.display=\"none\";\n\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (rb.value== \"location\"){\n\t\t\t\t\t\t\twords=2;\n\t\t\t\t\t\t\t// displayNames('Select a University', -1, 0, 0);\n\t\t\t\t\t\t\tdocument.getElementById(\"CloudB_ContainerContainer\").style.display=\"flex\";\n\t\t\t\t\t\t\tdocument.getElementById(\"CloudA_ContainerContainer\").style.display=\"none\";\n\t\t\t\t\t\t\tdocument.getElementById(\"CloudC_ContainerContainer\").style.display=\"none\";\n\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (rb.value== \"trend\"){\n\t\t\t\t\t\t\twords=3;\n\t\t\t\t\t\t\t// displayNames('Select a University', -1, 0, 0);\n\t\t\t\t\t\t\tdocument.getElementById(\"CloudC_ContainerContainer\").style.display=\"flex\";\n\t\t\t\t\t\t\tdocument.getElementById(\"CloudB_ContainerContainer\").style.display=\"none\";\n\t\t\t\t\t\t\tdocument.getElementById(\"CloudA_ContainerContainer\").style.display=\"none\";\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if(rb1.value==\"search\"){\n\t\t\t\tdocument.getElementById(\"main_cont\").style.display=\"none\";\n\t\t\t\tdocument.getElementById(\"SearchPageDiv\").style.display=\"block\";\n\t\t\t}\n\t\t}\n\t}\n}\n\n//Gets the uni clicked on and displays their mood\nfunction displayNames(name, mood, tweets, retweets){\n\tdocument.getElementById(\"Uni\").innerHTML = name;\n\n\tvar sentiment;\n\n\n\tif(mood >= 0 && mood < 0.2 && tweets >0 && retweets > 0){\n\t\tsentiment = \"Very Unhappy\";\n\t\t// if(tweets == 0 && retweets == 0){\n\t\t//   sentiment = \"No tweets\";\n\t\t// }\n\t}\n\telse if(mood >= 0.2 && mood < 0.4){\n\t\tsentiment = \"Unhappy\";\n\t}\n\telse if(mood >= 0.4 && mood < 0.6){\n\t\tsentiment = \"Neutral\";\n\t}\n\telse if(mood >= 0.6 && mood < 0.8){\n\t\tsentiment = \"Happy\";\n\t}\n\telse if(mood >= 0.8 && mood <= 1){\n\t\tsentiment = \"Very Happy\";\n\t}\n\telse if(mood == \"Retrieving Sentiment Information\"){\n\t\tsentiment = mood;\n\t}\n\telse{\n\t\tsentiment = \"No Sentiment Information to Display\";\n\t}\n\tdocument.getElementById(\"Mood\").innerHTML = sentiment;\n\treturn;\n}\n\n//displays the sentiment of the search term\nfunction displayNamesSearch(mood, tweets, retweets){\n\tvar sentiment;\n\tif(tweets == 0 && retweets == 0){\n\t\tsentiment = \"No Sentiment Information to display\"\n\t}\n\tif(mood >= 0 && mood < 0.2){\n\t\tsentiment = \"Very Unhappy\";\n\t}\n\telse if(mood >= 0.2 && mood < 0.4){\n\t\tsentiment = \"Unhappy\";\n\t}\n\telse if(mood >= 0.4 && mood < 0.6){\n\t\tsentiment = \"Neutral\";\n\t}\n\telse if(mood >= 0.6 && mood < 0.8){\n\t\tsentiment = \"Happy\";\n\t}\n\telse if(mood >= 0.8 && mood <= 1){\n\t\tsentiment = \"Very Happy\";\n\t}\n\telse if(mood == \"Retrieving Sentiment Information\"){\n\t\tsentiment = mood;\n\t}\n\n\tdocument.getElementById(\"SearchMood\").innerHTML = sentiment;\n}\n\nfunction PullfromDB(){\n\treturn new Promise( function (resolve, reject) {\n\t\tconsole.log(\"Pull from DB\");\n\n\t\tdb.collection('20 ibm').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tibm.push(doc.data());\n\t\t\t\tresolve(ibm);\n\t\t\t})\n\t\t})\n\t\tconsole.log(ibm);\n\n\t\tdb.collection('location ibm').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tibm2.push(doc.data());\n\t\t\t\tresolve(ibm2);\n\t\t\t})\n\t\t})\n\n\t\tconsole.log(ibm2);\n\n\t\tdb.collection('University').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tds.push(doc.data());\n\t\t\t\tresolve(ds);\n\t\t\t})\n\t\t})\n\t\tconsole.log(ds);\n\n\t\tdb.collection('Line Graphs IBM').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tibm_joy.push(doc.data());\n\t\t\t\tresolve(ibm_joy);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('Line Graphs ICL').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\ticl_joy.push(doc.data());\n\t\t\t\tresolve(icl_joy);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('Line Graphs Ox').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tox_joy.push(doc.data());\n\t\t\t\tresolve(ox_joy);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('Line Graphs Birmingham').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tbham_joy.push(doc.data());\n\t\t\t\tresolve(bham_joy);\n\t\t\t})\n\t\t})\n\n\n\t\tdb.collection('Line Graphs Bristol').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tbristol_joy.push(doc.data());\n\t\t\t\tresolve(bristol_joy);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('Line Graphs Cardiff').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tcardiff_joy.push(doc.data());\n\t\t\t\tresolve(cardiff_joy);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('Line Graphs Durham').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tdurham_joy.push(doc.data());\n\t\t\t\tresolve(durham_joy);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('Line Graphs Edinburgh').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tedin_joy.push(doc.data());\n\t\t\t\tresolve(edin_joy);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('Line Graphs Exeter').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tex_joy.push(doc.data());\n\t\t\t\tresolve(ex_joy);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('Line Graphs Glasgow').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tglas_joy.push(doc.data());\n\t\t\t\tresolve(glas_joy);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('Line Graphs KCL').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tkcl_joy.push(doc.data());\n\t\t\t\tresolve(kcl_joy);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('Line Graphs UCL').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tucl_joy.push(doc.data());\n\t\t\t\tresolve(ucl_joy);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('Line Graphs Leeds').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tleeds_joy.push(doc.data());\n\t\t\t\tresolve(leeds_joy);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('Line Graphs Liverpool').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tliv_joy.push(doc.data());\n\t\t\t\tresolve(liv_joy);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('Line Graphs LSE').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tlse_joy.push(doc.data());\n\t\t\t\tresolve(lse_joy);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('Line Graphs Manchester').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tman_joy.push(doc.data());\n\t\t\t\tresolve(man_joy);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('Line Graphs Sheffield').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tshef_joy.push(doc.data());\n\t\t\t\tresolve(shef_joy);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('20 icl').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\ticl.push(doc.data());\n\t\t\t\tresolve(icl);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('location icl').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\ticl2.push(doc.data());\n\t\t\t\tresolve(icl2);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('20 ox').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tox.push(doc.data());\n\t\t\t\tresolve(ox);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('location ox').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tox2.push(doc.data());\n\t\t\t\tresolve(ox2);\n\t\t\t})\n\t\t})\n\t\tdb.collection('20 bham').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\tbham.push(doc.data());\n\t\t\tresolve(bham);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('location bham').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tbham2.push(doc.data());\n\t\t\t\tresolve(bham2);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('20 bristol').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tbristol.push(doc.data());\n\t\t\t\tresolve(bristol);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('location bristol').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tbristol2.push(doc.data());\n\t\t\t\tresolve(bristol2);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('20 cardiff').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tcardiff.push(doc.data());\n\t\t\t\tresolve(cardiff);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('location cardiff').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tcardiff2.push(doc.data());\n\t\t\t\tresolve(cardiff2);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('20 durham').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tdurham.push(doc.data());\n\t\t\t\tresolve(durham);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('location durham').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tdurham2.push(doc.data());\n\t\t\t\tresolve(durham2);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('20 edin').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tedin.push(doc.data());\n\t\t\t\tresolve(edin);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('location edin').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tedin2.push(doc.data());\n\t\t\t\tresolve(edin2);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('20 ex').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tex.push(doc.data());\n\t\t\t\tresolve(ex);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('location ex').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tex2.push(doc.data());\n\t\t\t\tresolve(ex2);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('20 glasgow').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tglas.push(doc.data());\n\t\t\t\tresolve(glas);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('location glasgow').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tglas2.push(doc.data());\n\t\t\t\tresolve(glas2);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('20 kcl').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tkcl.push(doc.data());\n\t\t\t\tresolve(kcl);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('location kcl').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tkcl2.push(doc.data());\n\t\t\t\tresolve(kcl2);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('20 ucl').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tucl.push(doc.data());\n\t\t\t\tresolve(ucl);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('location ucl').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tucl2.push(doc.data());\n\t\t\t\tresolve(ucl2);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('20 leeds').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tleeds.push(doc.data());\n\t\t\t\tresolve(leeds);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('location leeds').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tleeds2.push(doc.data());\n\t\t\t\tresolve(leeds2);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('20 liverpool').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tliv.push(doc.data());\n\t\t\t\tresolve(liv);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('location liverpool').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tliv2.push(doc.data());\n\t\t\t\tresolve(liv2);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('20 lse').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tlse.push(doc.data());\n\t\t\t\tresolve(lse);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('location lse').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tlse2.push(doc.data());\n\t\t\t\tresolve(lse2);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('20 manchester').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tman.push(doc.data());\n\t\t\t\tresolve(man);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('location manchester').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tman2.push(doc.data());\n\t\t\t\tresolve(man2);\n\t\t\t})\n\t\t})\n\t\tdb.collection('20 sheffield').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tshef.push(doc.data());\n\t\t\t\tresolve(shef);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('location sheffield').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tshef2.push(doc.data());\n\t\t\t\tresolve(shef2);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('20 cam').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tcamb.push(doc.data());\n\t\t\t\tresolve(camb);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('location cam').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tcamb2.push(doc.data());\n\t\t\t\tresolve(camb2);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('20 search').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tsearch.push(doc.data());\n\t\t\t\tresolve(search);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('location search').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tsearch2.push(doc.data());\n\t\t\t\tresolve(search2);\n\t\t\t})\n\t\t})\n\n\t\tdb.collection('Search Sentiment').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tsearch_sent.push(doc.data());\n\t\t\t\tresolve(search_sent);\n\t\t\t\t// console.log(search_sent[0].Mood);\n\t\t\t})\n\t\t})\n\n\n\t\tdb.collection('Search Tweets Number').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tsearch_tweets.push(doc.data());\n\t\t\t\tresolve(search_tweets);\n\t\t\t})\n\t\t})\n\t\tdb.collection('Search Retweets Number').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tsearch_retweets.push(doc.data());\n\t\t\t\tresolve(search_retweets);\n\t\t\t})\n\t\t})\n\n\t});\n}\n\nfunction PullSearchDB(){\n\treturn new Promise(function(resolve, reject){\n\t\tconsole.log(\"Pull for Search\");\n\t\tsearch=[];\n\t\tdb.collection('20 search').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tsearch.push(doc.data());\n\t\t\t\tresolve(search);\n\t\t\t})\n\t\t})\n\t\tconsole.log(search[0]);\n\n\t\tsearch2=[];\n\n\t\tdb.collection('location search').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tsearch2.push(doc.data());\n\t\t\t\tresolve(search2);\n\t\t\t})\n\t\t})\n\n\t\tconsole.log(\"HELLO\");\n\t\tconsole.log(search2[0]);\n\n\t\tsearch_sent = [];\n\t\tdb.collection('Search Sentiment').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tsearch_sent.push(doc.data());\n\t\t\t\tresolve(search_sent);\n\t\t\t})\n\t\t})\n\t\tsearch_tweets = [];\n\t\tdb.collection('Search Tweets Number').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tsearch_tweets.push(doc.data());\n\t\t\t\tresolve(search_tweets);\n\t\t\t})\n\t\t})\n\t\tsearch_retweets = [];\n\t\tdb.collection('Search Retweets Number').get().then(querySnapshot => {\n\t\t\tquerySnapshot.forEach(doc => {\n\t\t\t\tsearch_retweets.push(doc.data());\n\t\t\t\tresolve(search_retweets);\n\t\t\t})\n\t\t})\n\n\t});\n}\n\nfunction drawCloud(data, title, container){\n\tchartA = anychart.tagCloud(data);\n\tchartA.title(title)\n\tchartA.angles([0])\n\tchartA.container(container);\n\tchartA.draw();\n\treturn chartA;\n}\n\nfunction drawLine(data, title, container){\n\tvar dataTable = anychart.data.table(\"date\");\n\tdataTable.addData(data);\n\tanychart.format.inputDateTimeFormat('yyyy-MM-dd');\n\tvar mapping = dataTable.mapAs({value: \"joy\"});\n\n\tline = anychart.stock();\n\tline.plot().line(mapping);\n\tvar rangePicker = anychart.ui.rangePicker();\n\trangePicker.format('dd MM yyyy');\n\tline.title(title);\n\tline.container(container);\n\tline.draw();\n\tline.selectRange(\"ytd\");\n\treturn line;\n}\n\nfunction sleep(ms) {\n\treturn new Promise(resolve => setTimeout(resolve, ms));\n}\n\nfunction startTimer(duration, display) {\n\tconsole.log(\"HELLO\");\n\tvar timer = duration, minutes, seconds;\n\n\tvar thing = setInterval(function () {\n\n\t\tminutes = parseInt(timer / 60, 10);\n\t\tseconds = parseInt(timer % 60, 10);\n\t\tminutes = minutes < 10 ? \"0\" + minutes : minutes;\n\t\tseconds = seconds < 10 ? \"0\" + seconds : seconds;\n\t\tdisplay.textContent = minutes + \":\" + seconds;\n\n\t\tif (--timer < 0) {\n\t\t\ttimer = 0,0,0;\n\t\t\tclearInterval(thing);\n\t\t\tconsole.log(\"Starting Delay\");\n\t\t\tsleep(1000).then(() => {\n\n\t\t\t\tconsole.log(\"World!\");\n\t\t\t\tPullSearchDB().then(()=>{\n\t\t\t\t\tsleep(3000).then(() => {\n\n\t\t\t\t\t\tconsole.log(\"Delay Complete\");\n\t\t\t\t\t\tsearch20 = [];\n\t\t\t\t\t\tsearch_loc = [];\n\t\t\t\t\t\tconsole.log(search[0]);\n\t\t\t\t\t\tconsole.log(search2[0]);\n\t\t\t\t\t\tif (search.length != 0) {\n\t\t\t\t\t\t\tfor(var i = 0; i < Object.keys(search[0]).length ; i++){\n\t\t\t\t\t\t\t\tsearch20.push({\"x\": search[0][i].x, \"value\": search[0][i].value});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (search2.length != 0) {\n\t\t\t\t\t\t\tfor(var i = 0; i < Object.keys(search2[0]).length; i++){\n\t\t\t\t\t\t\t\tsearch_loc.push({\"x\": search2[0][i].x, \"value\": search2[0][i].value});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tchart3.dispose();\n\t\t\t\t\t\tchart4.dispose();\n\t\t\t\t\t\tconsole.log(\"Charts Disposed.\");\n\t\t\t\t\t\tchart3 = drawCloud(search20, '20 Most Common SEARCH', 'SearchCloudA');\n\t\t\t\t\t\tconsole.log(\"Half way there\");\n\t\t\t\t\t\tchart4 = drawCloud(search_loc, 'Locations SEARCH', 'SearchCloudB');\n\t\t\t\t\t\tconsole.log(\"Drawing Attempted.\");\n\t\t\t\t\t\t\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t} , 1000);\n}\n\nfunction timer_search(){\n\tconsole.log(\"Search Pressed.\");\n\tvar time = document.getElementById(\"id_number\").value * 60;\n\tconsole.log(time);\n\tdisplay = document.querySelector('#timedisplayer');\n\tstartTimer(time, display);\n}\n\n\ngetQ();\n\nPullfromDB().then(function() {\n\tconsole.log(\"Drawing function\");\n\tanychart.onDocumentReady(function() {\n\n\t\t// displayNamesSearch(search_sent[0].Mood);\n\t\tvar map = anychart.map();\n\t\tvar dataSet = anychart.data.set(ds);\n\t\tvar tweets = dataSet.mapAs({name: 'Name', lat: 'Latitude', long: 'Longitude', size: 'Tweets' });\n\t\tvar series1 = map.bubble(tweets);\n\t\tvar retweets = dataSet.mapAs({name: 'Name', lat: 'Latitude', long: 'Longitude', size: 'Retweets' });\n\t\tvar series2 = map.bubble(retweets);\n\t\tmap.minBubbleSize(\".5%\");\n\t\tmap.maxBubbleSize(\"5%\");\n\t\tmap.unboundRegions().fill('#C4D5E5')\n\t\tmap.unboundRegions().stroke('#C4D5E5');\n\n\t\tmap.geoData(anychart.maps['united_kingdom']);\n\t\t//Credits NEED LICENSE KEY\n\t\t//map.credits().enabled(false);\n\t\tvar zoomController = anychart.ui.zoom();\n\t\tzoomController.render(map);\n\t\tmap.container('Map_Container');\n\t\tmap.tooltip(true);\n\t\tseries1.tooltip().enabled(false);\n\t\tseries2.tooltip().format(\"Tweets: {%Tweets} \\nRetweets: {%Retweets} \\nMood: {%Mood}\");\n\n\t\tmap.draw();\n\n\t\t//Line Graph Code draw to CloudC_Container\n\t\tvar dataTable = anychart.data.table(\"date\");\n\t\tdataTable.addData(leeds_joy);\n\t\tanychart.format.inputDateTimeFormat('yyyy-MM-dd');\n\t\tvar mapping = dataTable.mapAs({value: \"joy\"});\n\n\t\tline = anychart.stock();\n\t\tline.plot().line(mapping);\n\t\tvar rangePicker = anychart.ui.rangePicker();\n\t\trangePicker.format('dd MM yyyy');\n\t\tline.title(\"Trend in Happiness Default\");\n\t\tline.container(\"CloudC_Container\");\n\t\tline.draw();\n\t\tline.selectRange(\"ytd\");\n\n\n\t\t//WordCloud Draw to CloudA_Container and CloudB_Container\n\t\tvar data1;\n\t\tvar data2;\n\t\tvar chart1;\n\t\tvar chart2;\n\n\t\tibm20 = [];\n\t\tibm_loc = [];\n\t\tfor(var i = 0; i < Object.keys(ibm[0]).length; i++){\n\t\t\tibm20.push({\"x\": ibm[0][i].x, \"value\": ibm[0][i].value});\n\t\t}\n\t\tdata1 = ibm20;\n\t\tfor(var i = 0; i < Object.keys(ibm2[0]).length; i++){\n\t\t\tibm_loc.push({\"x\": ibm2[0][i].x, \"value\": ibm2[0][i].value});\n\t\t}\n\t\tdata2 = ibm_loc;\n\n\t\tchart1 = anychart.tagCloud(data1);\n\t\tchart2 = anychart.tagCloud(data2);\n\t\tchart1.title('20 Most Common Words from Tweets')\n\t\tchart2.title('Location Word Cloud')\n\t\tchart1.angles([0])\n\t\tchart2.angles([0])\n\t\tchart1.container(\"CloudA_Container\");\n\t\tchart2.container(\"CloudB_Container\");\n\t\tchart1.draw();\n\t\tchart2.draw();\n\n\n\t\tmap.listen(\"dblClick\", function(e2) {\n\n\t\t\tif(words==1){\n\t\t\t\tchart1.dispose();\n\t\t\t\tibm20 = [];\n\t\t\t\tfor(var i = 0; i < 20; i++){\n\t\t\t\t\tibm20.push({\"x\": ibm[0][i].x, \"value\": ibm[0][i].value});\n\t\t\t\t}\n\t\t\t\tdata1 = ibm20;\n\t\t\t\tchart1 = anychart.tagCloud(data1);\n\t\t\t\tchart1.angles([0])\n\t\t\t\tchart1.container(\"CloudA_Container\");\n\t\t\t\tchart1.background().fill(\"transparent\");\n\t\t\t\tchart1.draw();\n\t\t\t}\n\t\t\tif(words==2){\n\t\t\t\tchart2.dispose();\n\t\t\t\tibm_loc = [];\n\t\t\t\tfor(var i = 0; i < Object.keys(ibm2[0]).length; i++){\n\t\t\t\t\tibm_loc.push({\"x\": ibm2[0][i].x, \"value\": ibm2[0][i].value});\n\t\t\t\t}\n\t\t\t\tdata2 = ibm_loc;\n\t\t\t\tchart2 = anychart.tagCloud(data2);\n\t\t\t\tchart2.angles([0])\n\t\t\t\tchart2.container(\"CloudB_Container\");\n\t\t\t\tchart2.background().fill(\"transparent\");\n\t\t\t\tchart2.draw();\n\t\t\t}\n\t\t\tif(words==3){\n\t\t\t\tline.dispose();\n\t\t\t\tvar dataTable = anychart.data.table(\"date\");\n\t\t\t\tdataTable.addData(ibm_joy);\n\t\t\t\tanychart.format.inputDateTimeFormat('yyyy-MM-dd');\n\t\t\t\tvar mapping = dataTable.mapAs({value: \"joy\"});\n\t\t\t\tline = anychart.stock();\n\t\t\t\tline.plot().line(mapping);\n\t\t\t\tvar rangePicker = anychart.ui.rangePicker();\n\t\t\t\trangePicker.format('dd MM yyyy');\n\t\t\t\tline.title(\"Trend in Happiness Default\");\n\t\t\t\tline.container(\"CloudC_Container\");\n\t\t\t\tline.draw();\n\t\t\t\tline.selectRange(\"ytd\");\n\t\t\t}\n\n\t\t\tdisplayNames('Select a University', -1, 0, 0);\n\n\t\t});\n\n\t\tmap.bubble(tweets).listen(\"Click\", function(e) {\n\t\t\tgetQ();\n\t\t\tvar dsarray_index = e.pointIndex;\n\t\t\tconsole.log(ds[dsarray_index].Name);\n\t\t\tdisplayNames(ds[dsarray_index].Name, ds[dsarray_index].Mood, ds[dsarray_index].Tweets, ds[dsarray_index].Retweets);\n\t\t\tswitch(ds[dsarray_index].Name){\n\n\t\t\t\tcase \"Imperial College London\":\n\t\t\t\t\ticl20 = [];\n\t\t\t\t\ticl_loc = [];\n\t\t\t\t\tfor(var i = 0; i < Object.keys(icl[0]).length; i++){\n\t\t\t\t\t\t\ticl20.push({\"x\": icl[0][i].x, \"value\": icl[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tfor(var i = 0; i < Object.keys(icl2[0]).length; i++){\n\t\t\t\t\t\t\ticl_loc.push({\"x\": icl2[0][i].x, \"value\": icl2[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tdata1 = icl20;\n\t\t\t\t\tconsole.log(data1);\n\t\t\t\t\tdata2 = icl_loc;\n\t\t\t\t\tconsole.log(data2);\n\t\t\t\t\tdataTable.addData(icl_joy);\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"University of Oxford\":\n\t\t\t\t\tox20 = [];\n\t\t\t\t\tox_loc = [];\n\t\t\t\t\tfor(var i = 0; i < Object.keys(ox[0]).length; i++){\n\t\t\t\t\t\t\tox20.push({\"x\": ox[0][i].x, \"value\": ox[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tfor(var i = 0; i < Object.keys(ox2[0]).length; i++){\n\t\t\t\t\t\t\tox_loc.push({\"x\": ox2[0][i].x, \"value\": ox2[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tdata1 = ox20;\n\t\t\t\t\tconsole.log(ox20);\n\t\t\t\t\tdata2 = ox_loc;\n\t\t\t\t\tconsole.log(ox_loc);\n\t\t\t\t\tdataTable.addData(ox_joy);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"University of Birmingham\":\n\t\t\t\t\tbham20 = [];\n\t\t\t\t\tbham_loc = [];\n\t\t\t\t\tfor(var i = 0; i < Object.keys(bham[0]).length; i++){\n\t\t\t\t\t\t\tbham20.push({\"x\": bham[0][i].x, \"value\": bham[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tfor(var i = 0; i < Object.keys(bham2[0]).length; i++){\n\t\t\t\t\t\t\tbham_loc.push({\"x\": bham2[0][i].x, \"value\": bham2[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tdata1 = bham20;\n\t\t\t\t\tdata2 = bham_loc;\n\n\t\t\t\t\tdataTable.addData(bham_joy);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"University of Bristol\":\n\t\t\t\t\tbristol20 = [];\n\t\t\t\t\tbristol_loc = [];\n\t\t\t\t\tfor(var i = 0; i < Object.keys(bristol[0]).length; i++){\n\t\t\t\t\t\t\tbristol20.push({\"x\": bristol[0][i].x, \"value\": bristol[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tfor(var i = 0; i < Object.keys(bristol2[0]).length; i++){\n\t\t\t\t\t\t\tbristol_loc.push({\"x\": bristol2[0][i].x, \"value\": bristol2[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tdata1 = bristol20;\n\t\t\t\t\tdata2 = bristol_loc;\n\n\t\t\t\t\tdataTable.addData(bristol_joy);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"University of Cardiff\":\n\t\t\t\t\tcardiff20 = [];\n\t\t\t\t\tcardiff_loc = [];\n\t\t\t\t\tfor(var i = 0; i < Object.keys(cardiff[0]).length; i++){\n\t\t\t\t\t\t\tcardiff20.push({\"x\": cardiff[0][i].x, \"value\": cardiff[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tfor(var i = 0; i < Object.keys(cardiff2[0]).length; i++){\n\t\t\t\t\t\t\tcardiff_loc.push({\"x\": cardiff2[0][i].x, \"value\": cardiff2[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tdata1 = cardiff20;\n\t\t\t\t\tdata2 = cardiff_loc;\n\n\t\t\t\t\tdataTable.addData(cardiff_joy);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"University of Durham\":\n\t\t\t\t\tdurham20 = [];\n\t\t\t\t\tdurham_loc = [];\n\t\t\t\t\tfor(var i = 0; i < Object.keys(durham[0]).length; i++){\n\t\t\t\t\t\t\tdurham20.push({\"x\": durham[0][i].x, \"value\": durham[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tfor(var i = 0; i < Object.keys(durham2[0]).length; i++){\n\t\t\t\t\t\t\tdurham_loc.push({\"x\": durham2[0][i].x, \"value\": durham2[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tdata1 = durham20;\n\t\t\t\t\tdata2 = durham_loc;\n\n\t\t\t\t\tdataTable.addData(durham_joy);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"University of Edinburgh\":\n\t\t\t\t\tedin20 = [];\n\t\t\t\t\tedin_loc = [];\n\t\t\t\t\tfor(var i = 0; i < Object.keys(edin[0]).length; i++){\n\t\t\t\t\t\t\tedin20.push({\"x\": edin[0][i].x, \"value\": edin[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tfor(var i = 0; i < Object.keys(edin2[0]).length; i++){\n\t\t\t\t\t\t\tedin_loc.push({\"x\": edin2[0][i].x, \"value\": edin2[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tdata1 = edin20;\n\t\t\t\t\tdata2 = edin_loc;\n\n\t\t\t\t\tdataTable.addData(edin_joy);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"University of Exeter\":\n\t\t\t\t\tex20 = [];\n\t\t\t\t\tex_loc = [];\n\t\t\t\t\tfor(var i = 0; i < Object.keys(ex[0]).length; i++){\n\t\t\t\t\t\t\tex20.push({\"x\": ex[0][i].x, \"value\": ex[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tfor(var i = 0; i < Object.keys(ex2[0]).length; i++){\n\t\t\t\t\t\t\tex_loc.push({\"x\": ex2[0][i].x, \"value\": ex2[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tdata1 = ex20;\n\t\t\t\t\tdata2 = ex_loc;\n\n\t\t\t\t\tdataTable.addData(ex_joy);\n\t\t\t\t\tbreak;\n\n\n\t\t\t\tcase \"University of Glasgow\":\n\t\t\t\t\tglas20 = [];\n\t\t\t\t\tglas_loc = [];\n\t\t\t\t\tfor(var i = 0; i < Object.keys(glas[0]).length; i++){\n\t\t\t\t\t\t\tglas20.push({\"x\": glas[0][i].x, \"value\": glas[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tfor(var i = 0; i < Object.keys(glas2[0]).length; i++){\n\t\t\t\t\t\t\tglas_loc.push({\"x\": glas2[0][i].x, \"value\": glas2[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tdata1 = glas20;\n\t\t\t\t\tdata2 = glas_loc;\n\n\t\t\t\t\tdataTable.addData(glas_joy);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"King's College London\":\n\t\t\t\t\tkcl20 = [];\n\t\t\t\t\tkcl_loc = [];\n\t\t\t\t\tfor(var i = 0; i < Object.keys(kcl[0]).length; i++){\n\t\t\t\t\t\t\tkcl20.push({\"x\": kcl[0][i].x, \"value\": kcl[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tfor(var i = 0; i < Object.keys(kcl2[0]).length; i++){\n\t\t\t\t\t\t\tkcl_loc.push({\"x\": kcl2[0][i].x, \"value\": kcl2[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tdata1 = kcl20;\n\t\t\t\t\tdata2 = kcl_loc;\n\n\t\t\t\t\tdataTable.addData(kcl_joy);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"University College London\":\n\t\t\t\t\tucl20 = [];\n\t\t\t\t\tucl_loc = [];\n\t\t\t\t\tfor(var i = 0; i < Object.keys(ucl[0]).length; i++){\n\t\t\t\t\t\t\tucl20.push({\"x\": ucl[0][i].x, \"value\": ucl[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tfor(var i = 0; i < Object.keys(ucl2[0]).length; i++){\n\t\t\t\t\t\t\tucl_loc.push({\"x\": ucl2[0][i].x, \"value\": ucl2[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tdata1 = ucl20;\n\t\t\t\t\tdata2 = ucl_loc;\n\n\t\t\t\t\tdataTable.addData(ucl_joy);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"University of Leeds\":\n\t\t\t\t\tleeds20 = [];\n\t\t\t\t\tleeds_loc = [];\n\t\t\t\t\tfor(var i = 0; i < Object.keys(leeds[0]).length; i++){\n\t\t\t\t\t\t\tleeds20.push({\"x\": leeds[0][i].x, \"value\": leeds[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tfor(var i = 0; i < Object.keys(leeds2[0]).length; i++){\n\t\t\t\t\t\t\tleeds_loc.push({\"x\": leeds2[0][i].x, \"value\": leeds2[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tdata1 = leeds20;\n\t\t\t\t\tdata2 = leeds_loc;\n\n\t\t\t\t\tdataTable.addData(leeds_joy);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"University of Liverpool\":\n\t\t\t\t\tliv20 = [];\n\t\t\t\t\tliv_loc = [];\n\t\t\t\t\tfor(var i = 0; i < Object.keys(liv[0]).length; i++){\n\t\t\t\t\t\t\tliv20.push({\"x\": liv[0][i].x, \"value\": liv[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tfor(var i = 0; i < Object.keys(liv2[0]).length; i++){\n\t\t\t\t\t\t\tliv_loc.push({\"x\": liv2[0][i].x, \"value\": liv2[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tdata1 = liv20;\n\t\t\t\t\tdata2 = liv_loc;\n\n\t\t\t\t\tdataTable.addData(liv_joy);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"London School of Economics\":\n\t\t\t\t\tlse20 = [];\n\t\t\t\t\tlse_loc = [];\n\t\t\t\t\tfor(var i = 0; i < Object.keys(lse[0]).length; i++){\n\t\t\t\t\t\t\tlse20.push({\"x\": lse[0][i].x, \"value\": lse[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tfor(var i = 0; i < Object.keys(lse2[0]).length; i++){\n\t\t\t\t\t\t\tlse_loc.push({\"x\": lse2[0][i].x, \"value\": lse2[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tdata1 = lse20;\n\t\t\t\t\tdata2 = lse_loc;\n\n\t\t\t\t\tdataTable.addData(lse_joy);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"University of Manchester\":\n\t\t\t\t\tman20 = [];\n\t\t\t\t\tman_loc = [];\n\t\t\t\t\tfor(var i = 0; i < Object.keys(man[0]).length; i++){\n\t\t\t\t\t\t\tman20.push({\"x\": man[0][i].x, \"value\": man[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tfor(var i = 0; i < Object.keys(man2[0]).length; i++){\n\t\t\t\t\t\t\tman_loc.push({\"x\": man2[0][i].x, \"value\": man2[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tdata1 = man20;\n\t\t\t\t\tdata2 = man_loc;\n\n\t\t\t\t\tdataTable.addData(man_joy);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"University of Sheffield\":\n\t\t\t\t\tshef20 = [];\n\t\t\t\t\tshef_loc = [];\n\t\t\t\t\tfor(var i = 0; i < Object.keys(shef[0]).length; i++){\n\t\t\t\t\t\t\tshef20.push({\"x\": shef[0][i].x, \"value\": shef[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tfor(var i = 0; i < Object.keys(shef2[0]).length; i++){\n\t\t\t\t\t\t\tshef_loc.push({\"x\": shef2[0][i].x, \"value\": shef2[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tdata1 = shef20;\n\t\t\t\t\tdata2 = shef_loc;\n\n\t\t\t\t\tdataTable.addData(shef_joy);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"University of Cambridge\":\n\t\t\t\t\tcamb20 = [];\n\t\t\t\t\tcamb_loc = [];\n\t\t\t\t\tfor(var i = 0; i < Object.keys(camb [0]).length; i++){\n\t\t\t\t\t\t\tcamb20.push({\"x\": camb[0][i].x, \"value\": camb[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconsole.log(camb);\n\t\t\t\t\tfor(var i = 0; i < Object.keys(camb2[0]).length; i++){\n\t\t\t\t\t\t\tcamb_loc.push({\"x\": camb2[0][i].x, \"value\": camb2[0][i].value});\n\t\t\t\t\t\t}\n\t\t\t\t\tdata1 = camb20;\n\t\t\t\t\tdata2 = camb_loc;\n\n\t\t\t\t\tdataTable.addData(camb_joy);\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\n\t\t\t}\n\n\n\t\t\t// if(words==1){\n\t\t\t\tchart1.dispose();\n\t\t\t\tchart1 = anychart.tagCloud(data1);\n\t\t\t\tchart1.title('20 Most Common Words from Tweets');\n\t\t\t\tchart1.angles([0]);\n\t\t\t\tchart1.container(\"CloudA_Container\");\n\t\t\t\t// chart1.background().fill(\"transparent\");\n\t\t\t\tchart1.draw();\n\t\t\t// }\n\t\t\t// if(words==2){\n\t\t\t\tchart2.dispose();\n\t\t\t\tchart2 = anychart.tagCloud(data2);\n\t\t\t\tchart2.title('Locations Mentioned in Tweets: ');\n\t\t\t\tchart2.angles([0]);\n\t\t\t\tchart2.container(\"CloudB_Container\");\n\t\t\t\t// chart2.background().fill(\"transparent\");\n\t\t\t\tchart2.draw();\n\t\t\t// }\n\t\t\t// if(words==3){\n\t\t\t\tline.dispose();\n\t\t\t\tanychart.format.inputDateTimeFormat('yyyy-MM-dd');\n\t\t\t\tvar mapping = dataTable.mapAs({value: \"joy\"});\n\t\t\t\tline = anychart.stock();\n\t\t\t\tline.plot().line(mapping);\n\t\t\t\tvar rangePicker = anychart.ui.rangePicker();\n\t\t\t\trangePicker.format('dd MM yyyy');\n\t\t\t\tline.title(\"Trend in Happiness\");\n\t\t\t\tline.container(\"CloudC_Container\");\n\t\t\t\tline.draw();\n\t\t\t\tline.selectRange(\"ytd\");\n\t\t\t// }\n\t\t});\n\n\t\tsearch20 = [];\n\t\tsearch_loc = [];\n\t\tif(search.length != 0){\n\t\t\tfor(var i = 0; i < Object.keys(search[0]).length ; i++){\n\t\t\t\tsearch20.push({\"x\": search[0][i].x, \"value\": search[0][i].value});\n\t\t\t}\n\t\t}\n\t\tif(search2.length != 0){\n\t\t\tfor(var i = 0; i < Object.keys(search2[0]).length; i++){\n\t\t\t\tsearch_loc.push({\"x\": search2[0][i].x, \"value\": search2[0][i].value});\n\t\t\t}\n\t\t}\n\t\tif(search_tweets != 0 || search_retweets != 0){\n\t\t\t\tdisplayNamesSearch(search_sent[0].Mood, search_tweets, search_retweets);\n\t\t\t\t// chart3 = drawCloud(search20, '20 Most Common Words from Tweets', 'SearchCloudA');\n\t\t\t\t// chart4 = drawCloud(search_loc, 'Location Word Cloud', \"SearchCloudB\");\n\t\t\t\tdata3 = search20;\n\t\t\t\tdata4 = search_loc;\n\t\t\t\tchart3 = anychart.tagCloud(data3);\n\t\t\t\tchart4 = anychart.tagCloud(data4);\n\t\t\t\tchart3.title('20 Most Common Words from Tweets')\n\t\t\t\tchart4.title('Location Word Cloud')\n\t\t\t\tchart3.angles([0])\n\t\t\t\tchart4.angles([0])\n\t\t\t\tchart3.container(\"SearchCloudA\");\n\t\t\t\tchart4.container(\"SearchCloudB\");\n\t\t\t\tchart3.draw();\n\t\t\t\tchart4.draw();\n\t\t}\n\n\t});\n});\n\n\n</script>\n\n</body>\n</html>\n","output":"str","x":1070,"y":580,"wires":[[]]},{"id":"54dff13a.5d9668","type":"function","z":"105a4573.6dbd83","name":"","func":"if(msg.payload == 0){\n    msg.payload = \"\";\n    return msg; \n}\nreturn;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1675,"y":800,"wires":[["1cb4294a.d830cf"]],"l":false},{"id":"88652f5f.c5fc78","type":"function","z":"105a4573.6dbd83","name":"","func":"if(msg.payload == 0){\n    msg.payload = \"\";\n    return msg; \n}\nreturn;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2275,"y":800,"wires":[["2a1af15b.4aa796"]],"l":false}]